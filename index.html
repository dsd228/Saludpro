
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SaludPro v7.0 - Inteligencia Cl√≠nica Avanzada</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Material+Symbols+Outlined" rel="stylesheet">
  <style>
    :root {
      --primary-blue: #1a73e8;
      --primary-blue-darker: #0d47a1;
      --primary-blue-lighter: #e8f0fe;
      --success-green: #34a853;
      --warning-yellow: #f9ab00;
      --alert-red: #ea4335;
      --accent-teal: #00897b;
      --accent-purple: #7b1fa2;
      --background-light: #f8f9fa;
      --background-dark: #1e1e1e;
      --text-dark: #202124;
      --text-light: #ffffff;
      --text-muted: #5f6368;
      --border-radius: 8px;
      --shadow-small: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
      --shadow-medium: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23);
      --shadow-large: 0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23);
      --shadow-xl: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
      --transition-fast: all 0.2s ease-in-out;
      --transition-slow: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --z-modal: 1000;
      --status-success: #34a853;
      --status-warning: #f9ab00;
      --status-error: #ea4335;
      --status-info: #1a73e8;
      --font-size-base: 16px;
      --font-family: 'Roboto', sans-serif;
    }

    .theme-dark {
      --background-light: #1e1e1e;
      --background-dark: #121212;
      --text-dark: #e0e0e0;
      --text-muted: #b0b0b0;
      --primary-blue-lighter: #1a237e;
    }

    body {
      font-family: var(--font-family);
      margin: 0;
      background-color: var(--background-light);
      color: var(--text-dark);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      line-height: 1.6;
      transition: var(--transition-slow);
      font-size: var(--font-size-base);
    }

    h1, h2, h3, h4, h5, h6 {
      margin: 0 0 15px 0;
      color: var(--text-dark);
      font-weight: 500;
    }

    h1 { font-size: 2.5em; }
    h2 { font-size: 2em; }
    h3 { font-size: 1.7em; }
    h4 { font-size: 1.5em; }
    h5 { font-size: 1.2em; }
    h6 { font-size: 1em; }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      background-color: var(--primary-blue);
      color: white;
      padding: 15px 0;
      box-shadow: var(--shadow-medium);
      position: sticky;
      top: 0;
      z-index: 1000;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto;
      padding: 0 20px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.5em;
      font-weight: 700;
    }

    .logo span {
      color: var(--warning-yellow);
    }

    nav ul {
      display: flex;
      list-style: none;
      gap: 20px;
      margin: 0;
      padding: 0;
    }

    nav ul li a {
      color: white;
      text-decoration: none;
      padding: 8px 12px;
      border-radius: var(--border-radius);
      transition: var(--transition-fast);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    nav ul li a:hover {
      background-color: rgba(255, 255, 255, 0.2);
    }

    nav ul li a.active {
      background-color: rgba(255, 255, 255, 0.3);
      font-weight: 500;
    }

    main {
      flex-grow: 1;
      padding: 20px 0;
    }

    .page {
      display: none;
      padding: 20px;
      background-color: white;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-medium);
      margin-top: 20px;
      animation: fadeIn 0.5s ease-out;
      min-height: 500px;
    }

    .page.active {
      display: block;
    }

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }

    .page-header h2 {
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--primary-blue);
    }

    .breadcrumbs {
      display: flex;
      gap: 5px;
      margin-bottom: 10px;
      font-size: 0.9em;
      color: var(--text-muted);
    }

    .breadcrumbs span {
      color: var(--text-dark);
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: var(--border-radius);
      font-size: 1em;
      cursor: pointer;
      transition: var(--transition-fast);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background-color: var(--primary-blue);
      color: white;
    }

    .btn-primary:hover {
      background-color: var(--primary-blue-darker);
    }

    .btn-secondary {
      background-color: var(--text-muted);
      color: white;
    }

    .btn-secondary:hover {
      background-color: #777;
    }

    .btn-warning {
      background-color: var(--warning-yellow);
      color: var(--text-dark);
    }

    .btn-warning:hover {
      background-color: #f09300;
    }

    .btn-danger {
      background-color: var(--alert-red);
      color: white;
    }

    .btn-danger:hover {
      background-color: #d32f2f;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: var(--text-dark);
    }

    .form-control {
      width: 100%;
      padding: 10px 15px;
      border: 1px solid #ccc;
      border-radius: var(--border-radius);
      font-size: 1em;
      transition: var(--transition-fast);
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
    }

    .form-row {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .form-row .form-group {
      flex: 1;
      min-width: 200px;
    }

    .card {
      background-color: white;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-small);
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid #eee;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }

    .card-title {
      margin: 0;
      color: var(--primary-blue);
      font-size: 1.3em;
      font-weight: 500;
    }

    .tabs {
      display: flex;
      border-bottom: 1px solid #eee;
      margin-bottom: 20px;
    }

    .tab {
      padding: 10px 20px;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: var(--transition-fast);
      font-weight: 500;
      color: var(--text-muted);
    }

    .tab.active {
      border-bottom-color: var(--primary-blue);
      color: var(--primary-blue);
      font-weight: 600;
    }

    .tab:hover {
      color: var(--primary-blue);
      background-color: rgba(26, 115, 232, 0.05);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Consultorio Virtual */
    .consultorio-container {
      background-color: var(--background-light);
      border-radius: var(--border-radius);
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: var(--shadow-medium);
    }

    .search-box {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }

    .search-box input {
      flex-grow: 1;
      padding: 12px 15px;
      border-radius: var(--border-radius);
      border: 1px solid #ccc;
      font-size: 1em;
      transition: var(--transition-fast);
    }

    .search-box input:focus {
      outline: none;
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
    }

    .search-box button {
      padding: 12px 20px;
      background-color: var(--primary-blue);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-size: 1em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .search-box button:hover {
      background-color: var(--primary-blue-darker);
    }

    .suggestions {
      position: absolute;
      background: white;
      border: 1px solid #ddd;
      border-radius: var(--border-radius);
      max-height: 200px;
      overflow-y: auto;
      width: 100%;
      box-shadow: var(--shadow-large);
      z-index: 1000;
      margin-top: 1px;
    }

    .suggestion-item {
      padding: 10px 15px;
      cursor: pointer;
      border-bottom: 1px solid #eee;
      transition: var(--transition-fast);
    }

    .suggestion-item:hover {
      background-color: #f5f5f5;
    }

    .suggestion-item:last-child {
      border-bottom: none;
    }

    .highlight {
      background-color: #fffacd;
      font-weight: bold;
    }

    .diagnostic-result {
      padding: 15px;
      border-radius: var(--border-radius);
      margin-bottom: 15px;
      background-color: white;
      border: 1px solid #eee;
      box-shadow: var(--shadow-small);
    }

    .diagnostic-result h4 {
      margin: 0 0 10px 0;
      color: var(--text-dark);
    }

    .progress-bar {
      width: 100%;
      height: 10px;
      background-color: #eee;
      border-radius: 5px;
      overflow: hidden;
      margin: 10px 0;
    }

    .progress {
      height: 100%;
      background-color: var(--primary-blue);
      border-radius: 5px;
      transition: width 0.5s ease;
    }

    .severity-high {
      color: var(--alert-red);
      font-weight: 600;
    }

    .severity-moderate {
      color: var(--warning-yellow);
      font-weight: 600;
    }

    .severity-low {
      color: var(--status-success);
      font-weight: 600;
    }

    .alert-card {
      display: flex;
      align-items: center;
      background-color: var(--warning-yellow);
      color: var(--text-dark);
      padding: 15px;
      border-radius: var(--border-radius);
      margin-bottom: 20px;
      box-shadow: var(--shadow-medium);
      border-left: 5px solid var(--alert-red);
    }

    .alert-card.info {
      background-color: #e3f2fd;
      border-left-color: var(--primary-blue);
    }

    .alert-card.success {
      background-color: #e8f5e8;
      border-left-color: var(--status-success);
    }

    .alert-icon {
      font-size: 2em;
      margin-right: 15px;
    }

    .recommendation {
      background-color: #f8f9fa;
      border-left: 4px solid var(--primary-blue);
      padding: 10px 15px;
      margin: 10px 0;
      border-radius: 0 4px 4px 0;
    }

    /* Calendario */
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 1px;
      background-color: #eee;
      border-radius: var(--border-radius);
      overflow: hidden;
      margin-bottom: 20px;
    }

    .calendar-header {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      background-color: var(--primary-blue);
      color: white;
      text-align: center;
      font-weight: 500;
    }

    .calendar-header div {
      padding: 10px;
    }

    .calendar-day {
      background-color: white;
      padding: 10px;
      min-height: 100px;
      position: relative;
    }

    .day-number {
      font-weight: 500;
      margin-bottom: 5px;
    }

    .appointment {
      background-color: var(--primary-blue);
      color: white;
      padding: 5px;
      border-radius: 4px;
      font-size: 0.8em;
      margin-bottom: 3px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .waiting-room {
      background-color: white;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-medium);
      overflow: hidden;
    }

    .waiting-room table {
      width: 100%;
      border-collapse: collapse;
    }

    .waiting-room th {
      background-color: var(--primary-blue);
      color: white;
      text-align: left;
      padding: 15px;
    }

    .waiting-room td {
      padding: 12px 15px;
      border-bottom: 1px solid #eee;
    }

    .waiting-time.high {
      color: var(--alert-red);
      font-weight: 600;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: var(--z-modal);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background-color: white;
      border-radius: var(--border-radius);
      width: 90%;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
      animation: slideIn 0.4s ease-out forwards;
      position: relative;
      border: 1px solid rgba(0,0,0,0.1);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #eee;
      padding: 15px 20px;
    }

    .modal-header h2 {
      margin: 0;
      color: var(--text-dark);
      font-size: 1.5em;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .modal-close-btn {
      background: none;
      border: none;
      font-size: 1.5em;
      color: #888;
      cursor: pointer;
      transition: var(--transition-fast);
    }

    .modal-close-btn:hover {
      color: var(--alert-red);
    }

    .modal-body {
      padding: 20px;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      padding: 15px 20px;
      border-top: 1px solid #eee;
      background-color: #f5f5f5;
      border-radius: 0 0 var(--border-radius) var(--border-radius);
    }

    @keyframes slideIn {
      from {
        transform: translateY(-50px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    /* Notificaciones */
    .notification-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .notification {
      padding: 15px 20px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-medium);
      display: flex;
      align-items: center;
      gap: 10px;
      color: white;
      min-width: 300px;
      animation: slideInRight 0.3s ease-out;
    }

    .notification.success {
      background-color: var(--status-success);
    }

    .notification.warning {
      background-color: var(--warning-yellow);
      color: var(--text-dark);
    }

    .notification.error {
      background-color: var(--status-error);
    }

    .notification.info {
      background-color: var(--primary-blue);
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        gap: 15px;
        text-align: center;
      }

      nav ul {
        flex-wrap: wrap;
        justify-content: center;
      }

      .form-row {
        flex-direction: column;
      }

      .form-row .form-group {
          min-width: 100%;
      }

      .calendar {
        grid-template-columns: repeat(1, 1fr);
      }

      .calendar-header {
        display: none;
      }

      .modal {
        width: 95%;
        margin: 10px;
      }
    }

    /* Cargadores */
    .loader {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid var(--primary-blue);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Accesibilidad */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0,0,0,0);
      white-space: nowrap;
      border: 0;
    }

    button, input, select, textarea {
      font-family: var(--font-family);
    }

    *:focus {
      outline: 2px solid var(--primary-blue);
      outline-offset: 2px;
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <div class="logo">
        <span class="material-symbols-outlined">medical_information</span>
        Salud<span>Pro</span> v7.0
      </div>
      <nav>
        <ul>
          <li><a href="#" class="active" onclick="navigateTo('dashboard')"><span class="material-symbols-outlined">dashboard</span>Dashboard</a></li>
          <li><a href="#" onclick="navigateTo('consultorio')"><span class="material-symbols-outlined">healing</span>Consultorio</a></li>
          <li><a href="#" onclick="navigateTo('appointments')"><span class="material-symbols-outlined">event</span>Citas</a></li>
          <li><a href="#" onclick="navigateTo('pharmacy')"><span class="material-symbols-outlined">local_pharmacy</span>Farmacia</a></li>
          <li><a href="#" onclick="toggleTheme()"><span class="material-symbols-outlined">dark_mode</span>Tema</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- Dashboard -->
    <section id="dashboard" class="page active">
      <div class="page-header">
        <h2><span class="material-symbols-outlined">dashboard</span>Dashboard</h2>
        <div>
          <span class="material-symbols-outlined">calendar_today</span>
          <span id="current-date">12 de abril de 2025</span>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h3 class="card-title"><span class="material-symbols-outlined">groups</span>Pacientes Recientes</h3>
          <button class="btn btn-primary" onclick="navigateTo('consultorio')">
            <span class="material-symbols-outlined">add</span>Nuevo Paciente
          </button>
        </div>
        <div class="patient-list">
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="background-color: #f5f5f5; border-bottom: 2px solid #eee;">
                <th style="padding: 12px; text-align: left;">Nombre</th>
                <th style="padding: 12px; text-align: left;">Edad</th>
                <th style="padding: 12px; text-align: left;">Diagn√≥stico</th>
                <th style="padding: 12px; text-align: left;">Acciones</th>
              </tr>
            </thead>
            <tbody id="patient-list-body">
              <!-- Se llenar√° con JavaScript -->
            </tbody>
          </table>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h3 class="card-title"><span class="material-symbols-outlined">event</span>Pr√≥ximas Citas</h3>
        </div>
        <div id="upcoming-appointments">
          <!-- Se llenar√° con JavaScript -->
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h3 class="card-title"><span class="material-symbols-outlined">warning</span>Alertas Cl√≠nicas</h3>
        </div>
        <div id="clinical-alerts">
          <!-- Se llenar√° con JavaScript -->
        </div>
      </div>
    </section>

    <!-- Consultorio Virtual -->
    <section id="consultorio" class="page">
      <div class="page-header">
        <div class="breadcrumbs">
          <span>Dashboard</span> > <span>Consultorio</span>
        </div>
        <h2><span class="material-symbols-outlined">healing</span>Consultorio Virtual</h2>
        <button class="btn btn-secondary" onclick="navigateTo('dashboard')">
          <span class="material-symbols-outlined">arrow_back</span>Volver
        </button>
      </div>

      <div class="consultorio-container">
        <div class="search-box">
          <input type="text" id="patient-search" placeholder="Buscar paciente..." oninput="searchPatients()">
          <button onclick="openPatientSearchModal()"><span class="material-symbols-outlined">search</span>Buscar</button>
        </div>

        <div id="active-patient-info" style="margin-bottom: 20px; padding: 15px; background-color: #e3f2fd; border-radius: var(--border-radius); display: none;">
          <h3 id="active-patient-name"></h3>
          <p><strong>Edad:</strong> <span id="active-patient-age"></span> | <strong>Diagn√≥stico:</strong> <span id="active-patient-diagnosis"></span></p>
          <p><strong>Genotipo:</strong> <span id="active-patient-genotype"></span> | <strong>Riesgo CV:</strong> <span id="active-patient-risk"></span></p>
        </div>

        <div class="tabs">
          <div class="tab active" onclick="switchTab('diagnosis')">Diagn√≥stico Diferencial</div>
          <div class="tab" onclick="switchTab('vitals')">Signos Vitales</div>
          <div class="tab" onclick="switchTab('prescriptions')">Recetas</div>
          <div class="tab" onclick="switchTab('orders')">√ìrdenes</div>
          <div class="tab" onclick="switchTab('history')">Historia Cl√≠nica</div>
        </div>

        <div id="diagnosis-tab" class="tab-content active">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title"><span class="material-symbols-outlined">psychology</span>Asistente de Diagn√≥stico Diferencial</h3>
            </div>
            <div class="form-group">
              <label for="symptoms">S√≠ntomas (separados por comas)</label>
              <input type="text" id="symptoms" class="form-control" placeholder="cefalea, fiebre, rigidez de nuca...">
            </div>
            <div class="form-group">
              <label for="lab-results">Resultados de Laboratorio</label>
              <textarea id="lab-results" class="form-control" rows="3" placeholder="LCR: turbio, neutr√≥filos elevados..."></textarea>
            </div>
            <button class="btn btn-primary" onclick="runDiagnosticAI()">
              <span class="material-symbols-outlined">auto_fix_high</span>Analizar Diagn√≥stico
            </button>
            <div id="diagnostic-results" style="margin-top: 20px;">
              <!-- Resultados del diagn√≥stico -->
            </div>
          </div>
        </div>

        <div id="vitals-tab" class="tab-content">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title"><span class="material-symbols-outlined">monitor_heart</span>Signos Vitales</h3>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="temperature">Temperatura (¬∞C)</label>
                <input type="number" id="temperature" class="form-control" step="0.1" placeholder="36.5">
              </div>
              <div class="form-group">
                <label for="pa">Presi√≥n Arterial</label>
                <input type="text" id="pa" class="form-control" placeholder="120/80">
              </div>
              <div class="form-group">
                <label for="fc">Frecuencia Card√≠aca</label>
                <input type="number" id="fc" class="form-control" placeholder="75">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="fr">Frecuencia Respiratoria</label>
                <input type="number" id="fr" class="form-control" placeholder="16">
              </div>
              <div class="form-group">
                <label for="spo2">Saturaci√≥n O2 (%)</label>
                <input type="number" id="spo2" class="form-control" placeholder="98">
              </div>
              <div class="form-group">
                <label for="weight">Peso (kg)</label>
                <input type="number" id="weight" class="form-control" step="0.1" placeholder="70">
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="height">Talla (cm)</label>
                <input type="number" id="height" class="form-control" placeholder="170">
              </div>
              <div class="form-group">
                <label for="imc">IMC</label>
                <input type="text" id="imc" class="form-control" readonly>
              </div>
            </div>
            <button class="btn btn-primary" onclick="saveVitalSigns()">
              <span class="material-symbols-outlined">save</span>Guardar Signos Vitales
            </button>
          </div>
        </div>

        <div id="prescriptions-tab" class="tab-content">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title"><span class="material-symbols-outlined">prescriptions</span>Recetas</h3>
            </div>
            <div id="medication-entries">
              <div class="medication-entry">
                <div class="form-row">
                  <div class="form-group flex-grow">
                    <label for="medication-1">Medicamento</label>
                    <input type="text" id="medication-1" class="form-control medication-name" placeholder="Nombre del medicamento">
                  </div>
                  <div class="form-group">
                    <label for="dose-1">Dosis</label>
                    <input type="text" id="dose-1" class="form-control" placeholder="10mg">
                  </div>
                  <div class="form-group">
                    <label for="frequency-1">Frecuencia</label>
                    <select id="frequency-1" class="form-control">
                      <option value="once">1 vez al d√≠a</option>
                      <option value="twice">2 veces al d√≠a</option>
                      <option value="thrice">3 veces al d√≠a</option>
                      <option value="four-times">4 veces al d√≠a</option>
                      <option value="as-needed">Seg√∫n necesidad</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label for="duration-1">Duraci√≥n</label>
                    <input type="text" id="duration-1" class="form-control" placeholder="7 d√≠as">
                  </div>
                </div>
                <div class="form-group">
                  <label for="instructions-1">Instrucciones</label>
                  <input type="text" id="instructions-1" class="form-control" placeholder="Tomar con alimentos...">
                </div>
              </div>
            </div>
            <button class="btn btn-secondary" id="add-medication" onclick="addMedicationEntry()">
              <span class="material-symbols-outlined">add</span>Agregar Medicamento
            </button>
            <button class="btn btn-primary" style="margin-top: 10px;" onclick="checkInteractions()">
              <span class="material-symbols-outlined">warning</span>Verificar Interacciones
            </button>
            <div id="interactions-warning" style="margin-top: 15px; display: none;">
              <div class="alert-card">
                <span class="material-symbols-outlined alert-icon">warning</span>
                <div>
                  <strong>Interacciones Detectadas:</strong>
                  <ul id="interactions-list"></ul>
                </div>
              </div>
            </div>
            <button class="btn btn-primary" style="margin-top: 15px;" onclick="savePrescription()">
              <span class="material-symbols-outlined">save</span>Guardar Receta
            </button>
          </div>
        </div>

        <div id="orders-tab" class="tab-content">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title"><span class="material-symbols-outlined">receipt_long</span>√ìrdenes M√©dicas</h3>
            </div>
            <div class="form-group">
              <label for="order-type">Tipo de Orden</label>
              <select id="order-type" class="form-control" onchange="updateOrderOptions()">
                <option value="">Seleccionar tipo...</option>
                <option value="laboratory">Laboratorio</option>
                <option value="imaging">Imagenolog√≠a</option>
                <option value="consultation">Interconsulta</option>
              </select>
            </div>
            <div class="form-group" id="order-options-container">
              <!-- Opciones din√°micas seg√∫n el tipo -->
            </div>
            <button class="btn btn-primary" onclick="createMedicalOrder()">
              <span class="material-symbols-outlined">add</span>Crear Orden
            </button>
            <div id="orders-list" style="margin-top: 20px;">
              <!-- Lista de √≥rdenes -->
            </div>
          </div>
        </div>

        <div id="history-tab" class="tab-content">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title"><span class="material-symbols-outlined">history</span>Historia Cl√≠nica</h3>
            </div>
            <div id="patient-history">
              <!-- Se llenar√° con JavaScript -->
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Citas -->
    <section id="appointments" class="page">
      <div class="page-header">
        <h2><span class="material-symbols-outlined">event</span>Gesti√≥n de Citas</h2>
        <button class="btn btn-secondary" onclick="navigateTo('dashboard')">
          <span class="material-symbols-outlined">arrow_back</span>Volver
        </button>
      </div>

      <div class="card">
        <div class="card-header">
          <h3 class="card-title"><span class="material-symbols-outlined">event_available</span>Nueva Cita</h3>
        </div>
        <div class="form-row">
          <div class="form-group flex-grow">
            <label for="appointment-patient">Paciente</label>
            <select id="appointment-patient" class="form-control">
              <option value="">Seleccionar paciente...</option>
              <!-- Se llenar√° con JavaScript -->
            </select>
          </div>
          <div class="form-group">
            <label for="appointment-date">Fecha</label>
            <input type="date" id="appointment-date" class="form-control">
          </div>
          <div class="form-group">
            <label for="appointment-time">Hora</label>
            <input type="time" id="appointment-time" class="form-control">
          </div>
        </div>
        <div class="form-group">
          <label for="appointment-reason">Motivo</label>
          <input type="text" id="appointment-reason" class="form-control" placeholder="Consulta de seguimiento...">
        </div>
        <button class="btn btn-primary" onclick="createAppointment()">
          <span class="material-symbols-outlined">add</span>Programar Cita
        </button>
      </div>

      <div class="card">
        <div class="card-header">
          <h3 class="card-title"><span class="material-symbols-outlined">calendar_month</span>Calendario de Citas</h3>
        </div>
        <div class="calendar">
          <div class="calendar-header">
            <div>Lun</div>
            <div>Mar</div>
            <div>Mi√©</div>
            <div>Jue</div>
            <div>Vie</div>
            <div>S√°b</div>
            <div>Dom</div>
          </div>
          <div class="calendar-day">
            <div class="day-number">1</div>
            <div class="appointment">10:00 - Mar√≠a L√≥pez</div>
          </div>
          <div class="calendar-day">
            <div class="day-number">2</div>
            <div class="appointment">14:00 - Carlos Ruiz</div>
          </div>
          <div class="calendar-day">
            <div class="day-number">3</div>
          </div>
          <div class="calendar-day">
            <div class="day-number">4</div>
          </div>
          <div class="calendar-day">
            <div class="day-number">5</div>
            <div class="appointment">09:00 - Ana Garc√≠a</div>
            <div class="appointment">15:00 - Luis P√©rez</div>
          </div>
          <div class="calendar-day">
            <div class="day-number">6</div>
          </div>
          <div class="calendar-day">
            <div class="day-number">7</div>
          </div>
          <div class="calendar-day">
            <div class="day-number">8</div>
          </div>
          <div class="calendar-day">
            <div class="day-number">9</div>
          </div>
          <div class="calendar-day">
            <div class="day-number">10</div>
          </div>
          <div class="calendar-day">
            <div class="day-number">11</div>
          </div>
          <div class="calendar-day">
            <div class="day-number">12</div>
            <div class="appointment">11:00 - Roberto S√°nchez</div>
          </div>
          <div class="calendar-day">
            <div class="day-number">13</div>
          </div>
          <div class="calendar-day">
            <div class="day-number">14</div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="card-header">
          <h3 class="card-title"><span class="material-symbols-outlined">groups</span>Sala de Espera</h3>
        </div>
        <div class="waiting-room">
          <table>
            <thead>
              <tr>
                <th>Paciente</th>
                <th>M√©dico</th>
                <th>Hora de llegada</th>
                <th>Tiempo de espera</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Mar√≠a L√≥pez</td>
                <td>Dr. P√©rez</td>
                <td>10:15</td>
                <td class="waiting-time high">45 min</td>
              </tr>
              <tr>
                <td>Carlos Ruiz</td>
                <td>Dr. Fern√°ndez</td>
                <td>10:30</td>
                <td class="waiting-time">30 min</td>
              </tr>
              <tr>
                <td>Ana Garc√≠a</td>
                <td>Dr. P√©rez</td>
                <td>10:45</td>
                <td class="waiting-time">15 min</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Farmacia -->
    <section id="pharmacy" class="page">
      <div class="page-header">
        <h2><span class="material-symbols-outlined">local_pharmacy</span>Farmacia</h2>
        <button class="btn btn-secondary" onclick="navigateTo('dashboard')">
          <span class="material-symbols-outlined">arrow_back</span>Volver
        </button>
      </div>

      <div class="card">
        <div class="card-header">
          <h3 class="card-title"><span class="material-symbols-outlined">inventory</span>Stock de Medicamentos</h3>
        </div>
        <table style="width: 100%; border-collapse: collapse;">
          <thead>
            <tr style="background-color: #f5f5f5; border-bottom: 2px solid #eee;">
              <th style="padding: 12px; text-align: left;">Medicamento</th>
              <th style="padding: 12px; text-align: left;">Laboratorio</th>
              <th style="padding: 12px; text-align: left;">Cantidad</th>
              <th style="padding: 12px; text-align: left;">Estado</th>
            </tr>
          </thead>
          <tbody id="pharmacy-stock-body">
            <!-- Se llenar√° con JavaScript -->
          </tbody>
        </table>
      </div>

      <div class="card">
        <div class="card-header">
          <h3 class="card-title"><span class="material-symbols-outlined">receipt_long</span>√ìrdenes de Laboratorio</h3>
        </div>
        <div id="lab-orders-list">
          <div class="alert-card info">
            <span class="material-symbols-outlined alert-icon">info</span>
            <div>
              <strong>√ìrdenes Pendientes:</strong> Hemograma, Creatinina, Perfil Lip√≠dico
            </div>
          </div>
          <div class="alert-card success">
            <span class="material-symbols-outlined alert-icon">check_circle</span>
            <div>
              <strong>Resultados Disponibles:</strong> Glucosa en Ayunas - 98 mg/dL
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Modal de b√∫squeda de pacientes -->
  <div id="modal-overlay" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h2><span class="material-symbols-outlined">search</span>Buscar Paciente</h2>
        <button class="modal-close-btn" onclick="closeModal()">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <input type="text" id="modal-search" class="form-control" placeholder="Buscar por nombre..." oninput="filterModalPatients()">
        </div>
        <div id="modal-patient-list">
          <!-- Lista de pacientes en el modal -->
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
      </div>
    </div>
  </div>

  <!-- Contenedor de notificaciones -->
  <div class="notification-container" id="notification-container">
    <!-- Las notificaciones se agregar√°n aqu√≠ din√°micamente -->
  </div>

  <script>
    // Base de datos simulada con estructuras FHIR-like
    const DATA_STORE = {
      patients: [
        {
          id: "urn:uuid:patient-001",
          resourceType: "Patient",
          nombre: "Mar√≠a L√≥pez",
          edad: 45,
          diagnosticoPrincipal: "Meningitis Bacteriana",
          especialidad: "Neurolog√≠a",
          riesgoCardiovascular: "alto",
          alergias: ["Penicilina"],
          genotipo: "CYP2D6_metabolizador_lento",
          historiaClinica: {
            resumen: "Paciente femenina de 45 a√±os con meningitis bacteriana aguda.",
            diagnosticos: [
              { fecha: "2025-04-10", cie10: "G00.9", descripcion: "Meningitis Bacteriana", estado: "Activo" },
              { fecha: "2024-03-15", cie10: "E11.9", descripcion: "Diabetes Mellitus Tipo 2", estado: "Cr√≥nico" }
            ],
            tratamientos: [
              { fechaInicio: "2025-04-10", medicamento: "Ceftriaxona", dosis: "2g IV cada 12h", duracion: "14 d√≠as" },
              { fechaInicio: "2025-04-10", medicamento: "Dexametasona", dosis: "10mg IV cada 6h", duracion: "4 d√≠as" }
            ],
            evolucion: [
              { fecha: "2025-04-10", nota: "Ingreso con cefalea intensa, fiebre y rigidez de nuca. Sospecha de meningitis." },
              { fecha: "2025-04-11", nota: "Punci√≥n lumbar realizada. LCR turbio, neutr√≥filos elevados. Iniciado tratamiento emp√≠rico." }
            ],
            signosVitales: [
              { fecha: "2025-04-10", temperatura: 39.2, pa: "150/95", fc: 110, fr: 22, spo2: 94 },
              { fecha: "2025-04-11", temperatura: 38.1, pa: "140/85", fc: 95, fr: 18, spo2: 96 }
            ],
            laboratorio: [],
            seguimiento: [
              { tipo: "Control de LCR", cada: "7 d√≠as", proximo: "2025-04-17" },
              { tipo: "Hemograma", cada: "3 d√≠as", proximo: "2025-04-14" }
            ]
          }
        },
        {
          id: "urn:uuid:patient-002",
          resourceType: "Patient",
          nombre: "Carlos Mart√≠nez",
          edad: 38,
          diagnosticoPrincipal: "Diabetes Mellitus Tipo 2",
          especialidad: "Endocrinolog√≠a",
          riesgoCardiovascular: "moderado",
          alergias: [],
          genotipo: "CYP2C9_normal",
          historiaClinica: {
            resumen: "Paciente masculino de 38 a√±os con DM2 diagnosticado hace 5 a√±os.",
            diagnosticos: [
              { fecha: "2020-05-10", cie10: "E11.9", descripcion: "Diabetes Mellitus Tipo 2", estado: "Cr√≥nico" },
              { fecha: "2022-11-03", cie10: "I25.10", descripcion: "Enfermedad Arterial Coronaria", estado: "Cr√≥nico" }
            ],
            tratamientos: [
              { fechaInicio: "2020-05-10", medicamento: "Metformina", dosis: "1000mg cada 12h", duracion: "Continuo" },
              { fechaInicio: "2022-11-03", medicamento: "Aspirina", dosis: "100mg cada 24h", duracion: "Continuo" },
              { fechaInicio: "2023-02-15", medicamento: "Glibenclamida", dosis: "5mg cada 24h", duracion: "Continuo" }
            ],
            evolucion: [
              { fecha: "2020-05-10", nota: "Diagn√≥stico de DM2. Iniciado tratamiento con Metformina." },
              { fecha: "2023-02-15", nota: "HbA1c 8.5%. Se agrega Glibenclamida." },
              { fecha: "2023-08-20", nota: "Angioplastia coronaria por angina inestable. Iniciado tratamiento con Aspirina." }
            ],
            signosVitales: [
              { fecha: "2023-02-10", temperatura: 36.6, pa: "140/90", fc: 78, fr: 16, spo2: 97, peso: 85, talla: 1.75, imc: 27.8 },
              { fecha: "2023-05-15", temperatura: 36.5, pa: "135/85", fc: 76, fr: 15, spo2: 98, peso: 83, talla: 1.75, imc: 27.1 },
              { fecha: "2023-08-20", temperatura: 36.7, pa: "130/80", fc: 74, fr: 15, spo2: 99, peso: 82, talla: 1.75, imc: 26.8 }
            ],
            laboratorio: [
              { fecha: "2023-02-10", test: "HbA1c", resultado: "8.5%", normal: "4.0-5.6%" },
              { fecha: "2023-05-15", test: "HbA1c", resultado: "7.8%", normal: "4.0-5.6%" },
              { fecha: "2023-08-20", test: "HbA1c", resultado: "7.2%", normal: "4.0-5.6%" }
            ],
            seguimiento: [
              { tipo: "HbA1c", cada: "3 meses", proximo: "2025-07-15" },
              { tipo: "Perfil Lip√≠dico", cada: "6 meses", proximo: "2025-10-20" }
            ]
          }
        },
        {
          id: "urn:uuid:patient-003",
          resourceType: "Patient",
          nombre: "Roberto S√°nchez",
          edad: 67,
          diagnosticoPrincipal: "Insuficiencia Card√≠aca",
          especialidad: "Cardiolog√≠a",
          riesgoCardiovascular: "alto",
          alergias: ["Ioduro"],
          genotipo: "CYP2C19_normal",
          historiaClinica: {
            resumen: "Paciente masculino de 67 a√±os con IC por miocardiopat√≠a isqu√©mica.",
            diagnosticos: [
              { fecha: "2020-01-15", cie10: "I50.9", descripcion: "Insuficiencia Card√≠aca", estado: "Cr√≥nico" },
              { fecha: "2018-06-20", cie10: "I25.10", descripcion: "Enfermedad Arterial Coronaria", estado: "Cr√≥nico" }
            ],
            tratamientos: [
              { fechaInicio: "2020-01-15", medicamento: "Furosemida", dosis: "40mg cada 24h", duracion: "Continuo" },
              { fechaInicio: "2020-01-15", medicamento: "Carvedilol", dosis: "25mg cada 12h", duracion: "Continuo" },
              { fechaInicio: "2020-01-15", medicamento: "Losart√°n", dosis: "50mg cada 24h", duracion: "Continuo" },
              { fechaInicio: "2020-01-15", medicamento: "Digoxina", dosis: "0.125mg cada 24h", duracion: "Continuo" }
            ],
            evolucion: [
              { fecha: "2020-01-15", nota: "Diagn√≥stico de IC por miocardiopat√≠a isqu√©mica. Clase funcional III NYHA." },
              { fecha: "2021-06-18", nota: "Optimizado tratamiento. Clase funcional II NYHA." },
              { fecha: "2023-03-22", nota: "Estable con tratamiento actual. Control de peso y PA adecuado." }
            ],
            signosVitales: [
              { fecha: "2023-02-08", temperatura: 36.5, pa: "125/80", fc: 68, fr: 16, spo2: 96, peso: 78, talla: 1.72, imc: 26.4 },
              { fecha: "2023-05-11", temperatura: 36.6, pa: "122/78", fc: 66, fr: 15, spo2: 97, peso: 77, talla: 1.72, imc: 26.0 },
              { fecha: "2023-08-15", temperatura: 36.4, pa: "120/75", fc: 65, fr: 15, spo2: 98, peso: 77, talla: 1.72, imc: 26.0 }
            ],
            laboratorio: [
              { fecha: "2023-02-08", test: "BNP", resultado: "850 pg/mL", normal: "<100 pg/mL" },
              { fecha: "2023-05-11", test: "BNP", resultado: "620 pg/mL", normal: "<100 pg/mL" },
              { fecha: "2023-08-15", test: "BNP", resultado: "580 pg/mL", normal: "<100 pg/mL" }
            ],
            seguimiento: [
              { tipo: "Control de peso", cada: "semanal", proximo: "2025-04-19" },
              { tipo: "Ecocardiograma", cada: "12 meses", proximo: "2026-03-15" }
            ]
          }
        }
      ],
      appointments: [
        { id: "app-001", pacienteId: "urn:uuid:patient-001", fecha: "2025-04-12", hora: "10:00", motivo: "Consulta de seguimiento", estado: "confirmada", medico: "Dr. P√©rez" },
        { id: "app-002", pacienteId: "urn:uuid:patient-002", fecha: "2025-04-12", hora: "14:00", motivo: "Control de glucemia", estado: "pendiente", medico: "Dr. G√≥mez" },
        { id: "app-003", pacienteId: "urn:uuid:patient-003", fecha: "2025-04-12", hora: "11:00", motivo: "Evaluaci√≥n cardiol√≥gica", estado: "confirmada", medico: "Dr. Fern√°ndez" }
      ],
      medicalOrders: [],
      pharmacyStock: [
        { id: "med-001", nombre: "Metformina", laboratorio: "Gen√©rico", cantidad: 120, umbral: 50 },
        { id: "med-002", nombre: "Losart√°n", laboratorio: "MSD", cantidad: 30, umbral: 50 },
        { id: "med-003", nombre: "Aspirina", laboratorio: "Bayer", cantidad: 8, umbral: 20 },
        { id: "med-004", nombre: "Ceftriaxona", laboratorio: "Roche", cantidad: 50, umbral: 10 },
        { id: "med-005", nombre: "Dexametasona", laboratorio: "Merck", cantidad: 100, umbral: 25 }
      ],
      staff: [
        { id: 1, nombre: "Juan P√©rez", especialidad: "Cardiolog√≠a", rol: "M√©dico", citas: 12 },
        { id: 2, nombre: "Ana Mart√≠nez", especialidad: "Enfermer√≠a", rol: "Enfermera", citas: 8 },
        { id: 3, nombre: "Carlos G√≥mez", especialidad: "Administraci√≥n", rol: "Administrador", citas: 0 },
        { id: 4, nombre: "Luc√≠a Fern√°ndez", especialidad: "Pediatr√≠a", rol: "M√©dico", citas: 15 }
      ]
    };

    // Base de conocimiento m√©dico con estructuras LOINC/SNOMED
    const medicalKnowledgeBase = {
      diseases: [
        {
          id: "urn:snomed:74400008",
          nombre: "Esclerosis M√∫ltiple",
          codigoCIE10: "G35",
          etiologia: "Enfermedad autoinmune donde el sistema inmunol√≥gico ataca la mielina, la cubierta protectora de los nervios, en el sistema nervioso central.",
          fisiopatologia: "La inflamaci√≥n autoinmune conduce a la desmielinizaci√≥n de las fibras nerviosas, lo que interrumpe la transmisi√≥n de se√±ales nerviosas entre el cerebro y otras partes del cuerpo.",
          prevalencia: 0.0003,
          factoresRiesgo: ["edad: 20-50", "g√©nero: F > M", "antecedentes familiares", "deficiencia de vitamina D"],
          diagnostico: "Basado en criterios de McDonald, que requieren evidencia de lesiones en diferentes partes del sistema nervioso central (diseminaci√≥n en el espacio) y en diferentes momentos (diseminaci√≥n en el tiempo), generalmente confirmadas por resonancia magn√©tica (RM) y estudios del l√≠quido cefalorraqu√≠deo.",
          diagnosticosDiferenciales: ["Neuromielitis √≥ptica", "S√≠ndrome de Guillain-Barr√©", "Enfermedad de Lyme", "Tumores del sistema nervioso central", "Deficiencia de vitamina B12"],
          clasificacion: "Forma recurrente-remitente (RRMS), progresiva primaria (PPMS), progresiva secundaria (SPMS), progresiva activa, progresiva no activa.",
          tratamientos: ["Interfer√≥n beta (reduce la frecuencia de brotes)", "Glatiramer acetato", "Terapias de c√©lulas B (Ocrelizumab)", "Inmunosupresores (Mitoxantrona)", "Terapias para s√≠ntomas espec√≠ficos (fatiga, espasmos, depresi√≥n)"],
          protocolos: ["Gu√≠a de pr√°ctica cl√≠nica de la Asociaci√≥n Americana de Esclerosis M√∫ltiple"],
          pronostico: "Variable. La mayor√≠a de los pacientes tienen una esperanza de vida cercana a la normal, pero con discapacidad progresiva. El curso depende del tipo y de la respuesta al tratamiento.",
          educacionPaciente: "La esclerosis m√∫ltiple es una condici√≥n cr√≥nica del sistema nervioso. Aunque no tiene cura, hay tratamientos que pueden ralentizar su progreso y manejar los s√≠ntomas.",
          recursosAdicionales: ["https://www.nationalmssociety.org/", "https://www.msif.org/"],
          imagenes: [
            { url: "https://placehold.co/400x300/1a73e8/ffffff?text=RM+Esclerosis+M√∫ltiple", descripcion: "Lesiones desmielinizantes en la resonancia magn√©tica cerebral" },
            { url: "https://placehold.co/400x300/34a853/ffffff?text=Marcha+en+EM", descripcion: "Paciente con esclerosis m√∫ltiple mostrando dificultad de marcha" }
          ]
        },
        {
          id: "urn:snomed:32277002",
          nombre: "Meningitis Bacteriana",
          codigoCIE10: "G00.9",
          etiologia: "Infecci√≥n bacteriana del sistema nervioso central, com√∫nmente causada por Streptococcus pneumoniae, Neisseria meningitidis o Haemophilus influenzae tipo b.",
          fisiopatologia: "Las bacterias ingresan al sistema nervioso central, provocando inflamaci√≥n de las meninges (membranas que rodean el cerebro y la m√©dula espinal), lo que aumenta la presi√≥n intracraneal y puede da√±ar el tejido cerebral.",
          prevalencia: 0.00001,
          factoresRiesgo: ["edad: ni√±os, ancianos", "inmunosupresi√≥n", "trauma craneal", "otitis media", "sinusitis"],
          presentacionClinica: ["Cefalea intensa", "Fotofobia (sensibilidad a la luz)", "Fiebre alta", "Rigidez de nuca", "N√°useas y v√≥mites", "Confusi√≥n mental", "Convulsiones"],
          diagnostico: "Diagn√≥stico definitivo mediante punci√≥n lumbar y an√°lisis del l√≠quido cefalorraqu√≠deo (LCR): elevaci√≥n de c√©lulas (predominio de neutr√≥filos), prote√≠nas elevadas, glucosa baja. Cultivo del LCR para identificar el pat√≥geno.",
          diagnosticosDiferenciales: ["Meningitis viral", "Encefalitis", "Absceso cerebral", "Hemorragia subaracnoidea", "Sepsis"],
          clasificacion: "Aguda (progresi√≥n r√°pida) o subaguda (progresi√≥n m√°s lenta).",
          tratamientos: ["Ceftriaxona 2g IV cada 12h", "Vancomicina 15mg/kg IV cada 12h", "Dexametasona 10mg IV cada 6h", "Soporte vital"],
          protocolos: ["Gu√≠a IDSA para meningitis bacteriana", "Protocolo de manejo de meningitis en adultos"],
          pronostico: "Grave. Mortalidad del 10-30% incluso con tratamiento. Secuelas neurol√≥gicas en 20-50% de los sobrevivientes.",
          educacionPaciente: "La meningitis bacteriana es una emergencia m√©dica grave. Requiere hospitalizaci√≥n inmediata y tratamiento con antibi√≥ticos intravenosos.",
          recursosAdicionales: ["https://www.cdc.gov/meningitis/index.html"],
          imagenes: [
            { url: "https://placehold.co/400x300/ea4335/ffffff?text=RM+Meningitis", descripcion: "Resonancia magn√©tica cerebral en meningitis" },
            { url: "https://placehold.co/400x300/f9ab00/ffffff?text=Punci√≥n+Lumbar", descripcion: "Procedimiento de punci√≥n lumbar" }
          ]
        },
        {
          id: "urn:snomed:44054006",
          nombre: "Diabetes Mellitus Tipo 2",
          codigoCIE10: "E11.9",
          etiologia: "Resistencia a la insulina combinada con una deficiencia relativa de insulina. Factores de riesgo: obesidad, sedentarismo, antecedentes familiares, edad avanzada.",
          fisiopatologia: "Las c√©lulas del cuerpo no responden adecuadamente a la insulina (resistencia), lo que lleva a una producci√≥n inadecuada de insulina por parte del p√°ncreas, resultando en hiperglucemia cr√≥nica.",
          prevalencia: 0.1,
          factoresRiesgo: ["obesidad", "sedentarismo", "antecedentes familiares", "edad > 45", "hipertensi√≥n", "dislipidemia"],
          presentacionClinica: ["Poliuria", "Polidipsia", "Polidipsia", "P√©rdida de peso inexplicada", "Fatiga", "Visi√≥n borrosa", "Infecciones recurrentes"],
          diagnostico: "Diagn√≥stico basado en niveles de glucosa: ayunas ‚â•126 mg/dL, HbA1c ‚â•6.5%, o glucosa al azar ‚â•200 mg/dL con s√≠ntomas.",
          diagnosticosDiferenciales: ["Diabetes Mellitus Tipo 1", "Diabetes secundaria", "S√≠ndrome de Cushing", "Feocromocitoma"],
          clasificacion: "Por gravedad del control gluc√©mico, presencia de complicaciones micro/macrovasculares.",
          tratamientos: ["Modificaci√≥n del estilo de vida (dieta, ejercicio)", "Metformina (primera l√≠nea)", "Sulfonilureas", "Inhibidores de DPP-4", "An√°logos del GLP-1", "Insulina (en etapas avanzadas)"],
          protocolos: ["Gu√≠as de la Asociaci√≥n Americana de Diabetes (ADA)"],
          pronostico: "Cr√≥nica progresiva. Buen control gluc√©mico reduce significativamente el riesgo de complicaciones como nefropat√≠a, retinopat√≠a, neuropat√≠a y enfermedad cardiovascular.",
          educacionPaciente: "La diabetes tipo 2 se puede manejar con dieta, ejercicio y medicamentos. Es crucial controlar la glucosa para prevenir complicaciones.",
          recursosAdicionales: ["https://www.diabetes.org/"],
          imagenes: [
            { url: "https://placehold.co/400x300/34a853/ffffff?text=Glucosa+en+Sangre", descripcion: "Monitoreo de glucosa en sangre" },
            { url: "https://placehold.co/400x300/1a73e8/ffffff?text=Complicaciones+Diabetes", descripcion: "Complicaciones cr√≥nicas de la diabetes" }
          ]
        },
        {
          id: "urn:snomed:59621000",
          nombre: "Enfermedad de Parkinson",
          codigoCIE10: "G20",
          etiologia: "Trastorno neurodegenerativo caracterizado por la p√©rdida progresiva de neuronas dopamin√©rgicas en la sustancia negra del mesenc√©falo.",
          fisiopatologia: "La deficiencia de dopamina en los ganglios basales interrumpe los circuitos motores, llevando a los s√≠ntomas motores caracter√≠sticos.",
          prevalencia: 0.003,
          factoresRiesgo: ["edad > 60", "g√©nero: M > F", "antecedentes familiares", "exposici√≥n a pesticidas"],
          presentacionClinica: ["Temblor de reposo (mano, pierna, mand√≠bula)", "Bradicinesia (lentitud de movimientos)", "Rigidez muscular", "Postura encorvada", "Problemas de equilibrio y marcha (falta de balanceo de brazos, arrastre de pies)", "Alteraciones del habla y escritura"],
          diagnostico: "Diagn√≥stico cl√≠nico basado en la historia y el examen f√≠sico. No hay una prueba definitiva. Criterios de diagn√≥stico de la UK Parkinson's Disease Society Brain Bank.",
          diagnosticosDiferenciales: ["Parkinsonismo secundario (por medicamentos, traumatismo)", "Par√°lisis supranuclear progresiva", "Atrofia multisist√©mica", "Temblor esencial"],
          clasificacion: "Por etapa (escala de Hoehn y Yahr), por tipo de presentaci√≥n (temblor-dominante, akin√©tico-r√≠gido).",
          tratamientos: ["Levodopa/Carbidopa (tratamiento m√°s eficaz)", "Agonistas dopamin√©rgicos (Pramipexol, Ropinirol)", "Inhibidores de la COMT (Entacapona)", "Inhibidores de la MAO-B (Selegilina)", "Terapia con ejercicio y rehabilitaci√≥n"],
          protocolos: ["Gu√≠as de pr√°ctica cl√≠nica para el manejo del Parkinson"],
          pronostico: "Progresivo. No curable, pero los tratamientos pueden controlar los s√≠ntomas durante muchos a√±os. La esperanza de vida puede reducirse ligeramente.",
          educacionPaciente: "El Parkinson es una enfermedad neurodegenerativa que afecta el movimiento. Aunque no tiene cura, hay tratamientos que pueden mejorar significativamente la calidad de vida.",
          recursosAdicionales: ["https://www.parkinson.org/"],
          imagenes: [
            { url: "https://placehold.co/400x300/ea4335/ffffff?text=RM+Parkinson", descripcion: "Resonancia magn√©tica cerebral en Parkinson" },
            { url: "https://placehold.co/400x300/f9ab00/ffffff?text=Marcha+Parkinson", descripcion: "Caracter√≠stica marcha en pacientes con Parkinson" }
          ]
        }
      ],
      medicalTests: [
        {
          id: "urn:loinc:15056-0",
          nombre: "Hemoglobina",
          indicaciones: ["Anemia", "P√©rdida de sangre", "Evaluaci√≥n general de salud"],
          interpretacion: "Valores normales: Hombres 13.8-17.2 g/dL, Mujeres 12.1-15.1 g/dL. Valores bajos indican anemia, valores altos pueden indicar policitemia."
        },
        {
          id: "urn:loinc:2075-0",
          nombre: "Creatinina",
          indicaciones: ["Evaluaci√≥n de funci√≥n renal", "Monitorizaci√≥n en pacientes con enfermedad renal cr√≥nica", "Antes de estudios con contraste"],
          interpretacion: "Valores normales: 0.7-1.3 mg/dL. Valores elevados indican disminuci√≥n de la funci√≥n renal glomerular."
        },
        {
          id: "urn:loinc:17855-8",
          nombre: "HbA1c",
          indicaciones: ["Diagn√≥stico de diabetes", "Monitorizaci√≥n del control gluc√©mico a largo plazo"],
          interpretacion: "Valores normales: <5.7%. Prediabetes: 5.7-6.4%. Diabetes: ‚â•6.5%. Refleja el promedio de glucosa en sangre en los √∫ltimos 2-3 meses."
        },
        {
          id: "urn:loinc:2885-2",
          nombre: "Perfil Lip√≠dico",
          indicaciones: ["Evaluaci√≥n de riesgo cardiovascular", "Monitorizaci√≥n en pacientes con dislipidemia"],
          interpretacion: "Incluye colesterol total, LDL, HDL y triglic√©ridos. LDL <100 mg/dL √≥ptimo, HDL >40 mg/dL (H), >50 mg/dL (M), triglic√©ridos <150 mg/dL."
        },
        {
          id: "urn:loinc:1988-5",
          nombre: "PCR (Prote√≠na C Reactiva)",
          indicaciones: ["Evaluaci√≥n de inflamaci√≥n", "Monitorizaci√≥n en enfermedades autoinmunes", "Riesgo cardiovascular"],
          interpretacion: "Valores normales: <10 mg/L. Valores elevados indican inflamaci√≥n sist√©mica. Valores >3 mg/L indican riesgo cardiovascular aumentado."
        },
        {
          id: "urn:loinc:94545-4",
          nombre: "BNP (P√©ptido Natriur√©tico B", 
          indicaciones: ["Evaluaci√≥n de insuficiencia card√≠aca", "Diferenciaci√≥n de disnea por IC vs. causa pulmonar"],
          interpretacion: "Valores normales: <100 pg/mL. Valores >400 pg/mL sugieren IC. Valores entre 100-400 pg/mL requieren evaluaci√≥n cl√≠nica adicional."
        },
        {
          id: "urn:loinc:24357-5",
          nombre: "Punci√≥n Lumbar",
          indicaciones: ["Diagn√≥stico de meningitis", "Diagn√≥stico de hemorragia subaracnoidea", "Medici√≥n de presi√≥n del LCR", "Administraci√≥n de medicamentos (quimioterapia, anestesia espinal)"],
          contraindicaciones: ["Infecci√≥n en el sitio de punci√≥n", "Trastornos de coagulaci√≥n no corregidos", "Presi√≥n intracraneal muy elevada (riesgo de herniaci√≥n)"],
          riesgos: ["Dolor de cabeza post-punci√≥n", "Infecci√≥n", "Hemorragia", "Da√±o nervioso"],
          interpretacion: "El LCR normal es claro e incoloro. En meningitis bacteriana: turbio, elevaci√≥n de c√©lulas (neutr√≥filos), prote√≠nas elevadas, glucosa baja. En meningitis viral: l√≠quido claro, linfocitos elevados, prote√≠nas levemente elevadas, glucosa normal."
        },
        {
          id: "urn:loinc:18728-5",
          nombre: "Resonancia Magn√©tica (RM) Cerebral",
          indicaciones: ["Evaluaci√≥n de tumores", "Diagn√≥stico de esclerosis m√∫ltiple", "Evaluaci√≥n de accidente cerebrovascular", "Investigaci√≥n de epilepsia", "Evaluaci√≥n de trauma craneal"],
          interpretacion: "Permite visualizar con gran detalle el tejido cerebral. Las lesiones desmielinizantes en EM aparecen como hiperintensidades en secuencias T2/FLAIR. Los tumores pueden realzarse con contraste."
        }
      ],
      treatments: [
        {
          id: "urn:rxnorm:860975",
          nombre: "Metformina",
          indicaciones: ["Diabetes Mellitus Tipo 2", "S√≠ndrome de ovario poliqu√≠stico"],
          mecanismoAccion: "Disminuye la producci√≥n de glucosa por el h√≠gado (gluconeog√©nesis) y mejora la sensibilidad a la insulina en los m√∫sculos.",
          farmacocinetica: "Biodisponibilidad del 50-60%. No se metaboliza. Se excreta inalterada por los ri√±ones.",
          efectosAdversos: ["Hipoglucemia", "N√°useas", "Malestar gastrointestinal"],
          contraindicaciones: ["Insuficiencia renal (TFG <30 ml/min)", "Acidosis metab√≥lica", "Alcoholismo cr√≥nico"],
          interacciones: {
            "Contraste yodado": { severidad: "moderada", descripcion: "Aumenta el riesgo de acidosis l√°ctica." },
            "Alcohol": { severidad: "moderada", descripcion: "Aumenta el riesgo de acidosis l√°ctica." },
            "Cimetidina": { severidad: "leve", descripcion: "Puede aumentar los niveles plasm√°ticos de metformina." }
          }
        },
        {
          id: "urn:rxnorm:64726",
          nombre: "Losart√°n",
          indicaciones: ["Hipertensi√≥n arterial", "Nefropat√≠a diab√©tica", "Insuficiencia card√≠aca"],
          mecanismoAccion: "Antagonista del receptor de angiotensina II (AT1), bloquea los efectos de la angiotensina II, causando vasodilataci√≥n y disminuci√≥n de la retenci√≥n de sodio.",
          farmacocinetica: "Biodisponibilidad del 33%. Se metaboliza a un metabolito activo. Eliminaci√≥n biliar y renal.",
          efectosAdversos: ["Hipotensi√≥n", "Hiperkalemia", "Tos", "Dolor de espalda"],
          contraindicaciones: ["Embarazo", "Hipersensibilidad", "Estenosis de arteria renal bilateral"],
          interacciones: {
            "Potasio": { severidad: "moderada", descripcion: "Aumenta el riesgo de hiperkalemia." },
            "AINEs": { severidad: "moderada", descripcion: "Pueden reducir el efecto antihipertensivo y aumentar el riesgo de nefrotoxicidad." },
            "Litio": { severidad: "moderada", descripcion: "Puede aumentar los niveles s√©ricos de litio." }
          }
        },
        {
          id: "urn:rxnorm:1597380",
          nombre: "Aspirina",
          indicaciones: ["Analgesia", "Antipir√©tico", "Antiinflamatorio", "Antiagregante plaquetario (prevenci√≥n de eventos cardiovasculares)"],
          mecanismoAccion: "Inhibidor irreversible de la ciclooxigenasa (COX-1 y COX-2), reduciendo la producci√≥n de prostaglandinas y tromboxano A2.",
          farmacocinetica: "Absorci√≥n r√°pida en el est√≥mago e intestino delgado. Metabolismo hep√°tico. Excreci√≥n renal.",
          efectosAdversos: ["Irritaci√≥n g√°strica", "Sangrado gastrointestinal", "√ölcera p√©ptica", "S√≠ndrome de Reye (en ni√±os)"],
          contraindicaciones: ["Hemorragia activa", "√ölcera p√©ptica activa", "Hipersensibilidad a AINEs", "Asma inducida por AINEs"],
          interacciones: {
            "Warfarina": { severidad: "fatal", descripcion: "Riesgo muy alto de hemorragia grave." },
            "Tolbutamida": { severidad: "moderada", descripcion: "Puede aumentar el riesgo de hipoglucemia." },
            "Metotrexato": { severidad: "moderada", descripcion: "Puede aumentar los niveles s√©ricos y toxicidad del metotrexato." }
          }
        },
        {
          id: "urn:rxnorm:387025",
          nombre: "Glibenclamida",
          indicaciones: ["Diabetes Mellitus Tipo 2"],
          mecanismoAccion: "Secretagogo de insulina. Estimula la liberaci√≥n de insulina por las c√©lulas beta del p√°ncreas.",
          farmacocinetica: "Absorci√≥n completa. Metabolismo hep√°tico extenso. Excreci√≥n renal y biliar.",
          efectosAdversos: ["Hipoglucemia", "Aumento de peso", "Reacciones cut√°neas"],
          contraindicaciones: ["Diabetes Mellitus Tipo 1", "Cetoacidosis diab√©tica", "Insuficiencia hep√°tica grave"],
          interacciones: {
            "Metformina": { severidad: "moderada", descripcion: "Aumenta el riesgo de hipoglucemia." },
            "AINEs": { severidad: "moderada", descripcion: "Pueden potenciar el efecto hipoglucemiante." },
            "Corticosteroides": { severidad: "moderada", descripcion: "Pueden antagonizar el efecto hipoglucemiante." }
          }
        },
        {
          id: "urn:rxnorm:11572",
          nombre: "Warfarina",
          indicaciones: ["Prevenci√≥n y tratamiento de trombosis venosa", "Prevenci√≥n de embolismo sist√©mico en fibrilaci√≥n auricular", "V√°lvulas card√≠acas mec√°nicas"],
          mecanismoAccion: "Antagonista de la vitamina K, inhibe la s√≠ntesis de factores de coagulaci√≥n dependientes de vitamina K (II, VII, IX, X).",
          farmacocinetica: "Absorci√≥n completa. Metabolismo hep√°tico extenso. Vida media de 20-60 horas.",
          efectosAdversos: ["Hemorragia", "Necrosis cut√°nea", "Teratogenicidad"],
          contraindicaciones: ["Embarazo", "Hemorragia activa", "√ölcera p√©ptica activa", "Trauma o cirug√≠a reciente"],
          interacciones: {
            "Aspirina": { severidad: "fatal", descripcion: "Riesgo muy alto de hemorragia grave." },
            "Antibi√≥ticos (como ciprofloxacina)": { severidad: "moderada", descripcion: "Pueden potenciar el efecto anticoagulante." },
            "Barbit√∫ricos": { severidad: "moderada", descripcion: "Pueden reducir el efecto anticoagulante." }
          }
        },
        {
          id: "urn:rxnorm:1596903",
          nombre: "Tenofovir",
          indicaciones: ["Tratamiento de VIH", "Tratamiento de hepatitis B cr√≥nica"],
          mecanismoAccion: "An√°logo nucle√≥tido que inhibe la transcriptasa inversa del VIH.",
          farmacocinetica: "Biodisponibilidad variable. Metabolismo hep√°tico. Excreci√≥n renal.",
          efectosAdversos: ["Nefrotoxicidad", "Disminuci√≥n de la densidad mineral √≥sea", "N√°useas"],
          contraindicaciones: ["Insuficiencia renal grave", "Hipersensibilidad"],
          interacciones: {
            "Didanosina": { severidad: "moderada", descripcion: "Aumenta el riesgo de toxicidad pancre√°tica y neurop√°tica." },
            "Atazanavir": { severidad: "moderada", descripcion: "Aumenta los niveles plasm√°ticos de tenofovir, aumentando el riesgo de nefrotoxicidad." }
          }
        }
      ],
      protocols: [
        {
          id: "urn:protocol:meningitis-001",
          nombre: "Manejo de Meningitis Bacteriana en Adultos",
          area: "Infectolog√≠a/Neurolog√≠a",
          descripcion: "Protocolo basado en evidencia para el diagn√≥stico y tratamiento inmediato de meningitis bacteriana.",
          pasos: [
            "1. Sospecha cl√≠nica: Cefalea intensa, fiebre, rigidez de nuca, fotofobia.",
            "2. Estudios inmediatos: Hemograma, funci√≥n renal, glucemia, cultivos de sangre.",
            "3. Im√°genes: Tomograf√≠a computarizada (TC) de cr√°neo si hay signos de herniaci√≥n o antecedente de lesi√≥n cerebral.",
            "4. Punci√≥n lumbar: Si la TC es normal o no est√° indicada, realizar punci√≥n lumbar para an√°lisis del LCR.",
            "5. Tratamiento emp√≠rico inmediato: Ceftriaxona 2g IV cada 12h + Vancomicina 15mg/kg IV cada 12h + Dexametasona 10mg IV cada 6h.",
            "6. Ajustar tratamiento seg√∫n cultivo del LCR.",
            "7. Soporte vital y monitoreo neurol√≥gico."
          ],
          referencias: ["IDSA Guidelines", "UpToDate"]
        },
        {
          id: "urn:protocol:ms-001",
          nombre: "Diagn√≥stico de Esclerosis M√∫ltiple (Criterios McDonald 2017)",
          area: "Neurolog√≠a",
          descripcion: "Criterios internacionales para el diagn√≥stico de esclerosis m√∫ltiple.",
          pasos: [
            "1. Demostrar diseminaci√≥n en el espacio (DIS): ‚â•1 lesi√≥n en al menos 2 de las 4 √°reas caracter√≠sticas del SNC (periventricular, juxtacortical, infratentorial, m√©dula espinal).",
            "2. Demostrar diseminaci√≥n en el tiempo (DIT): ‚â•1 lesi√≥n gadolinio-positiva nueva en relaci√≥n con una escaneo previo, o una nueva lesi√≥n T2 o gadolinio-positiva en un escaneo posterior.",
            "3. Excluir diagn√≥sticos alternativos m√°s probables."
          ],
          referencias: ["Lancet Neurology 2018"]
        }
      ]
    };

    // Estado de la aplicaci√≥n
    const APP_STATE = {
      activePatientId: null,
      currentSection: 'dashboard',
      theme: 'light',
      fontSize: 16,
      activeTab: 'diagnosis',
      alerts: []
    };

    // Funciones de utilidad
    function navigateTo(section) {
      document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
      });
      document.getElementById(section).classList.add('active');
      
      document.querySelectorAll('nav ul li a').forEach(link => {
        link.classList.remove('active');
      });
      document.querySelector(`nav ul li a[onclick="navigateTo('${section}')"]`).classList.add('active');
      
      APP_STATE.currentSection = section;
    }

    function switchTab(tabId) {
      document.querySelectorAll('.tab').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      document.querySelector(`.tab[onclick="switchTab('${tabId}')"]`).classList.add('active');
      document.getElementById(`${tabId}-tab`).classList.add('active');
      APP_STATE.activeTab = tabId;
      
      if (tabId === 'history' && APP_STATE.activePatientId) {
        loadPatientHistory();
      }
    }

    function toggleTheme() {
      document.body.classList.toggle('theme-dark');
      const isDark = document.body.classList.contains('theme-dark');
      APP_STATE.theme = isDark ? 'dark' : 'light';
      
      const themeButton = document.querySelector('nav ul li a[onclick="toggleTheme()"] .material-symbols-outlined');
      if (themeButton) {
        themeButton.textContent = isDark ? 'light_mode' : 'dark_mode';
      }
    }

    function showNotification(message, type = 'info') {
      const container = document.getElementById('notification-container');
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.innerHTML = `
        <span class="material-symbols-outlined">
          ${type === 'success' ? 'check_circle' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : 'info'}
        </span>
        ${message}
      `;
      
      container.appendChild(notification);
      
      setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => {
          container.removeChild(notification);
        }, 300);
      }, 5000);
    }

    // Inicializaci√≥n
    function initApp() {
      // Fecha actual
      const now = new Date();
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      document.getElementById('current-date').textContent = now.toLocaleDateString('es-ES', options);
      
      // Llenar listas
      updatePatientList();
      updateModalPatientList();
      updateAppointmentPatientSelect();
      updateUpcomingAppointments();
      updatePharmacyStock();
      checkClinicalAlerts();
      
      // Inicializar funcionalidades
      setupVitalSigns();
      setupSearchFunctionality();
    }

    function updatePatientList() {
      const tbody = document.getElementById('patient-list-body');
      if (!tbody) return;
      tbody.innerHTML = '';
      
      DATA_STORE.patients.forEach(patient => {
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${patient.nombre}</td>
          <td>${patient.edad}</td>
          <td>${patient.diagnosticoPrincipal}</td>
          <td>
            <button class="btn btn-primary" onclick="selectPatient('${patient.id}')">
              <span class="material-symbols-outlined">edit</span>Atender
            </button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    function updateModalPatientList() {
      const container = document.getElementById('modal-patient-list');
      if (!container) return;
      container.innerHTML = '';
      
      DATA_STORE.patients.forEach(patient => {
        const div = document.createElement('div');
        div.className = 'patient-card';
        div.style = 'padding: 15px; border: 1px solid #eee; border-radius: var(--border-radius); margin-bottom: 10px; background-color: white; cursor: pointer;';
        div.innerHTML = `
          <h3 style="margin: 0;">${patient.nombre}</h3>
          <p style="margin: 5px 0;">Edad: ${patient.edad} | Diagn√≥stico: ${patient.diagnosticoPrincipal}</p>
        `;
        div.onclick = function() {
          selectPatient(patient.id);
          closeModal();
        };
        container.appendChild(div);
      });
    }

    function filterModalPatients() {
      const query = document.getElementById('modal-search')?.value.toLowerCase().trim() || '';
      const container = document.getElementById('modal-patient-list');
      if (!container) return;
      container.innerHTML = '';
      
      const filtered = DATA_STORE.patients.filter(patient => 
        patient.nombre.toLowerCase().includes(query)
      );
      
      if (filtered.length === 0) {
        container.innerHTML = '<p>No se encontraron pacientes.</p>';
        return;
      }
      
      filtered.forEach(patient => {
        const div = document.createElement('div');
        div.className = 'patient-card';
        div.style = 'padding: 15px; border: 1px solid #eee; border-radius: var(--border-radius); margin-bottom: 10px; background-color: white; cursor: pointer;';
        div.innerHTML = `
          <h3 style="margin: 0;">${patient.nombre}</h3>
          <p style="margin: 5px 0;">Edad: ${patient.edad} | Diagn√≥stico: ${patient.diagnosticoPrincipal}</p>
        `;
        div.onclick = function() {
          selectPatient(patient.id);
          closeModal();
        };
        container.appendChild(div);
      });
    }

    function updateAppointmentPatientSelect() {
      const select = document.getElementById('appointment-patient');
      if (!select) return;
      select.innerHTML = '<option value="">Seleccionar paciente...</option>';
      
      DATA_STORE.patients.forEach(patient => {
        const option = document.createElement('option');
        option.value = patient.id;
        option.textContent = patient.nombre;
        select.appendChild(option);
      });
    }

    function updateUpcomingAppointments() {
      const container = document.getElementById('upcoming-appointments');
      if (!container) return;
      container.innerHTML = '';
      
      const today = new Date().toISOString().split('T')[0];
      const upcoming = DATA_STORE.appointments.filter(appt => appt.fecha >= today);
      
      if (upcoming.length === 0) {
        container.innerHTML = '<p>No hay citas programadas.</p>';
        return;
      }
      
      const ul = document.createElement('ul');
      ul.style = 'list-style: none; padding: 0;';
      
      upcoming.forEach(appt => {
        const patient = DATA_STORE.patients.find(p => p.id === appt.pacienteId);
        const li = document.createElement('li');
        li.style = 'padding: 10px; border-bottom: 1px solid #eee; margin-bottom: 5px;';
        li.innerHTML = `
          <strong>${appt.hora}</strong> - ${patient ? patient.nombre : 'Paciente desconocido'} (${appt.motivo})
        `;
        ul.appendChild(li);
      });
      
      container.appendChild(ul);
    }

    function updatePharmacyStock() {
      const tbody = document.getElementById('pharmacy-stock-body');
      if (!tbody) return;
      tbody.innerHTML = '';
      
      DATA_STORE.pharmacyStock.forEach(item => {
        let status = 'Normal';
        let color = 'green';
        
        if (item.cantidad < item.umbral * 0.5) {
          status = 'Cr√≠tico';
          color = 'red';
        } else if (item.cantidad < item.umbral) {
          status = 'Bajo';
          color = 'orange';
        }
        
        const row = document.createElement('tr');
        row.innerHTML = `
          <td>${item.nombre}</td>
          <td>${item.laboratorio}</td>
          <td>${item.cantidad}</td>
          <td><span style="color: ${color}; font-weight: 600;">${status}</span></td>
        `;
        tbody.appendChild(row);
      });
    }

    function checkClinicalAlerts() {
      const container = document.getElementById('clinical-alerts');
      if (!container) return;
      container.innerHTML = '';
      
      const alerts = [];
      
      // Alertas de bajo stock
      DATA_STORE.pharmacyStock.forEach(item => {
        if (item.cantidad < item.umbral) {
          alerts.push({
            type: 'warning',
            message: `Bajo stock de ${item.nombre}: ${item.cantidad} unidades (umbral: ${item.umbral})`
          });
        }
      });
      
      // Alertas de seguimiento
      DATA_STORE.patients.forEach(patient => {
        if (patient.historiaClinica.seguimiento) {
          patient.historiaClinica.seguimiento.forEach(seguimiento => {
            const today = new Date();
            const nextDate = new Date(seguimiento.proximo);
            const diffTime = nextDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays <= 7 && diffDays >= 0) {
              alerts.push({
                type: 'info',
                message: `Pr√≥ximo seguimiento para ${patient.nombre}: ${seguimiento.tipo} (${seguimiento.proximo})`
              });
            }
          });
        }
      });
      
      if (alerts.length === 0) {
        container.innerHTML = '<p>No hay alertas cl√≠nicas.</p>';
        return;
      }
      
      const ul = document.createElement('ul');
      ul.style = 'list-style: none; padding: 0;';
      
      alerts.forEach(alert => {
        const li = document.createElement('li');
        li.style = 'padding: 10px; border-bottom: 1px solid #eee; margin-bottom: 5px;';
        li.innerHTML = `
          <span class="material-symbols-outlined" style="color: ${alert.type === 'warning' ? 'orange' : 'blue'};">
            ${alert.type === 'warning' ? 'warning' : 'info'}
          </span>
          ${alert.message}
        `;
        ul.appendChild(li);
      });
      
      container.appendChild(ul);
    }

    function selectPatient(patientId) {
      const patient = DATA_STORE.patients.find(p => p.id === patientId);
      if (!patient) return;
      
      APP_STATE.activePatientId = patientId;
      
      // Mostrar informaci√≥n del paciente activo
      const patientInfo = document.getElementById('active-patient-info');
      if (patientInfo) {
        patientInfo.style.display = 'block';
        document.getElementById('active-patient-name').textContent = patient.nombre;
        document.getElementById('active-patient-age').textContent = `${patient.edad} a√±os`;
        document.getElementById('active-patient-diagnosis').textContent = patient.diagnosticoPrincipal;
        document.getElementById('active-patient-genotype').textContent = patient.genotipo || 'No disponible';
        document.getElementById('active-patient-risk').textContent = patient.riesgoCardiovascular;
      }
      
      // Navegar al consultorio
      navigateTo('consultorio');
      
      showNotification(`Paciente ${patient.nombre} seleccionado para consulta.`);
    }

    function openPatientSearchModal() {
      const modal = document.getElementById('modal-overlay');
      if (modal) {
        modal.classList.add('active');
        const searchInput = document.getElementById('modal-search');
        if (searchInput) {
          searchInput.value = '';
          filterModalPatients();
        }
      }
    }

    function closeModal() {
      const modal = document.getElementById('modal-overlay');
      if (modal) {
        modal.classList.remove('active');
      }
    }

    // Funcionalidades del consultorio
    function runDiagnosticAI() {
      const symptomsInput = document.getElementById('symptoms');
      const labResultsInput = document.getElementById('lab-results');
      
      if (!symptomsInput || !labResultsInput) return;
      
      const symptoms = symptomsInput.value.toLowerCase().split(',').map(s => s.trim()).filter(s => s);
      const labResults = labResultsInput.value.toLowerCase();
      
      if (symptoms.length === 0) {
        showNotification('Por favor, ingrese al menos un s√≠ntoma.', 'warning');
        return;
      }
      
      // Mostrar indicador de carga
      const resultsDiv = document.getElementById('diagnostic-results');
      if (resultsDiv) {
        resultsDiv.innerHTML = '<p><div class="loader"></div>Analizando s√≠ntomas y resultados...</p>';
      }
      
      // Simular proceso de an√°lisis
      setTimeout(() => {
        const patient = DATA_STORE.patients.find(p => p.id === APP_STATE.activePatientId);
        const results = calculateDifferentialDiagnosis(symptoms, labResults, patient);
        
        // Mostrar resultados
        if (resultsDiv) {
          resultsDiv.innerHTML = '';
          results.forEach(result => {
            const resultDiv = document.createElement('div');
            resultDiv.className = 'diagnostic-result';
            resultDiv.innerHTML = `
              <h4>${result.diagnostico}</h4>
              <small>Nivel de sospecha</small>
              <div class="progress-bar">
                <div class="progress" style="width: ${result.nivelSospecha}%"></div>
              </div>
              <small>${result.nivelSospecha}% de probabilidad</small>
              <div class="recommendation">
                <strong>Recomendaciones:</strong>
                <ul>${result.recomendaciones.map(rec => `<li>${rec}</li>`).join('')}</ul>
              </div>
            `;
            resultsDiv.appendChild(resultDiv);
          });
          
          showNotification('An√°lisis de diagn√≥stico completado.');
        }
      }, 1500);
    }

    function calculateDifferentialDiagnosis(symptoms, labResults, patient) {
      const results = [];
      
      // Para cada enfermedad en la base de conocimiento
      medicalKnowledgeBase.diseases.forEach(disease => {
        let score = 0;
        let matchedSymptoms = 0;
        
        // 1. Coincidencia de s√≠ntomas
        if (disease.presentacionClinica) {
          disease.presentacionClinica.forEach(presentacion => {
            const presentacionLower = presentacion.toLowerCase();
            symptoms.forEach(symptom => {
              if (presentacionLower.includes(symptom)) {
                matchedSymptoms++;
                score += 20; // Puntuaci√≥n por s√≠ntoma coincidente
              }
            });
          });
        }
        
        // 2. Prevalencia base
        score += (disease.prevalencia * 10000); // Escalar para hacerlo comparable
        
        // 3. Factores de riesgo del paciente
        if (disease.factoresRiesgo) {
          disease.factoresRiesgo.forEach(riskFactor => {
            if (riskFactor.includes('edad')) {
              const ageRange = riskFactor.match(/\d+/g);
              if (ageRange && patient && patient.edad >= parseInt(ageRange[0]) && patient.edad <= parseInt(ageRange[1])) {
                score += 15;
              }
            }
            if (riskFactor.includes('g√©nero') && patient && riskFactor.includes(patient.genero || 'M')) {
              score += 10;
            }
            if (patient && patient.riesgoCardiovascular === 'alto' && riskFactor.includes('hipertensi√≥n')) {
              score += 10;
            }
          });
        }
        
        // 4. Resultados de laboratorio
        if (labResults.includes('lc') && disease.nombre.toLowerCase().includes('meningitis')) {
          score += 30;
        }
        if (labResults.includes('glucosa') && labResults.includes('alta') && disease.nombre.toLowerCase().includes('diabetes')) {
          score += 25;
        }
        
        // 5. Comorbilidades del paciente
        if (patient && patient.historiaClinica.diagnosticos) {
          patient.historiaClinica.diagnosticos.forEach(diag => {
            if (diag.descripcion.toLowerCase().includes('diabetes') && disease.nombre.toLowerCase().includes('nefropat√≠a')) {
              score += 20;
            }
            if (diag.descripcion.toLowerCase().includes('card√≠aco') && disease.nombre.toLowerCase().includes('insuficiencia')) {
              score += 18;
            }
          });
        }
        
        // Calcular porcentaje (normalizar entre 0-100)
        const maxPossibleScore = 100;
        const nivelSospecha = Math.min(100, Math.round((score / maxPossibleScore) * 100));
        
        if (nivelSospecha > 20) { // Solo incluir si es significativo
          const recomendaciones = generateRecommendations(disease, symptoms, patient);
          
          results.push({
            diagnostico: disease.nombre,
            nivelSospecha,
            recomendaciones
          });
        }
      });
      
      // Ordenar por nivel de sospecha
      return results.sort((a, b) => b.nivelSospecha - a.nivelSospecha);
    }

    function generateRecommendations(disease, symptoms, patient) {
      const recommendations = [];
      
      // Recomendaciones generales por enfermedad
      if (disease.nombre.toLowerCase().includes('meningitis')) {
        recommendations.push('Realizar punci√≥n lumbar de urgencia');
        recommendations.push('Iniciar tratamiento emp√≠rico con ceftriaxona + vancomicina');
        recommendations.push('Solicitar hemograma, funci√≥n renal y cultivos de sangre');
        recommendations.push('Considerar TC craneal si hay signos de herniaci√≥n');
      }
      
      if (disease.nombre.toLowerCase().includes('diabetes')) {
        recommendations.push('Realizar HbA1c y perfil lip√≠dico');
        recommendations.push('Evaluar complicaciones microvasculares (retinopat√≠a, nefropat√≠a)');
        recommendations.push('Educaci√≥n en autogesti√≥n de la diabetes');
      }
      
      if (disease.nombre.toLowerCase().includes('parkinson')) {
        recommendations.push('Evaluar mediante escala de Hoehn y Yahr');
        recommendations.push('Considerar tratamiento con levodopa/carbidopa');
        recommendations.push('Rehabilitaci√≥n con fisioterapia y terapia ocupacional');
      }
      
      // Recomendaciones basadas en comorbilidades
      if (patient && patient.historiaClinica.diagnosticos) {
        const hasCardio = patient.historiaClinica.diagnosticos.some(d => d.cie10.startsWith('I'));
        const hasRenal = patient.historiaClinica.diagnosticos.some(d => d.cie10.startsWith('N'));
        
        if (hasCardio && disease.nombre.toLowerCase().includes('antiinflamatorio')) {
          recommendations.push('Evitar AINEs por riesgo cardiovascular aumentado');
        }
        
        if (hasRenal && disease.nombre.toLowerCase().includes('metformina')) {
          recommendations.push('Evaluar funci√≥n renal antes de iniciar metformina');
        }
      }
      
      // Si no hay recomendaciones espec√≠ficas, usar las del protocolo
      if (recommendations.length === 0 && disease.tratamientos) {
        recommendations.push(...disease.tratamientos.slice(0, 3));
      }
      
      return recommendations.length > 0 ? recommendations : ['Evaluar cl√≠nicamente y realizar estudios complementarios'];
    }

    function setupVitalSigns() {
      const weightInput = document.getElementById('weight');
      const heightInput = document.getElementById('height');
      const imcOutput = document.getElementById('imc');
      
      if (!weightInput || !heightInput || !imcOutput) return;
      
      function updateIMC() {
        const weight = parseFloat(weightInput.value);
        const height = parseFloat(heightInput.value);
        if (weight > 0 && height > 0) {
          const heightInMeters = height / 100;
          const imc = weight / (heightInMeters * heightInMeters);
          imcOutput.value = imc.toFixed(2);
        } else {
          imcOutput.value = '';
        }
      }
      
      weightInput.addEventListener('input', updateIMC);
      heightInput.addEventListener('input', updateIMC);
    }

    function saveVitalSigns() {
      const temperature = document.getElementById('temperature');
      const pa = document.getElementById('pa');
      const fc = document.getElementById('fc');
      const fr = document.getElementById('fr');
      const spo2 = document.getElementById('spo2');
      const weight = document.getElementById('weight');
      const height = document.getElementById('height');
      
      if (!APP_STATE.activePatientId) {
        showNotification('Por favor, seleccione un paciente primero.', 'warning');
        return;
      }
      
      if (!temperature.value || !pa.value || !fc.value || !fr.value || !spo2.value) {
        showNotification('Por favor, complete todos los campos de signos vitales.', 'warning');
        return;
      }
      
      const patient = DATA_STORE.patients.find(p => p.id === APP_STATE.activePatientId);
      if (!patient) return;
      
      // Crear nueva entrada de signos vitales
      const newVitalSign = {
        fecha: new Date().toISOString().split('T')[0],
        temperatura: parseFloat(temperature.value),
        pa: pa.value,
        fc: parseInt(fc.value),
        fr: parseInt(fr.value),
        spo2: parseInt(spo2.value)
      };
      
      // A√±adir peso y talla si est√°n disponibles
      if (weight.value) newVitalSign.peso = parseFloat(weight.value);
      if (height.value) newVitalSign.talla = parseFloat(height.value);
      if (weight.value && height.value) {
        const heightInMeters = parseFloat(height.value) / 100;
        newVitalSign.imc = (parseFloat(weight.value) / (heightInMeters * heightInMeters)).toFixed(2);
      }
      
      // A√±adir a la historia cl√≠nica
      patient.historiaClinica.signosVitales.push(newVitalSign);
      
      // Limpiar formulario
      temperature.value = '';
      pa.value = '';
      fc.value = '';
      fr.value = '';
      spo2.value = '';
      weight.value = '';
      height.value = '';
      
      showNotification('Signos vitales guardados correctamente.', 'success');
    }

    function addMedicationEntry() {
      const container = document.getElementById('medication-entries');
      if (!container) return;
      
      const entryCount = container.children.length + 1;
      
      const entry = document.createElement('div');
      entry.className = 'medication-entry';
      entry.innerHTML = `
        <div class="form-row">
          <div class="form-group flex-grow">
            <label for="medication-${entryCount}">Medicamento</label>
            <input type="text" id="medication-${entryCount}" class="form-control medication-name" placeholder="Nombre del medicamento">
          </div>
          <div class="form-group">
            <label for="dose-${entryCount}">Dosis</label>
            <input type="text" id="dose-${entryCount}" class="form-control" placeholder="10mg">
          </div>
          <div class="form-group">
            <label for="frequency-${entryCount}">Frecuencia</label>
            <select id="frequency-${entryCount}" class="form-control">
              <option value="once">1 vez al d√≠a</option>
              <option value="twice">2 veces al d√≠a</option>
              <option value="thrice">3 veces al d√≠a</option>
              <option value="four-times">4 veces al d√≠a</option>
              <option value="as-needed">Seg√∫n necesidad</option>
            </select>
          </div>
          <div class="form-group">
            <label for="duration-${entryCount}">Duraci√≥n</label>
            <input type="text" id="duration-${entryCount}" class="form-control" placeholder="7 d√≠as">
          </div>
        </div>
        <div class="form-group">
          <label for="instructions-${entryCount}">Instrucciones</label>
          <input type="text" id="instructions-${entryCount}" class="form-control" placeholder="Tomar con alimentos...">
        </div>
        <button class="btn btn-danger" style="margin-top: 10px;" onclick="this.parentElement.remove()">
          <span class="material-symbols-outlined">delete</span>Eliminar
        </button>
      `;
      
      container.appendChild(entry);
    }

    function checkInteractions() {
      const medicationEntries = document.querySelectorAll('.medication-entry');
      const currentMedications = [];
      
      medicationEntries.forEach(entry => {
        const medNameInput = entry.querySelector('.medication-name');
        if (medNameInput && medNameInput.value) {
          currentMedications.push(medNameInput.value.trim());
        }
      });
      
      if (currentMedications.length < 2) {
        showNotification('Se necesitan al menos 2 medicamentos para verificar interacciones.', 'warning');
        return;
      }
      
      const warnings = new Set();
      
      // Verificar interacciones directas
      for (let i = 0; i < currentMedications.length; i++) {
        const med1Name = currentMedications[i];
        const med1Data = medicalKnowledgeBase.treatments.find(med => med.nombre.toLowerCase() === med1Name.toLowerCase());
        
        if (med1Data && med1Data.interacciones) {
          for (let j = i + 1; j < currentMedications.length; j++) {
            const med2Name = currentMedications[j];
            
            if (med1Data.interacciones[med2Name]) {
              const interaction = med1Data.interacciones[med2Name];
              warnings.add(`${med1Name} - ${med2Name}: ${interaction.descripcion} (<span class="severity-${interaction.severidad}">${interaction.severidad}</span>)`);
            }
            
            // Verificar la interacci√≥n inversa
            const med2Data = medicalKnowledgeBase.treatments.find(med => med.nombre.toLowerCase() === med2Name.toLowerCase());
            if (med2Data && med2Data.interacciones && med2Data.interacciones[med1Name]) {
              const interaction = med2Data.interacciones[med1Name];
              warnings.add(`${med2Name} - ${med1Name}: ${interaction.descripcion} (<span class="severity-${interaction.severidad}">${interaction.severidad}</span>)`);
            }
          }
        }
      }
      
      // Verificar interacciones de tercer orden
      for (let i = 0; i < currentMedications.length; i++) {
        for (let j = 0; j < currentMedications.length; j++) {
          if (i !== j) {
            const med1Name = currentMedications[i];
            const med2Name = currentMedications[j];
            const med1Data = medicalKnowledgeBase.treatments.find(med => med.nombre.toLowerCase() === med1Name.toLowerCase());
            const med2Data = medicalKnowledgeBase.treatments.find(med => med.nombre.toLowerCase() === med2Name.toLowerCase());
            
            if (med1Data && med2Data) {
              // Si med1 interact√∫a con med2, y med2 interact√∫a con otro med3 que est√° en la lista
              for (let k = 0; k < currentMedications.length; k++) {
                if (k !== i && k !== j) {
                  const med3Name = currentMedications[k];
                  if (med2Data.interacciones && med2Data.interacciones[med3Name]) {
                    warnings.add(`‚ö†Ô∏è Interacci√≥n indirecta detectada: ${med1Name} ‚Üí ${med2Name} ‚Üí ${med3Name}`);
                  }
                }
              }
            }
          }
        }
      }
      
      // Verificar farmacogen√≥mica
      const patient = DATA_STORE.patients.find(p => p.id === APP_STATE.activePatientId);
      if (patient && patient.genotipo) {
        currentMedications.forEach(medName => {
          const medData = medicalKnowledgeBase.treatments.find(med => med.nombre.toLowerCase() === medName.toLowerCase());
          if (medData) {
            if (patient.genotipo === 'CYP2D6_metabolizador_lento' && medName === 'Warfarina') {
              warnings.add(`‚ö†Ô∏è Riesgo farmacogen√≥mico: ${patient.genotipo} aumenta la sensibilidad a Warfarina`);
            }
            if (patient.genotipo === 'CYP2C9*2' && medName === 'Warfarina') {
              warnings.add(`‚ö†Ô∏è Riesgo farmacogen√≥mico: ${patient.genotipo} aumenta la toxicidad con Warfarina`);
            }
          }
        });
      }
      
      // Mostrar advertencias
      const warningDiv = document.getElementById('interactions-warning');
      const warningList = document.getElementById('interactions-list');
      
      if (warnings.size > 0) {
        warningList.innerHTML = '';
        warnings.forEach(warning => {
          const li = document.createElement('li');
          li.innerHTML = warning;
          warningList.appendChild(li);
        });
        warningDiv.style.display = 'block';
        showNotification(`${warnings.size} interacciones medicamentosas detectadas.`, 'warning');
      } else {
        warningDiv.style.display = 'none';
        showNotification('No se detectaron interacciones medicamentosas.', 'success');
      }
    }

    function savePrescription() {
      if (!APP_STATE.activePatientId) {
        showNotification('Por favor, seleccione un paciente primero.', 'warning');
        return;
      }
      
      const medicationEntries = document.querySelectorAll('.medication-entry');
      const prescriptions = [];
      
      let valid = true;
      medicationEntries.forEach(entry => {
        const medName = entry.querySelector('.medication-name').value;
        const dose = entry.querySelector('#dose-1')?.value;
        const frequency = entry.querySelector('#frequency-1')?.value;
        
        if (medName && dose && frequency) {
          prescriptions.push({ medName, dose, frequency });
        } else {
          valid = false;
        }
      });
      
      if (!valid) {
        showNotification('Por favor, complete todos los campos de la receta.', 'warning');
        return;
      }
      
      if (prescriptions.length === 0) {
        showNotification('No hay medicamentos en la receta.', 'warning');
        return;
      }
      
      // Verificar interacciones antes de emitir
      const warningDiv = document.getElementById('interactions-warning');
      if (warningDiv && warningDiv.style.display === 'block') {
        const confirmIssue = confirm('Hay interacciones medicamentosas detectadas. ¬øDesea continuar con la emisi√≥n de la receta?');
        if (!confirmIssue) return;
      }
      
      const patient = DATA_STORE.patients.find(p => p.id === APP_STATE.activePatientId);
      
      // Reducir stock
      prescriptions.forEach(pres => {
        const stockItem = DATA_STORE.pharmacyStock.find(item => item.nombre.toLowerCase() === pres.medName.toLowerCase());
        if (stockItem) {
          stockItem.cantidad -= 1; // Simulaci√≥n simple
        }
      });
      
      // Actualizar UI de farmacia
      updatePharmacyStock();
      checkClinicalAlerts();
      
      showNotification(`Receta emitida para ${patient.nombre} con √©xito.`, 'success');
    }

    function updateOrderOptions() {
      const orderType = document.getElementById('order-type')?.value;
      const container = document.getElementById('order-options-container');
      if (!container) return;
      container.innerHTML = '';
      
      if (!orderType) return;
      
      const select = document.createElement('select');
      select.className = 'form-control';
      select.id = 'order-option';
      select.innerHTML = '<option value="">Seleccionar opci√≥n...</option>';
      
      if (orderType === 'laboratory') {
        medicalKnowledgeBase.medicalTests
          .filter(test => test.id.startsWith('urn:loinc:'))
          .forEach(test => {
            const option = document.createElement('option');
            option.value = test.id;
            option.textContent = test.nombre;
            select.appendChild(option);
          });
      } else if (orderType === 'imaging') {
        medicalKnowledgeBase.medicalTests
          .filter(test => test.nombre.toLowerCase().includes('resonancia') || test.nombre.toLowerCase().includes('rm') || test.nombre.toLowerCase().includes('tc'))
          .forEach(test => {
            const option = document.createElement('option');
            option.value = test.id;
            option.textContent = test.nombre;
            select.appendChild(option);
          });
      } else if (orderType === 'consultation') {
        const specialties = [...new Set(DATA_STORE.patients.map(p => p.especialidad))];
        specialties.forEach(specialty => {
          const option = document.createElement('option');
          option.value = specialty.toLowerCase();
          option.textContent = specialty;
          select.appendChild(option);
        });
      }
      
      container.appendChild(select);
    }

    function createMedicalOrder() {
      const orderType = document.getElementById('order-type')?.value;
      const orderOption = document.getElementById('order-option')?.value;
      
      if (!orderType || !orderOption) {
        showNotification('Por favor, seleccione tipo y opci√≥n de orden.', 'warning');
        return;
      }
      
      if (!APP_STATE.activePatientId) {
        showNotification('Por favor, seleccione un paciente primero.', 'warning');
        return;
      }
      
      const patient = DATA_STORE.patients.find(p => p.id === APP_STATE.activePatientId);
      const test = medicalKnowledgeBase.medicalTests.find(t => t.id === orderOption);
      
      const order = {
        id: 'ord-' + Date.now(),
        type: orderType,
        option: test ? test.nombre : orderOption,
        patientId: APP_STATE.activePatientId,
        patientName: patient.nombre,
        date: new Date().toISOString().split('T')[0],
        status: 'pendiente'
      };
      
      DATA_STORE.medicalOrders.push(order);
      
      // Simular generaci√≥n de resultados despu√©s de un tiempo
      if (orderType === 'laboratory' || orderType === 'imaging') {
        showNotification(`Orden creada: ${order.option}. Los resultados estar√°n disponibles en unos momentos.`, 'info');
        
        setTimeout(() => {
          // Generar resultado simulado
          const result = generateSimulatedResult(test, patient);
          const patientHistory = DATA_STORE.patients.find(p => p.id === APP_STATE.activePatientId).historiaClinica;
          patientHistory.laboratorio.push(result);
          
          // Actualizar estado de la orden
          order.status = 'resultados listos';
          order.result = result;
          
          showNotification(`Resultados disponibles para ${order.option}: ${result.resultado}`, 'success');
          
          // Actualizar UI si estamos en la secci√≥n de farmacia
          if (APP_STATE.currentSection === 'pharmacy') {
            updateLabOrdersList();
          }
        }, 3000); // Simular 3 segundos de procesamiento
      } else {
        showNotification('Orden m√©dica creada correctamente.', 'success');
      }
      
      // Actualizar lista de √≥rdenes
      updateOrdersList();
      
      // Resetear formulario
      document.getElementById('order-type').value = '';
      document.getElementById('order-options-container').innerHTML = '';
    }

    function generateSimulatedResult(test, patient) {
      const today = new Date().toISOString().split('T')[0];
      
      // Valores normales y patol√≥gicos simulados
      const results = {
        'Hemoglobina': { normal: '12.1-15.1 g/dL', values: ['13.5 g/dL', '11.8 g/dL', '16.2 g/dL'] },
        'Creatinina': { normal: '0.7-1.3 mg/dL', values: ['1.1 mg/dL', '1.8 mg/dL', '0.9 mg/dL'] },
        'HbA1c': { normal: '<5.7%', values: ['5.2%', '8.5%', '6.8%'] },
        'Perfil Lip√≠dico': { normal: 'LDL <100 mg/dL', values: ['LDL 95 mg/dL, HDL 55 mg/dL', 'LDL 145 mg/dL, HDL 38 mg/dL'] },
        'PCR': { normal: '<10 mg/L', values: ['5 mg/L', '25 mg/L', '8 mg/L'] },
        'BNP': { normal: '<100 pg/mL', values: ['85 pg/mL', '650 pg/mL', '95 pg/mL'] },
        'Punci√≥n Lumbar': { normal: 'LCR claro, c√©lulas <5/mm¬≥', values: ['LCR turbio, neutr√≥filos elevados', 'LCR claro, linfocitos elevados'] },
        'Resonancia Magn√©tica (RM) Cerebral': { normal: 'Sin lesiones', values: ['Lesiones desmielinizantes en sustancia blanca', 'Sin hallazgos significativos'] }
      };
      
      const testName = test ? test.nombre : 'Estudio';
      const possibleResults = results[testName] || { normal: 'Normal', values: ['Normal', 'Anormal'] };
      
      // Simular resultado basado en el paciente
      let resultado;
      if (patient.diagnosticoPrincipal.includes('Diabetes') && testName === 'HbA1c') {
        resultado = Math.random() > 0.5 ? '8.5%' : '7.2%';
      } else if (patient.diagnosticoPrincipal.includes('Insuficiencia') && testName === 'BNP') {
        resultado = Math.random() > 0.3 ? '650 pg/mL' : '450 pg/mL';
      } else if (patient.diagnosticoPrincipal.includes('Meningitis') && testName === 'Punci√≥n Lumbar') {
        resultado = 'LCR turbio, neutr√≥filos elevados, prote√≠nas 80 mg/dL, glucosa 30 mg/dL';
      } else {
        resultado = possibleResults.values[Math.floor(Math.random() * possibleResults.values.length)];
      }
      
      return {
        fecha: today,
        test: testName,
        resultado: resultado,
        normal: possibleResults.normal
      };
    }

    function updateOrdersList() {
      const ordersList = document.getElementById('orders-list');
      if (!ordersList) return;
      
      if (DATA_STORE.medicalOrders.length === 0) {
        ordersList.innerHTML = '<p>No hay √≥rdenes m√©dicas.</p>';
        return;
      }
      
      ordersList.innerHTML = '';
      DATA_STORE.medicalOrders
        .filter(order => order.patientId === APP_STATE.activePatientId)
        .forEach(order => {
          const alert = document.createElement('div');
          alert.className = `alert-card ${order.status === 'resultados listos' ? 'success' : 'info'}`;
          alert.innerHTML = `
            <span class="material-symbols-outlined alert-icon">${order.status === 'resultados listos' ? 'check_circle' : 'info'}</span>
            <div>
              <strong>${order.status === 'resultados listos' ? 'Resultados Disponibles:' : 'Orden Creada:'}</strong> ${order.option} 
              ${order.status === 'resultados listos' && order.result ? `- ${order.result.resultado}` : ''}
            </div>
          `;
          ordersList.appendChild(alert);
        });
    }

    function updateLabOrdersList() {
      const ordersList = document.getElementById('lab-orders-list');
      if (!ordersList) return;
      
      ordersList.innerHTML = '';
      
      // √ìrdenes pendientes
      const pending = DATA_STORE.medicalOrders.filter(o => o.status === 'pendiente');
      if (pending.length > 0) {
        const alert = document.createElement('div');
        alert.className = 'alert-card info';
        alert.innerHTML = `
          <span class="material-symbols-outlined alert-icon">info</span>
          <div>
            <strong>√ìrdenes Pendientes:</strong> ${pending.map(o => o.option).join(', ')}
          </div>
        `;
        ordersList.appendChild(alert);
      }
      
      // Resultados disponibles
      const completed = DATA_STORE.medicalOrders.filter(o => o.status === 'resultados listos');
      if (completed.length > 0) {
        completed.forEach(order => {
          const alert = document.createElement('div');
          alert.className = 'alert-card success';
          alert.innerHTML = `
            <span class="material-symbols-outlined alert-icon">check_circle</span>
            <div>
              <strong>Resultados Disponibles:</strong> ${order.option} - ${order.result.resultado}
            </div>
          `;
          ordersList.appendChild(alert);
        });
      }
      
      if (pending.length === 0 && completed.length === 0) {
        ordersList.innerHTML = '<p>No hay √≥rdenes de laboratorio.</p>';
      }
    }

    function createAppointment() {
      const patientId = document.getElementById('appointment-patient')?.value;
      const date = document.getElementById('appointment-date')?.value;
      const time = document.getElementById('appointment-time')?.value;
      const reason = document.getElementById('appointment-reason')?.value;
      
      if (!patientId || !date || !time || !reason) {
        showNotification('Por favor, complete todos los campos.', 'warning');
        return;
      }
      
      // Verificar disponibilidad
      const existingAppointment = DATA_STORE.appointments.find(appt => 
        appt.fecha === date && appt.hora === time
      );
      
      if (existingAppointment) {
        showNotification('El m√©dico ya tiene una cita programada a esa hora.', 'warning');
        return;
      }
      
      const appointment = {
        id: 'app-' + Date.now(),
        pacienteId: patientId,
        fecha: date,
        hora: time,
        motivo: reason,
        estado: 'confirmada',
        medico: 'Dr. P√©rez' // Asignaci√≥n simulada
      };
      
      DATA_STORE.appointments.push(appointment);
      
      // Resetear formulario
      document.getElementById('appointment-patient').value = '';
      document.getElementById('appointment-date').value = '';
      document.getElementById('appointment-time').value = '';
      document.getElementById('appointment-reason').value = '';
      
      // Actualizar listas
      updateUpcomingAppointments();
      
      // Simular env√≠o de recordatorio
      const patient = DATA_STORE.patients.find(p => p.id === patientId);
      setTimeout(() => {
        showNotification(`Recordatorio enviado al paciente ${patient.nombre} y al m√©dico.`, 'info');
      }, 1000);
      
      showNotification('Cita programada correctamente.');
    }

    function loadPatientHistory() {
      const historyDiv = document.getElementById('patient-history');
      if (!historyDiv || !APP_STATE.activePatientId) return;
      
      const patient = DATA_STORE.patients.find(p => p.id === APP_STATE.activePatientId);
      if (!patient) return;
      
      historyDiv.innerHTML = '';
      
      // Diagn√≥sticos
      if (patient.historiaClinica.diagnosticos && patient.historiaClinica.diagnosticos.length > 0) {
        const diags = document.createElement('div');
        diags.className = 'card';
        diags.innerHTML = `
          <div class="card-header">
            <h3 class="card-title"><span class="material-symbols-outlined">diagnosis</span>Diagn√≥sticos</h3>
          </div>
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="background-color: #f5f5f5; border-bottom: 2px solid #eee;">
                <th style="padding: 12px; text-align: left;">Fecha</th>
                <th style="padding: 12px; text-align: left;">CIE-10</th>
                <th style="padding: 12px; text-align: left;">Descripci√≥n</th>
                <th style="padding: 12px; text-align: left;">Estado</th>
              </tr>
            </thead>
            <tbody>
              ${patient.historiaClinica.diagnosticos.map(d => `
                <tr>
                  <td>${d.fecha}</td>
                  <td>${d.cie10}</td>
                  <td>${d.descripcion}</td>
                  <td>${d.estado}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        `;
        historyDiv.appendChild(diags);
      }
      
      // Tratamientos
      if (patient.historiaClinica.tratamientos && patient.historiaClinica.tratamientos.length > 0) {
        const trats = document.createElement('div');
        trats.className = 'card';
        trats.innerHTML = `
          <div class="card-header">
            <h3 class="card-title"><span class="material-symbols-outlined">prescriptions</span>Tratamientos</h3>
          </div>
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="background-color: #f5f5f5; border-bottom: 2px solid #eee;">
                <th style="padding: 12px; text-align: left;">Inicio</th>
                <th style="padding: 12px; text-align: left;">Medicamento</th>
                <th style="padding: 12px; text-align: left;">Dosis</th>
                <th style="padding: 12px; text-align: left;">Duraci√≥n</th>
              </tr>
            </thead>
            <tbody>
              ${patient.historiaClinica.tratamientos.map(t => `
                <tr>
                  <td>${t.fechaInicio}</td>
                  <td>${t.medicamento}</td>
                  <td>${t.dosis}</td>
                  <td>${t.duracion}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        `;
        historyDiv.appendChild(trats);
      }
      
      // Evoluci√≥n
      if (patient.historiaClinica.evolucion && patient.historiaClinica.evolucion.length > 0) {
        const evol = document.createElement('div');
        evol.className = 'card';
        evol.innerHTML = `
          <div class="card-header">
            <h3 class="card-title"><span class="material-symbols-outlined">timeline</span>Evoluci√≥n</h3>
          </div>
          <div class="timeline">
            ${patient.historiaClinica.evolucion.map(e => `
              <div style="padding: 10px; border-bottom: 1px solid #eee;">
                <strong>${e.fecha}</strong>: ${e.nota}
              </div>
            `).join('')}
          </div>
        `;
        historyDiv.appendChild(evol);
      }
      
      // Signos vitales
      if (patient.historiaClinica.signosVitales && patient.historiaClinica.signosVitales.length > 0) {
        const vitals = document.createElement('div');
        vitals.className = 'card';
        vitals.innerHTML = `
          <div class="card-header">
            <h3 class="card-title"><span class="material-symbols-outlined">monitor_heart</span>Signos Vitales</h3>
          </div>
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="background-color: #f5f5f5; border-bottom: 2px solid #eee;">
                <th style="padding: 12px; text-align: left;">Fecha</th>
                <th style="padding: 12px; text-align: left;">Temp (¬∞C)</th>
                <th style="padding: 12px; text-align: left;">PA</th>
                <th style="padding: 12px; text-align: left;">FC</th>
                <th style="padding: 12px; text-align: left;">FR</th>
                <th style="padding: 12px; text-align: left;">SpO2</th>
              </tr>
            </thead>
            <tbody>
              ${patient.historiaClinica.signosVitales.map(v => `
                <tr>
                  <td>${v.fecha}</td>
                  <td>${v.temperatura}</td>
                  <td>${v.pa}</td>
                  <td>${v.fc}</td>
                  <td>${v.fr}</td>
                  <td>${v.spo2}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        `;
        historyDiv.appendChild(vitals);
      }
      
      // Laboratorio
      if (patient.historiaClinica.laboratorio && patient.historiaClinica.laboratorio.length > 0) {
        const labs = document.createElement('div');
        labs.className = 'card';
        labs.innerHTML = `
          <div class="card-header">
            <h3 class="card-title"><span class="material-symbols-outlined">science</span>Laboratorio</h3>
          </div>
          <table style="width: 100%; border-collapse: collapse;">
            <thead>
              <tr style="background-color: #f5f5f5; border-bottom: 2px solid #eee;">
                <th style="padding: 12px; text-align: left;">Fecha</th>
                <th style="padding: 12px; text-align: left;">Test</th>
                <th style="padding: 12px; text-align: left;">Resultado</th>
                <th style="padding: 12px; text-align: left;">Normal</th>
              </tr>
            </thead>
            <tbody>
              ${patient.historiaClinica.laboratorio.map(l => `
                <tr>
                  <td>${l.fecha}</td>
                  <td>${l.test}</td>
                  <td>${l.resultado}</td>
                  <td>${l.normal}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>
        `;
        historyDiv.appendChild(labs);
      }
      
      if (historyDiv.children.length === 0) {
        historyDiv.innerHTML = '<p>No hay historial cl√≠nico disponible.</p>';
      }
    }

    function setupSearchFunctionality() {
      const searchInput = document.getElementById('patient-search');
      const suggestionsContainer = document.createElement('div');
      suggestionsContainer.className = 'suggestions';
      suggestionsContainer.style.display = 'none';
      
      if (searchInput) {
        searchInput.parentNode.appendChild(suggestionsContainer);
        
        const commonSuggestions = [
          "cefalea intensa, fotofobia, fiebre", // Meningitis
          "diabetes mellitus tipo 2 tratamiento",
          "metformina mecanismo de acci√≥n",
          "protocolo de esclerosis m√∫ltiple",
          "parkinson diagn√≥stico",
          "losart√°n interacciones",
          "punci√≥n lumbar indicaciones",
          "RM cerebral en esclerosis m√∫ltiple",
          "s√≠ntomas de insuficiencia card√≠aca"
        ];
        
        searchInput.addEventListener('focus', () => {
          if (searchInput.value === '') {
            suggestionsContainer.innerHTML = '';
            commonSuggestions.forEach(suggestion => {
              const item = document.createElement('div');
              item.className = 'suggestion-item';
              item.textContent = suggestion;
              item.onclick = () => {
                searchInput.value = suggestion;
                suggestionsContainer.style.display = 'none';
              };
              suggestionsContainer.appendChild(item);
            });
            suggestionsContainer.style.display = 'block';
          }
        });
        
        searchInput.addEventListener('input', () => {
          const query = searchInput.value.toLowerCase().trim();
          if (query === '') {
            suggestionsContainer.style.display = 'none';
            return;
          }
          
          const filteredSuggestions = commonSuggestions.filter(suggestion => 
            suggestion.toLowerCase().includes(query)
          );
          
          suggestionsContainer.innerHTML = '';
          if (filteredSuggestions.length > 0) {
            filteredSuggestions.forEach(suggestion => {
              const item = document.createElement('div');
              item.className = 'suggestion-item';
              item.innerHTML = suggestion.replace(new RegExp(query, 'gi'), match => 
                `<span class="highlight">${match}</span>`
              );
              item.onclick = () => {
                searchInput.value = suggestion;
                suggestionsContainer.style.display = 'none';
              };
              suggestionsContainer.appendChild(item);
            });
            suggestionsContainer.style.display = 'block';
          } else {
            suggestionsContainer.style.display = 'none';
          }
        });
        
        document.addEventListener('click', (e) => {
          if (e.target !== searchInput && !suggestionsContainer.contains(e.target)) {
            suggestionsContainer.style.display = 'none';
          }
        });
      }
    }

    // Inicializar la aplicaci√≥n
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>
