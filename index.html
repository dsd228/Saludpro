<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Enfermería DAVID · Sistema completo con almacenamiento persistente">
    <title>Enfermería DAVID · Sistema Completo</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Estilos existentes (se mantienen igual) */
        :root {
            --bg: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            --glass: rgba(15, 30, 40, 0.9);
            --glass-2: rgba(255, 255, 255, 0.1);
            --accent: #00b4d8;
            --accent-2: #0077b6;
            --accent-3: #023e8a;
            --primary-blue: #3a86ff;
            --primary-blue-darker: #00509d;
            --primary-blue-lighter: rgba(58, 134, 255, 0.1);
            --success-green: #38b000;
            --warning-yellow: #ffca3a;
            --alert-red: #d90429;
            --text-light: #e0f7fa;
            --text-dark: #073b4c;
            --muted: #8d99ae;
            --danger: #ef233c;
            --card-radius: 20px;
            --shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            --shadow-sm: 0 8px 24px rgba(0, 0, 0, 0.2);
            --shadow-md: 0 16px 32px rgba(0, 0, 0, 0.25);
            --shadow-lg: 0 32px 64px rgba(0, 0, 0, 0.3);
            --shadow-inset: inset 0 1px 2px rgba(255, 255, 255, 0.1);
            --tap: 48px;
            --font: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, Arial;
            --maxwidth: 1400px;
            --border: rgba(141, 153, 174, 0.3);
            --border-light: rgba(141, 153, 174, 0.2);
            --transition: all 0.4s cubic-bezier(0.16, 1, 0.3, 1);
            --transition-fast: all 0.2s ease;
            --z-header: 100;
            --z-sidebar: 90;
            --z-modal: 200;
            --gradient-primary: linear-gradient(135deg, #00b4d8, #0077b6);
            --gradient-secondary: linear-gradient(135deg, #3a86ff, #00509d);
            --gradient-success: linear-gradient(135deg, #38b000, #006d21);
            --gradient-warning: linear-gradient(135deg, #ffca3a, #e69500);
            --gradient-danger: linear-gradient(135deg, #d90429, #9d0208);
        }
        
        :root[data-theme="light"] {
            --bg: linear-gradient(135deg, #f0f2f5, #e6e9ef, #d8dee9);
            --glass: rgba(255, 255, 255, 0.95);
            --glass-2: rgba(15, 30, 40, 0.05);
            --accent: #0077b6;
            --accent-2: #00509d;
            --accent-3: #003f7f;
            --primary-blue: #1e3a8a;
            --primary-blue-darker: #1e3a8a;
            --primary-blue-lighter: rgba(30, 58, 138, 0.1);
            --success-green: #16a34a;
            --warning-yellow: #d97706;
            --alert-red: #dc2626;
            --text-light: #073b4c;
            --text-dark: #073b4c;
            --muted: #64748b;
            --border: rgba(100, 116, 139, 0.3);
            --border-light: rgba(100, 116, 139, 0.2);
            --gradient-primary: linear-gradient(135deg, #0077b6, #00509d);
            --gradient-secondary: linear-gradient(135deg, #1e3a8a, #1e3a8a);
            --gradient-success: linear-gradient(135deg, #16a34a, #059669);
            --gradient-warning: linear-gradient(135deg, #d97706, #b45309);
            --gradient-danger: linear-gradient(135deg, #dc2626, #b91c1c);
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            transition: var(--transition);
        }
        
        html, body {
            height: 100%;
            margin: 0;
            font-family: var(--font);
            background: var(--bg);
            -webkit-font-smoothing: antialiased;
            display: flex;
            justify-content: center;
            padding: 16px;
            color: var(--text-dark);
            overflow-x: hidden;
        }
        
        .app {
            width: 100%;
            max-width: var(--maxwidth);
            height: calc(100vh - 32px);
            display: flex;
            flex-direction: column;
            background: var(--glass);
            backdrop-filter: blur(20px);
            border-radius: var(--card-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            position: relative;
            border: 1px solid var(--border);
        }
        
        header {
            padding: 20px 32px;
            background: rgba(15, 30, 40, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: var(--z-header);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
        }
        
        header h1 {
            font-size: 1.8rem;
            font-weight: 700;
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 14px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }
        
        .brand-icon {
            font-size: 2rem;
            color: var(--accent);
            text-shadow: 0 0 10px rgba(0, 180, 216, 0.5);
        }
        
        .controls {
            display: flex;
            align-items: center;
            gap: 16px;
        }
        
        .theme-toggle {
            background: var(--glass-2);
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
            padding: 12px;
            border-radius: 50%;
            width: 52px;
            height: 52px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
        }
        
        .theme-toggle:hover {
            background: var(--accent-2);
            transform: translateY(-2px) rotate(15deg);
            box-shadow: var(--shadow-md);
        }
        
        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        .sidebar {
            width: 320px;
            background: var(--glass);
            border-right: 1px solid var(--border);
            padding: 20px;
            overflow-y: auto;
            transition: var(--transition);
            position: relative;
            z-index: var(--z-sidebar);
            box-shadow: var(--shadow-sm);
        }
        
        .sidebar-header {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 16px 0;
            margin-bottom: 24px;
            border-bottom: 1px solid var(--border-light);
            color: var(--accent);
        }
        
        .sidebar-header h3 {
            font-size: 1.2rem;
            font-weight: 600;
            letter-spacing: 0.5px;
        }
        
        .cat-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 14px;
        }
        
        .cat-btn {
            padding: 18px 22px;
            border: none;
            border-radius: 16px;
            background: var(--glass-2);
            color: var(--text-light);
            font-weight: 500;
            cursor: pointer;
            text-align: left;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 16px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            position: relative;
            overflow: hidden;
        }
        
        .cat-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: transparent;
            transition: var(--transition);
        }
        
        .cat-btn:hover {
            background: var(--accent-2);
            color: white;
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }
        
        .cat-btn:hover::before {
            background: var(--accent);
        }
        
        .cat-btn.active {
            background: var(--accent-2);
            color: white;
            box-shadow: var(--shadow-md);
            font-weight: 600;
        }
        
        .cat-btn.active::before {
            background: var(--accent);
        }
        
        .cat-btn i {
            font-size: 1.6rem;
            width: 28px;
            text-align: center;
            transition: var(--transition);
        }
        
        .cat-btn[data-cat="higiene"] i { color: #4CAF50; }
        .cat-btn[data-cat="curaciones"] i { color: #2196F3; }
        .cat-btn[data-cat="farmaco"] i { color: #9C27B0; }
        .cat-btn[data-cat="emergencias"] i { color: #F44336; }
        .cat-btn[data-cat="movilizacion"] i { color: #FF9800; }
        .cat-btn[data-cat="nutricion"] i { color: #8D6E63; }
        .cat-btn[data-cat="infeccion"] i { color: #795548; }
        .cat-btn[data-cat="medicamentos"] i { color: #009688; }
        .cat-btn[data-cat="enfermedades"] i { color: #607D8B; }
        .cat-btn[data-cat="pae"] i { color: #3F51B5; }
        .cat-btn[data-cat="rcp"] i { color: #E91E63; }
        .cat-btn[data-cat="calculadoras"] i { color: #FF5722; }
        .cat-btn[data-cat="recursos"] i { color: #00BCD4; }
        .cat-btn[data-cat="pacientes"] i { color: #673AB7; }
        
        .small {
            font-size: 0.9rem;
            color: var(--muted);
            margin-top: 10px;
            line-height: 1.5;
            opacity: 0.9;
        }
        
        main {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            background: var(--glass);
            backdrop-filter: blur(10px);
        }
        
        .search-container {
            display: flex;
            gap: 12px;
            margin-bottom: 28px;
            position: sticky;
            top: 92px;
            background: var(--glass);
            padding: 12px 0;
            z-index: 50;
            border-radius: 12px;
            backdrop-filter: blur(10px);
        }
        
        .input {
            flex: 1;
            padding: 16px 20px;
            border: 1px solid var(--border-light);
            border-radius: 16px;
            font-family: var(--font);
            font-size: 1.05rem;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            box-shadow: var(--shadow-sm);
            backdrop-filter: blur(10px);
        }
        
        .input::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        
        .input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(0, 180, 216, 0.2);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .btn {
            padding: 16px 20px;
            border: none;
            border-radius: 16px;
            cursor: pointer;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            box-shadow: var(--shadow-sm);
            font-size: 1.05rem;
            transition: var(--transition);
        }
        
        .btn.primary {
            background: var(--gradient-primary);
            color: white;
            border: 1px solid rgba(0, 119, 182, 0.3);
        }
        
        .btn.primary:hover {
            background: var(--gradient-secondary);
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }
        
        .btn.secondary {
            background: var(--gradient-secondary);
            color: white;
            border: 1px solid rgba(30, 58, 138, 0.3);
        }
        
        .btn.secondary:hover {
            background: var(--primary-blue-darker);
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }
        
        .btn.ghost {
            background: transparent;
            color: var(--accent);
            border: 1px solid var(--accent);
        }
        
        .btn.ghost:hover {
            background: var(--glass-2);
            transform: translateY(-3px);
        }
        
        .btn.small {
            padding: 10px 14px;
            font-size: 0.95rem;
        }
        
        .content-area {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }
        
        .category-card {
            background: var(--glass-2);
            border-radius: 20px;
            padding: 28px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }
        
        .category-card:hover {
            transform: translateY(-6px);
            box-shadow: var(--shadow-lg);
        }
        
        .category-card h2 {
            color: var(--accent);
            margin-bottom: 20px;
            font-size: 1.6rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
            letter-spacing: -0.5px;
        }
        
        .category-card h2 i {
            font-size: 1.7rem;
        }
        
        .category-card h3 {
            color: var(--accent-2);
            margin: 20px 0 12px 0;
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            letter-spacing: -0.3px;
        }
        
        .category-card h4 {
            color: var(--primary-blue);
            margin: 12px 0 8px 0;
            font-size: 1.15rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .procedure {
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border-light);
            transition: var(--transition);
            position: relative;
        }
        
        .procedure::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 1px;
            background: var(--accent);
            transition: var(--transition);
        }
        
        .procedure:hover::after {
            width: 100%;
        }
        
        .procedure:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .procedure h3 {
            color: var(--accent-2);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .procedure h3 i {
            font-size: 1.3rem;
            color: var(--accent);
        }
        
        .procedure p {
            margin: 6px 0;
            color: var(--text-light);
            line-height: 1.6;
            font-size: 1.02rem;
        }
        
        .procedure .summary {
            font-style: italic;
            color: var(--muted);
            margin-bottom: 12px;
            padding: 16px;
            background: var(--primary-blue-lighter);
            border-radius: 12px;
            border-left: 4px solid var(--primary-blue);
            border: 1px solid var(--border-light);
        }
        
        .procedure .summary i {
            color: var(--primary-blue);
            margin-right: 8px;
        }
        
        .materials, .steps, .notes {
            margin: 12px 0;
        }
        
        .materials ul, .steps ol {
            margin: 10px 0;
            padding-left: 28px;
        }
        
        .materials li, .steps li {
            margin: 6px 0;
            display: flex;
            align-items: flex-start;
            gap: 10px;
            line-height: 1.5;
        }
        
        .materials li::before, .steps li::before {
            content: "•";
            color: var(--accent);
            font-weight: bold;
            margin-top: 6px;
            font-size: 1.2rem;
        }
        
        .steps li::before {
            content: counter(step);
            counter-increment: step;
            background: var(--accent);
            color: white;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.9rem;
            font-weight: bold;
            margin-top: 4px;
        }
        
        .notes {
            background: var(--primary-blue-lighter);
            padding: 18px 22px;
            border-radius: 14px;
            border-left: 4px solid var(--primary-blue);
            margin: 14px 0;
            font-size: 0.98rem;
            border: 1px solid var(--border-light);
        }
        
        .notes i {
            color: var(--primary-blue);
            margin-right: 10px;
        }
        
        .disease-panel {
            background: var(--glass-2);
            border-radius: 20px;
            padding: 28px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            margin-top: 24px;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }
        
        .disease-panel h2 {
            color: var(--accent);
            margin-bottom: 20px;
            font-size: 1.6rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .disease-panel h2 i {
            font-size: 1.7rem;
        }
        
        .disease-item {
            margin-bottom: 24px;
            padding-bottom: 24px;
            border-bottom: 1px solid var(--border-light);
            transition: var(--transition);
            position: relative;
        }
        
        .disease-item::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 1px;
            background: var(--accent);
            transition: var(--transition);
        }
        
        .disease-item:hover::after {
            width: 100%;
        }
        
        .disease-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .disease-item strong {
            color: var(--accent-2);
            font-size: 1.15rem;
            font-weight: 600;
        }
        
        .disease-item .small {
            font-size: 0.98rem;
            color: var(--muted);
            margin-top: 8px;
            line-height: 1.6;
        }
        
        .disease-item .small i {
            color: var(--primary-blue);
            margin-right: 6px;
        }
        
        .med-combo {
            background: var(--glass-2);
            border-radius: 20px;
            padding: 28px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            margin-top: 24px;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }
        
        .med-combo h2 {
            color: var(--accent);
            margin-bottom: 24px;
            font-size: 1.6rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .med-combo h2 i {
            font-size: 1.7rem;
        }
        
        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .form-group {
            flex: 1;
            min-width: 240px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 10px;
            font-weight: 500;
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.05rem;
        }
        
        .form-group label i {
            color: var(--accent);
            font-size: 1.15rem;
        }
        
        select.form-control, input.form-control {
            width: 100%;
            padding: 16px 20px;
            border: 1px solid var(--border-light);
            border-radius: 16px;
            font-family: var(--font);
            font-size: 1.05rem;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            box-shadow: var(--shadow-sm);
            backdrop-filter: blur(10px);
        }
        
        select.form-control:focus, input.form-control:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(0, 180, 216, 0.2);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .interactions-warning {
            background: rgba(255, 202, 58, 0.15);
            border: 1px solid rgba(255, 202, 58, 0.3);
            border-radius: 16px;
            padding: 20px;
            margin: 20px 0;
            display: flex;
            align-items: flex-start;
            gap: 16px;
            animation: fadeIn 0.4s ease;
            backdrop-filter: blur(10px);
            border-left: 4px solid var(--warning-yellow);
        }
        
        .interactions-warning.danger {
            background: rgba(217, 4, 41, 0.15);
            border: 1px solid rgba(217, 4, 41, 0.3);
            color: #f8d7da;
            border-left: 4px solid var(--alert-red);
        }
        
        .interactions-warning.success {
            background: rgba(56, 176, 0, 0.15);
            border: 1px solid rgba(56, 176, 0, 0.3);
            color: #d1f7e5;
            border-left: 4px solid var(--success-green);
        }
        
        .interactions-warning i {
            font-size: 1.6rem;
            margin-top: 4px;
        }
        
        .interactions-warning.danger i {
            color: var(--alert-red);
        }
        
        .interactions-warning.success i {
            color: var(--success-green);
        }
        
        .interactions-list {
            margin: 10px 0 0 48px;
            flex: 1;
        }
        
        .interactions-list li {
            margin: 8px 0;
            padding: 6px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-light);
        }
        
        .interactions-list li:last-child {
            border-bottom: none;
        }
        
        .interactions-list li a {
            color: var(--accent);
            text-decoration: none;
            margin-left: 8px;
        }
        
        .interactions-list li a:hover {
            text-decoration: underline;
        }
        
        .pae-form {
            background: var(--glass-2);
            border-radius: 20px;
            padding: 28px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            margin-top: 24px;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }
        
        .pae-form h2 {
            color: var(--accent);
            margin-bottom: 24px;
            font-size: 1.6rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .pae-form h2 i {
            font-size: 1.7rem;
        }
        
        .rcp-guide {
            background: var(--glass-2);
            border-radius: 20px;
            padding: 28px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            margin-top: 24px;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }
        
        .rcp-guide h2 {
            color: var(--accent);
            margin-bottom: 24px;
            font-size: 1.6rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .rcp-guide h2 i {
            font-size: 1.7rem;
        }
        
        .rcp-step {
            margin-bottom: 24px;
            padding-left: 36px;
            position: relative;
            transition: var(--transition);
            padding: 16px 20px;
            background: rgba(58, 134, 255, 0.05);
            border-radius: 12px;
            border-left: 4px solid var(--primary-blue);
            border: 1px solid var(--border-light);
        }
        
        .rcp-step:hover {
            background: rgba(58, 134, 255, 0.1);
            transform: translateX(8px);
        }
        
        .rcp-step::before {
            content: attr(data-step);
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 32px;
            height: 32px;
            background: var(--accent);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            font-weight: bold;
            z-index: 1;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .score-result {
            background: var(--glass-2);
            border-radius: 20px;
            padding: 28px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            margin-top: 24px;
            text-align: center;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }
        
        .score-result h3 {
            color: var(--accent);
            margin-bottom: 20px;
            font-size: 1.4rem;
            font-weight: 600;
        }
        
        .score-value {
            font-size: 2.4rem;
            font-weight: bold;
            color: var(--accent);
            margin: 20px 0;
            text-shadow: 0 2px 4px rgba(0, 180, 216, 0.3);
            font-family: 'Courier New', monospace;
        }
        
        .score-category {
            font-size: 1.4rem;
            font-weight: 500;
            color: var(--accent-2);
        }
        
        .tab-container {
            margin-top: 24px;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border-light);
            margin-bottom: 24px;
            border-radius: 16px 16px 0 0;
            overflow: hidden;
            background: var(--glass-2);
            border: 1px solid var(--border-light);
        }
        
        .tab {
            padding: 16px 24px;
            cursor: pointer;
            font-weight: 500;
            color: var(--muted);
            border-bottom: 3px solid transparent;
            transition: var(--transition);
            background: transparent;
            flex: 1;
            text-align: center;
        }
        
        .tab:first-child {
            border-radius: 16px 0 0 0;
        }
        
        .tab:last-child {
            border-radius: 0 16px 0 0;
        }
        
        .tab:hover {
            background: var(--accent-2);
            color: white;
        }
        
        .tab.active {
            color: var(--accent);
            border-bottom: 3px solid var(--accent);
            background: rgba(0, 180, 216, 0.1);
            font-weight: 600;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .calculator-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(360px, 1fr));
            gap: 24px;
            margin-top: 24px;
        }
        
        .calculator-form {
            background: var(--glass-2);
            border-radius: 20px;
            padding: 28px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }
        
        .calculator-form:hover {
            transform: translateY(-6px);
            box-shadow: var(--shadow-lg);
        }
        
        .calculator-form h3 {
            color: var(--accent);
            margin-bottom: 24px;
            font-size: 1.4rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .calculator-form h3 i {
            font-size: 1.5rem;
        }
        
        .patient-list {
            background: var(--glass-2);
            border-radius: 20px;
            padding: 28px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            margin-top: 24px;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }
        
        .patient-list h2 {
            color: var(--accent);
            margin-bottom: 24px;
            font-size: 1.6rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .patient-list h2 i {
            font-size: 1.7rem;
        }
        
        .patient-card {
            background: var(--primary-blue-lighter);
            border-radius: 14px;
            padding: 20px;
            margin-bottom: 16px;
            border-left: 5px solid var(--primary-blue);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border-light);
        }
        
        .patient-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(58, 134, 255, 0.1));
            opacity: 0;
            transition: var(--transition);
        }
        
        .patient-card:hover {
            transform: translateX(8px);
            background: rgba(58, 134, 255, 0.18);
        }
        
        .patient-card:hover::before {
            opacity: 1;
        }
        
        .patient-card::after {
            content: "→";
            position: absolute;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0;
            transition: var(--transition);
            color: var(--primary-blue);
            font-weight: bold;
            font-size: 1.5rem;
        }
        
        .patient-card:hover::after {
            opacity: 1;
        }
        
        .patient-card:last-child {
            margin-bottom: 0;
        }
        
        .patient-card h3 {
            color: var(--primary-blue-darker);
            margin-bottom: 8px;
            font-size: 1.15rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .patient-card h3 i {
            color: var(--primary-blue);
            font-size: 1.3rem;
        }
        
        .patient-card p {
            margin: 4px 0;
            font-size: 0.98rem;
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .patient-card p i {
            color: var(--muted);
            font-size: 1.1rem;
            width: 22px;
            text-align: center;
        }
        
        .resource-panel {
            background: var(--glass-2);
            border-radius: 20px;
            padding: 28px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            margin-top: 24px;
            transition: var(--transition);
            backdrop-filter: blur(10px);
        }
        
        .resource-panel h2 {
            color: var(--accent);
            margin-bottom: 24px;
            font-size: 1.6rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .resource-panel h2 i {
            font-size: 1.7rem;
        }
        
        .resource-card {
            background: var(--primary-blue-lighter);
            border-radius: 14px;
            padding: 20px;
            margin-bottom: 16px;
            border-left: 5px solid var(--primary-blue);
            transition: var(--transition);
            border: 1px solid var(--border-light);
        }
        
        .resource-card:hover {
            transform: translateX(8px);
            background: rgba(58, 134, 255, 0.18);
        }
        
        .resource-card:last-child {
            margin-bottom: 0;
        }
        
        .resource-card h3 {
            color: var(--primary-blue-darker);
            margin-bottom: 8px;
            font-size: 1.15rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .resource-card h3 i {
            color: var(--primary-blue);
            font-size: 1.3rem;
        }
        
        .resource-card p {
            margin: 4px 0;
            font-size: 0.98rem;
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .resource-card p i {
            color: var(--muted);
            font-size: 1.1rem;
            width: 22px;
            text-align: center;
        }
        
        .resource-card a {
            display: inline-block;
            margin-top: 12px;
            padding: 10px 16px;
            background: var(--gradient-secondary);
            color: white;
            border-radius: 10px;
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            border: 1px solid rgba(30, 58, 138, 0.3);
        }
        
        .resource-card a:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-sm);
        }
        
        .welcome-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 24px;
        }
        
        .welcome-card {
            background: var(--glass-2);
            border-radius: 20px;
            padding: 28px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }
        
        .welcome-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(0, 180, 216, 0.1));
            opacity: 0;
            transition: var(--transition);
        }
        
        .welcome-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }
        
        .welcome-card:hover::before {
            opacity: 1;
        }
        
        .welcome-card i {
            font-size: 3rem;
            color: var(--accent);
            margin-bottom: 16px;
            transition: var(--transition);
        }
        
        .welcome-card:hover i {
            transform: scale(1.1);
        }
        
        .welcome-card h3 {
            color: var(--accent);
            margin-bottom: 10px;
            font-size: 1.3rem;
        }
        
        .welcome-card p {
            color: var(--muted);
            font-size: 0.98rem;
            line-height: 1.6;
        }
        
        .rcp-controls {
            display: flex;
            gap: 16px;
            margin-top: 24px;
            flex-wrap: wrap;
        }
        
        .rcp-timer {
            font-size: 2rem;
            font-weight: 700;
            color: var(--accent);
            margin: 20px 0;
            text-align: center;
            font-family: 'Courier New', monospace;
            background: rgba(0, 180, 216, 0.1);
            padding: 16px;
            border-radius: 16px;
            border: 2px solid var(--accent);
            box-shadow: var(--shadow-sm);
        }
        
        .rcp-state {
            font-size: 1rem;
            color: var(--muted);
            margin-bottom: 16px;
            text-align: center;
        }
        
        .detailed-info {
            background: rgba(58, 134, 255, 0.08);
            border: 1px solid var(--border-light);
            border-radius: 16px;
            padding: 20px;
            margin: 16px 0;
            font-size: 0.98rem;
            color: var(--text-light);
        }
        
        .detailed-info h4 {
            color: var(--primary-blue);
            margin: 12px 0 8px 0;
            font-size: 1.1rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .detailed-info p {
            margin: 6px 0;
            line-height: 1.6;
        }
        
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: var(--z-modal);
            overflow-y: auto;
            backdrop-filter: blur(5px);
        }
        
        .modal-content {
            background: var(--glass);
            margin: 5% auto;
            padding: 30px;
            border-radius: var(--card-radius);
            width: 90%;
            max-width: 700px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border);
            position: relative;
            animation: modalFadeIn 0.3s;
        }
        
        .close-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--muted);
            background: none;
            border: none;
        }
        
        .close-modal:hover {
            color: var(--alert-red);
        }
        
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Mobile menu button */
        .mobile-menu-btn {
            display: none;
            background: var(--glass-2);
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--text-light);
            padding: 12px;
            border-radius: 50%;
            width: 52px;
            height: 52px;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
        }
        
        .mobile-menu-btn:hover {
            background: var(--accent-2);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        /* Patient form styles */
        .patient-form-container {
            padding: 20px 0;
        }
        
        .patient-form-container .form-row {
            margin-bottom: 20px;
        }
        
        .patient-form-container .form-group {
            margin-bottom: 15px;
        }
        
        .patient-form-container textarea {
            width: 100%;
            min-height: 100px;
            padding: 16px 20px;
            border: 1px solid var(--border-light);
            border-radius: 16px;
            font-family: var(--font);
            font-size: 1.05rem;
            background: rgba(255, 255, 255, 0.1);
            color: var(--text-light);
            box-shadow: var(--shadow-sm);
            backdrop-filter: blur(10px);
            resize: vertical;
        }
        
        .patient-form-container textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(0, 180, 216, 0.2);
            background: rgba(255, 255, 255, 0.15);
        }
        
        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
            padding-top: 20px;
            border-top: 1px solid var(--border-light);
        }
        
        /* Notification styles */
        #notification-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 10px;
            max-width: 350px;
        }
        
        .notification {
            padding: 16px 20px;
            border-radius: 12px;
            background: var(--glass);
            backdrop-filter: blur(10px);
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 12px;
            animation: fadeIn 0.3s ease;
        }
        
        .notification-success {
            background: rgba(56, 176, 0, 0.2);
            border-color: rgba(56, 176, 0, 0.3);
            color: var(--success-green);
        }
        
        .notification-error {
            background: rgba(217, 4, 41, 0.2);
            border-color: rgba(217, 4, 41, 0.3);
            color: var(--alert-red);
        }
        
        .notification-info {
            background: rgba(0, 180, 216, 0.2);
            border-color: rgba(0, 180, 216, 0.3);
            color: var(--accent);
        }
        
        .notification-warning {
            background: rgba(255, 202, 58, 0.2);
            border-color: rgba(255, 202, 58, 0.3);
            color: var(--warning-yellow);
        }
        
        .notification-close {
            margin-left: auto;
            background: none;
            border: none;
            cursor: pointer;
            color: inherit;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-12px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        @media (max-width: 1024px) {
            .app {
                border-radius: 16px;
            }
            
            .category-card, .disease-panel, .med-combo, .pae-form, .rcp-guide, .patient-list, .resource-panel {
                border-radius: 16px;
                padding: 24px;
            }
            
            .calculator-container {
                grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            }
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                max-height: 280px;
                border-right: none;
                border-bottom: 1px solid var(--border);
                position: relative;
                z-index: 60;
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .form-group {
                min-width: 100%;
            }
            
            .calculator-container {
                grid-template-columns: 1fr;
            }
            
            .welcome-actions {
                grid-template-columns: 1fr;
            }
            
            .rcp-controls {
                flex-direction: column;
            }
            
            header {
                padding: 16px;
            }
            
            .search-container {
                flex-direction: column;
            }
            
            .btn {
                width: 100%;
            }
            
            .app {
                border-radius: 12px;
            }
            
            .category-card, .disease-panel, .med-combo, .pae-form, .rcp-guide, .patient-list, .resource-panel {
                border-radius: 12px;
                padding: 20px;
            }
            
            .mobile-menu-btn {
                display: flex;
            }
            
            .sidebar.hidden-mobile {
                display: none;
            }
            
            .modal-content {
                width: 95%;
                margin: 10% auto;
                padding: 20px;
            }
        }
        
        @media (max-width: 480px) {
            .app {
                border-radius: 12px;
            }
            
            .category-card, .disease-panel, .med-combo, .pae-form, .rcp-guide, .patient-list, .resource-panel {
                border-radius: 12px;
                padding: 16px;
            }
            
            .cat-btn {
                padding: 14px 18px;
                font-size: 0.95rem;
            }
            
            .input, .btn {
                font-size: 0.95rem;
            }
            
            header h1 {
                font-size: 1.5rem;
            }
            
            .modal-content {
                padding: 16px;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <header>
            <h1><i class="fas fa-microscope brand-icon"></i> Enfermería DAVID · Sistema Completo</h1>
            <div class="controls">
                <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle menu">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </header>
        
        <div class="container">
            <nav class="sidebar" id="sidebar" aria-label="Categorías">
                <div class="sidebar-header">
                    <i class="fas fa-th-large"></i>
                    <h3>Funcionalidades</h3>
                </div>
                <div class="cat-grid" role="navigation">
                    <button class="cat-btn" data-cat="higiene">
                        <i class="fas fa-soap"></i>
                        Higiene Clínica
                    </button>
                    <button class="cat-btn" data-cat="curaciones">
                        <i class="fas fa-band-aid"></i>
                        Curaciones Avanzadas
                    </button>
                    <button class="cat-btn" data-cat="farmaco">
                        <i class="fas fa-pills"></i>
                        Farmacología
                    </button>
                    <button class="cat-btn" data-cat="emergencias">
                        <i class="fas fa-ambulance"></i>
                        Emergencias Médicas
                    </button>
                    <button class="cat-btn" data-cat="movilizacion">
                        <i class="fas fa-wheelchair"></i>
                        Movilización
                    </button>
                    <button class="cat-btn" data-cat="nutricion">
                        <i class="fas fa-utensils"></i>
                        Nutrición
                    </button>
                    <button class="cat-btn" data-cat="infeccion">
                        <i class="fas fa-virus"></i>
                        Control Infecciones
                    </button>
                    <button class="cat-btn" data-cat="medicamentos">
                        <i class="fas fa-prescription-bottle-alt"></i>
                        Medicamentos
                    </button>
                    <button class="cat-btn" data-cat="enfermedades">
                        <i class="fas fa-notes-medical"></i>
                        Enfermedades
                    </button>
                    <button class="cat-btn" data-cat="pae">
                        <i class="fas fa-clipboard-list"></i>
                        PAE Avanzado
                    </button>
                    <button class="cat-btn" data-cat="rcp">
                        <i class="fas fa-heartbeat"></i>
                        RCP Integral
                    </button>
                    <button class="cat-btn" data-cat="calculadoras">
                        <i class="fas fa-calculator"></i>
                        Calculadoras Clínicas
                    </button>
                    <button class="cat-btn" data-cat="recursos">
                        <i class="fas fa-book"></i>
                        Recursos Educativos
                    </button>
                    <button class="cat-btn active" data-cat="pacientes">
                        <i class="fas fa-users"></i>
                        Gestión de Pacientes
                    </button>
                </div>
                <div class="small">
                    Seleccione una categoría para acceder a procedimientos, guías clínicas, combinador de fármacos, enfermedades y más funciones especializadas.
                </div>
            </nav>
            
            <main class="panel" id="mainPanel" aria-live="polite">
                <div class="search-container">
                    <input id="globalSearch" class="input" placeholder="Buscar procedimiento, enfermedad, medicamento o paciente..." aria-label="Buscar">
                    <button id="searchBtn" class="btn primary">
                        <i class="fas fa-search"></i> Buscar
                    </button>
                    <button id="openAllBtn" class="btn secondary">
                        <i class="fas fa-expand"></i> Mostrar Todo
                    </button>
                </div>
                
                <div class="content-area" id="contentArea">
                    <!-- Panel de pacientes como vista principal -->
                    <div class="patient-list" id="pacientes">
                        <h2><i class="fas fa-users"></i> Gestión Integral de Pacientes</h2>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="patient-search"><i class="fas fa-search"></i> Buscar paciente por nombre</label>
                                <input type="text" id="patient-search" class="form-control" placeholder="Nombre del paciente...">
                            </div>
                            <div class="form-group">
                                <label for="patient-specialty"><i class="fas fa-stethoscope"></i> Especialidad médica</label>
                                <select id="patient-specialty" class="form-control">
                                    <option value="">Todas las especialidades</option>
                                    <option value="Cardiología">Cardiología</option>
                                    <option value="Neumología">Neumología</option>
                                    <option value="Endocrinología">Endocrinología</option>
                                    <option value="Neurología">Neurología</option>
                                    <option value="Oncología">Oncología</option>
                                    <option value="Nefrología">Nefrología</option>
                                    <option value="Gastroenterología">Gastroenterología</option>
                                    <option value="Reumatología">Reumatología</option>
                                </select>
                            </div>
                        </div>
                        <div style="margin-top:14px;display:flex;gap:12px;flex-wrap:wrap">
                            <button id="addPatientBtn" class="btn primary">
                                <i class="fas fa-plus"></i> Agregar Nuevo Paciente
                            </button>
                            <button id="exportPatientsBtn" class="btn secondary">
                                <i class="fas fa-file-export"></i> Exportar Pacientes
                            </button>
                        </div>
                        <div id="patients-container"></div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <!-- Modal para crear/editar pacientes -->
    <div class="modal" id="patientModal">
        <div class="modal-content">
            <button class="close-modal" id="closePatientModal">&times;</button>
            <h2><i class="fas fa-user-plus"></i> <span id="patientModalTitle">Agregar Nuevo Paciente</span></h2>
            
            <div class="patient-form-container">
                <div class="form-row">
                    <div class="form-group">
                        <label for="modal-patient-name"><i class="fas fa-user"></i> Nombre del Paciente</label>
                        <input type="text" id="modal-patient-name" class="form-control" placeholder="Nombre completo del paciente">
                    </div>
                    <div class="form-group">
                        <label for="modal-patient-age"><i class="fas fa-birthday-cake"></i> Edad</label>
                        <input type="number" id="modal-patient-age" class="form-control" placeholder="Edad en años">
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="modal-patient-diagnosis"><i class="fas fa-diagnoses"></i> Diagnóstico Principal</label>
                        <input type="text" id="modal-patient-diagnosis" class="form-control" placeholder="Diagnóstico médico principal">
                    </div>
                    <div class="form-group">
                        <label for="modal-patient-specialty"><i class="fas fa-stethoscope"></i> Especialidad</label>
                        <select id="modal-patient-specialty" class="form-control">
                            <option value="">Seleccionar especialidad...</option>
                            <option value="Cardiología">Cardiología</option>
                            <option value="Neumología">Neumología</option>
                            <option value="Endocrinología">Endocrinología</option>
                            <option value="Neurología">Neurología</option>
                            <option value="Oncología">Oncología</option>
                            <option value="Nefrología">Nefrología</option>
                            <option value="Gastroenterología">Gastroenterología</option>
                            <option value="Reumatología">Reumatología</option>
                        </select>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="modal-patient-allergies"><i class="fas fa-allergies"></i> Alergias</label>
                    <input type="text" id="modal-patient-allergies" class="form-control" placeholder="Lista de alergias separadas por coma">
                </div>
                
                <div class="form-group">
                    <label for="modal-patient-history"><i class="fas fa-notes-medical"></i> Resumen de Historia Clínica</label>
                    <textarea id="modal-patient-history" class="form-control" placeholder="Resumen de la historia clínica del paciente..."></textarea>
                </div>
                
                <div class="form-actions">
                    <button type="button" class="btn ghost" id="cancelPatientBtn">Cancelar</button>
                    <button type="button" class="btn primary" id="savePatientBtn">Guardar Paciente</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Helper function to get element by ID
        function $(id) {
            return document.getElementById(id);
        }
        
        // Theme toggle functionality
        const themeToggle = $('themeToggle');
        const html = document.documentElement;
        const themeIcon = themeToggle.querySelector('i');
        
        // Check for saved theme preference or use preferred color scheme
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            html.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
        } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            html.setAttribute('data-theme', 'dark');
            updateThemeIcon('dark');
        } else {
            updateThemeIcon('light');
        }
        
        function updateThemeIcon(theme) {
            if (theme === 'dark') {
                themeIcon.className = 'fas fa-sun';
            } else {
                themeIcon.className = 'fas fa-moon';
            }
        }
        
        themeToggle.addEventListener('click', () => {
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        });
        
        // Mobile menu toggle
        const mobileMenuBtn = $('mobileMenuBtn');
        const sidebar = $('sidebar');
        
        mobileMenuBtn.addEventListener('click', () => {
            sidebar.classList.toggle('hidden-mobile');
        });
        
        // Procedimientos de enfermería
        const PROCEDURES = {
            higiene: [
                {
                    id: 'lavado_mano',
                    title: 'Lavado de manos',
                    summary: 'Técnica esencial para prevenir infecciones según protocolos de la OMS.',
                    materials: ['Jabón', 'Agua', 'Toalla desechable', 'Gel alcohólico 70%'],
                    steps: [
                        'Retirar joyas и reloj',
                        'Mojar manos con agua',
                        'Aplicar jabón suficiente',
                        'Frotar palmas, dorsos, entre dedos y pulgares ≥20s',
                        'Enjuagar abundantemente',
                        'Secar con toalla desechable',
                        'Cerrar grifo con toalla'
                    ],
                    notes: 'Crucial antes y después del contacto con paciente. Realice el lavado de manos siguiendo los 7 pasos recomendados por la OMS.'
                },
                {
                    id: 'baño_cama',
                    title: 'Baño en cama',
                    summary: 'Higiene integral del paciente encamado con prevención de lesiones.',
                    materials: ['Toallas', 'Agua tibia', 'Jabón suave', 'Guantes', 'Sábana impermeable', 'Báscula'],
                    steps: [
                        'Preparar equipo y ambiente',
                        'Explicar procedimiento al paciente',
                        'Proteger intimidad con cortinas',
                        'Colocar sábana impermeable',
                        'Limpiar de proximal a distal',
                        'Secar y vestir',
                        'Cambiar sábana si está húmeda',
                        'Documentar procedimiento'
                    ],
                    notes: 'Evite fricciones excesivas. Revise áreas de riesgo para escaras. Mantenga al paciente abrigado durante el procedimiento.'
                }
            ],
            curaciones: [
                {
                    id: 'curacion_quirurgica',
                    title: 'Curación de herida quirúrgica',
                    summary: 'Técnica aséptica para el cuidado de heridas quirúrgicas.',
                    materials: ['Guantes estériles', 'Gasas estériles', 'Solución salina', 'Antiséptico', 'Apósito', 'Tijeras estériles'],
                    steps: [
                        'Lavado de manos',
                        'Preparar material estéril',
                        'Retirar apósito anterior con cuidado',
                        'Evaluar características de la herida',
                        'Limpiar con solución salina de centro a periferia',
                        'Aplicar antiséptico si es necesario',
                        'Colocar nuevo apósito estéril',
                        'Fijar adecuadamente',
                        'Documentar procedimiento'
                    ],
                    notes: 'Observar signos de infección: enrojecimiento, calor, dolor, edema, secreción purulenta.'
                }
            ]
        };
        
        // Enfermedades comunes
        const DISEASES = [
            {
                name: 'Neumonía',
                summary: 'Infección inflamatoria aguda del parénquima pulmonar, generalmente bacteriana o viral. Presenta fiebre, tos productiva, disnea y crepitaciones. Cuidados: oxigenoterapia, movilización, antibióticos según guía.',
                detailed: {
                    etiologia: 'Bacteriana (Streptococcus pneumoniae), viral (influenza), atípica (Mycoplasma). Factores de riesgo: edad, tabaquismo, enfermedad pulmonar crónica.',
                    sintomas: 'Fiebre, tos productiva, disnea, dolor torácico pleurítico, escalofríos, sudoración nocturna.',
                    diagnostico: 'Radiografía de tórax, análisis de sangre, cultivo de esputo, gasometría arterial en casos graves.',
                    tratamiento: 'Antibióticos empíricos según gravedad, oxigenoterapia, hidratación, fisioterapia respiratoria.',
                    prevencion: 'Vacunación antineumocócica e influenza, abandono del tabaquismo, higiene de manos.'
                }
            },
            {
                name: 'Diabetes Mellitus',
                summary: 'Enfermedad metabólica caracterizada por niveles elevados de glucosa en sangre. Requiere control estricto de glucemia, dieta y medicación.',
                detailed: {
                    etiologia: 'Tipo 1: destrucción autoinmune de células β pancreáticas. Tipo 2: resistencia a la insulina y deficiencia relativa de insulina.',
                    sintomas: 'Poliuria, polidipsia, polifagia, pérdida de peso, visión borrosa, fatiga.',
                    diagnostico: 'Glucemia en ayunas ≥126 mg/dL, hemoglobina glicosilada ≥6.5%, prueba de tolerancia a la glucosa alterada.',
                    tratamiento: 'Dieta, ejercicio, antidiabéticos orales, insulina, monitorización de glucemia.',
                    prevencion: 'Estilo de vida saludable, control de peso, ejercicio regular, dieta equilibrada.'
                }
            }
        ];
        
        // Medicamentos y combinaciones peligrosas
        const NEVER_COMBINE = [
            { a: 'warfarina', b: 'ibuprofeno', reason: 'Aumento del riesgo de hemorragia gastrointestinal y sistémica', ref: 'https://www.ncbi.nlm.nih.gov/books/NBK545235/' },
            { a: 'sertralina', b: 'tramadol', reason: 'Riesgo de síndrome serotoninérgico y convulsiones', ref: 'https://www.ncbi.nlm.nih.gov/books/NBK537237/' },
            { a: 'omeprazol', b: 'clopidogrel', reason: 'Disminución del efecto antiagregante plaquetario', ref: 'https://www.ncbi.nlm.nih.gov/books/NBK548274/' }
        ];
        
        const MEDS = [
            'Warfarina', 'Ibuprofeno', 'Paracetamol', 'Ciprofloxacina', 'Metformina',
            'Sertralina', 'Omeprazol', 'Sildenafil', 'Nitroglicerina', 'Clopidogrel',
            'Atorvastatina', 'Amlodipino', 'Losartán', 'Metoprolol', 'Insulina',
            'Aspirina', 'Tramadol', 'Diazepam', 'Loratadina', 'Amoxicilina'
        ];
        
        // Pacientes
        const PATIENTS_KEY = 'enfermeria_david_pacientes';
        const PAE_KEY = 'enfermeria_david_pae';
        const RECURSOS_KEY = 'enfermeria_david_recursos';
        
        // Funciones de almacenamiento persistente
        function getStoredData(key, defaultValue = []) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : defaultValue;
            } catch (e) {
                console.error('Error reading from localStorage:', e);
                showNotification('Error al cargar datos almacenados. Algunas funciones pueden no estar disponibles.', 'error');
                return defaultValue;
            }
        }
        
        function setStoredData(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
                return true;
            } catch (e) {
                console.error('Error writing to localStorage:', e);
                showNotification('Error al guardar datos. Verifique el almacenamiento del navegador.', 'error');
                return false;
            }
        }
        
        // Obtener datos almacenados o usar datos iniciales
        let PACIENTES = getStoredData(PATIENTS_KEY, [
            {
                id: 1,
                nombre: 'María González',
                edad: 65,
                diagnosticoPrincipal: 'Diabetes mellitus tipo 2',
                especialidad: 'Endocrinología',
                riesgoCardiovascular: 'moderado',
                alergias: ['Penicilina'],
                historiaClinica: {
                    resumen: 'Paciente femenina de 65 años con diabetes tipo 2 diagnosticada hace 10 años. Buen control glucémico actual con metformina y estilo de vida.',
                    diagnosticos: [
                        { fecha: '2023-05-10', cie10: 'E11.9', descripcion: 'Diabetes mellitus tipo 2', estado: 'Activo' },
                        { fecha: '2022-11-15', cie10: 'I10', descripcion: 'Hipertensión esencial', estado: 'Controlado' }
                    ],
                    tratamientos: [
                        { medicamento: 'Metformina', dosis: '850 mg', frecuencia: 'Cada 12 horas', inicio: '2023-05-10' },
                        { medicamento: 'Losartán', dosis: '50 mg', frecuencia: 'Una vez al día', inicio: '2022-11-15' }
                    ],
                    evolucion: [
                        { fecha: '2023-10-20', nota: 'Paciente estable, glucemias en rango objetivo. Refiere adherencia al tratamiento.' }
                    ],
                    signosVitales: [
                        { fecha: '2023-10-20', tensionArterial: '130/80', frecuenciaCardiaca: '72', temperatura: '36.5', saturacionOxigeno: '98%' }
                    ],
                    controles: [
                        { tipo: 'Control diabetes', proximo: '2023-11-20' },
                        { tipo: 'Laboratorio', proximo: '2024-01-15' }
                    ]
                }
            },
            {
                id: 2,
                nombre: 'Juan Pérez',
                edad: 72,
                diagnosticoPrincipal: 'Hipertensión arterial',
                especialidad: 'Cardiología',
                riesgoCardiovascular: 'alto',
                alergias: [],
                historiaClinica: {
                    resumen: 'Paciente masculino de 72 años con hipertensión arterial de 15 años de evolución. EPOC leve asociado. Tabaquismo previo.',
                    diagnosticos: [
                        { fecha: '2018-03-22', cie10: 'I10', descripcion: 'Hipertensión esencial', estado: 'Activo' },
                        { fecha: '2020-08-14', cie10: 'J44.9', descripcion: 'EPOC no especificado', estado: 'Estable' }
                    ],
                    tratamientos: [
                        { medicamento: 'Amlodipino', dosis: '5 mg', frecuencia: 'Una vez al día', inicio: '2018-03-22' },
                        { medicamento: 'Salbutamol', dosis: '100 mcg', frecuencia: 'Según necesidad', inicio: '2020-08-14' }
                    ],
                    evolucion: [
                        { fecha: '2023-10-18', nota: 'Tensión arterial controlada. EPOC estable. Recomendado ejercicio moderado.' }
                    ],
                    signosVitales: [
                        { fecha: '2023-10-18', tensionArterial: '125/75', frecuenciaCardiaca: '68', temperatura: '36.7', saturacionOxigeno: '96%' }
                    ],
                    controles: [
                        { tipo: 'Control hipertensión', proximo: '2023-11-18' },
                        { tipo: 'Espirometría', proximo: '2024-02-01' }
                    ]
                }
            }
        ]);
        
        let RECURSOS = getStoredData(RECURSOS_KEY, [
            {
                id: 1,
                titulo: 'Guía de Práctica Clínica: Manejo de la Diabetes Tipo 2',
                categoria: 'Protocolos',
                tipo: 'documento',
                url: 'https://example.com/diabetes2.pdf',
                etiquetas: ['diabetes', 'endocrinología', 'protocolo', 'tratamiento'],
                descripcion: 'Guía actualizada basada en evidencia para el manejo integral de la diabetes mellitus tipo 2, incluyendo objetivos terapéuticos, algoritmos de tratamiento y prevención de complicaciones.'
            },
            {
                id: 2,
                titulo: 'Técnicas de Venopunción',
                categoria: 'Videos',
                tipo: 'video',
                url: 'https://example.com/venopuncion',
                etiquetas: ['venopunción', 'técnica', 'video', 'procedimiento'],
                descripcion: 'Video demostrativo de las técnicas adecuadas para la venopunción, incluyendo selección del sitio, preparación del equipo y método para minimizar molestias al paciente.'
            }
        ]);
        
        // Variables globales
        let currentEditingPatientId = null;
        
        // Content area and functions
        const contentArea = $('contentArea');
        
        // Modal elements
        const patientModal = $('patientModal');
        const patientModalTitle = $('patientModalTitle');
        const closePatientModal = $('closePatientModal');
        const cancelPatientBtn = $('cancelPatientBtn');
        const savePatientBtn = $('savePatientBtn');
        
        function clearContent() {
            contentArea.innerHTML = '';
            
            // Remove active state from all buttons
            document.querySelectorAll('.cat-btn').forEach(btn => {
                btn.classList.remove('active');
            });
        }
        
        function getCatTitle(cat) {
            const titles = {
                'higiene': 'Procedimientos de Higiene Clínica',
                'curaciones': 'Técnicas Avanzadas de Curación',
                'farmaco': 'Farmacología y Administración de Medicamentos',
                'emergencias': 'Manejo de Emergencias Médicas',
                'movilizacion': 'Técnicas de Movilización',
                'nutricion': 'Cuidados Nutricionales',
                'infeccion': 'Control de Infecciones',
                'medicamentos': 'Gestión de Medicamentos',
                'enfermedades': 'Enfermedades y Condiciones',
                'pae': 'Plan de Atención de Enfermería',
                'rcp': 'Reanimación Cardiovascular',
                'calculadoras': 'Calculadoras Clínicas',
                'recursos': 'Recursos Educativos',
                'pacientes': 'Gestión de Pacientes'
            };
            return titles[cat] || cat;
        }
        
        // Show pacientes
        function showPacientes() {
            clearContent();
            
            // Add active state to the selected button
            document.querySelectorAll('.cat-btn').forEach(btn => {
                if (btn.getAttribute('data-cat') === 'pacientes') {
                    btn.classList.add('active');
                }
            });
            
            const pacientesHTML = `
                <div class="patient-list" id="pacientes">
                    <h2><i class="fas fa-users"></i> Gestión Integral de Pacientes</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="patient-search"><i class="fas fa-search"></i> Buscar paciente por nombre</label>
                            <input type="text" id="patient-search" class="form-control" placeholder="Nombre del paciente...">
                        </div>
                        <div class="form-group">
                            <label for="patient-specialty"><i class="fas fa-stethoscope"></i> Especialidad médica</label>
                            <select id="patient-specialty" class="form-control">
                                <option value="">Todas las especialidades</option>
                                <option value="Cardiología">Cardiología</option>
                                <option value="Neumología">Neumología</option>
                                <option value="Endocrinología">Endocrinología</option>
                                <option value="Neurología">Neurología</option>
                                <option value="Oncología">Oncología</option>
                                <option value="Nefrología">Nefrología</option>
                                <option value="Gastroenterología">Gastroenterología</option>
                                <option value="Reumatología">Reumatología</option>
                            </select>
                        </div>
                    </div>
                    <div style="margin-top:14px;display:flex;gap:12px;flex-wrap:wrap">
                        <button id="addPatientBtn" class="btn primary">
                            <i class="fas fa-plus"></i> Agregar Nuevo Paciente
                        </button>
                        <button id="exportPatientsBtn" class="btn secondary">
                            <i class="fas fa-file-export"></i> Exportar Pacientes
                        </button>
                    </div>
                    <div id="patients-container"></div>
                </div>
            `;
            
            contentArea.innerHTML = pacientesHTML;
            
            // Add event listeners
            $('patient-search').addEventListener('input', updatePatientGrid);
            $('patient-specialty').addEventListener('change', updatePatientGrid);
            $('addPatientBtn').addEventListener('click', () => {
                openPatientModal();
            });
            $('exportPatientsBtn').addEventListener('click', () => {
                exportPatients();
            });
            
            updatePatientGrid();
        }
        
        // Update patient grid
        function updatePatientGrid() {
            const container = $('patients-container');
            if (!container) return;
            
            const search = ($('patient-search') ? $('patient-search').value : '').toLowerCase();
            const specialty = ($('patient-specialty') ? $('patient-specialty').value : '');
            
            const filteredPatients = PACIENTES.filter(p => {
                const matchesSearch = !search || p.nombre.toLowerCase().includes(search) || 
                                    p.diagnosticoPrincipal.toLowerCase().includes(search);
                const matchesSpecialty = !specialty || p.especialidad === specialty;
                return matchesSearch && matchesSpecialty;
            });
            
            if (filteredPatients.length === 0) {
                container.innerHTML = '<p class="small">No se encontraron pacientes que coincidan con los criterios de búsqueda.</p>';
                return;
            }
            
            container.innerHTML = filteredPatients.map(p => 
                `<div class="patient-card" data-id="${p.id}">
                    <h3><i class="fas fa-user"></i> ${p.nombre}</h3>
                    <p><i class="fas fa-birthday-cake"></i> Edad: ${p.edad} años</p>
                    <p><i class="fas fa-diagnoses"></i> Diagnóstico: ${p.diagnosticoPrincipal}</p>
                    <p><i class="fas fa-stethoscope"></i> Especialidad: ${p.especialidad}</p>
                    <p><i class="fas fa-heartbeat"></i> Riesgo cardiovascular: ${p.riesgoCardiovascular}</p>
                    <p><i class="fas fa-allergies"></i> Alergias: ${p.alergias.length > 0 ? p.alergias.join(', ') : 'Ninguna registrada'}</p>
                    <div class="detailed-info" style="margin-top:12px;">
                        <h4><i class="fas fa-notes-medical"></i> Información Clínica</h4>
                        <p><strong>Resumen:</strong> ${p.historiaClinica.resumen}</p>
                        <p><strong>Diagnosticos:</strong> ${p.historiaClinica.diagnosticos.map(d => d.descripcion).join(', ')}</p>
                        <p><strong>Tratamientos:</strong> ${p.historiaClinica.tratamientos.map(t => t.medicamento).join(', ')}</p>
                        <p><strong>Próximos controles:</strong> ${p.historiaClinica.controles.map(c => c.tipo + ' (' + c.proximo + ')').join(', ')}</p>
                    </div>
                    <div style="margin-top:16px; display:flex; gap:10px;">
                        <button class="btn small edit-patient" data-id="${p.id}">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="btn small ghost delete-patient" data-id="${p.id}">
                            <i class="fas fa-trash"></i> Eliminar
                        </button>
                    </div>
                </div>`
            ).join('');
            
            // Add event listeners to edit buttons
            document.querySelectorAll('.edit-patient').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const patientId = parseInt(btn.getAttribute('data-id'));
                    openPatientModal(patientId);
                });
            });
            
            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-patient').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const patientId = parseInt(btn.getAttribute('data-id'));
                    deletePatient(patientId);
                });
            });
        }
        
        // Export patients
        function exportPatients() {
            if (PACIENTES.length === 0) {
                showNotification('No hay pacientes para exportar', 'error');
                return;
            }
            
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(PACIENTES, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "pacientes_enfermeria_david.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            showNotification('Pacientes exportados correctamente', 'success');
        }
        
        // Modal functions
        function openPatientModal(patientId = null) {
            currentEditingPatientId = patientId;
            
            if (patientId) {
                // Editing existing patient
                const patient = PACIENTES.find(p => p.id === patientId);
                if (patient) {
                    patientModalTitle.textContent = 'Editar Paciente';
                    $('modal-patient-name').value = patient.nombre;
                    $('modal-patient-age').value = patient.edad;
                    $('modal-patient-diagnosis').value = patient.diagnosticoPrincipal;
                    $('modal-patient-specialty').value = patient.especialidad;
                    $('modal-patient-allergies').value = patient.alergias.join(', ');
                    $('modal-patient-history').value = patient.historiaClinica.resumen;
                }
            } else {
                // Adding new patient
                patientModalTitle.textContent = 'Agregar Nuevo Paciente';
                $('modal-patient-name').value = '';
                $('modal-patient-age').value = '';
                $('modal-patient-diagnosis').value = '';
                $('modal-patient-specialty').value = '';
                $('modal-patient-allergies').value = '';
                $('modal-patient-history').value = '';
            }
            
            patientModal.style.display = 'block';
        }
        
        function closePatientModal() {
            patientModal.style.display = 'none';
            currentEditingPatientId = null;
        }
        
        function savePatient() {
            const name = $('modal-patient-name').value.trim();
            const age = parseInt($('modal-patient-age').value);
            const diagnosis = $('modal-patient-diagnosis').value.trim();
            const specialty = $('modal-patient-specialty').value;
            const allergies = $('modal-patient-allergies').value.split(',').map(a => a.trim()).filter(a => a);
            const history = $('modal-patient-history').value.trim();
            
            if (!name || !age || !diagnosis || !specialty) {
                showNotification('Por favor, complete todos los campos obligatorios', 'error');
                return;
            }
            
            if (currentEditingPatientId) {
                // Update existing patient
                const patientIndex = PACIENTES.findIndex(p => p.id === currentEditingPatientId);
                if (patientIndex !== -1) {
                    PACIENTES[patientIndex] = {
                        ...PACIENTES[patientIndex],
                        nombre: name,
                        edad: age,
                        diagnosticoPrincipal: diagnosis,
                        especialidad: specialty,
                        alergias: allergies,
                        historiaClinica: {
                            ...PACIENTES[patientIndex].historiaClinica,
                            resumen: history
                        }
                    };
                    
                    if (setStoredData(PATIENTS_KEY, PACIENTES)) {
                        showNotification('Paciente actualizado con éxito', 'success');
                    }
                }
            } else {
                // Add new patient
                const newPatient = {
                    id: PACIENTES.length > 0 ? Math.max(...PACIENTES.map(p => p.id)) + 1 : 1,
                    nombre: name,
                    edad: age,
                    diagnosticoPrincipal: diagnosis,
                    especialidad: specialty,
                    riesgoCardiovascular: 'moderado',
                    alergias: allergies,
                    historiaClinica: {
                        resumen: history,
                        diagnosticos: [
                            { fecha: new Date().toISOString().split('T')[0], cie10: 'XX.X', descripcion: diagnosis, estado: 'Activo' }
                        ],
                        tratamientos: [],
                        evolucion: [
                            { fecha: new Date().toISOString().split('T')[0], nota: 'Paciente agregado al sistema.' }
                        ],
                        signosVitales: [],
                        controles: []
                    }
                };
                
                PACIENTES.push(newPatient);
                if (setStoredData(PATIENTS_KEY, PACIENTES)) {
                    showNotification('Paciente agregado con éxito', 'success');
                }
            }
            
            updatePatientGrid();
            closePatientModal();
        }
        
        function deletePatient(patientId) {
            if (confirm('¿Está seguro de que desea eliminar este paciente? Esta acción no se puede deshacer.')) {
                PACIENTES = PACIENTES.filter(p => p.id !== patientId);
                if (setStoredData(PATIENTS_KEY, PACIENTES)) {
                    showNotification('Paciente eliminado correctamente', 'success');
                    updatePatientGrid();
                }
            }
        }
        
        // Modal event listeners
        closePatientModal.addEventListener('click', closePatientModal);
        cancelPatientBtn.addEventListener('click', closePatientModal);
        savePatientBtn.addEventListener('click', savePatient);
        
        // Close modal when clicking outside
        window.addEventListener('click', (e) => {
            if (e.target === patientModal) {
                closePatientModal();
            }
        });
        
        // Notification system
        function showNotification(message, type = 'info') {
            // Create notification container if it doesn't exist
            let container = document.getElementById('notification-container');
            if (!container) {
                container = document.createElement('div');
                container.id = 'notification-container';
                container.style.cssText = `
                    position: fixed;
                    top: 20px;
                    right: 20px;
                    z-index: 1000;
                    display: flex;
                    flex-direction: column;
                    gap: 10px;
                    max-width: 350px;
                `;
                document.body.appendChild(container);
            }
            
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-icon">
                    ${type === 'success' ? '<i class="fas fa-check-circle"></i>' : 
                      type === 'error' ? '<i class="fas fa-exclamation-triangle"></i>' : 
                      type === 'warning' ? '<i class="fas fa-exclamation-triangle"></i>' : 
                      '<i class="fas fa-info-circle"></i>'}
                </div>
                <div class="notification-message">${message}</div>
                <button class="notification-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            
            container.appendChild(notification);
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }
        
        // Event listeners for category buttons
        document.querySelectorAll('.cat-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const cat = btn.getAttribute('data-cat');
                
                if (cat === 'pacientes') {
                    showPacientes();
                } else {
                    showNotification(`Función ${getCatTitle(cat)} en desarrollo`, 'info');
                }
                
                // En móviles, ocultar el menú después de seleccionar una opción
                if (window.innerWidth <= 768) {
                    sidebar.classList.add('hidden-mobile');
                }
            });
        });
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            // Set initial state - show patients by default
            showPacientes();
            
            // Show success notification for storage
            if (typeof(Storage) !== "undefined") {
                showNotification('Sistema de almacenamiento local habilitado', 'success');
            } else {
                showNotification('Su navegador no soporta almacenamiento local. Algunas funciones estarán limitadas.', 'error');
            }
        });
    </script>
</body>
</html>
