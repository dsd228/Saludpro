```html
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Enfermer√≠a DAVID ¬∑ Final Full ‚Äî procedimientos, PAE, combinador f√°rmacos, enfermedades, RCP, PWA.">
    <title>Enfermer√≠a DAVID ¬∑ Final Full</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg: linear-gradient(180deg, #e0f7fa, #b2ebf2);
            --glass: rgba(255, 255, 255, 0.7);
            --glass-2: rgba(255, 255, 255, 0.15);
            --accent: #26a69a;
            --accent-2: #4db6ac;
            --primary-blue: #1a73e8;
            --primary-blue-darker: #0d47a1;
            --primary-blue-lighter: #e8f0fe;
            --success-green: #34a853;
            --warning-yellow: #f9ab00;
            --alert-red: #ea4335;
            --accent-teal: #00897b;
            --accent-purple: #7b1fa2;
            --background-light: #f8f9fa;
            --text-dark: #2c4a52;
            --text-light: #ffffff;
            --muted: #546e7a;
            --danger: #e57373;
            --card-radius: 16px;
            --shadow: 0 10px 30px rgba(38, 166, 154, 0.15);
            --tap: 48px;
            --font: 'Roboto', system-ui, -apple-system, "Segoe UI", Roboto, Arial;
            --maxwidth: 1100px;
            --border: #b2ebf2;
        }
        
        :root[data-theme="dark"] {
            --bg: linear-gradient(180deg, #0a232f, #08313a);
            --glass: rgba(16, 52, 64, 0.75);
            --glass-2: rgba(255, 255, 255, 0.05);
            --accent: #4db6ac;
            --accent-2: #26a69a;
            --text-dark: #ffffff;
            --text-light: #e0f7fa;
            --muted: #8caab5;
            --border: #006064;
            --background-light: #0a232f;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            transition: background-color 0.3s, color 0.3s;
        }
        
        html, body {
            height: 100%;
            margin: 0;
            font-family: var(--font);
            background: var(--bg);
            -webkit-font-smoothing: antialiased;
            display: flex;
            justify-content: center;
            padding: 12px;
            color: var(--text-dark);
        }
        
        .app {
            width: 100%;
            max-width: var(--maxwidth);
            height: calc(100vh - 24px);
            display: flex;
            flex-direction: column;
            background: var(--glass);
            backdrop-filter: blur(10px);
            border-radius: var(--card-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
        }
        
        header {
            padding: 16px;
            background: rgba(255, 255, 255, 0.9);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        header h1 {
            font-size: 1.5rem;
            font-weight: 500;
            color: var(--accent);
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .theme-toggle {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--accent);
            padding: 8px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .theme-toggle:hover {
            background: var(--glass-2);
        }
        
        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        .sidebar {
            width: 280px;
            background: var(--glass);
            border-right: 1px solid var(--border);
            padding: 16px;
            overflow-y: auto;
        }
        
        .cat-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 8px;
        }
        
        .cat-btn {
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            background: var(--glass-2);
            color: var(--text-dark);
            font-weight: 500;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .cat-btn:hover {
            background: var(--accent-2);
            color: white;
            transform: translateY(-2px);
        }
        
        .cat-btn.full {
            grid-column: span 2;
        }
        
        .cat-btn[data-cat="higiene"]::before { content: "üß¥"; }
        .cat-btn[data-cat="curaciones"]::before { content: "ü©π"; }
        .cat-btn[data-cat="farmaco"]::before { content: "üíä"; }
        .cat-btn[data-cat="emergencias"]::before { content: "üö®"; }
        .cat-btn[data-cat="movilizacion"]::before { content: "ü¶Ω"; }
        .cat-btn[data-cat="nutricion"]::before { content: "ü•ó"; }
        .cat-btn[data-cat="infeccion"]::before { content: "ü¶†"; }
        .cat-btn[data-cat="medicamentos"]::before { content: "üìã"; }
        .cat-btn[data-cat="enfermedades"]::before { content: "üè•"; }
        .cat-btn[data-cat="pae"]::before { content: "üìã"; }
        .cat-btn[data-cat="rcp"]::before { content: "‚ù§Ô∏è"; }
        .cat-btn[data-cat="calculadoras"]::before { content: "üßÆ"; }
        .cat-btn[data-cat="recursos"]::before { content: "üìö"; }
        .cat-btn[data-cat="pacientes"]::before { content: "üë•"; }
        
        .small {
            font-size: 0.8rem;
            color: var(--muted);
            margin-top: 8px;
        }
        
        main {
            flex: 1;
            padding: 16px;
            overflow-y: auto;
            background: var(--background-light);
        }
        
        .search-container {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }
        
        .input {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-family: var(--font);
            font-size: 1rem;
            background: white;
            color: var(--text-dark);
        }
        
        .btn {
            padding: 12px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn.primary {
            background: var(--accent);
            color: white;
        }
        
        .btn.primary:hover {
            background: var(--accent-2);
        }
        
        .btn.secondary {
            background: var(--primary-blue);
            color: white;
        }
        
        .btn.secondary:hover {
            background: var(--primary-blue-darker);
        }
        
        .btn.ghost {
            background: transparent;
            color: var(--accent);
            border: 1px solid var(--accent);
        }
        
        .btn.ghost:hover {
            background: var(--glass-2);
        }
        
        .content-area {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }
        
        .category-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
        }
        
        .category-card h2 {
            color: var(--accent);
            margin-bottom: 12px;
            font-size: 1.3rem;
        }
        
        .category-card h3 {
            color: var(--accent-2);
            margin: 12px 0 8px 0;
            font-size: 1.1rem;
        }
        
        .category-card h4 {
            color: var(--primary-blue);
            margin: 8px 0 4px 0;
            font-size: 1rem;
        }
        
        .procedure {
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px dashed var(--border);
        }
        
        .procedure:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .procedure h3 {
            color: var(--accent-2);
            margin-bottom: 8px;
        }
        
        .procedure p {
            margin: 4px 0;
            color: var(--text-dark);
        }
        
        .procedure .summary {
            font-style: italic;
            color: var(--muted);
            margin-bottom: 8px;
        }
        
        .materials, .steps, .notes {
            margin: 8px 0;
        }
        
        .materials ul, .steps ol {
            margin: 8px 0;
            padding-left: 20px;
        }
        
        .materials li, .steps li {
            margin: 4px 0;
        }
        
        .notes {
            background: var(--primary-blue-lighter);
            padding: 8px 12px;
            border-radius: 8px;
            border-left: 4px solid var(--primary-blue);
        }
        
        .disease-panel {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
            margin-top: 16px;
        }
        
        .disease-panel h2 {
            color: var(--accent);
            margin-bottom: 12px;
        }
        
        .disease-item {
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px dashed var(--border);
        }
        
        .disease-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .disease-item strong {
            color: var(--accent-2);
        }
        
        .disease-item .small {
            font-size: 0.9rem;
            color: var(--muted);
            margin-top: 4px;
        }
        
        .med-combo {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
            margin-top: 16px;
        }
        
        .med-combo h2 {
            color: var(--accent);
            margin-bottom: 16px;
        }
        
        .form-row {
            display: flex;
            gap: 16px;
            margin-bottom: 16px;
            flex-wrap: wrap;
        }
        
        .form-group {
            flex: 1;
            min-width: 200px;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-dark);
        }
        
        select.form-control, input.form-control {
            width: 100%;
            padding: 12px 16px;
            border: 1px solid var(--border);
            border-radius: 8px;
            font-family: var(--font);
            font-size: 1rem;
            background: white;
            color: var(--text-dark);
        }
        
        .interactions-warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 12px 16px;
            margin: 16px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .interactions-warning.danger {
            background: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
        
        .interactions-warning.success {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        
        .interactions-list {
            margin: 8px 0 0 28px;
        }
        
        .interactions-list li {
            margin: 4px 0;
        }
        
        .pae-form {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
            margin-top: 16px;
        }
        
        .pae-form h2 {
            color: var(--accent);
            margin-bottom: 16px;
        }
        
        .rcp-guide {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
            margin-top: 16px;
        }
        
        .rcp-guide h2 {
            color: var(--accent);
            margin-bottom: 16px;
        }
        
        .rcp-step {
            margin-bottom: 16px;
            padding-left: 28px;
            position: relative;
        }
        
        .rcp-step::before {
            content: attr(data-step);
            position: absolute;
            left: 0;
            top: 0;
            width: 24px;
            height: 24px;
            background: var(--accent);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .score-result {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
            margin-top: 16px;
            text-align: center;
        }
        
        .score-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--accent);
            margin: 16px 0;
        }
        
        .score-category {
            font-size: 1.2rem;
            font-weight: 500;
            color: var(--accent-2);
        }
        
        .tab-container {
            margin-top: 16px;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border);
            margin-bottom: 16px;
        }
        
        .tab {
            padding: 12px 16px;
            cursor: pointer;
            font-weight: 500;
            color: var(--muted);
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            color: var(--accent);
            border-bottom: 3px solid var(--accent);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .calculator-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 16px;
        }
        
        .calculator-form {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
        }
        
        .calculator-form h3 {
            color: var(--accent);
            margin-bottom: 16px;
        }
        
        .patient-list {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
            margin-top: 16px;
        }
        
        .patient-list h2 {
            color: var(--accent);
            margin-bottom: 16px;
        }
        
        .patient-card {
            background: var(--primary-blue-lighter);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            border-left: 4px solid var(--primary-blue);
        }
        
        .patient-card:last-child {
            margin-bottom: 0;
        }
        
        .patient-card h3 {
            color: var(--primary-blue-darker);
            margin-bottom: 4px;
        }
        
        .patient-card p {
            margin: 2px 0;
            font-size: 0.9rem;
            color: var(--text-dark);
        }
        
        .resource-panel {
            background: white;
            border-radius: 12px;
            padding: 16px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border: 1px solid var(--border);
            margin-top: 16px;
        }
        
        .resource-panel h2 {
            color: var(--accent);
            margin-bottom: 16px;
        }
        
        .resource-card {
            background: var(--primary-blue-lighter);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 8px;
            border-left: 4px solid var(--primary-blue);
        }
        
        .resource-card:last-child {
            margin-bottom: 0;
        }
        
        .resource-card h3 {
            color: var(--primary-blue-darker);
            margin-bottom: 4px;
        }
        
        .resource-card p {
            margin: 2px 0;
            font-size: 0.9rem;
            color: var(--text-dark);
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                max-height: 200px;
                border-right: none;
                border-bottom: 1px solid var(--border);
            }
            
            .form-row {
                flex-direction: column;
            }
            
            .form-group {
                min-width: 100%;
            }
            
            .calculator-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <header>
            <h1>üè• Enfermer√≠a DAVID ¬∑ Final Full</h1>
            <button class="theme-toggle" id="themeToggle">üåì</button>
        </header>
        
        <div class="container">
            <nav class="sidebar" id="sidebar" aria-label="Categor√≠as">
                <div class="cat-grid" role="navigation">
                    <button class="cat-btn" data-cat="higiene">Higiene</button>
                    <button class="cat-btn" data-cat="curaciones">Curaciones</button>
                    <button class="cat-btn" data-cat="farmaco">Farmacolog√≠a</button>
                    <button class="cat-btn" data-cat="emergencias">Emergencias</button>
                    <button class="cat-btn" data-cat="movilizacion">Movilizaci√≥n</button>
                    <button class="cat-btn" data-cat="nutricion">Nutrici√≥n</button>
                    <button class="cat-btn" data-cat="infeccion">Control infecci√≥n</button>
                    <button class="cat-btn" data-cat="medicamentos">Medicamentos</button>
                    <button class="cat-btn" data-cat="enfermedades">Enfermedades</button>
                    <button class="cat-btn" data-cat="pae">PAE</button>
                    <button class="cat-btn" data-cat="rcp">RCP</button>
                    <button class="cat-btn" data-cat="calculadoras">Calculadoras</button>
                    <button class="cat-btn" data-cat="recursos">Recursos</button>
                    <button class="cat-btn" data-cat="pacientes">Pacientes</button>
                </div>
                <div style="margin-top:10px" class="small">
                    Toque una categor√≠a. Cada bot√≥n abre sub-funciones y procedimientos.
                </div>
            </nav>
            
            <main class="panel" id="mainPanel" aria-live="polite">
                <div class="search-container">
                    <input id="globalSearch" class="input" placeholder="Buscar procedimiento/enfermedad/medicamento..." aria-label="Buscar">
                    <button id="searchBtn" class="btn primary">Buscar</button>
                    <button id="openAllBtn" class="btn secondary">Abrir Todo</button>
                </div>
                
                <div class="content-area" id="contentArea">
                    <div class="category-card">
                        <h2>Bienvenido a Enfermer√≠a DAVID</h2>
                        <p>Seleccione una categor√≠a del men√∫ lateral para acceder a procedimientos, gu√≠as cl√≠nicas, combinador de f√°rmacos, enfermedades y m√°s.</p>
                        <p>Esta aplicaci√≥n proporciona acceso r√°pido a informaci√≥n esencial para profesionales de enfermer√≠a y salud.</p>
                    </div>
                </div>
                
                <!-- Panel de enfermedades -->
                <div class="disease-panel" id="diseasePanel" style="display:none;">
                    <h2>Enfermedades</h2>
                    <div id="diseaseResults"></div>
                    <div style="margin-top:8px">
                        <button id="wikiFetchBtn" class="btn primary">Buscar en Wikipedia</button>
                        <div id="wikiOutput" class="small" style="margin-top:8px"></div>
                    </div>
                </div>
                
                <!-- Combinador de f√°rmacos -->
                <div class="med-combo" id="medCombo" style="display:none;">
                    <h2>Combinador de F√°rmacos</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="medSearchBox">Buscar f√°rmaco</label>
                            <input type="text" id="medSearchBox" class="form-control" placeholder="Buscar f√°rmaco...">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="medSelectA">Medicamento A</label>
                            <select id="medSelectA" class="form-control">
                                <option value="">Seleccionar...</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="medSelectB">Medicamento B</label>
                            <select id="medSelectB" class="form-control">
                                <option value="">Seleccionar...</option>
                            </select>
                        </div>
                    </div>
                    <button id="checkInteractionsBtn" class="btn primary">Verificar Interacciones</button>
                    <div id="medAlert" style="margin-top:16px;"></div>
                    <details style="margin-top:6px">
                        <summary class="small">Lista 'Nunca combinar' (cr√≠ticas)</summary>
                        <div id="neverList" style="margin-top:8px;max-height:260px;overflow:auto"></div>
                    </details>
                </div>
                
                <!-- Formulario PAE -->
                <div class="pae-form" id="paeForm" style="display:none;">
                    <h2>Plan de Atenci√≥n de Enfermer√≠a (PAE)</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="patientName">Nombre del Paciente</label>
                            <input type="text" id="patientName" class="form-control" placeholder="Nombre completo">
                        </div>
                        <div class="form-group">
                            <label for="patientAge">Edad</label>
                            <input type="number" id="patientAge" class="form-control" placeholder="A√±os">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="diagnosis">Diagn√≥stico M√©dico</label>
                        <input type="text" id="diagnosis" class="form-control" placeholder="Diagn√≥stico principal">
                    </div>
                    <div class="form-group">
                        <label for="nursingDiagnosis">Diagn√≥stico de Enfermer√≠a</label>
                        <select id="nursingDiagnosis" class="form-control">
                            <option value="">Seleccionar diagn√≥stico...</option>
                            <option value="dolor">Dolor agudo</option>
                            <option value="riesgo-caidas">Riesgo de ca√≠das</option>
                            <option value="alteracion-ventilacion">Alteraci√≥n de la ventilaci√≥n espont√°nea</option>
                            <option value="integridad-cutanea">Riesgo de deterioro de la integridad cut√°nea</option>
                            <option value="nutricion">Desequilibrio de la nutrici√≥n</option>
                            <option value="ansiedad">Ansiedad</option>
                        </select>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="goals">Objetivos</label>
                            <textarea id="goals" class="form-control" rows="3" placeholder="Objetivos a alcanzar..."></textarea>
                        </div>
                        <div class="form-group">
                            <label for="interventions">Intervenciones</label>
                            <textarea id="interventions" class="form-control" rows="3" placeholder="Intervenciones de enfermer√≠a..."></textarea>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="pae_name">Nombre del PAE</label>
                            <input type="text" id="pae_name" class="form-control" placeholder="Nombre del plan">
                        </div>
                        <div class="form-group">
                            <label for="pae_diag">Diagn√≥stico</label>
                            <input type="text" id="pae_diag" class="form-control" placeholder="Diagn√≥stico principal">
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="pae_plan">Plan de Cuidados</label>
                        <textarea id="pae_plan" class="form-control" rows="4" placeholder="Describa el plan de cuidados..."></textarea>
                    </div>
                    <div style="margin-top:16px;display:flex;gap:8px">
                        <button id="generatePaeBtn" class="btn primary">Generar PAE</button>
                        <button id="savePaeBtn" class="btn secondary">Guardar PAE</button>
                        <button id="exportPaeBtn" class="btn ghost">Exportar</button>
                    </div>
                    <div id="paeMsg" class="small" style="margin-top:8px"></div>
                </div>
                
                <!-- Gu√≠a de RCP -->
                <div class="rcp-guide" id="rcpGuide" style="display:none;">
                    <h2>RCP B√°sica (Adulto)</h2>
                    <div class="rcp-step" data-step="1">
                        <strong>Verificar seguridad del entorno</strong>
                        <p>Aseg√∫rese de que el √°rea es segura para usted y el paciente antes de intervenir.</p>
                    </div>
                    <div class="rcp-step" data-step="2">
                        <strong>Comprobar respuesta del paciente</strong>
                        <p>Agite suavemente los hombros y pregunte "¬øEst√° bien?". Si no hay respuesta, proceda.</p>
                    </div>
                    <div class="rcp-step" data-step="3">
                        <strong>Llamar a emergencias</strong>
                        <p>Si est√° solo, grite pidiendo ayuda. Si hay alguien m√°s, p√≠dale que llame al 112 y traiga un DEA.</p>
                    </div>
                    <div class="rcp-step" data-step="4">
                        <strong>Iniciar compresiones tor√°cicas</strong>
                        <p>Coloque las manos en el centro del pecho. Comprima a una profundidad de 5-6 cm a una velocidad de 100-120 por minuto.</p>
                    </div>
                    <div class="rcp-step" data-step="5">
                        <strong>Apertura de v√≠a a√©rea y ventilaciones</strong>
                        <p>Despu√©s de 30 compresiones, abra la v√≠a a√©rea con la maniobra frente-ment√≥n. D√© 2 ventilaciones de 1 segundo cada una.</p>
                    </div>
                    <div class="rcp-step" data-step="6">
                        <strong>Usar DEA si disponible</strong>
                        <p>Siga las instrucciones del DEA. No toque al paciente durante la descarga.</p>
                    </div>
                    <div class="rcp-step" data-step="7">
                        <strong>Continuar RCP</strong>
                        <p>Contin√∫e con ciclos de 30:2 (30 compresiones, 2 ventilaciones) hasta que llegue ayuda o el paciente reaccione.</p>
                    </div>
                    <div style="margin-top:16px">
                        <button id="rcpStart" class="btn primary">Iniciar RCP</button>
                        <button id="rcpStop" class="btn ghost">Detener</button>
                        <div id="rcpState" class="small" style="margin-top:8px">Estado: detenido</div>
                        <div id="rcpTimer" style="font-weight:700;margin-top:6px">00:00</div>
                    </div>
                </div>
                
                <!-- Calculadoras -->
                <div class="calculator-container" id="calculadoras" style="display:none;">
                    <div class="calculator-form">
                        <h3>IMC (√çndice de Masa Corporal)</h3>
                        <div class="form-group">
                            <label for="imc_weight">Peso (kg)</label>
                            <input type="number" id="imc_weight" class="form-control" placeholder="Ej: 70">
                        </div>
                        <div class="form-group">
                            <label for="imc_height">Altura (cm)</label>
                            <input type="number" id="imc_height" class="form-control" placeholder="Ej: 170">
                        </div>
                        <button id="calculateImc" class="btn primary" style="margin-top:16px;">Calcular IMC</button>
                        <div id="imc-result" style="margin-top:16px;display:none;">
                            <div class="score-value" id="imc-value"></div>
                            <div class="score-category" id="imc-category"></div>
                        </div>
                    </div>
                    
                    <div class="calculator-form">
                        <h3>Filtraci√≥n Glomerular (CKD-EPI)</h3>
                        <div class="form-group">
                            <label for="creatinine">Creatinina (mg/dL)</label>
                            <input type="number" id="creatinine" class="form-control" placeholder="Ej: 1.0">
                        </div>
                        <div class="form-group">
                            <label>Sexo</label>
                            <div style="display:flex;gap:16px;margin-top:8px;">
                                <label style="display:flex;align-items:center;gap:4px;">
                                    <input type="radio" name="sex" value="male" checked> Hombre
                                </label>
                                <label style="display:flex;align-items:center;gap:4px;">
                                    <input type="radio" name="sex" value="female"> Mujer
                                </label>
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="age">Edad</label>
                            <input type="number" id="age" class="form-control" placeholder="Ej: 45">
                        </div>
                        <button id="calculateFiltration" class="btn primary" style="margin-top:16px;">Calcular Filtraci√≥n</button>
                        <div id="filtration-result" style="margin-top:16px;display:none;">
                            <div class="score-value" id="filtration-value"></div>
                            <div class="score-category" id="filtration-category"></div>
                        </div>
                    </div>
                    
                    <div class="calculator-form">
                        <h3>SCORE (Riesgo Cardiovascular)</h3>
                        <div class="form-group">
                            <label for="score_age">Edad</label>
                            <input type="number" id="score_age" class="form-control" placeholder="Ej: 55">
                        </div>
                        <div class="form-group">
                            <label for="total-cholesterol">Colesterol total (mg/dL)</label>
                            <input type="number" id="total-cholesterol" class="form-control" placeholder="Ej: 220">
                        </div>
                        <div class="form-group">
                            <label for="hdl-cholesterol">HDL Colesterol (mg/dL)</label>
                            <input type="number" id="hdl-cholesterol" class="form-control" placeholder="Ej: 50">
                        </div>
                        <div class="form-group">
                            <label for="systolic-pressure">Presi√≥n sist√≥lica (mmHg)</label>
                            <input type="number" id="systolic-pressure" class="form-control" placeholder="Ej: 140">
                        </div>
                        <div class="form-group">
                            <label style="display:flex;align-items:center;gap:8px;">
                                <input type="checkbox" id="smoker"> Fumador
                            </label>
                        </div>
                        <div class="form-group">
                            <label style="display:flex;align-items:center;gap:8px;">
                                <input type="checkbox" id="diabetes"> Diabetes
                            </label>
                        </div>
                        <button id="calculateScore" class="btn primary" style="margin-top:16px;">Calcular SCORE</button>
                        <div id="score-result" style="margin-top:16px;display:none;">
                            <div class="score-value" id="score-value"></div>
                            <div class="score-category" id="score-category"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Lista de pacientes -->
                <div class="patient-list" id="pacientes" style="display:none;">
                    <h2>Pacientes</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="patient-search">Buscar paciente</label>
                            <input type="text" id="patient-search" class="form-control" placeholder="Nombre del paciente...">
                        </div>
                        <div class="form-group">
                            <label for="patient-specialty">Especialidad</label>
                            <select id="patient-specialty" class="form-control">
                                <option value="">Todas</option>
                                <option value="Cardiolog√≠a">Cardiolog√≠a</option>
                                <option value="Neumolog√≠a">Neumolog√≠a</option>
                                <option value="Endocrinolog√≠a">Endocrinolog√≠a</option>
                                <option value="Neurolog√≠a">Neurolog√≠a</option>
                            </select>
                        </div>
                    </div>
                    <button id="addPatientBtn" class="btn primary" style="margin-top:8px;">Agregar Paciente</button>
                    <div id="patients-container"></div>
                </div>
                
                <!-- Recursos educativos -->
                <div class="resource-panel" id="recursos" style="display:none;">
                    <h2>Recursos Educativos</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="resource-search">Buscar recurso</label>
                            <input type="text" id="resource-search" class="form-control" placeholder="T√≠tulo o etiqueta...">
                        </div>
                        <div class="form-group">
                            <label for="resource-category">Categor√≠a</label>
                            <select id="resource-category" class="form-control">
                                <option value="">Todas</option>
                                <option value="Protocolos">Protocolos</option>
                                <option value="Gu√≠as">Gu√≠as</option>
                                <option value="Videos">Videos</option>
                                <option value="Im√°genes">Im√°genes</option>
                            </select>
                        </div>
                    </div>
                    <button id="addResourceBtn" class="btn primary" style="margin-top:8px;">Agregar Recurso</button>
                    <div id="resources-container"></div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // Helper function to get element by ID
        function $(id) {
            return document.getElementById(id);
        }
        
        // Theme toggle functionality
        const themeToggle = $('themeToggle');
        const html = document.documentElement;
        
        // Check for saved theme preference or use preferred color scheme
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            html.setAttribute('data-theme', savedTheme);
        } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            html.setAttribute('data-theme', 'dark');
        }
        
        themeToggle.addEventListener('click', () => {
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        });
        
        // Procedimientos de enfermer√≠a
        const PROCEDURES = {
            higiene: [
                {
                    id: 'lavado_mano',
                    title: 'Lavado de manos',
                    summary: 'T√©cnica esencial para prevenir infecciones.',
                    materials: ['Jab√≥n', 'Agua', 'Toalla'],
                    steps: [
                        'Retirar joyas',
                        'Mojar y aplicar jab√≥n/gel',
                        'Frotar palmas/dorsos/entre dedos ‚â•20s',
                        'Enjuagar y secar'
                    ],
                    notes: 'Crucial antes y despu√©s del contacto con paciente.'
                },
                {
                    id: 'ba√±o_cama',
                    title: 'Ba√±o en cama',
                    summary: 'Higiene integral del paciente encamado.',
                    materials: ['Toallas', 'Agua tibia', 'Jab√≥n', 'Guantes'],
                    steps: [
                        'Preparar equipo',
                        'Proteger intimidad',
                        'Limpiar de proximal a distal',
                        'Secar y vestir'
                    ],
                    notes: ''
                },
                {
                    id: 'higiene_oral',
                    title: 'Higiene oral',
                    summary: 'Prevenci√≥n de infecciones orales y cuidado de mucosas.',
                    materials: ['Cepillo suave', 'Pasta oral sin fl√∫or si indicado', 'Colutorio'],
                    steps: [
                        'Explicar',
                        'Posicionar',
                        'Limpiar suavemente',
                        'Enjuagar y documentar'
                    ],
                    notes: ''
                },
                {
                    id: 'cuidado_ongles',
                    title: 'Cuidado de u√±as',
                    summary: 'Prevenci√≥n de colonizaci√≥n bacteriana en u√±as largas.',
                    materials: ['Tijeras o corta√∫√±as', 'Lima'],
                    steps: [
                        'Cortar con t√©cnica',
                        'No cortar cut√≠cula si no indicado'
                    ],
                    notes: 'Evitar instrumentos compartidos.'
                },
                {
                    id: 'cuidado_piel',
                    title: 'Cuidado de piel fr√°gil',
                    summary: 'Higiene y protecci√≥n de la piel en pacientes de edad avanzada',
                    materials: ['Emolientes', 'Guantes'],
                    steps: [
                        'Evaluar piel',
                        'Aplicar emolientes',
                        'Evitar fricciones'
                    ],
                    notes: 'Aumentar hidrataci√≥n cut√°nea.'
                }
            ],
            curaciones: [
                {
                    id: 'curacion_simple',
                    title: 'Curaci√≥n de herida simple',
                    summary: 'Cambio de ap√≥sito en heridas limpias.',
                    materials: ['Guantes', 'Soluci√≥n salina', 'Gasas', 'Ap√≥sito est√©ril'],
                    steps: [
                        'Higiene',
                        'Retirar ap√≥sito',
                        'Irrigar',
                        'Aplicar ap√≥sito nuevo'
                    ],
                    notes: 'Registrar aspecto y exudado.'
                },
                {
                    id: 'curacion_escaras',
                    title: 'Curaci√≥n de escaras',
                    summary: 'Manejo y alivio de presi√≥n.',
                    materials: ['Ap√≥sitos especiales', 'Colch√≥n antiescaras'],
                    steps: [
                        'Evaluar estad√≠o',
                        'Reposicionar cada 2h',
                        'Aplicar ap√≥sito especializado'
                    ],
                    notes: ''
                },
                {
                    id: 'curacion_quirurgica',
                    title: 'Curaci√≥n postquir√∫rgica',
                    summary: 'Seguimiento de heridas operatorias.',
                    materials: ['Guantes est√©riles', 'Pinzas', 'Ap√≥sito'],
                    steps: [
                        'Comprobar sellado',
                        'Limpieza est√©ril',
                        'Registrar signos infecci√≥n'
                    ],
                    notes: ''
                },
                {
                    id: 'curacion_valvula',
                    title: 'Cambio de ap√≥sito con drenaje',
                    summary: 'Cuidado en heridas con drenaje activo',
                    materials: ['EPP', 'Recipientes', 'ap√≥sitos adsorbentes'],
                    steps: [
                        'Evitar contaminaci√≥n',
                        'Documentar volumen y aspecto'
                    ],
                    notes: ''
                },
                {
                    id: 'curacion_absceso',
                    title: 'Drenaje y curaci√≥n de absceso',
                    summary: 'Drenaje y cuidados post-drenaje',
                    materials: ['Equipo est√©ril', 'Antis√©ptico'],
                    steps: [
                        'Valorar',
                        'Drenar por profesional',
                        'Curar y control'
                    ],
                    notes: 'Derivar si sospecha de celulitis.'
                }
            ],
            farmaco: [
                {
                    id: 'admin_oral',
                    title: 'Administraci√≥n oral',
                    summary: 'Verificar 5 correctos antes de administrar',
                    materials: ['Prescripci√≥n', 'Hoja alergias'],
                    steps: [
                        'Identificar paciente',
                        'Comprobar f√°rmaco/dosis/v√≠a/hora',
                        'Administrar y registrar'
                    ],
                    notes: ''
                },
                {
                    id: 'admin_ev',
                    title: 'Administraci√≥n EV (bolus)',
                    summary: 'Preparaci√≥n y administraci√≥n por v√≠a venosa',
                    materials: ['Soluci√≥n', 'Set EV', 'Aguja', 'Tubo'],
                    steps: [
                        'Verificar prescripci√≥n',
                        'Diluir si necesario',
                        'Administrar seg√∫n velocidad',
                        'Observar reacciones'
                    ],
                    notes: 'Solo personal habilitado.'
                },
                {
                    id: 'oxigenoterapia',
                    title: 'Oxigenoterapia',
                    summary: 'C√°nula nasal o mascarilla seg√∫n indicaci√≥n',
                    materials: ['C√°nula', 'Mascarilla', 'Ox√≠metro'],
                    steps: [
                        'Verificar orden',
                        'Colocar dispositivo',
                        'Monitorizar SpO2'
                    ],
                    notes: ''
                },
                {
                    id: 'vacunas',
                    title: 'Administraci√≥n de vacuna IM',
                    summary: 'Preparaci√≥n est√©ril y registro de lote',
                    materials: ['Jeringa', 'Vacuna', 'Algod√≥n', 'EPI'],
                    steps: [
                        'Verificar vacuna y lote',
                        'Administrar en sitio apropiado',
                        'Registrar lote y reacciones'
                    ],
                    notes: ''
                },
                {
                    id: 'dosis_peso',
                    title: 'Dosis seg√∫n peso',
                    summary: 'Calcular dosis por kg ejemplo',
                    materials: ['Balanza', 'Calculadora'],
                    steps: [
                        'Calcular kg',
                        'Aplicar mg/kg'
                    ],
                    notes: 'Ejemplo 10 mg/kg como referencia no universal.'
                }
            ],
            emergencias: [
                {
                    id: 'rcp',
                    title: 'RCP b√°sica (adulto)',
                    summary: 'Comprimir 100-120/min y 5-6 cm de profundidad',
                    materials: ['DEA si disponible'],
                    steps: [
                        'Seguridad',
                        'Comprobar respuesta',
                        'Llamar ayuda',
                        'Iniciar compresiones 30:2 o continuas seg√∫n gu√≠a',
                        'Usar DEA'
                    ],
                    notes: ''
                },
                {
                    id: 'anafilaxia',
                    title: 'Manejo de anafilaxia',
                    summary: 'Reconocer y actuar r√°pido',
                    materials: ['Epinefrina IM', 'Ox√≠geno', 'V√≠a IV'],
                    steps: [
                        'Evaluar VA',
                        'Administrar epinefrina IM',
                        'Ox√≠geno y soporte'
                    ],
                    notes: 'Tras la dosis, monitorizar y repetir seg√∫n protocolo.'
                },
                {
                    id: 'hemorragia',
                    title: 'Control de hemorragia',
                    summary: 'Compresi√≥n directa, torniquete si necesario',
                    materials: ['Gasas', 'Guantes', 'Torniquete'],
                    steps: [
                        'Comprimir',
                        'Elevar miembro',
                        'Transportar a urgencias'
                    ],
                    notes: ''
                },
                {
                    id: 'obstruccion_va',
                    title: 'Obstrucci√≥n de v√≠a a√©rea (adulto)',
                    summary: 'Maniobra de Heimlich y cuidados',
                    materials: [],
                    steps: [
                        'Valorar capacidad de hablar',
                        'Heimlich si obstrucci√≥n completa',
                        'Si inconsciente iniciar RCP'
                    ],
                    notes: ''
                },
                {
                    id: 'sintomaticos',
                    title: 'Manejo inicial del s√≠ncope',
                    summary: 'Evaluar causas y medidas iniciales',
                    materials: [],
                    steps: [
                        'Posici√≥n supina',
                        'Abrir v√≠a a√©rea',
                        'Monitorizar'
                    ],
                    notes: 'Buscar causa subyacente.'
                }
            ],
            movilizacion: [
                {
                    id: 'transferencia',
                    title: 'Transferencia segura',
                    summary: 'Uso de t√©cnicas y dispositivos de ayuda',
                    materials: ['Cintur√≥n traslado', 'S√°banas de deslizar'],
                    steps: [
                        'Evaluar',
                        'Explicar',
                        'Coordinar equipo',
                        'Usar ayudas mec√°nicas'
                    ],
                    notes: ''
                },
                {
                    id: 'posicionamiento',
                    title: 'Cambio de dec√∫bito',
                    summary: 'Prevenci√≥n de escaras mediante cambios posicionales',
                    materials: [],
                    steps: [
                        'Cambiar cada 2h',
                        'Registrar posici√≥n'
                    ],
                    notes: ''
                },
                {
                    id: 'ayuda_mec',
                    title: 'Uso de ayuda mec√°nica',
                    summary: 'Uso de gr√∫a y tablas',
                    materials: ['Gr√∫a', 'Equipo'],
                    steps: [
                        'Evaluar',
                        'Coordinaci√≥n equipo',
                        'Seguridad paciente'
                    ],
                    notes: 'Formaci√≥n previa necesaria.'
                }
            ],
            nutricion: [
                {
                    id: 'alimentacion_asistida',
                    title: 'Asistencia en alimentaci√≥n',
                    summary: 'Prevenci√≥n de aspiraci√≥n',
                    materials: ['Texturas adaptadas'],
                    steps: [
                        'Valorar riesgo',
                        'Posicionar 45-90¬∞',
                        'Supervisar ingestion'
                    ],
                    notes: ''
                },
                {
                    id: 'sonda_nasogastrica',
                    title: 'SNG - cuidado y administraci√≥n',
                    summary: 'Cuidado de nutrici√≥n enteral',
                    materials: ['Sonda NG', 'Bomba nutricional'],
                    steps: [
                        'Comprobar posicion',
                        'Administrar por gravedad o bomba',
                        'Limpiar y fijar'
                    ],
                    notes: ''
                }
            ],
            infeccion: [
                {
                    id: 'aislamiento_contacto',
                    title: 'Precauciones por contacto',
                    summary: 'EPP y manejo de residuos',
                    materials: ['Guantes', 'Bata', 'Mascarilla'],
                    steps: [
                        'Determinar aislamiento',
                        'Colocar EPP',
                        'Retirar EPP correctamente',
                        'Limpiar superficies'
                    ],
                    notes: ''
                },
                {
                    id: 'control_infeccion_cateter',
                    title: 'Cuidados de cat√©ter central',
                    summary: 'Mantener t√©cnica est√©ril',
                    materials: ['EPP', 'Ap√≥sito est√©ril'],
                    steps: [
                        'Higiene de manos',
                        'Cambiar ap√≥sito seg√∫n protocolo',
                        'Registrar signos infecci√≥n'
                    ],
                    notes: ''
                }
            ]
        };
        
        // Enfermedades comunes
        const DISEASES = [
            {
                name: 'Neumon√≠a',
                summary: 'Infecci√≥n inflamatoria aguda del par√©nquima pulmonar, generalmente bacteriana o viral. Presenta fiebre, tos productiva, disnea y crepitaciones.'
            },
            {
                name: 'Insuficiencia card√≠aca',
                summary: 'Incapacidad del coraz√≥n para bombear adecuadamente. S√≠ntomas incluyen disnea, ortopnea, edema perif√©rico y fatiga.'
            },
            {
                name: 'Diabetes mellitus',
                summary: 'Trastorno del metabolismo de la glucosa con hiperglucemia cr√≥nica. Tipos principales: tipo 1 (autoinmune) y tipo 2 (resistencia a insulina).'
            },
            {
                name: 'EPOC',
                summary: 'Enfermedad pulmonar obstructiva cr√≥nica con limitaci√≥n al flujo a√©reo progresiva. Caracterizada por tos cr√≥nica, esputo y disnea.'
            },
            {
                name: 'Sepsis',
                summary: 'Respuesta sist√©mica descontrolada a infecci√≥n que puede llevar a disfunci√≥n org√°nica. Requiere tratamiento inmediato con antibi√≥ticos y soporte.'
            },
            {
                name: 'ACV (Accidente cerebrovascular)',
                summary: 'P√©rdida repentina de funci√≥n neurol√≥gica por isquemia o hemorragia cerebral. Signos: debilidad facial, alteraci√≥n del habla, p√©rdida de fuerza en un lado.'
            },
            {
                name: '√ölcera p√©ptica',
                summary: 'Lesi√≥n en la mucosa g√°strica o duodenal. Causada por H. pylori o AINEs. Dolor epig√°strico, n√°useas, posible hemorragia digestiva.'
            },
            {
                name: 'Insuficiencia renal aguda',
                summary: 'P√©rdida r√°pida de funci√≥n renal con alteraci√≥n de homeostasis. Caracterizada por oliguria, retenci√≥n de metabolitos y alteraciones electrol√≠ticas.'
            },
            {
                name: 'Hipertensi√≥n arterial',
                summary: 'Presi√≥n arterial persistentemente elevada (>140/90 mmHg). Factor de riesgo para enfermedad cardiovascular, ACV y nefropat√≠a.'
            },
            {
                name: 'C√°ncer de pulm√≥n',
                summary: 'Neoplasia maligna m√°s com√∫n y letal. Relacionado con tabaquismo. S√≠ntomas: tos persistente, hemoptisis, p√©rdida de peso, disnea.'
            }
        ];
        
        // Medicamentos y combinaciones peligrosas
        const NEVER_COMBINE = [
            { a: 'warfarina', b: 'ibuprofeno', reason: 'Aumento del riesgo de hemorragia', ref: 'https://www.ncbi.nlm.nih.gov/books/NBK545235/' },
            { a: 'paracetamol', b: 'alcohol', reason: 'Hepatotoxicidad severa', ref: 'https://www.ncbi.nlm.nih.gov/books/NBK547703/' },
            { a: 'ciprofloxacina', b: 'anti√°cidos', reason: 'Disminuci√≥n de absorci√≥n', ref: 'https://www.ncbi.nlm.nih.gov/books/NBK538340/' },
            { a: 'metformina', b: 'contraste iodado', reason: 'Riesgo de acidosis l√°ctica', ref: 'https://www.ncbi.nlm.nih.gov/books/NBK538272/' },
            { a: 'sertralina', b: 'fenelzina', reason: 'S√≠ndrome serotonin√©rgico', ref: 'https://www.ncbi.nlm.nih.gov/books/NBK537281/' },
            { a: 'simvastatina', b: 'eritromicina', reason: 'Miopat√≠a severa', ref: 'https://www.ncbi.nlm.nih.gov/books/NBK537092/' },
            { a: 'gemfibrozil', b: 'statinas', reason: 'Rabdomi√≥lisis', ref: 'https://www.ncbi.nlm.nih.gov/books/NBK537290/' },
            { a: 'metotrexato', b: 'cotrimoxazol', reason: 'Mielosupresi√≥n', ref: 'https://www.ncbi.nlm.nih.gov/books/NBK537276/' },
            { a: 'digoxina', b: 'verapamilo', reason: 'Bloqueo card√≠aco', ref: 'https://www.ncbi.nlm.nih.gov/books/NBK537278/' },
            { a: 'nitroglicerina', b: 'sildenafil', reason: 'Hipotensi√≥n severa', ref: 'https://www.ncbi.nlm.nih.gov/books/NBK537279/' },
            { a: 'linezolid', b: 'sertralina', reason: 'S√≠ndrome serotonin√©rgico', ref: 'https://www.ncbi.nlm.nih.gov/books/NBK537282/' }
        ];
        
        const MEDS = [
            'Warfarina', 'Ibuprofeno', 'Paracetamol', 'Ciprofloxacina', 'Metformina',
            'Sertralina', 'Omeprazol', 'Sildenafil', 'Nitroglicerina', 'Clopidogrel',
            'Digoxina', 'Verapamilo', 'Fenelzina (MAOI)', 'Sertralina (SSRI)', 
            'Contraste iodado', 'Simvastatina', 'Eritromicina', 'Gemfibrozil', 
            'Metotrexato', 'Linezolid'
        ];
        
        // Pacientes
        const PATIENTS = [
            {
                id: 1,
                nombre: 'Mar√≠a Gonz√°lez',
                edad: 65,
                diagnosticoPrincipal: 'Diabetes mellitus tipo 2',
                especialidad: 'Endocrinolog√≠a',
                riesgoCardiovascular: 'moderado',
                alergias: ['Penicilina'],
                historiaClinica: {
                    resumen: 'Paciente femenina de 65 a√±os con diabetes tipo 2 diagnosticada hace 10 a√±os.',
                    diagnosticos: [
                        { fecha: '2013-06-15', cie10: 'E11.9', descripcion: 'Diabetes mellitus tipo 2', estado: 'Cr√≥nico' },
                        { fecha: '2018-03-20', cie10: 'E78.0', descripcion: 'Hipercolesterolemia', estado: 'Cr√≥nico' }
                    ],
                    tratamientos: [
                        { fechaInicio: '2013-06-15', medicamento: 'Metformina', dosis: '850mg cada 12h', duracion: 'Continuo' },
                        { fechaInicio: '2018-03-20', medicamento: 'Atorvastatina', dosis: '20mg cada 24h', duracion: 'Continuo' }
                    ],
                    evolucion: [
                        { fecha: '2023-01-10', nota: 'HbA1c 7.2%. Buen control gluc√©mico.' },
                        { fecha: '2023-07-15', nota: 'LDL 110 mg/dL. Ajuste de dosis de estatina.' }
                    ],
                    signosVitales: [
                        { fecha: '2023-01-10', temperatura: 36.5, pa: '130/80', fc: 78, fr: 16, spo2: 98, peso: 70, talla: 1.60, imc: 27.3 },
                        { fecha: '2023-07-15', temperatura: 36.7, pa: '128/78', fc: 76, fr: 14, spo2: 98, peso: 68, talla: 1.60, imc: 26.6 }
                    ],
                    controles: [
                        { tipo: 'HbA1c', cada: '3 meses', proximo: '2023-10-15' },
                        { tipo: 'Perfil lip√≠dico', cada: '6 meses', proximo: '2024-01-15' }
                    ]
                }
            },
            {
                id: 2,
                nombre: 'Carlos Rodr√≠guez',
                edad: 72,
                diagnosticoPrincipal: 'EPOC',
                especialidad: 'Neumolog√≠a',
                riesgoCardiovascular: 'alto',
                alergias: [],
                historiaClinica: {
                    resumen: 'Paciente masculino de 72 a√±os con EPOC grado III, exfumador de 40 paquetes-a√±o.',
                    diagnosticos: [
                        { fecha: '2010-05-12', cie10: 'J44.9', descripcion: 'EPOC', estado: 'Cr√≥nico' },
                        { fecha: '2015-11-03', cie10: 'I20.9', descripcion: 'Angina de pecho', estado: 'Intermitente' }
                    ],
                    tratamientos: [
                        { fechaInicio: '2010-05-12', medicamento: 'Tiotropio', dosis: '18mcg cada 24h', duracion: 'Continuo' },
                        { fechaInicio: '2015-11-03', medicamento: 'Isosorbide', dosis: '20mg cada 12h', duracion: 'Continuo' }
                    ],
                    evolucion: [
                        { fecha: '2023-02-20', nota: 'Exacerbaci√≥n leve de EPOC. Tratada con antibi√≥tico y corticoide.' },
                        { fecha: '2023-08-10', nota: 'Funci√≥n pulmonar estable. Contin√∫a rehabilitaci√≥n.' }
                    ],
                    signosVitales: [
                        { fecha: '2023-02-20', temperatura: 37.2, pa: '140/85', fc: 88, fr: 22, spo2: 92, peso: 65, talla: 1.70, imc: 22.5 },
                        { fecha: '2023-08-10', temperatura: 36.8, pa: '138/82', fc: 84, fr: 18, spo2: 94, peso: 66, talla: 1.70, imc: 22.8 }
                    ],
                    controles: [
                        { tipo: 'Espirometr√≠a', cada: '6 meses', proximo: '2024-02-10' },
                        { tipo: 'Control de oxigenoterapia', cada: '3 meses', proximo: '2023-11-10' }
                    ]
                }
            },
            {
                id: 3,
                nombre: 'Ana Mart√≠nez',
                edad: 48,
                diagnosticoPrincipal: 'VIH',
                especialidad: 'Infectolog√≠a',
                riesgoCardiovascular: 'moderado',
                alergias: ['Sulfamidas'],
                historiaClinica: {
                    resumen: 'Paciente femenina de 48 a√±os con VIH desde 2013, tratamiento antirretroviral efectivo.',
                    diagnosticos: [
                        { fecha: '2013-06-15', cie10: 'B20', descripcion: 'VIH', estado: 'Cr√≥nico' }
                    ],
                    tratamientos: [
                        { fechaInicio: '2013-06-15', medicamento: 'Dolutegravir', dosis: '50mg cada 24h', duracion: 'Continuo' }
                    ],
                    evolucion: [
                        { fecha: '2013-06-15', nota: 'Diagn√≥stico de VIH. Iniciado tratamiento antirretroviral.' },
                        { fecha: '2020-01-10', nota: 'Control viral indetectable desde hace 5 a√±os.' },
                        { fecha: '2023-03-15', nota: 'Carga viral indetectable. CD4 650 c√©lulas/mm¬≥.' }
                    ],
                    signosVitales: [
                        { fecha: '2023-01-10', temperatura: 36.8, pa: '115/75', fc: 72, fr: 14, spo2: 98, peso: 62, talla: 1.60, imc: 24.2 },
                        { fecha: '2023-07-15', temperatura: 36.6, pa: '118/72', fc: 70, fr: 12, spo2: 99, peso: 63, talla: 1.60, imc: 24.6 }
                    ],
                    controles: [
                        { tipo: 'Carga Viral', cada: '6 meses', proximo: '2023-09-15' },
                        { tipo: 'Perfil Inmunol√≥gico', cada: '6 meses', proximo: '2023-09-15' }
                    ]
                }
            },
            {
                id: 4,
                nombre: 'Roberto S√°nchez',
                edad: 67,
                diagnosticoPrincipal: 'Insuficiencia Card√≠aca',
                especialidad: 'Cardiolog√≠a',
                riesgoCardiovascular: 'alto',
                alergias: ['Ioduro'],
                historiaClinica: {
                    resumen: 'Paciente masculino de 67 a√±os con IC por miocardiopat√≠a isqu√©mica.',
                    diagnosticos: [
                        { fecha: '2020-01-15', cie10: 'I50.9', descripcion: 'Insuficiencia Card√≠aca', estado: 'Cr√≥nico' },
                        { fecha: '2020-01-15', cie10: 'I25.10', descripcion: 'Enfermedad arterial coronaria', estado: 'Cr√≥nico' }
                    ],
                    tratamientos: [
                        { fechaInicio: '2020-01-15', medicamento: 'Enalapril', dosis: '10mg cada 12h', duracion: 'Continuo' },
                        { fechaInicio: '2020-01-15', medicamento: 'Carvedilol', dosis: '25mg cada 12h', duracion: 'Continuo' },
                        { fechaInicio: '2020-01-15', medicamento: 'Furosemida', dosis: '40mg cada 24h', duracion: 'Continuo' }
                    ],
                    evolucion: [
                        { fecha: '2020-01-15', nota: 'IC clase III NYHA. Iniciado tratamiento.' },
                        { fecha: '2022-06-20', nota: 'Mejor√≠a funcional. Clase II NYHA.' },
                        { fecha: '2023-05-10', nota: 'Estable. Control de peso diario.' }
                    ],
                    signosVitales: [
                        { fecha: '2020-01-15', temperatura: 36.9, pa: '150/90', fc: 92, fr: 20, spo2: 94, peso: 85, talla: 1.75, imc: 27.8 },
                        { fecha: '2023-05-10', temperatura: 36.7, pa: '128/78', fc: 76, fr: 14, spo2: 97, peso: 78, talla: 1.75, imc: 25.5 }
                    ],
                    controles: [
                        { tipo: 'Ecocardiograma', cada: '12 meses', proximo: '2024-05-10' },
                        { tipo: 'Perfil renal', cada: '6 meses', proximo: '2023-11-10' }
                    ]
                }
            }
        ];
        
        // Recursos educativos
        const RESOURCES = [
            {
                id: 1,
                titulo: 'Gu√≠a de RCP 2023',
                categoria: 'Gu√≠as',
                tipo: 'documento',
                url: 'https://example.com/rcp2023.pdf',
                etiquetas: ['RCP', 'emergencias', 'cardiolog√≠a'],
                descripcion: 'Gu√≠a actualizada de reanimaci√≥n cardiopulmonar seg√∫n recomendaciones 2023.'
            },
            {
                id: 2,
                titulo: 'Video: T√©cnica de curaci√≥n',
                categoria: 'Videos',
                tipo: 'video',
                url: 'https://example.com/curacion.mp4',
                etiquetas: ['curaciones', 'heridas', 'asepsia'],
                descripcion: 'Demostraci√≥n de t√©cnica correcta para curaci√≥n de heridas simples.'
            },
            {
                id: 3,
                titulo: 'Imagen: Anatom√≠a del coraz√≥n',
                categoria: 'Im√°genes',
                tipo: 'imagen',
                url: 'https://placehold.co/600x400/orange/white?text=Anatom%C3%ADa+del+coraz%C3%B3n',
                etiquetas: ['cardiolog√≠a', 'anatom√≠a'],
                descripcion: 'Ilustraci√≥n detallada de la anatom√≠a card√≠aca.'
            },
            {
                id: 4,
                titulo: 'Protocolo de diabetes',
                categoria: 'Protocolos',
                tipo: 'documento',
                url: 'https://example.com/diabetes.pdf',
                etiquetas: ['diabetes', 'endocrinolog√≠a', 'protocolo'],
                descripcion: 'Protocolo de manejo de diabetes mellitus en atenci√≥n primaria.'
            },
            {
                id: 5,
                titulo: 'Video: Administraci√≥n de medicamentos EV',
                categoria: 'Videos',
                tipo: 'video',
                url: 'https://example.com/medicamentos_ev.mp4',
                etiquetas: ['farmacolog√≠a', 'v√≠a endovenosa'],
                descripcion: 'T√©cnica segura para la administraci√≥n de medicamentos por v√≠a endovenosa.'
            }
        ];
        
        // PAE almacenados
        const PAE_KEY = 'pae_records';
        
        // Content area and functions
        const contentArea = $('contentArea');
        const diseasePanel = $('diseasePanel');
        const diseaseResults = $('diseaseResults');
        const medCombo = $('medCombo');
        const paeForm = $('paeForm');
        const rcpGuide = $('rcpGuide');
        const calculadoras = $('calculadoras');
        const pacientes = $('pacientes');
        const recursos = $('recursos');
        
        function clearContent() {
            contentArea.innerHTML = '';
            diseasePanel.style.display = 'none';
            medCombo.style.display = 'none';
            paeForm.style.display = 'none';
            rcpGuide.style.display = 'none';
            calculadoras.style.display = 'none';
            pacientes.style.display = 'none';
            recursos.style.display = 'none';
        }
        
        function renderCategory(cat) {
            clearContent();
            
            if (PROCEDURES[cat]) {
                const categoryCard = document.createElement('div');
                categoryCard.className = 'category-card';
                
                const h2 = document.createElement('h2');
                h2.textContent = getCatTitle(cat);
                categoryCard.appendChild(h2);
                
                PROCEDURES[cat].forEach(proc => {
                    const procedure = document.createElement('div');
                    procedure.className = 'procedure';
                    
                    const h3 = document.createElement('h3');
                    h3.textContent = proc.title;
                    procedure.appendChild(h3);
                    
                    if (proc.summary) {
                        const summary = document.createElement('p');
                        summary.className = 'summary';
                        summary.textContent = proc.summary;
                        procedure.appendChild(summary);
                    }
                    
                    if (proc.materials && proc.materials.length > 0) {
                        const materials = document.createElement('div');
                        materials.className = 'materials';
                        
                        const materialsLabel = document.createElement('h3');
                        materialsLabel.textContent = 'Materiales:';
                        materials.appendChild(materialsLabel);
                        
                        const ul = document.createElement('ul');
                        proc.materials.forEach(mat => {
                            const li = document.createElement('li');
                            li.textContent = mat;
                            ul.appendChild(li);
                        });
                        materials.appendChild(ul);
                        procedure.appendChild(materials);
                    }
                    
                    if (proc.steps && proc.steps.length > 0) {
                        const steps = document.createElement('div');
                        steps.className = 'steps';
                        
                        const stepsLabel = document.createElement('h3');
                        stepsLabel.textContent = 'Pasos:';
                        steps.appendChild(stepsLabel);
                        
                        const ol = document.createElement('ol');
                        proc.steps.forEach(step => {
                            const li = document.createElement('li');
                            li.textContent = step;
                            ol.appendChild(li);
                        });
                        steps.appendChild(ol);
                        procedure.appendChild(steps);
                    }
                    
                    if (proc.notes) {
                        const notes = document.createElement('div');
                        notes.className = 'notes';
                        notes.textContent = proc.notes;
                        procedure.appendChild(notes);
                    }
                    
                    categoryCard.appendChild(procedure);
                });
                
                contentArea.appendChild(categoryCard);
            }
        }
        
        function getCatTitle(cat) {
            const titles = {
                'higiene': 'Procedimientos de Higiene',
                'curaciones': 'Curaciones y Heridas',
                'farmaco': 'Farmacolog√≠a',
                'emergencias': 'Emergencias',
                'movilizacion': 'Movilizaci√≥n y Transferencia',
                'nutricion': 'Nutrici√≥n',
                'infeccion': 'Control de Infecciones',
                'medicamentos': 'Medicamentos',
                'enfermedades': 'Enfermedades',
                'pae': 'Plan de Atenci√≥n de Enfermer√≠a',
                'rcp': 'Reanimaci√≥n Cardiovascular',
                'calculadoras': 'Calculadoras Cl√≠nicas',
                'recursos': 'Recursos Educativos',
                'pacientes': 'Gesti√≥n de Pacientes'
            };
            return titles[cat] || cat;
        }
        
        // Event listeners for category buttons
        document.querySelectorAll('.cat-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const cat = btn.getAttribute('data-cat');
                
                if (cat === 'medicamentos') {
                    showMedCombo();
                } else if (cat === 'enfermedades') {
                    showDiseases();
                } else if (cat === 'pae') {
                    showPaeForm();
                } else if (cat === 'rcp') {
                    showRcpGuide();
                } else if (cat === 'calculadoras') {
                    showCalculadoras();
                } else if (cat === 'pacientes') {
                    showPacientes();
                } else if (cat === 'recursos') {
                    showRecursos();
                } else {
                    renderCategory(cat);
                }
            });
        });
        
        // Open all procedures
        $('openAllBtn').addEventListener('click', () => {
            clearContent();
            Object.keys(PROCEDURES).forEach(k => renderCategory(k));
        });
        
        // Global search
        $('searchBtn').addEventListener('click', () => {
            const q = $('globalSearch').value.trim().toLowerCase();
            if (!q) { 
                alert('Ingrese t√©rmino de b√∫squeda'); 
                return; 
            }
            clearContent();
            
            const results = [];
            
            // Search procedures
            Object.keys(PROCEDURES).forEach(cat => {
                PROCEDURES[cat].forEach(proc => {
                    const hay = (proc.title + ' ' + proc.summary + ' ' + (proc.steps||[]).join(' ')).toLowerCase();
                    if (hay.includes(q)) {
                        results.push({cat, p: proc});
                    }
                });
            });
            
            // Search diseases
            const dHits = DISEASES.filter(d => (d.name + ' ' + d.summary).toLowerCase().includes(q));
            if (dHits.length) {
                const card = document.createElement('div');
                card.className = 'category-card';
                card.innerHTML = `<h2>Enfermedades encontradas</h2>`;
                
                dHits.forEach(d => {
                    const diseaseItem = document.createElement('div');
                    diseaseItem.className = 'disease-item';
                    diseaseItem.innerHTML = `<strong>${d.name}</strong><div class="small">${d.summary}</div>`;
                    card.appendChild(diseaseItem);
                });
                
                contentArea.appendChild(card);
            }
            
            // Search medications
            const mHits = MEDS.filter(m => m.toLowerCase().includes(q));
            if (mHits.length) {
                const card = document.createElement('div');
                card.className = 'category-card';
                card.innerHTML = `<h2>Medicamentos encontrados</h2><div class="small">${mHits.join(', ')}</div>`;
                contentArea.appendChild(card);
            }
            
            // Search patients
            const pHits = PATIENTS.filter(p => p.nombre.toLowerCase().includes(q) || 
                p.diagnosticoPrincipal.toLowerCase().includes(q) || 
                p.especialidad.toLowerCase().includes(q));
            if (pHits.length) {
                const card = document.createElement('div');
                card.className = 'category-card';
                card.innerHTML = `<h2>Pacientes encontrados</h2>`;
                
                pHits.forEach(p => {
                    const patientItem = document.createElement('div');
                    patientItem.className = 'disease-item';
                    patientItem.innerHTML = `<strong>${p.nombre}</strong><div class="small">Edad: ${p.edad}, Diagn√≥stico: ${p.diagnosticoPrincipal}, Especialidad: ${p.especialidad}</div>`;
                    card.appendChild(patientItem);
                });
                
                contentArea.appendChild(card);
            }
            
            // Show procedure results
            if (results.length > 0) {
                const card = document.createElement('div');
                card.className = 'category-card';
                card.innerHTML = `<h2>Resultados de b√∫squeda</h2>`;
                
                results.forEach(r => {
                    const proc = r.p;
                    const procedure = document.createElement('div');
                    procedure.className = 'procedure';
                    
                    const h3 = document.createElement('h3');
                    h3.textContent = proc.title;
                    procedure.appendChild(h3);
                    
                    if (proc.summary) {
                        const summary = document.createElement('p');
                        summary.className = 'summary';
                        summary.textContent = proc.summary;
                        procedure.appendChild(summary);
                    }
                    
                    card.appendChild(procedure);
                });
                
                contentArea.appendChild(card);
            }
            
            if (results.length === 0 && dHits.length === 0 && mHits.length === 0 && pHits.length === 0) {
                const card = document.createElement('div');
                card.className = 'category-card';
                card.innerHTML = `<h2>No se encontraron resultados</h2><p>No se encontr√≥ informaci√≥n relacionada con "${q}". Intente con otro t√©rmino de b√∫squeda.</p>`;
                contentArea.appendChild(card);
            }
        });
        
        // Show diseases
        function showDiseases() {
            clearContent();
            diseasePanel.style.display = 'block';
            diseaseResults.innerHTML = DISEASES.map(d => 
                `<div class="disease-item">
                    <strong>${d.name}</strong>
                    <div class="small">${d.summary}</div>
                </div>`
            ).join('');
        }
        
        // Show medication combinator
        function showMedCombo() {
            clearContent();
            medCombo.style.display = 'block';
            
            // Populate medication selects
            const medSelectA = $('medSelectA');
            const medSelectB = $('medSelectB');
            
            medSelectA.innerHTML = '<option value="">Seleccionar...</option>';
            medSelectB.innerHTML = '<option value="">Seleccionar...</option>';
            
            MEDS.forEach(med => {
                const optionA = document.createElement('option');
                optionA.value = med.toLowerCase();
                optionA.textContent = med;
                medSelectA.appendChild(optionA);
                
                const optionB = document.createElement('option');
                optionB.value = med.toLowerCase();
                optionB.textContent = med;
                medSelectB.appendChild(optionB);
            });
            
            // Populate never list
            $('neverList').innerHTML = NEVER_COMBINE.map(n => 
                `<div style="margin-bottom:8px">
                    <strong>${n.a} + ${n.b}</strong>
                    <div class="small">${n.reason} <a href="${n.ref}" target="_blank" rel="noopener">ref</a></div>
                </div>`
            ).join('');
            
            // Med search quick fill
            $('medSearchBox').addEventListener('input', (e) => {
                const q = e.target.value.trim().toLowerCase();
                if (!q) return;
                const matches = MEDS.filter(m => m.toLowerCase().includes(q));
                if (matches.length) {
                    $('medSelectA').value = matches[0].toLowerCase();
                    $('medSelectB').value = matches[1]?.toLowerCase() || matches[0].toLowerCase();
                }
            });
        }
        
        // Check medication interactions
        $('checkInteractionsBtn').addEventListener('click', () => {
            const a = $('medSelectA').value.toLowerCase();
            const b = $('medSelectB').value.toLowerCase();
            const out = $('medAlert');
            
            if (!a || !b) {
                out.innerHTML = '<span style="color:var(--danger)">Seleccione dos f√°rmacos</span>';
                return;
            }
            
            if (a === b) {
                out.innerHTML = '<span style="color:green">Mismo medicamento seleccionado ‚Äî cuidado con duplicidad terap√©utica.</span>';
                return;
            }
            
            const hits = NEVER_COMBINE.filter(n => 
                (a.includes(n.a) && b.includes(n.b)) || 
                (a.includes(n.b) && b.includes(n.a))
            );
            
            if (hits.length) {
                out.innerHTML = hits.map(h => 
                    `<div style="color:var(--danger)">
                        <strong>${h.reason}</strong>
                        <div class="small">${h.a.toUpperCase()} + ${h.b.toUpperCase()}</div>
                    </div>`
                ).join('');
            } else {
                out.innerHTML = '<span style="color:green">No se detectaron interacciones cr√≠ticas en la base local. Consulte monograf√≠as especializadas para interacciones completas.</span>';
            }
        });
        
        // Show PAE form
        function showPaeForm() {
            clearContent();
            paeForm.style.display = 'block';
        }
        
        // Generate PAE
        $('generatePaeBtn').addEventListener('click', () => {
            const patientName = $('patientName').value;
            const patientAge = $('patientAge').value;
            const diagnosis = $('diagnosis').value;
            const nursingDiagnosis = $('nursingDiagnosis').value;
            const goals = $('goals').value;
            const interventions = $('interventions').value;
            
            if (!patientName || !patientAge || !diagnosis || !nursingDiagnosis || !goals || !interventions) {
                alert('Por favor, complete todos los campos del PAE.');
                return;
            }
            
            clearContent();
            
            const paeCard = document.createElement('div');
            paeCard.className = 'category-card';
            paeCard.innerHTML = `
                <h2>Plan de Atenci√≥n de Enfermer√≠a (PAE)</h2>
                <div class="form-row">
                    <div class="form-group">
                        <label>Paciente:</label>
                        <p>${patientName}, ${patientAge} a√±os</p>
                    </div>
                    <div class="form-group">
                        <label>Diagn√≥stico M√©dico:</label>
                        <p>${diagnosis}</p>
                    </div>
                </div>
                <div class="form-group">
                    <label>Diagn√≥stico de Enfermer√≠a:</label>
                    <p>${$('nursingDiagnosis').options[$('nursingDiagnosis').selectedIndex].text}</p>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label>Objetivos:</label>
                        <p>${goals}</p>
                    </div>
                    <div class="form-group">
                        <label>Intervenciones:</label>
                        <p>${interventions}</p>
                    </div>
                </div>
                <div class="form-group">
                    <label>Fecha:</label>
                    <p>${new Date().toLocaleDateString('es-ES', { year: 'numeric', month: 'long', day: 'numeric' })}</p>
                </div>
                <div style="margin-top:16px;text-align:center;">
                    <button id="printPaeBtn" class="btn primary">Imprimir PAE</button>
                </div>
            `;
            
            contentArea.appendChild(paeCard);
            
            // Print functionality
            $('printPaeBtn').addEventListener('click', () => {
                window.print();
            });
        });
        
        // Save PAE
        $('savePaeBtn').addEventListener('click', () => {
            const name = $('pae_name').value.trim();
            const diag = $('pae_diag').value.trim();
            const plan = $('pae_plan').value.trim();
            
            if (!name || !diag) {
                $('paeMsg').textContent = 'Nombre y diagn√≥stico requeridos';
                setTimeout(() => $('paeMsg').textContent='', 2000);
                return;
            }
            
            const arr = JSON.parse(localStorage.getItem(PAE_KEY) || '[]');
            arr.push({name, diag, plan, ts: Date.now()});
            localStorage.setItem(PAE_KEY, JSON.stringify(arr));
            $('paeMsg').textContent = 'PAE guardado localmente';
            setTimeout(() => $('paeMsg').textContent='', 2000);
        });
        
        // Export PAE
        $('exportPaeBtn').addEventListener('click', () => {
            const arr = JSON.parse(localStorage.getItem(PAE_KEY) || '[]');
            if (arr.length === 0) {
                $('paeMsg').textContent = 'No hay PAEs guardados para exportar';
                setTimeout(() => $('paeMsg').textContent='', 2000);
                return;
            }
            
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(arr, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "pae_records.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            $('paeMsg').textContent = 'PAEs exportados';
            setTimeout(() => $('paeMsg').textContent='', 2000);
        });
        
        // Show RCP guide
        function showRcpGuide() {
            clearContent();
            rcpGuide.style.display = 'block';
        }
        
        // RCP timer
        let rcpInterval = null;
        let rcpSeconds = 0;
        
        function startRCP() {
            if (rcpInterval) return;
            rcpSeconds = 0;
            rcpInterval = setInterval(() => {
                rcpSeconds++;
                const mm = String(Math.floor(rcpSeconds/60)).padStart(2,'0');
                const ss = String(rcpSeconds%60).padStart(2,'0');
                $('rcpTimer').textContent = `${mm}:${ss}`;
                if(rcpSeconds % 120 === 0) {
                    if(navigator.vibrate) navigator.vibrate(600);
                    alert('Cambio de reanimador recomendado (cada 2 min).');
                }
            }, 1000);
            $('rcpState').textContent='Estado: iniciado';
        }
        
        function stopRCP() {
            if(rcpInterval) clearInterval(rcpInterval);
            rcpInterval = null;
            $('rcpState').textContent='Estado: detenido';
            $('rcpTimer').textContent='00:00';
        }
        
        $('rcpStart').addEventListener('click', startRCP);
        $('rcpStop').addEventListener('click', stopRCP);
        
        // Show calculadoras
        function showCalculadoras() {
            clearContent();
            calculadoras.style.display = 'flex';
        }
        
        // Calculate IMC
        $('calculateImc').addEventListener('click', () => {
            const weight = parseFloat($('imc_weight').value);
            const height = parseFloat($('imc_height').value) / 100;
            
            if (!weight || !height) {
                $('imc-result').style.display = 'none';
                return;
            }
            
            const imc = weight / (height * height);
            let category = '';
            
            if (imc < 18.5) category = 'Bajo peso';
            else if (imc < 25) category = 'Peso normal';
            else if (imc < 30) category = 'Sobrepeso';
            else if (imc < 35) category = 'Obesidad grado I';
            else if (imc < 40) category = 'Obesidad grado II';
            else category = 'Obesidad grado III';
            
            $('imc-value').textContent = imc.toFixed(2);
            $('imc-category').textContent = category;
            $('imc-result').style.display = 'block';
        });
        
        // Calculate Filtration
        $('calculateFiltration').addEventListener('click', () => {
            const creatinine = parseFloat($('creatinine').value);
            const age = parseInt($('age').value);
            const sex = document.querySelector('input[name="sex"]:checked')?.value;
            
            if (!creatinine || !age || !sex) {
                $('filtration-result').style.display = 'none';
                return;
            }
            
            // F√≥rmula CKD-EPI
            let k, a, sexFactor;
            if (sex === 'female') {
                k = 0.7;
                a = creatinine <= 0.7 ? -0.241 : -1.2;
                sexFactor = 1.018;
            } else {
                k = 0.9;
                a = creatinine <= 0.9 ? -0.302 : -1.2;
                sexFactor = 1;
            }
            
            const eGFR = 141 * Math.pow(Math.min(creatinine/k, 1), a) * 
                        Math.pow(Math.max(creatinine/k, 1), -1.209) * 
                        Math.pow(0.993, age) * sexFactor;
            
            let category = '';
            if (eGFR >= 90) category = 'Normal o aumentado';
            else if (eGFR >= 60) category = 'Levemente disminuido';
            else if (eGFR >= 30) category = 'Moderadamente disminuido';
            else if (eGFR >= 15) category = 'Severamente disminuido';
            else category = 'Insuficiencia renal';
            
            $('filtration-value').textContent = Math.round(eGFR) + ' ml/min/1.73m¬≤';
            $('filtration-category').textContent = category;
            $('filtration-result').style.display = 'block';
        });
        
        // Calculate SCORE
        $('calculateScore').addEventListener('click', () => {
            const age = parseInt($('score_age').value);
            const totalCholesterol = parseFloat($('total-cholesterol').value);
            const hdlCholesterol = parseFloat($('hdl-cholesterol').value);
            const systolicPressure = parseInt($('systolic-pressure').value);
            const smoker = $('smoker').checked;
            const diabetes = $('diabetes').checked;
            
            if (!age || !totalCholesterol || !hdlCholesterol || !systolicPressure) {
                $('score-result').style.display = 'none';
                return;
            }
            
            // F√≥rmula SCORE simplificada (aproximaci√≥n)
            let score = 0;
            
            // Factores de riesgo
            if (age >= 70) score += 3;
            else if (age >= 60) score += 2;
            else if (age >= 50) score += 1;
            
            if (totalCholesterol >= 280) score += 3;
            else if (totalCholesterol >= 240) score += 2;
            else if (totalCholesterol >= 200) score += 1;
            
            if (hdlCholesterol < 35) score += 2;
            else if (hdlCholesterol < 40) score += 1;
            
            if (systolicPressure >= 180) score += 3;
            else if (systolicPressure >= 160) score += 2;
            else if (systolicPressure >= 140) score += 1;
            
            if (smoker) score += 2;
            if (diabetes) score += 2;
            
            let category = '';
            if (score < 5) category = 'Bajo riesgo (<1%)';
            else if (score < 10) category = 'Riesgo bajo (1-2%)';
            else if (score < 15) category = 'Riesgo moderado (3-5%)';
            else if (score < 20) category = 'Riesgo alto (6-10%)';
            else category = 'Riesgo muy alto (>10%)';
            
            $('score-value').textContent = score + ' puntos';
            $('score-category').textContent = category;
            $('score-result').style.display = 'block';
        });
        
        // Show pacientes
        function showPacientes() {
            clearContent();
            pacientes.style.display = 'block';
            updatePatientGrid();
        }
        
        // Update patient grid
        function updatePatientGrid() {
            const container = $('patients-container');
            const search = $('patient-search').value.toLowerCase();
            const specialty = $('patient-specialty').value;
            
            const filteredPatients = PATIENTS.filter(p => {
                const matchesSearch = !search || p.nombre.toLowerCase().includes(search) || 
                                    p.diagnosticoPrincipal.toLowerCase().includes(search);
                const matchesSpecialty = !specialty || p.especialidad === specialty;
                return matchesSearch && matchesSpecialty;
            });
            
            if (filteredPatients.length === 0) {
                container.innerHTML = '<p>No se encontraron pacientes.</p>';
                return;
            }
            
            container.innerHTML = filteredPatients.map(p => 
                `<div class="patient-card">
                    <h3>${p.nombre}</h3>
                    <p>Edad: ${p.edad} a√±os</p>
                    <p>Diagn√≥stico: ${p.diagnosticoPrincipal}</p>
                    <p>Especialidad: ${p.especialidad}</p>
                    <p>Riesgo cardiovascular: ${p.riesgoCardiovascular}</p>
                    <p>Alergias: ${p.alergias.length > 0 ? p.alergias.join(', ') : 'Ninguna'}</p>
                </div>`
            ).join('');
        }
        
        // Patient search
        $('patient-search').addEventListener('input', updatePatientGrid);
        $('patient-specialty').addEventListener('change', updatePatientGrid);
        
        // Add patient button
        $('addPatientBtn').addEventListener('click', () => {
            alert('Funcionalidad de agregar paciente disponible en versi√≥n completa con backend.');
        });
        
        // Show recursos
        function showRecursos() {
            clearContent();
            recursos.style.display = 'block';
            updateResourceCards();
        }
        
        // Update resource cards
        function updateResourceCards() {
            const container = $('resources-container');
            const search = $('resource-search').value.toLowerCase();
            const category = $('resource-category').value;
            
            const filteredResources = RESOURCES.filter(r => {
                const matchesSearch = !search || r.titulo.toLowerCase().includes(search) || 
                                    r.etiquetas.some(tag => tag.toLowerCase().includes(search));
                const matchesCategory = !category || r.categoria === category;
                return matchesSearch && matchesCategory;
            });
            
            if (filteredResources.length === 0) {
                container.innerHTML = '<p>No se encontraron recursos.</p>';
                return;
            }
            
            container.innerHTML = filteredResources.map(r => 
                `<div class="resource-card">
                    <h3>${r.titulo}</h3>
                    <p>Categor√≠a: ${r.categoria}</p>
                    <p>Tipo: ${r.tipo}</p>
                    <p>Etiquetas: ${r.etiquetas.join(', ')}</p>
                    <p>${r.descripcion}</p>
                    <a href="${r.url}" target="_blank" class="btn primary" style="margin-top:8px;">Abrir Recurso</a>
                </div>`
            ).join('');
        }
        
        // Resource search
        $('resource-search').addEventListener('input', updateResourceCards);
        $('resource-category').addEventListener('change', updateResourceCards);
        
        // Add resource button
        $('addResourceBtn').addEventListener('click', () => {
            alert('Funcionalidad de agregar recurso disponible en versi√≥n completa con backend.');
        });
        
        // Wikipedia search
        $('wikiFetchBtn').addEventListener('click', async () => {
            const q = $('globalSearch').value.trim();
            if(!q) { 
                alert('Escriba t√©rmino en la b√∫squeda (ej: neumon√≠a)'); 
                return; 
            }
            $('wikiOutput').textContent = 'Buscando en Wikipedia...';
            try {
                const url = `https://es.wikipedia.org/api/rest_v1/page/summary/${encodeURIComponent(q)}`;
                const res = await fetch(url);
                if(!res.ok) { 
                    $('wikiOutput').textContent = 'No encontrado en Wikipedia.'; 
                    return; 
                }
                const data = await res.json();
                $('wikiOutput').innerHTML = `<strong>${data.title}</strong><div class="small">${data.extract}</div><div style="margin-top:6px"><a href="${data.content_urls?.desktop?.page||'#'}" target="_blank">Leer en Wikipedia</a></div>`;
                diseasePanel.style.display = '';
            } catch(e) {
                $('wikiOutput').textContent = 'Error al buscar en Wikipedia.';
            }
        });
        
        // Add keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + F for search focus
            if ((e.ctrlKey || e.metaKey) && e.key === 'f') {
                e.preventDefault();
                $('globalSearch').focus();
            }
            
            // Escape to clear search
            if (e.key === 'Escape') {
                $('globalSearch').value = '';
            }
        });
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            // Set initial state
            clearContent();
            
            // Add welcome message
            const welcomeCard = document.createElement('div');
            welcomeCard.className = 'category-card';
            welcomeCard.innerHTML = `
                <h2>Bienvenido a Enfermer√≠a DAVID</h2>
                <p>Seleccione una categor√≠a del men√∫ lateral para acceder a procedimientos, gu√≠as cl√≠nicas, combinador de f√°rmacos, enfermedades y m√°s.</p>
                <p>Esta aplicaci√≥n proporciona acceso r√°pido a informaci√≥n esencial para profesionales de enfermer√≠a y salud.</p>
                <div class="form-row" style="margin-top:16px;">
                    <div class="form-group">
                        <button id="quickRcpBtn" class="btn primary" style="width:100%;">üöÄ Gu√≠a R√°pida de RCP</button>
                    </div>
                    <div class="form-group">
                        <button id="quickMedBtn" class="btn secondary" style="width:100%;">üíä Combinador de F√°rmacos</button>
                    </div>
                </div>
            `;
            contentArea.appendChild(welcomeCard);
            
            // Quick action buttons
            $('quickRcpBtn').addEventListener('click', () => {
                document.querySelector('[data-cat="rcp"]').click();
            });
            
            $('quickMedBtn').addEventListener('click', () => {
                document.querySelector('[data-cat="medicamentos"]').click();
            });
        });
    </script>
</body>
</html>
```
