<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MedSys Pro - Sistema Médico Institucional</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --accent-color: #3b82f6;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --bg-tertiary: #f1f5f9;
            --text-primary: #1e293b;
            --text-secondary: #64748b;
            --text-tertiary: #94a3b8;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgb(0 0 0 / 0.05);
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1);
            --shadow-lg: 0 10px 15px -3px rgb(0 0 0 / 0.1);
            --border-radius: 8px;
            --transition: all 0.3s ease;
        }

        [data-theme="dark"] {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #cbd5e1;
            --text-tertiary: #94a3b8;
            --border-color: #475569;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-secondary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: var(--transition);
        }

        .app-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar */
        .sidebar {
            width: 280px;
            background: var(--bg-primary);
            border-right: 1px solid var(--border-color);
            box-shadow: var(--shadow-md);
            position: fixed;
            height: 100vh;
            overflow-y: auto;
            z-index: 1000;
            transition: var(--transition);
        }

        .sidebar.collapsed {
            width: 80px;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            width: 40px;
            height: 40px;
            background: var(--primary-color);
            border-radius: var(--border-radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
        }

        .logo-text {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--text-primary);
            transition: var(--transition);
        }

        .sidebar.collapsed .logo-text {
            display: none;
        }

        .nav-menu {
            padding: 1rem 0;
        }

        .nav-item {
            margin: 0.25rem 1rem;
        }

        .nav-link {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 1rem;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: var(--border-radius);
            transition: var(--transition);
            cursor: pointer;
        }

        .nav-link:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .nav-link.active {
            background: var(--primary-color);
            color: white;
        }

        .nav-icon {
            width: 20px;
            text-align: center;
        }

        .nav-text {
            transition: var(--transition);
        }

        .sidebar.collapsed .nav-text {
            display: none;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            margin-left: 280px;
            transition: var(--transition);
        }

        .sidebar.collapsed + .main-content {
            margin-left: 80px;
        }

        .header {
            background: var(--bg-primary);
            border-bottom: 1px solid var(--border-color);
            padding: 1rem 2rem;
            display: flex;
            justify-content: between;
            align-items: center;
            gap: 1rem;
            box-shadow: var(--shadow-sm);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .sidebar-toggle {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.25rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .sidebar-toggle:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .search-bar {
            flex: 1;
            max-width: 500px;
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 3rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background: var(--bg-secondary);
            color: var(--text-primary);
            font-size: 0.875rem;
            transition: var(--transition);
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgb(37 99 235 / 0.1);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-tertiary);
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .header-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.125rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .header-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .user-menu {
            position: relative;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            cursor: pointer;
        }

        /* Content Area */
        .content {
            padding: 2rem;
            min-height: calc(100vh - 80px);
        }

        .page-header {
            margin-bottom: 2rem;
        }

        .page-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }

        .page-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        /* Cards */
        .card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-sm);
            transition: var(--transition);
        }

        .card:hover {
            box-shadow: var(--shadow-md);
        }

        .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .card-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .card-body {
            padding: 1.5rem;
        }

        /* Grid System */
        .grid {
            display: grid;
            gap: 1.5rem;
        }

        .grid-cols-1 { grid-template-columns: repeat(1, 1fr); }
        .grid-cols-2 { grid-template-columns: repeat(2, 1fr); }
        .grid-cols-3 { grid-template-columns: repeat(3, 1fr); }
        .grid-cols-4 { grid-template-columns: repeat(4, 1fr); }

        @media (max-width: 768px) {
            .grid-cols-2, .grid-cols-3, .grid-cols-4 {
                grid-template-columns: 1fr;
            }
        }

        /* Forms */
        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            background: var(--bg-primary);
            color: var(--text-primary);
            font-size: 0.875rem;
            transition: var(--transition);
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgb(37 99 235 / 0.1);
        }

        .form-textarea {
            resize: vertical;
            min-height: 100px;
        }

        /* Buttons */
        .btn {
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-size: 0.875rem;
            font-weight: 500;
            text-decoration: none;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--secondary-color);
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .btn-secondary:hover {
            background: var(--border-color);
        }

        .btn-success {
            background: var(--success-color);
            color: white;
        }

        .btn-warning {
            background: var(--warning-color);
            color: white;
        }

        .btn-error {
            background: var(--error-color);
            color: white;
        }

        /* Tables */
        .table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-primary);
            border-radius: var(--border-radius);
            overflow: hidden;
            box-shadow: var(--shadow-sm);
        }

        .table th, .table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .table th {
            background: var(--bg-tertiary);
            font-weight: 600;
            color: var(--text-primary);
        }

        .table td {
            color: var(--text-secondary);
        }

        .table tr:hover {
            background: var(--bg-secondary);
        }

        /* Badges */
        .badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .badge-primary {
            background: rgb(37 99 235 / 0.1);
            color: var(--primary-color);
        }

        .badge-success {
            background: rgb(16 185 129 / 0.1);
            color: var(--success-color);
        }

        .badge-warning {
            background: rgb(245 158 11 / 0.1);
            color: var(--warning-color);
        }

        .badge-error {
            background: rgb(239 68 68 / 0.1);
            color: var(--error-color);
        }

        /* Modal */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            opacity: 0;
            visibility: hidden;
            transition: var(--transition);
        }

        .modal.active {
            opacity: 1;
            visibility: visible;
        }

        .modal-content {
            background: var(--bg-primary);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            transform: scale(0.9);
            transition: var(--transition);
        }

        .modal.active .modal-content {
            transform: scale(1);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-tertiary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: var(--border-radius);
            transition: var(--transition);
        }

        .modal-close:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .modal-body {
            padding: 1.5rem;
        }

        /* Animations */
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .slide-in {
            animation: slideIn 0.3s ease-in-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .header {
                padding: 1rem;
            }

            .content {
                padding: 1rem;
            }

            .page-title {
                font-size: 1.5rem;
            }
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        .flex { display: flex; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-1 { gap: 0.25rem; }
        .gap-2 { gap: 0.5rem; }
        .gap-4 { gap: 1rem; }
        .mb-2 { margin-bottom: 0.5rem; }
        .mb-4 { margin-bottom: 1rem; }
        .mt-4 { margin-top: 1rem; }
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .font-bold { font-weight: 700; }
        .text-sm { font-size: 0.875rem; }
        .text-xs { font-size: 0.75rem; }

        /* Calculator specific styles */
        .calculator-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
        }

        .calculator-result {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .result-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .result-interpretation {
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        /* Disease search styles */
        .disease-card {
            cursor: pointer;
            transition: var(--transition);
        }

        .disease-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .symptoms-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .symptom-tag {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
        }

        /* Professional directory styles */
        .professional-card {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem;
        }

        .professional-avatar {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            background: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            font-weight: 600;
        }

        .professional-info {
            flex: 1;
        }

        .professional-name {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .professional-specialty {
            color: var(--primary-color);
            font-weight: 500;
            margin-bottom: 0.25rem;
        }

        .professional-contact {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        /* News styles */
        .news-card {
            border-left: 4px solid var(--primary-color);
            transition: var(--transition);
        }

        .news-card:hover {
            border-left-color: var(--accent-color);
        }

        .news-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 0.875rem;
            color: var(--text-tertiary);
        }

        .news-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
        }

        .news-excerpt {
            color: var(--text-secondary);
            line-height: 1.6;
        }

        /* Settings styles */
        .settings-section {
            margin-bottom: 2rem;
        }

        .settings-title {
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .color-picker {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .color-option {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid transparent;
            cursor: pointer;
            transition: var(--transition);
        }

        .color-option.active {
            border-color: var(--text-primary);
        }

        /* Language selector */
        .language-selector {
            display: flex;
            gap: 0.5rem;
        }

        .language-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            color: var(--text-secondary);
            border-radius: var(--border-radius);
            cursor: pointer;
            transition: var(--transition);
        }

        .language-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        /* Favorites styles */
        .favorite-btn {
            background: none;
            border: none;
            color: var(--text-tertiary);
            font-size: 1.25rem;
            cursor: pointer;
            transition: var(--transition);
        }

        .favorite-btn.active {
            color: var(--warning-color);
        }

        .favorite-btn:hover {
            color: var(--warning-color);
        }

        /* Loading spinner */
        .spinner {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border-color);
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Toast notifications */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--border-radius);
            box-shadow: var(--shadow-lg);
            padding: 1rem 1.5rem;
            z-index: 3000;
            transform: translateX(100%);
            transition: var(--transition);
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast-success {
            border-left: 4px solid var(--success-color);
        }

        .toast-error {
            border-left: 4px solid var(--error-color);
        }

        .toast-warning {
            border-left: 4px solid var(--warning-color);
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <div class="logo">
                    <i class="fas fa-heartbeat"></i>
                </div>
                <div class="logo-text" id="logoText">MedSys Pro</div>
            </div>
            
            <div class="nav-menu">
                <div class="nav-item">
                    <a href="#" class="nav-link active" data-page="dashboard">
                        <i class="nav-icon fas fa-home"></i>
                        <span class="nav-text" data-i18n="nav.dashboard">Panel Principal</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-page="diseases">
                        <i class="nav-icon fas fa-disease"></i>
                        <span class="nav-text" data-i18n="nav.diseases">Enfermedades</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-page="calculators">
                        <i class="nav-icon fas fa-calculator"></i>
                        <span class="nav-text" data-i18n="nav.calculators">Calculadoras</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-page="lab-results">
                        <i class="nav-icon fas fa-flask"></i>
                        <span class="nav-text" data-i18n="nav.labResults">Laboratorio</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-page="medications">
                        <i class="nav-icon fas fa-pills"></i>
                        <span class="nav-text" data-i18n="nav.medications">Medicamentos</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-page="news">
                        <i class="nav-icon fas fa-newspaper"></i>
                        <span class="nav-text" data-i18n="nav.news">Novedades</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-page="directory">
                        <i class="nav-icon fas fa-address-book"></i>
                        <span class="nav-text" data-i18n="nav.directory">Directorio</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-page="guidelines">
                        <i class="nav-icon fas fa-book-medical"></i>
                        <span class="nav-text" data-i18n="nav.guidelines">Guías Clínicas</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-page="profile">
                        <i class="nav-icon fas fa-user"></i>
                        <span class="nav-text" data-i18n="nav.profile">Mi Perfil</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-page="settings">
                        <i class="nav-icon fas fa-cog"></i>
                        <span class="nav-text" data-i18n="nav.settings">Configuración</span>
                    </a>
                </div>
                <div class="nav-item">
                    <a href="#" class="nav-link" data-page="help">
                        <i class="nav-icon fas fa-question-circle"></i>
                        <span class="nav-text" data-i18n="nav.help">Ayuda</span>
                    </a>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <button class="sidebar-toggle" id="sidebarToggle">
                        <i class="fas fa-bars"></i>
                    </button>
                    <div class="search-bar">
                        <i class="search-icon fas fa-search"></i>
                        <input type="text" class="search-input" placeholder="Buscar..." data-i18n-placeholder="search.placeholder" id="globalSearch">
                    </div>
                </div>
                <div class="header-right">
                    <button class="header-btn" id="themeToggle" title="Cambiar tema">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="header-btn" id="notificationsBtn" title="Notificaciones">
                        <i class="fas fa-bell"></i>
                    </button>
                    <div class="user-menu">
                        <div class="user-avatar" id="userAvatar">
                            <i class="fas fa-user"></i>
                        </div>
                    </div>
                </div>
            </header>

            <!-- Content Area -->
            <div class="content" id="mainContent">
                <!-- Dashboard Page -->
                <div id="dashboard-page" class="page fade-in">
                    <div class="page-header">
                        <h1 class="page-title" data-i18n="dashboard.title">Panel Principal</h1>
                        <p class="page-subtitle" data-i18n="dashboard.subtitle">Bienvenido al sistema médico institucional</p>
                    </div>

                    <div class="grid grid-cols-4 mb-4">
                        <div class="card">
                            <div class="card-body">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-secondary" data-i18n="dashboard.stats.diseases">Enfermedades</p>
                                        <p class="text-2xl font-bold" id="diseasesCount">0</p>
                                    </div>
                                    <div class="text-3xl text-primary">
                                        <i class="fas fa-disease"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-body">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-secondary" data-i18n="dashboard.stats.medications">Medicamentos</p>
                                        <p class="text-2xl font-bold" id="medicationsCount">0</p>
                                    </div>
                                    <div class="text-3xl text-success">
                                        <i class="fas fa-pills"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-body">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-secondary" data-i18n="dashboard.stats.professionals">Profesionales</p>
                                        <p class="text-2xl font-bold" id="professionalsCount">0</p>
                                    </div>
                                    <div class="text-3xl text-warning">
                                        <i class="fas fa-user-md"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-body">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <p class="text-sm text-secondary" data-i18n="dashboard.stats.guidelines">Guías</p>
                                        <p class="text-2xl font-bold" id="guidelinesCount">0</p>
                                    </div>
                                    <div class="text-3xl text-error">
                                        <i class="fas fa-book-medical"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="grid grid-cols-2">
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title" data-i18n="dashboard.recentActivity">Actividad Reciente</h3>
                            </div>
                            <div class="card-body">
                                <div id="recentActivity">
                                    <!-- Recent activity will be populated here -->
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title" data-i18n="dashboard.quickActions">Acciones Rápidas</h3>
                            </div>
                            <div class="card-body">
                                <div class="grid grid-cols-2 gap-4">
                                    <button class="btn btn-primary" onclick="navigateTo('calculators')">
                                        <i class="fas fa-calculator"></i>
                                        <span data-i18n="dashboard.quickActions.calculator">Calculadora</span>
                                    </button>
                                    <button class="btn btn-secondary" onclick="navigateTo('diseases')">
                                        <i class="fas fa-search"></i>
                                        <span data-i18n="dashboard.quickActions.search">Buscar</span>
                                    </button>
                                    <button class="btn btn-success" onclick="navigateTo('lab-results')">
                                        <i class="fas fa-flask"></i>
                                        <span data-i18n="dashboard.quickActions.lab">Laboratorio</span>
                                    </button>
                                    <button class="btn btn-warning" onclick="navigateTo('medications')">
                                        <i class="fas fa-pills"></i>
                                        <span data-i18n="dashboard.quickActions.meds">Medicamentos</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Other pages will be dynamically loaded here -->
            </div>
        </main>
    </div>

    <!-- Login Modal -->
    <div class="modal" id="loginModal">
        <div class="modal-content" style="width: 400px;">
            <div class="modal-header">
                <h2 class="modal-title" data-i18n="login.title">Iniciar Sesión</h2>
            </div>
            <div class="modal-body">
                <form id="loginForm">
                    <div class="form-group">
                        <label class="form-label" data-i18n="login.username">Usuario</label>
                        <input type="text" class="form-input" id="loginUsername" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label" data-i18n="login.password">Contraseña</label>
                        <input type="password" class="form-input" id="loginPassword" required>
                    </div>
                    <div class="form-group">
                        <label class="flex items-center gap-2">
                            <input type="checkbox" id="rememberMe">
                            <span data-i18n="login.remember">Recordarme</span>
                        </label>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">
                        <span data-i18n="login.submit">Iniciar Sesión</span>
                    </button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Application State
        const AppState = {
            currentUser: null,
            currentPage: 'dashboard',
            theme: 'light',
            language: 'es',
            sidebarCollapsed: false,
            data: {
                diseases: [],
                medications: [],
                professionals: [],
                guidelines: [],
                news: [],
                labResults: [],
                calculatorHistory: [],
                favorites: {
                    diseases: [],
                    medications: [],
                    guidelines: []
                }
            }
        };

        // Translations
        const translations = {
            es: {
                nav: {
                    dashboard: 'Panel Principal',
                    diseases: 'Enfermedades',
                    calculators: 'Calculadoras',
                    labResults: 'Laboratorio',
                    medications: 'Medicamentos',
                    news: 'Novedades',
                    directory: 'Directorio',
                    guidelines: 'Guías Clínicas',
                    profile: 'Mi Perfil',
                    settings: 'Configuración',
                    help: 'Ayuda'
                },
                dashboard: {
                    title: 'Panel Principal',
                    subtitle: 'Bienvenido al sistema médico institucional',
                    stats: {
                        diseases: 'Enfermedades',
                        medications: 'Medicamentos',
                        professionals: 'Profesionales',
                        guidelines: 'Guías'
                    },
                    recentActivity: 'Actividad Reciente',
                    quickActions: {
                        title: 'Acciones Rápidas',
                        calculator: 'Calculadora',
                        search: 'Buscar',
                        lab: 'Laboratorio',
                        meds: 'Medicamentos'
                    }
                },
                search: {
                    placeholder: 'Buscar...'
                },
                login: {
                    title: 'Iniciar Sesión',
                    username: 'Usuario',
                    password: 'Contraseña',
                    remember: 'Recordarme',
                    submit: 'Iniciar Sesión'
                }
            },
            en: {
                nav: {
                    dashboard: 'Dashboard',
                    diseases: 'Diseases',
                    calculators: 'Calculators',
                    labResults: 'Laboratory',
                    medications: 'Medications',
                    news: 'News',
                    directory: 'Directory',
                    guidelines: 'Guidelines',
                    profile: 'My Profile',
                    settings: 'Settings',
                    help: 'Help'
                },
                dashboard: {
                    title: 'Dashboard',
                    subtitle: 'Welcome to the institutional medical system',
                    stats: {
                        diseases: 'Diseases',
                        medications: 'Medications',
                        professionals: 'Professionals',
                        guidelines: 'Guidelines'
                    },
                    recentActivity: 'Recent Activity',
                    quickActions: {
                        title: 'Quick Actions',
                        calculator: 'Calculator',
                        search: 'Search',
                        lab: 'Laboratory',
                        meds: 'Medications'
                    }
                },
                search: {
                    placeholder: 'Search...'
                },
                login: {
                    title: 'Login',
                    username: 'Username',
                    password: 'Password',
                    remember: 'Remember me',
                    submit: 'Login'
                }
            }
        };

        // Sample Data
        const sampleData = {
            diseases: [
                {
                    id: 1,
                    name: 'Hipertensión Arterial',
                    nameEn: 'Arterial Hypertension',
                    specialty: 'Cardiología',
                    specialtyEn: 'Cardiology',
                    icd10: 'I10',
                    description: 'Presión arterial persistentemente elevada por encima de 140/90 mmHg en adultos.',
                    descriptionEn: 'Persistently elevated blood pressure above 140/90 mmHg in adults.',
                    symptoms: ['Dolor de cabeza', 'Mareos', 'Visión borrosa', 'Fatiga', 'Palpitaciones'],
                    symptomsEn: ['Headache', 'Dizziness', 'Blurred vision', 'Fatigue', 'Palpitations'],
                    diagnosis: 'Medición repetida de presión arterial, evaluación de órganos diana, análisis de laboratorio.',
                    diagnosisEn: 'Repeated blood pressure measurement, target organ evaluation, laboratory analysis.',
                    treatment: 'Modificaciones del estilo de vida, medicación antihipertensiva según guías.',
                    treatmentEn: 'Lifestyle modifications, antihypertensive medication according to guidelines.',
                    medications: ['Enalapril', 'Amlodipino', 'Hidroclorotiazida'],
                    prognosis: 'Bueno con tratamiento adecuado y adherencia.',
                    prognosisEn: 'Good with adequate treatment and adherence.',
                    prevention: 'Dieta baja en sodio, ejercicio regular, control de peso.',
                    preventionEn: 'Low sodium diet, regular exercise, weight control.'
                },
                {
                    id: 2,
                    name: 'Diabetes Mellitus Tipo 2',
                    nameEn: 'Type 2 Diabetes Mellitus',
                    specialty: 'Endocrinología',
                    specialtyEn: 'Endocrinology',
                    icd10: 'E11',
                    description: 'Trastorno metabólico caracterizado por hiperglucemia crónica debido a resistencia a la insulina.',
                    descriptionEn: 'Metabolic disorder characterized by chronic hyperglycemia due to insulin resistance.',
                    symptoms: ['Poliuria', 'Polidipsia', 'Pérdida de peso', 'Fatiga', 'Visión borrosa'],
                    symptomsEn: ['Polyuria', 'Polydipsia', 'Weight loss', 'Fatigue', 'Blurred vision'],
                    diagnosis: 'Glucemia en ayunas ≥126 mg/dL, HbA1c ≥6.5%, prueba de tolerancia a la glucosa.',
                    diagnosisEn: 'Fasting glucose ≥126 mg/dL, HbA1c ≥6.5%, glucose tolerance test.',
                    treatment: 'Control glucémico mediante dieta, ejercicio y medicación hipoglucemiante.',
                    treatmentEn: 'Glycemic control through diet, exercise and hypoglycemic medication.',
                    medications: ['Metformina', 'Glibenclamida', 'Insulina'],
                    prognosis: 'Variable, depende del control glucémico y complicaciones.',
                    prognosisEn: 'Variable, depends on glycemic control and complications.',
                    prevention: 'Mantener peso saludable, ejercicio regular, dieta equilibrada.',
                    preventionEn: 'Maintain healthy weight, regular exercise, balanced diet.'
                },
                {
                    id: 3,
                    name: 'Neumonía Adquirida en la Comunidad',
                    nameEn: 'Community-Acquired Pneumonia',
                    specialty: 'Neumología',
                    specialtyEn: 'Pulmonology',
                    icd10: 'J18.9',
                    description: 'Infección aguda del parénquima pulmonar adquirida fuera del hospital.',
                    descriptionEn: 'Acute infection of lung parenchyma acquired outside the hospital.',
                    symptoms: ['Fiebre', 'Tos productiva', 'Disnea', 'Dolor torácico', 'Escalofríos'],
                    symptomsEn: ['Fever', 'Productive cough', 'Dyspnea', 'Chest pain', 'Chills'],
                    diagnosis: 'Radiografía de tórax, hemograma, cultivos, gasometría arterial.',
                    diagnosisEn: 'Chest X-ray, blood count, cultures, arterial blood gas.',
                    treatment: 'Antibioticoterapia empírica según severidad y factores de riesgo.',
                    treatmentEn: 'Empirical antibiotic therapy according to severity and risk factors.',
                    medications: ['Amoxicilina', 'Azitromicina', 'Ceftriaxona'],
                    prognosis: 'Bueno en pacientes jóvenes sin comorbilidades.',
                    prognosisEn: 'Good in young patients without comorbidities.',
                    prevention: 'Vacunación, higiene de manos, evitar tabaquismo.',
                    preventionEn: 'Vaccination, hand hygiene, avoid smoking.'
                }
            ],
            medications: [
                {
                    id: 1,
                    name: 'Paracetamol',
                    genericName: 'Acetaminofén',
                    brandNames: ['Tylenol', 'Panadol', 'Tempra'],
                    category: 'Analgésicos',
                    categoryEn: 'Analgesics',
                    atcCode: 'N02BE01',
                    presentation: '500mg tabletas',
                    presentationEn: '500mg tablets',
                    indication: 'Dolor leve a moderado, fiebre',
                    indicationEn: 'Mild to moderate pain, fever',
                    dosage: 'Adultos: 500-1000mg cada 6-8 horas. Máximo 4g/día.',
                    dosageEn: 'Adults: 500-1000mg every 6-8 hours. Maximum 4g/day.',
                    contraindications: 'Hipersensibilidad, hepatopatía severa',
                    contraindicationsEn: 'Hypersensitivity, severe liver disease',
                    sideEffects: 'Raros: hepatotoxicidad, reacciones cutáneas',
                    sideEffectsEn: 'Rare: hepatotoxicity, skin reactions',
                    interactions: 'Warfarina, alcohol, carbamazepina',
                    price: 12.50,
                    currency: 'USD',
                    lastUpdated: '2024-01-15',
                    pharmacies: ['Farmacia Central', 'Cruz Verde', 'Inkafarma']
                },
                {
                    id: 2,
                    name: 'Amoxicilina',
                    genericName: 'Amoxicilina',
                    brandNames: ['Amoxil', 'Flemoxin', 'Clamoxyl'],
                    category: 'Antibióticos',
                    categoryEn: 'Antibiotics',
                    atcCode: 'J01CA04',
                    presentation: '500mg cápsulas',
                    presentationEn: '500mg capsules',
                    indication: 'Infecciones bacterianas susceptibles',
                    indicationEn: 'Susceptible bacterial infections',
                    dosage: 'Adultos: 500mg cada 8 horas por 7-10 días.',
                    dosageEn: 'Adults: 500mg every 8 hours for 7-10 days.',
                    contraindications: 'Alergia a penicilinas, mononucleosis',
                    contraindicationsEn: 'Penicillin allergy, mononucleosis',
                    sideEffects: 'Diarrea, náuseas, rash cutáneo',
                    sideEffectsEn: 'Diarrhea, nausea, skin rash',
                    interactions: 'Anticoagulantes orales, metotrexato',
                    price: 18.90,
                    currency: 'USD',
                    lastUpdated: '2024-01-14',
                    pharmacies: ['Boticas Arcángel', 'Mifarma', 'Farmacia Universal']
                },
                {
                    id: 3,
                    name: 'Enalapril',
                    genericName: 'Enalapril maleato',
                    brandNames: ['Renitec', 'Vasotec', 'Glioten'],
                    category: 'Antihipertensivos',
                    categoryEn: 'Antihypertensives',
                    atcCode: 'C09AA02',
                    presentation: '10mg tabletas',
                    presentationEn: '10mg tablets',
                    indication: 'Hipertensión arterial, insuficiencia cardíaca',
                    indicationEn: 'Arterial hypertension, heart failure',
                    dosage: 'Inicial: 5mg/día. Mantenimiento: 10-40mg/día.',
                    dosageEn: 'Initial: 5mg/day. Maintenance: 10-40mg/day.',
                    contraindications: 'Embarazo, angioedema previo, estenosis renal bilateral',
                    contraindicationsEn: 'Pregnancy, previous angioedema, bilateral renal stenosis',
                    sideEffects: 'Tos seca, hipotensión, hiperpotasemia',
                    sideEffectsEn: 'Dry cough, hypotension, hyperkalemia',
                    interactions: 'Diuréticos, AINEs, suplementos de potasio',
                    price: 15.75,
                    currency: 'USD',
                    lastUpdated: '2024-01-13',
                    pharmacies: ['Farmacia del Ahorro', 'Similares', 'Farmacias Guadalajara']
                }
            ],
            professionals: [
                {
                    id: 1,
                    name: 'Dr. Juan Carlos Pérez',
                    nameEn: 'Dr. Juan Carlos Pérez',
                    specialty: 'Cardiología',
                    specialtyEn: 'Cardiology',
                    subspecialty: 'Electrofisiología',
                    subspecialtyEn: 'Electrophysiology',
                    department: 'Consulta Externa',
                    departmentEn: 'Outpatient Clinic',
                    phone: '+51 999 123 456',
                    email: 'juan.perez@hospital.com',
                    location: 'Consultorio 201, Piso 2',
                    locationEn: 'Office 201, Floor 2',
                    schedule: 'Lunes a Viernes 8:00-16:00',
                    scheduleEn: 'Monday to Friday 8:00-16:00',
                    education: 'Universidad Nacional Mayor de San Marcos, Fellowship en Mayo Clinic',
                    educationEn: 'Universidad Nacional Mayor de San Marcos, Fellowship at Mayo Clinic',
                    certifications: ['Cardiología Intervencionista', 'Electrofisiología Cardíaca'],
                    certificationsEn: ['Interventional Cardiology', 'Cardiac Electrophysiology'],
                    languages: ['Español', 'Inglés'],
                    languagesEn: ['Spanish', 'English'],
                    experience: 15,
                    rating: 4.8,
                    reviews: 127,
                    available: true
                },
                {
                    id: 2,
                    name: 'Dra. María Elena López',
                    nameEn: 'Dr. María Elena López',
                    specialty: 'Neurología',
                    specialtyEn: 'Neurology',
                    subspecialty: 'Neurología Pediátrica',
                    subspecialtyEn: 'Pediatric Neurology',
                    department: 'Hospitalización',
                    departmentEn: 'Inpatient Ward',
                    phone: '+51 999 654 321',
                    email: 'maria.lopez@hospital.com',
                    location: 'Piso 3, Neurología',
                    locationEn: 'Floor 3, Neurology',
                    schedule: 'Lunes, Miércoles, Viernes 9:00-17:00',
                    scheduleEn: 'Monday, Wednesday, Friday 9:00-17:00',
                    education: 'Universidad Peruana Cayetano Heredia, Residencia en Hospital Nacional',
                    educationEn: 'Universidad Peruana Cayetano Heredia, Residency at National Hospital',
                    certifications: ['Neurología Pediátrica', 'Electroencefalografía'],
                    certificationsEn: ['Pediatric Neurology', 'Electroencephalography'],
                    languages: ['Español', 'Inglés', 'Francés'],
                    languagesEn: ['Spanish', 'English', 'French'],
                    experience: 12,
                    rating: 4.9,
                    reviews: 89,
                    available: false
                },
                {
                    id: 3,
                    name: 'Dr. Roberto Silva',
                    nameEn: 'Dr. Roberto Silva',
                    specialty: 'Medicina Interna',
                    specialtyEn: 'Internal Medicine',
                    subspecialty: 'Medicina Intensiva',
                    subspecialtyEn: 'Intensive Care Medicine',
                    department: 'UCI',
                    departmentEn: 'ICU',
                    phone: '+51 999 789 012',
                    email: 'roberto.silva@hospital.com',
                    location: 'UCI, Piso 4',
                    locationEn: 'ICU, Floor 4',
                    schedule: 'Guardias 24/7',
                    scheduleEn: '24/7 On-call',
                    education: 'Universidad Nacional de Trujillo, Especialización en España',
                    educationEn: 'Universidad Nacional de Trujillo, Specialization in Spain',
                    certifications: ['Medicina Intensiva', 'Soporte Vital Avanzado'],
                    certificationsEn: ['Intensive Care Medicine', 'Advanced Life Support'],
                    languages: ['Español', 'Inglés'],
                    languagesEn: ['Spanish', 'English'],
                    experience: 20,
                    rating: 4.7,
                    reviews: 156,
                    available: true
                }
            ],
            guidelines: [
                {
                    id: 1,
                    title: 'Guía de Manejo de Hipertensión Arterial 2024',
                    titleEn: 'Arterial Hypertension Management Guidelines 2024',
                    specialty: 'Cardiología',
                    specialtyEn: 'Cardiology',
                    organization: 'Sociedad Peruana de Cardiología',
                    organizationEn: 'Peruvian Society of Cardiology',
                    version: '2024.1',
                    lastUpdate: '2024-01-10',
                    evidenceLevel: 'A',
                    description: 'Guía actualizada para el diagnóstico y tratamiento de la hipertensión arterial en adultos.',
                    descriptionEn: 'Updated guidelines for diagnosis and treatment of arterial hypertension in adults.',
                    keyPoints: [
                        'Objetivo de PA < 130/80 mmHg en la mayoría de pacientes',
                        'Inicio con monoterapia en HTA grado 1',
                        'Combinación fija preferida en HTA grado 2',
                        'Evaluación de riesgo cardiovascular global'
                    ],
                    keyPointsEn: [
                        'BP target < 130/80 mmHg in most patients',
                        'Start with monotherapy in grade 1 HTN',
                        'Fixed combination preferred in grade 2 HTN',
                        'Global cardiovascular risk assessment'
                    ],
                    downloadUrl: '#',
                    category: 'Tratamiento'
                },
                {
                    id: 2,
                    title: 'Protocolo de Manejo de ACV Agudo',
                    titleEn: 'Acute Stroke Management Protocol',
                    specialty: 'Neurología',
                    specialtyEn: 'Neurology',
                    organization: 'Ministerio de Salud',
                    organizationEn: 'Ministry of Health',
                    version: '2023.2',
                    lastUpdate: '2023-12-15',
                    evidenceLevel: 'A',
                    description: 'Algoritmo de atención para accidente cerebrovascular agudo en servicios de emergencia.',
                    descriptionEn: 'Care algorithm for acute stroke in emergency services.',
                    keyPoints: [
                        'Ventana terapéutica de 4.5 horas para trombolisis',
                        'Evaluación con escala NIHSS',
                        'Neuroimagen urgente obligatoria',
                        'Unidad de ACV especializada'
                    ],
                    keyPointsEn: [
                        '4.5-hour therapeutic window for thrombolysis',
                        'NIHSS scale assessment',
                        'Urgent neuroimaging mandatory',
                        'Specialized stroke unit'
                    ],
                    downloadUrl: '#',
                    category: 'Emergencia'
                },
                {
                    id: 3,
                    title: 'Guía de Antibioticoterapia Empírica',
                    titleEn: 'Empirical Antibiotic Therapy Guidelines',
                    specialty: 'Infectología',
                    specialtyEn: 'Infectious Diseases',
                    organization: 'Sociedad Peruana de Enfermedades Infecciosas',
                    organizationEn: 'Peruvian Society of Infectious Diseases',
                    version: '2024.1',
                    lastUpdate: '2024-01-05',
                    evidenceLevel: 'B',
                    description: 'Recomendaciones para el uso empírico de antibióticos según sitio de infección.',
                    descriptionEn: 'Recommendations for empirical antibiotic use by infection site.',
                    keyPoints: [
                        'Selección según patrón de resistencia local',
                        'Duración óptima de tratamiento',
                        'Criterios de escalamiento y desescalamiento',
                        'Prevención de resistencia antimicrobiana'
                    ],
                    keyPointsEn: [
                        'Selection based on local resistance patterns',
                        'Optimal treatment duration',
                        'Escalation and de-escalation criteria',
                        'Antimicrobial resistance prevention'
                    ],
                    downloadUrl: '#',
                    category: 'Tratamiento'
                }
            ],
            news: [
                {
                    id: 1,
                    title: 'Nueva evidencia sobre el uso de estatinas en prevención primaria',
                    titleEn: 'New evidence on statin use in primary prevention',
                    summary: 'Estudio multicéntrico demuestra beneficios adicionales en pacientes de riesgo intermedio.',
                    summaryEn: 'Multicenter study demonstrates additional benefits in intermediate-risk patients.',
                    content: 'Un amplio estudio multicéntrico publicado en el New England Journal of Medicine ha demostrado que el uso de estatinas en prevención primaria...',
                    contentEn: 'A large multicenter study published in the New England Journal of Medicine has shown that statin use in primary prevention...',
                    category: 'Farmacología',
                    categoryEn: 'Pharmacology',
                    author: 'Dr. Carlos Mendoza',
                    authorEn: 'Dr. Carlos Mendoza',
                    date: '2024-01-15',
                    source: 'New England Journal of Medicine',
                    tags: ['estatinas', 'prevención', 'cardiovascular'],
                    tagsEn: ['statins', 'prevention', 'cardiovascular'],
                    importance: 'high',
                    imageUrl: 'https://via.placeholder.com/400x200'
                },
                {
                    id: 2,
                    title: 'Actualización en técnicas de reanimación cardiopulmonar',
                    titleEn: 'Update on cardiopulmonary resuscitation techniques',
                    summary: 'Nuevas guías internacionales modifican protocolos de RCP en adultos.',
                    summaryEn: 'New international guidelines modify CPR protocols in adults.',
                    content: 'La American Heart Association ha publicado las nuevas guías de reanimación cardiopulmonar que incluyen cambios significativos...',
                    contentEn: 'The American Heart Association has published new cardiopulmonary resuscitation guidelines that include significant changes...',
                    category: 'Técnicas',
                    categoryEn: 'Techniques',
                    author: 'Dra. Ana Rodríguez',
                    authorEn: 'Dr. Ana Rodríguez',
                    date: '2024-01-14',
                    source: 'American Heart Association',
                    tags: ['RCP', 'emergencias', 'protocolos'],
                    tagsEn: ['CPR', 'emergency', 'protocols'],
                    importance: 'high',
                    imageUrl: 'https://via.placeholder.com/400x200'
                },
                {
                    id: 3,
                    title: 'Avances en inmunoterapia para cáncer de pulmón',
                    titleEn: 'Advances in immunotherapy for lung cancer',
                    summary: 'Nuevos biomarcadores mejoran la selección de pacientes para inmunoterapia.',
                    summaryEn: 'New biomarkers improve patient selection for immunotherapy.',
                    content: 'Investigadores han identificado nuevos biomarcadores que permiten una mejor selección de pacientes con cáncer de pulmón...',
                    contentEn: 'Researchers have identified new biomarkers that allow better selection of lung cancer patients...',
                    category: 'Oncología',
                    categoryEn: 'Oncology',
                    author: 'Dr. Luis Martínez',
                    authorEn: 'Dr. Luis Martínez',
                    date: '2024-01-13',
                    source: 'Journal of Clinical Oncology',
                    tags: ['cáncer', 'inmunoterapia', 'biomarcadores'],
                    tagsEn: ['cancer', 'immunotherapy', 'biomarkers'],
                    importance: 'medium',
                    imageUrl: 'https://via.placeholder.com/400x200'
                }
            ]
        };

        // Utility Functions
        function generateId() {
            return Date.now().toString(36) + Math.random().toString(36).substr(2);
        }

        function formatDate(date) {
            return new Date(date).toLocaleDateString(AppState.language === 'es' ? 'es-ES' : 'en-US');
        }

        function showToast(message, type = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast toast-${type} show`;
            toast.textContent = message;
            document.body.appendChild(toast);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => document.body.removeChild(toast), 300);
            }, 3000);
        }

        // Storage Functions
        function saveToStorage(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
                return true;
            } catch (error) {
                console.error('Error saving to storage:', error);
                return false;
            }
        }

        function loadFromStorage(key, defaultValue = null) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : defaultValue;
            } catch (error) {
                console.error('Error loading from storage:', error);
                return defaultValue;
            }
        }

        // Authentication Functions
        function login(username, password) {
            // Simple authentication - in real app, this would be server-side
            const users = loadFromStorage('users', [
                { username: 'admin', password: 'admin123', name: 'Administrador', role: 'admin' },
                { username: 'doctor', password: 'doctor123', name: 'Dr. Juan Pérez', role: 'doctor' },
                { username: 'nurse', password: 'nurse123', name: 'Enf. María García', role: 'nurse' }
            ]);

            const user = users.find(u => u.username === username && u.password === password);
            if (user) {
                AppState.currentUser = user;
                saveToStorage('currentUser', user);
                closeModal('loginModal');
                showToast(`Bienvenido, ${user.name}!`);
                updateUserInterface();
                return true;
            }
            return false;
        }

        function logout() {
            AppState.currentUser = null;
            localStorage.removeItem('currentUser');
            showModal('loginModal');
            updateUserInterface();
        }

        function checkAuthentication() {
            const user = loadFromStorage('currentUser');
            if (user) {
                AppState.currentUser = user;
                updateUserInterface();
            } else {
                showModal('loginModal');
            }
        }

        // Theme Functions
        function toggleTheme() {
            AppState.theme = AppState.theme === 'light' ? 'dark' : 'light';
            document.documentElement.setAttribute('data-theme', AppState.theme);
            saveToStorage('theme', AppState.theme);
            
            const themeIcon = document.querySelector('#themeToggle i');
            themeIcon.className = AppState.theme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
        }

        function loadTheme() {
            const savedTheme = loadFromStorage('theme', 'light');
            AppState.theme = savedTheme;
            document.documentElement.setAttribute('data-theme', savedTheme);
            
            const themeIcon = document.querySelector('#themeToggle i');
            if (themeIcon) {
                themeIcon.className = savedTheme === 'light' ? 'fas fa-moon' : 'fas fa-sun';
            }
        }

        // Language Functions
        function setLanguage(lang) {
            AppState.language = lang;
            saveToStorage('language', lang);
            updateTranslations();
            updateContent();
        }

        function updateTranslations() {
            const elements = document.querySelectorAll('[data-i18n]');
            elements.forEach(element => {
                const key = element.getAttribute('data-i18n');
                const translation = getTranslation(key);
                if (translation) {
                    element.textContent = translation;
                }
            });

            const placeholderElements = document.querySelectorAll('[data-i18n-placeholder]');
            placeholderElements.forEach(element => {
                const key = element.getAttribute('data-i18n-placeholder');
                const translation = getTranslation(key);
                if (translation) {
                    element.placeholder = translation;
                }
            });
        }

        function getTranslation(key) {
            const keys = key.split('.');
            let translation = translations[AppState.language];
            
            for (const k of keys) {
                if (translation && translation[k]) {
                    translation = translation[k];
                } else {
                    return null;
                }
            }
            
            return translation;
        }

        // Navigation Functions
        function navigateTo(page) {
            // Hide all pages
            const pages = document.querySelectorAll('.page');
            pages.forEach(p => p.classList.add('hidden'));

            // Show target page
            const targetPage = document.getElementById(`${page}-page`);
            if (targetPage) {
                targetPage.classList.remove('hidden');
                targetPage.classList.add('fade-in');
            } else {
                // Create page if it doesn't exist
                createPage(page);
            }

            // Update navigation
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => link.classList.remove('active'));
            
            const activeLink = document.querySelector(`[data-page="${page}"]`);
            if (activeLink) {
                activeLink.classList.add('active');
            }

            AppState.currentPage = page;
            saveToStorage('currentPage', page);
        }

        function createPage(pageId) {
            const content = document.getElementById('mainContent');
            const pageDiv = document.createElement('div');
            pageDiv.id = `${pageId}-page`;
            pageDiv.className = 'page fade-in';

            switch (pageId) {
                case 'diseases':
                    pageDiv.innerHTML = createDiseasesPage();
                    break;
                case 'calculators':
                    pageDiv.innerHTML = createCalculatorsPage();
                    break;
                case 'lab-results':
                    pageDiv.innerHTML = createLabResultsPage();
                    break;
                case 'medications':
                    pageDiv.innerHTML = createMedicationsPage();
                    break;
                case 'news':
                    pageDiv.innerHTML = createNewsPage();
                    break;
                case 'directory':
                    pageDiv.innerHTML = createDirectoryPage();
                    break;
                case 'guidelines':
                    pageDiv.innerHTML = createGuidelinesPage();
                    break;
                case 'profile':
                    pageDiv.innerHTML = createProfilePage();
                    break;
                case 'settings':
                    pageDiv.innerHTML = createSettingsPage();
                    break;
                case 'help':
                    pageDiv.innerHTML = createHelpPage();
                    break;
                default:
                    pageDiv.innerHTML = '<h1>Página no encontrada</h1>';
            }

            content.appendChild(pageDiv);
            initializePageEvents(pageId);
        }

        // Page Creation Functions
        function createDiseasesPage() {
            return `
                <div class="page-header">
                    <h1 class="page-title">Buscador de Enfermedades</h1>
                    <p class="page-subtitle">Encuentra información detallada sobre enfermedades y tratamientos</p>
                </div>

                <div class="card mb-4">
                    <div class="card-body">
                        <div class="grid grid-cols-3 gap-4">
                            <div class="form-group">
                                <input type="text" class="form-input" id="diseaseSearch" placeholder="Buscar por nombre o síntomas...">
                            </div>
                            <div class="form-group">
                                <select class="form-select" id="specialtyFilter">
                                    <option value="">Todas las especialidades</option>
                                    <option value="Cardiología">Cardiología</option>
                                    <option value="Neurología">Neurología</option>
                                    <option value="Endocrinología">Endocrinología</option>
                                    <option value="Neumología">Neumología</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <button class="btn btn-primary" onclick="searchDiseases()">
                                    <i class="fas fa-search"></i>
                                    Buscar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="diseasesResults" class="grid grid-cols-3 gap-4">
                    <!-- Results will be populated here -->
                </div>
            `;
        }

        function createCalculatorsPage() {
            return `
                <div class="page-header">
                    <h1 class="page-title">Calculadoras Médicas</h1>
                    <p class="page-subtitle">Herramientas de cálculo para la práctica clínica</p>
                </div>

                <div class="grid grid-cols-4 gap-4 mb-4">
                    <button class="card calculator-card" onclick="selectCalculator('bmi')">
                        <div class="card-body text-center">
                            <i class="fas fa-weight text-4xl text-primary mb-2"></i>
                            <h3 class="font-bold">IMC</h3>
                            <p class="text-sm text-secondary">Índice de Masa Corporal</p>
                        </div>
                    </button>
                    <button class="card calculator-card" onclick="selectCalculator('gfr')">
                        <div class="card-body text-center">
                            <i class="fas fa-kidneys text-4xl text-success mb-2"></i>
                            <h3 class="font-bold">GFR</h3>
                            <p class="text-sm text-secondary">Filtración Glomerular</p>
                        </div>
                    </button>
                    <button class="card calculator-card" onclick="selectCalculator('pediatric-dose')">
                        <div class="card-body text-center">
                            <i class="fas fa-baby text-4xl text-warning mb-2"></i>
                            <h3 class="font-bold">Dosis Pediátrica</h3>
                            <p class="text-sm text-secondary">Cálculo de dosis en niños</p>
                        </div>
                    </button>
                    <button class="card calculator-card" onclick="selectCalculator('cv-risk')">
                        <div class="card-body text-center">
                            <i class="fas fa-heart text-4xl text-error mb-2"></i>
                            <h3 class="font-bold">Riesgo CV</h3>
                            <p class="text-sm text-secondary">Riesgo Cardiovascular</p>
                        </div>
                    </button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title" id="calculatorTitle">Selecciona una calculadora</h3>
                    </div>
                    <div class="card-body" id="calculatorContent">
                        <p class="text-center text-secondary">Selecciona una calculadora para comenzar</p>
                    </div>
                </div>

                <div class="card mt-4">
                    <div class="card-header">
                        <h3 class="card-title">Historial de Cálculos</h3>
                    </div>
                    <div class="card-body" id="calculatorHistory">
                        <!-- History will be populated here -->
                    </div>
                </div>
            `;
        }

        function createLabResultsPage() {
            return `
                <div class="page-header">
                    <h1 class="page-title">Resultados de Laboratorio</h1>
                    <p class="page-subtitle">Interpretación automática de análisis clínicos</p>
                </div>

                <div class="card mb-4">
                    <div class="card-header">
                        <h3 class="card-title">Nuevo Análisis</h3>
                    </div>
                    <div class="card-body">
                        <form id="labResultForm">
                            <div class="grid grid-cols-3 gap-4 mb-4">
                                <div class="form-group">
                                    <label class="form-label">ID del Paciente</label>
                                    <input type="text" class="form-input" id="patientId" required>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Tipo de Análisis</label>
                                    <select class="form-select" id="testType" required>
                                        <option value="">Seleccionar...</option>
                                        <option value="hemograma">Hemograma Completo</option>
                                        <option value="quimica">Química Sanguínea</option>
                                        <option value="lipidos">Perfil Lipídico</option>
                                        <option value="hepatico">Perfil Hepático</option>
                                        <option value="renal">Función Renal</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Fecha</label>
                                    <input type="date" class="form-input" id="testDate" required>
                                </div>
                            </div>
                            <div id="labParameters">
                                <!-- Parameters will be populated based on test type -->
                            </div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save"></i>
                                Guardar Resultado
                            </button>
                        </form>
                    </div>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3 class="card-title">Historial de Resultados</h3>
                    </div>
                    <div class="card-body" id="labResultsHistory">
                        <!-- History will be populated here -->
                    </div>
                </div>
            `;
        }

        function createMedicationsPage() {
            return `
                <div class="page-header">
                    <h1 class="page-title">Buscador de Medicamentos</h1>
                    <p class="page-subtitle">Información completa sobre medicamentos, precios e interacciones</p>
                </div>

                <div class="card mb-4">
                    <div class="card-body">
                        <div class="grid grid-cols-4 gap-4">
                            <div class="form-group">
                                <input type="text" class="form-input" id="medicationSearch" placeholder="Buscar medicamento...">
                            </div>
                            <div class="form-group">
                                <select class="form-select" id="categoryFilter">
                                    <option value="">Todas las categorías</option>
                                    <option value="Analgésicos">Analgésicos</option>
                                    <option value="Antibióticos">Antibióticos</option>
                                    <option value="Antihipertensivos">Antihipertensivos</option>
                                    <option value="Antidiabéticos">Antidiabéticos</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <select class="form-select" id="priceRange">
                                    <option value="">Todos los precios</option>
                                    <option value="0-10">$0 - $10</option>
                                    <option value="10-25">$10 - $25</option>
                                    <option value="25-50">$25 - $50</option>
                                    <option value="50+">$50+</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <button class="btn btn-primary" onclick="searchMedications()">
                                    <i class="fas fa-search"></i>
                                    Buscar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Resultados de Búsqueda</h3>
                        </div>
                        <div class="card-body" id="medicationsResults">
                            <!-- Results will be populated here -->
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Medicamentos Favoritos</h3>
                        </div>
                        <div class="card-body" id="favoriteMedications">
                            <!-- Favorites will be populated here -->
                        </div>
                    </div>
                </div>
            `;
        }

        function createNewsPage() {
            return `
                <div class="page-header">
                    <h1 class="page-title">Novedades Médicas</h1>
                    <p class="page-subtitle">Últimas actualizaciones sobre drogas y técnicas médicas</p>
                </div>

                <div class="grid grid-cols-4 gap-4">
                    <div class="col-span-3">
                        <div id="newsArticles">
                            <!-- News articles will be populated here -->
                        </div>
                    </div>
                    <div>
                        <div class="card mb-4">
                            <div class="card-header">
                                <h3 class="card-title">Categorías</h3>
                            </div>
                            <div class="card-body">
                                <div class="space-y-2" id="newsCategories">
                                    <!-- Categories will be populated here -->
                                </div>
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Alertas Importantes</h3>
                            </div>
                            <div class="card-body">
                                <div class="space-y-3" id="importantAlerts">
                                    <!-- Alerts will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function createDirectoryPage() {
            return `
                <div class="page-header">
                    <h1 class="page-title">Directorio de Profesionales</h1>
                    <p class="page-subtitle">Encuentra especialistas y profesionales de la salud</p>
                </div>

                <div class="card mb-4">
                    <div class="card-body">
                        <div class="grid grid-cols-4 gap-4">
                            <div class="form-group">
                                <input type="text" class="form-input" id="professionalSearch" placeholder="Buscar por nombre...">
                            </div>
                            <div class="form-group">
                                <select class="form-select" id="professionalSpecialty">
                                    <option value="">Todas las especialidades</option>
                                    <option value="Cardiología">Cardiología</option>
                                    <option value="Neurología">Neurología</option>
                                    <option value="Medicina Interna">Medicina Interna</option>
                                    <option value="Pediatría">Pediatría</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <select class="form-select" id="departmentFilter">
                                    <option value="">Todos los departamentos</option>
                                    <option value="Consulta Externa">Consulta Externa</option>
                                    <option value="Hospitalización">Hospitalización</option>
                                    <option value="UCI">UCI</option>
                                    <option value="Emergencias">Emergencias</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <button class="btn btn-primary" onclick="searchProfessionals()">
                                    <i class="fas fa-search"></i>
                                    Buscar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div id="professionalsResults" class="grid grid-cols-2 gap-4">
                    <!-- Results will be populated here -->
                </div>
            `;
        }

        function createGuidelinesPage() {
            return `
                <div class="page-header">
                    <h1 class="page-title">Guías Clínicas y Protocolos</h1>
                    <p class="page-subtitle">Protocolos y guías de práctica clínica actualizadas</p>
                </div>

                <div class="card mb-4">
                    <div class="card-body">
                        <div class="grid grid-cols-3 gap-4">
                            <div class="form-group">
                                <input type="text" class="form-input" id="guidelineSearch" placeholder="Buscar guías...">
                            </div>
                            <div class="form-group">
                                <select class="form-select" id="guidelineSpecialty">
                                    <option value="">Todas las especialidades</option>
                                    <option value="Cardiología">Cardiología</option>
                                    <option value="Neurología">Neurología</option>
                                    <option value="Infectología">Infectología</option>
                                    <option value="Emergencias">Emergencias</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <button class="btn btn-primary" onclick="searchGuidelines()">
                                    <i class="fas fa-search"></i>
                                    Buscar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Guías Disponibles</h3>
                        </div>
                        <div class="card-body" id="guidelinesResults">
                            <!-- Results will be populated here -->
                        </div>
                    </div>
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Guías Favoritas</h3>
                        </div>
                        <div class="card-body" id="favoriteGuidelines">
                            <!-- Favorites will be populated here -->
                        </div>
                    </div>
                </div>
            `;
        }

        function createProfilePage() {
            return `
                <div class="page-header">
                    <h1 class="page-title">Mi Perfil</h1>
                    <p class="page-subtitle">Información personal y configuración de cuenta</p>
                </div>

                <div class="grid grid-cols-3 gap-4">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Información Personal</h3>
                        </div>
                        <div class="card-body">
                            <div class="text-center mb-4">
                                <div class="user-avatar" style="width: 80px; height: 80px; font-size: 2rem; margin: 0 auto;">
                                    <i class="fas fa-user"></i>
                                </div>
                                <h3 class="mt-2" id="profileName">Usuario</h3>
                                <p class="text-secondary" id="profileRole">Rol</p>
                            </div>
                            <form id="profileForm">
                                <div class="form-group">
                                    <label class="form-label">Nombre Completo</label>
                                    <input type="text" class="form-input" id="fullName">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Email</label>
                                    <input type="email" class="form-input" id="email">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Teléfono</label>
                                    <input type="tel" class="form-input" id="phone">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Especialidad</label>
                                    <input type="text" class="form-input" id="specialty">
                                </div>
                                <button type="submit" class="btn btn-primary">
                                    <i class="fas fa-save"></i>
                                    Guardar Cambios
                                </button>
                            </form>
                        </div>
                    </div>
                    <div class="col-span-2">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h3 class="card-title">Actividad Reciente</h3>
                            </div>
                            <div class="card-body" id="userActivity">
                                <!-- Activity will be populated here -->
                            </div>
                        </div>
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Estadísticas de Uso</h3>
                            </div>
                            <div class="card-body">
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="text-center">
                                        <div class="text-3xl font-bold text-primary" id="searchCount">0</div>
                                        <div class="text-sm text-secondary">Búsquedas realizadas</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-3xl font-bold text-success" id="calculationCount">0</div>
                                        <div class="text-sm text-secondary">Cálculos realizados</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-3xl font-bold text-warning" id="favoriteCount">0</div>
                                        <div class="text-sm text-secondary">Elementos favoritos</div>
                                    </div>
                                    <div class="text-center">
                                        <div class="text-3xl font-bold text-error" id="loginCount">0</div>
                                        <div class="text-sm text-secondary">Inicios de sesión</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        function createSettingsPage() {
            return `
                <div class="page-header">
                    <h1 class="page-title">Configuración</h1>
                    <p class="page-subtitle">Personaliza la aplicación y configuración institucional</p>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Configuración Personal</h3>
                        </div>
                        <div class="card-body">
                            <div class="settings-section">
                                <h4 class="settings-title">Idioma</h4>
                                <div class="language-selector">
                                    <button class="language-btn active" onclick="setLanguage('es')">Español</button>
                                    <button class="language-btn" onclick="setLanguage('en')">English</button>
                                </div>
                            </div>
                            
                            <div class="settings-section">
                                <h4 class="settings-title">Tema</h4>
                                <div class="flex gap-4">
                                    <button class="btn btn-secondary" onclick="toggleTheme()">
                                        <i class="fas fa-palette"></i>
                                        Cambiar Tema
                                    </button>
                                </div>
                            </div>
                            
                            <div class="settings-section">
                                <h4 class="settings-title">Notificaciones</h4>
                                <div class="space-y-2">
                                    <label class="flex items-center gap-2">
                                        <input type="checkbox" id="emailNotifications" checked>
                                        <span>Notificaciones por email</span>
                                    </label>
                                    <label class="flex items-center gap-2">
                                        <input type="checkbox" id="pushNotifications" checked>
                                        <span>Notificaciones push</span>
                                    </label>
                                    <label class="flex items-center gap-2">
                                        <input type="checkbox" id="newsAlerts" checked>
                                        <span>Alertas de noticias médicas</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Configuración Institucional</h3>
                        </div>
                        <div class="card-body">
                            <div class="settings-section">
                                <h4 class="settings-title">Información de la Institución</h4>
                                <div class="form-group">
                                    <label class="form-label">Nombre de la Institución</label>
                                    <input type="text" class="form-input" id="institutionName" value="Hospital General">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Dirección</label>
                                    <input type="text" class="form-input" id="institutionAddress" value="Av. Principal 123">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Teléfono</label>
                                    <input type="tel" class="form-input" id="institutionPhone" value="+51 1 234-5678">
                                </div>
                            </div>
                            
                            <div class="settings-section">
                                <h4 class="settings-title">Colores del Sistema</h4>
                                <div class="color-picker">
                                    <div class="color-option active" style="background-color: #2563eb;" onclick="setThemeColor('#2563eb')"></div>
                                    <div class="color-option" style="background-color: #059669;" onclick="setThemeColor('#059669')"></div>
                                    <div class="color-option" style="background-color: #dc2626;" onclick="setThemeColor('#dc2626')"></div>
                                    <div class="color-option" style="background-color: #7c3aed;" onclick="setThemeColor('#7c3aed')"></div>
                                    <div class="color-option" style="background-color: #ea580c;" onclick="setThemeColor('#ea580c')"></div>
                                </div>
                            </div>
                            
                            <button class="btn btn-primary" onclick="saveInstitutionalSettings()">
                                <i class="fas fa-save"></i>
                                Guardar Configuración
                            </button>
                        </div>
                    </div>
                </div>
                
                <div class="card mt-4">
                    <div class="card-header">
                        <h3 class="card-title">Gestión de Datos</h3>
                    </div>
                    <div class="card-body">
                        <div class="grid grid-cols-3 gap-4">
                            <button class="btn btn-secondary" onclick="exportData()">
                                <i class="fas fa-download"></i>
                                Exportar Datos
                            </button>
                            <button class="btn btn-warning" onclick="clearCache()">
                                <i class="fas fa-trash"></i>
                                Limpiar Caché
                            </button>
                            <button class="btn btn-error" onclick="resetApplication()">
                                <i class="fas fa-undo"></i>
                                Restablecer App
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }

        function createHelpPage() {
            return `
                <div class="page-header">
                    <h1 class="page-title">Ayuda y Soporte</h1>
                    <p class="page-subtitle">Encuentra respuestas a tus preguntas y obtén ayuda</p>
                </div>

                <div class="grid grid-cols-3 gap-4">
                    <div class="col-span-2">
                        <div class="card mb-4">
                            <div class="card-header">
                                <h3 class="card-title">Preguntas Frecuentes</h3>
                            </div>
                            <div class="card-body">
                                <div class="space-y-4" id="faqList">
                                    <!-- FAQ items will be populated here -->
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Guías de Usuario</h3>
                            </div>
                            <div class="card-body">
                                <div class="grid grid-cols-2 gap-4">
                                    <div class="card">
                                        <div class="card-body text-center">
                                            <i class="fas fa-search text-4xl text-primary mb-2"></i>
                                            <h4 class="font-bold">Búsqueda de Enfermedades</h4>
                                            <p class="text-sm text-secondary">Aprende a usar el buscador avanzado</p>
                                            <button class="btn btn-primary mt-2" onclick="showUserGuide('diseases')">Ver Guía</button>
                                        </div>
                                    </div>
                                    <div class="card">
                                        <div class="card-body text-center">
                                            <i class="fas fa-calculator text-4xl text-success mb-2"></i>
                                            <h4 class="font-bold">Calculadoras Médicas</h4>
                                            <p class="text-sm text-secondary">Guía para usar las calculadoras</p>
                                            <button class="btn btn-success mt-2" onclick="showUserGuide('calculators')">Ver Guía</button>
                                        </div>
                                    </div>
                                    <div class="card">
                                        <div class="card-body text-center">
                                            <i class="fas fa-flask text-4xl text-warning mb-2"></i>
                                            <h4 class="font-bold">Resultados de Lab</h4>
                                            <p class="text-sm text-secondary">Cómo interpretar resultados</p>
                                            <button class="btn btn-warning mt-2" onclick="showUserGuide('lab')">Ver Guía</button>
                                        </div>
                                    </div>
                                    <div class="card">
                                        <div class="card-body text-center">
                                            <i class="fas fa-pills text-4xl text-error mb-2"></i>
                                            <h4 class="font-bold">Medicamentos</h4>
                                            <p class="text-sm text-secondary">Búsqueda y gestión de medicamentos</p>
                                            <button class="btn btn-error mt-2" onclick="showUserGuide('medications')">Ver Guía</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <div class="card mb-4">
                            <div class="card-header">
                                <h3 class="card-title">Contacto de Soporte</h3>
                            </div>
                            <div class="card-body">
                                <div class="space-y-3">
                                    <div class="flex items-center gap-3">
                                        <i class="fas fa-phone text-primary"></i>
                                        <div>
                                            <div class="font-medium">Teléfono</div>
                                            <div class="text-sm text-secondary">+51 1 234-5678</div>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <i class="fas fa-envelope text-primary"></i>
                                        <div>
                                            <div class="font-medium">Email</div>
                                            <div class="text-sm text-secondary">soporte@hospital.com</div>
                                        </div>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <i class="fas fa-clock text-primary"></i>
                                        <div>
                                            <div class="font-medium">Horario</div>
                                            <div class="text-sm text-secondary">24/7 Disponible</div>
                                        </div>
                                    </div>
                                </div>
                                <button class="btn btn-primary mt-4" style="width: 100%;" onclick="openSupportChat()">
                                    <i class="fas fa-comments"></i>
                                    Iniciar Chat
                                </button>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header">
                                <h3 class="card-title">Información del Sistema</h3>
                            </div>
                            <div class="card-body">
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span>Versión:</span>
                                        <span class="font-medium">2.1.0</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Última actualización:</span>
                                        <span class="font-medium">15/01/2024</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Navegador:</span>
                                        <span class="font-medium" id="browserInfo">-</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span>Almacenamiento usado:</span>
                                        <span class="font-medium" id="storageUsed">-</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }

        // Modal Functions
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
            }
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
            }
        }

        // Search Functions
        function searchDiseases() {
            const searchTerm = document.getElementById('diseaseSearch').value.toLowerCase();
            const specialty = document.getElementById('specialtyFilter').value;
            
            let filtered = AppState.data.diseases.filter(disease => {
                const matchesSearch = !searchTerm || 
                    disease.name.toLowerCase().includes(searchTerm) ||
                    disease.symptoms.some(symptom => symptom.toLowerCase().includes(searchTerm));
                
                const matchesSpecialty = !specialty || disease.specialty === specialty;
                
                return matchesSearch && matchesSpecialty;
            });

            displayDiseases(filtered);
        }

        function displayDiseases(diseases) {
            const container = document.getElementById('diseasesResults');
            if (!container) return;

            container.innerHTML = diseases.map(disease => `
                <div class="card disease-card" onclick="showDiseaseDetail(${disease.id})">
                    <div class="card-body">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-bold">${AppState.language === 'es' ? disease.name : disease.nameEn}</h3>
                            <button class="favorite-btn ${AppState.data.favorites.diseases.includes(disease.id) ? 'active' : ''}" 
                                    onclick="event.stopPropagation(); toggleFavorite('diseases', ${disease.id})">
                                <i class="fas fa-star"></i>
                            </button>
                        </div>
                        <div class="badge badge-primary mb-2">${AppState.language === 'es' ? disease.specialty : disease.specialtyEn}</div>
                        <p class="text-sm text-secondary mb-3">${AppState.language === 'es' ? disease.description : disease.descriptionEn}</p>
                        <div class="symptoms-list">
                            ${(AppState.language === 'es' ? disease.symptoms : disease.symptomsEn).slice(0, 3).map(symptom => 
                                `<span class="symptom-tag">${symptom}</span>`
                            ).join('')}
                            ${(AppState.language === 'es' ? disease.symptoms : disease.symptomsEn).length > 3 ? 
                                `<span class="symptom-tag">+${(AppState.language === 'es' ? disease.symptoms : disease.symptomsEn).length - 3} más</span>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function searchMedications() {
            const searchTerm = document.getElementById('medicationSearch').value.toLowerCase();
            const category = document.getElementById('categoryFilter').value;
            const priceRange = document.getElementById('priceRange').value;
            
            let filtered = AppState.data.medications.filter(medication => {
                const matchesSearch = !searchTerm || 
                    medication.name.toLowerCase().includes(searchTerm) ||
                    medication.genericName.toLowerCase().includes(searchTerm);
                
                const matchesCategory = !category || medication.category === category;
                
                let matchesPrice = true;
                if (priceRange) {
                    const price = medication.price;
                    switch (priceRange) {
                        case '0-10':
                            matchesPrice = price <= 10;
                            break;
                        case '10-25':
                            matchesPrice = price > 10 && price <= 25;
                            break;
                        case '25-50':
                            matchesPrice = price > 25 && price <= 50;
                            break;
                        case '50+':
                            matchesPrice = price > 50;
                            break;
                    }
                }
                
                return matchesSearch && matchesCategory && matchesPrice;
            });

            displayMedications(filtered);
        }

        function displayMedications(medications) {
            const container = document.getElementById('medicationsResults');
            if (!container) return;

            container.innerHTML = medications.map(medication => `
                <div class="card mb-3" onclick="showMedicationDetail(${medication.id})">
                    <div class="card-body">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-bold">${medication.name}</h4>
                            <button class="favorite-btn ${AppState.data.favorites.medications.includes(medication.id) ? 'active' : ''}" 
                                    onclick="event.stopPropagation(); toggleFavorite('medications', ${medication.id})">
                                <i class="fas fa-star"></i>
                            </button>
                        </div>
                        <div class="badge badge-success mb-2">${AppState.language === 'es' ? medication.category : medication.categoryEn}</div>
                        <p class="text-sm text-secondary mb-2">${medication.genericName}</p>
                        <div class="flex justify-between items-center">
                            <span class="font-bold text-success">$${medication.price}</span>
                            <span class="text-xs text-secondary">${medication.presentation}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function searchProfessionals() {
            const searchTerm = document.getElementById('professionalSearch').value.toLowerCase();
            const specialty = document.getElementById('professionalSpecialty').value;
            const department = document.getElementById('departmentFilter').value;
            
            let filtered = AppState.data.professionals.filter(professional => {
                const matchesSearch = !searchTerm || 
                    professional.name.toLowerCase().includes(searchTerm);
                
                const matchesSpecialty = !specialty || professional.specialty === specialty;
                const matchesDepartment = !department || professional.department === department;
                
                return matchesSearch && matchesSpecialty && matchesDepartment;
            });

            displayProfessionals(filtered);
        }

        function displayProfessionals(professionals) {
            const container = document.getElementById('professionalsResults');
            if (!container) return;

            container.innerHTML = professionals.map(professional => `
                <div class="card">
                    <div class="professional-card">
                        <div class="professional-avatar">
                            ${professional.name.split(' ').map(n => n[0]).join('').substring(0, 2)}
                        </div>
                        <div class="professional-info">
                            <div class="professional-name">${professional.name}</div>
                            <div class="professional-specialty">${AppState.language === 'es' ? professional.specialty : professional.specialtyEn}</div>
                            <div class="professional-contact">
                                <div><i class="fas fa-phone"></i> ${professional.phone}</div>
                                <div><i class="fas fa-envelope"></i> ${professional.email}</div>
                                <div><i class="fas fa-map-marker-alt"></i> ${AppState.language === 'es' ? professional.location : professional.locationEn}</div>
                            </div>
                        </div>
                        <div class="text-right">
                            <div class="badge ${professional.available ? 'badge-success' : 'badge-error'}">
                                ${professional.available ? 'Disponible' : 'Ocupado'}
                            </div>
                            <div class="text-sm text-secondary mt-1">
                                <i class="fas fa-star text-warning"></i> ${professional.rating} (${professional.reviews})
                            </div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function searchGuidelines() {
            const searchTerm = document.getElementById('guidelineSearch').value.toLowerCase();
            const specialty = document.getElementById('guidelineSpecialty').value;
            
            let filtered = AppState.data.guidelines.filter(guideline => {
                const matchesSearch = !searchTerm || 
                    guideline.title.toLowerCase().includes(searchTerm) ||
                    guideline.description.toLowerCase().includes(searchTerm);
                
                const matchesSpecialty = !specialty || guideline.specialty === specialty;
                
                return matchesSearch && matchesSpecialty;
            });

            displayGuidelines(filtered);
        }

        function displayGuidelines(guidelines) {
            const container = document.getElementById('guidelinesResults');
            if (!container) return;

            container.innerHTML = guidelines.map(guideline => `
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="flex justify-between items-start mb-2">
                            <h4 class="font-bold">${AppState.language === 'es' ? guideline.title : guideline.titleEn}</h4>
                            <button class="favorite-btn ${AppState.data.favorites.guidelines.includes(guideline.id) ? 'active' : ''}" 
                                    onclick="toggleFavorite('guidelines', ${guideline.id})">
                                <i class="fas fa-star"></i>
                            </button>
                        </div>
                        <div class="flex gap-2 mb-2">
                            <div class="badge badge-primary">${AppState.language === 'es' ? guideline.specialty : guideline.specialtyEn}</div>
                            <div class="badge badge-${guideline.evidenceLevel === 'A' ? 'success' : guideline.evidenceLevel === 'B' ? 'warning' : 'error'}">
                                Nivel ${guideline.evidenceLevel}
                            </div>
                        </div>
                        <p class="text-sm text-secondary mb-3">${AppState.language === 'es' ? guideline.description : guideline.descriptionEn}</p>
                        <div class="flex justify-between items-center">
                            <span class="text-xs text-secondary">v${guideline.version} - ${formatDate(guideline.lastUpdate)}</span>
                            <button class="btn btn-primary btn-sm" onclick="downloadGuideline(${guideline.id})">
                                <i class="fas fa-download"></i>
                                Descargar
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Calculator Functions
        function selectCalculator(type) {
            const calculatorCards = document.querySelectorAll('.calculator-card');
            calculatorCards.forEach(card => card.classList.remove('active'));
            
            event.target.closest('.calculator-card').classList.add('active');
            
            const title = document.getElementById('calculatorTitle');
            const content = document.getElementById('calculatorContent');
            
            switch (type) {
                case 'bmi':
                    title.textContent = 'Calculadora de IMC';
                    content.innerHTML = createBMICalculator();
                    break;
                case 'gfr':
                    title.textContent = 'Calculadora de GFR';
                    content.innerHTML = createGFRCalculator();
                    break;
                case 'pediatric-dose':
                    title.textContent = 'Calculadora de Dosis Pediátrica';
                    content.innerHTML = createPediatricDoseCalculator();
                    break;
                case 'cv-risk':
                    title.textContent = 'Calculadora de Riesgo Cardiovascular';
                    content.innerHTML = createCVRiskCalculator();
                    break;
            }
        }

        function createBMICalculator() {
            return `
                <div class="calculator-grid">
                    <div>
                        <div class="form-group">
                            <label class="form-label">Peso (kg)</label>
                            <input type="number" class="form-input" id="b<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9799c26443167f2a',t:'MTc1Njk0OTgyMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
                            
mi-weight" step="0.1" placeholder="70">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Altura (cm)</label>
                            <input type="number" class="form-input" id="bmi-height" step="0.1" placeholder="170">
                        </div>
                        <button class="btn btn-primary" onclick="calculateBMI()">
                            <i class="fas fa-calculator"></i>
                            Calcular IMC
                        </button>
                    </div>
                    <div id="bmi-result" class="calculator-result hidden">
                        <div class="result-value" id="bmi-value">0</div>
                        <div class="result-interpretation" id="bmi-interpretation"></div>
                        <button class="btn btn-secondary" onclick="saveBMIResult()">
                            <i class="fas fa-save"></i>
                            Guardar Resultado
                        </button>
                    </div>
                </div>
            `;
        }

        function createGFRCalculator() {
            return `
                <div class="calculator-grid">
                    <div>
                        <div class="form-group">
                            <label class="form-label">Creatinina (mg/dL)</label>
                            <input type="number" class="form-input" id="gfr-creatinine" step="0.01" placeholder="1.0">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Edad (años)</label>
                            <input type="number" class="form-input" id="gfr-age" placeholder="45">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Sexo</label>
                            <select class="form-select" id="gfr-gender">
                                <option value="male">Masculino</option>
                                <option value="female">Femenino</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Raza</label>
                            <select class="form-select" id="gfr-race">
                                <option value="other">Otra</option>
                                <option value="african">Afroamericana</option>
                            </select>
                        </div>
                        <button class="btn btn-primary" onclick="calculateGFR()">
                            <i class="fas fa-calculator"></i>
                            Calcular GFR
                        </button>
                    </div>
                    <div id="gfr-result" class="calculator-result hidden">
                        <div class="result-value" id="gfr-value">0</div>
                        <div class="result-interpretation" id="gfr-interpretation"></div>
                        <button class="btn btn-secondary" onclick="saveGFRResult()">
                            <i class="fas fa-save"></i>
                            Guardar Resultado
                        </button>
                    </div>
                </div>
            `;
        }

        function createPediatricDoseCalculator() {
            return `
                <div class="calculator-grid">
                    <div>
                        <div class="form-group">
                            <label class="form-label">Peso del niño (kg)</label>
                            <input type="number" class="form-input" id="ped-weight" step="0.1" placeholder="20">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Dosis adulto (mg)</label>
                            <input type="number" class="form-input" id="ped-adult-dose" step="0.1" placeholder="500">
                        </div>
                        <div class="form-group">
                            <label class="form-label">Método de cálculo</label>
                            <select class="form-select" id="ped-method">
                                <option value="clark">Regla de Clark (peso)</option>
                                <option value="young">Regla de Young (edad)</option>
                                <option value="surface">Superficie corporal</option>
                            </select>
                        </div>
                        <div class="form-group" id="ped-age-group" style="display: none;">
                            <label class="form-label">Edad (años)</label>
                            <input type="number" class="form-input" id="ped-age" placeholder="8">
                        </div>
                        <button class="btn btn-primary" onclick="calculatePediatricDose()">
                            <i class="fas fa-calculator"></i>
                            Calcular Dosis
                        </button>
                    </div>
                    <div id="ped-result" class="calculator-result hidden">
                        <div class="result-value" id="ped-value">0</div>
                        <div class="result-interpretation" id="ped-interpretation"></div>
                        <button class="btn btn-secondary" onclick="savePediatricResult()">
                            <i class="fas fa-save"></i>
                            Guardar Resultado
                        </button>
                    </div>
                </div>
            `;
        }

        function createCVRiskCalculator() {
            return `
                <div class="calculator-grid">
                    <div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="form-group">
                                <label class="form-label">Edad</label>
                                <input type="number" class="form-input" id="cv-age" placeholder="45">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Sexo</label>
                                <select class="form-select" id="cv-gender">
                                    <option value="male">Masculino</option>
                                    <option value="female">Femenino</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Colesterol Total (mg/dL)</label>
                                <input type="number" class="form-input" id="cv-cholesterol" placeholder="200">
                            </div>
                            <div class="form-group">
                                <label class="form-label">HDL (mg/dL)</label>
                                <input type="number" class="form-input" id="cv-hdl" placeholder="50">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Presión Sistólica (mmHg)</label>
                                <input type="number" class="form-input" id="cv-systolic" placeholder="120">
                            </div>
                            <div class="form-group">
                                <label class="form-label">¿Fumador?</label>
                                <select class="form-select" id="cv-smoker">
                                    <option value="no">No</option>
                                    <option value="yes">Sí</option>
                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="flex items-center gap-2">
                                <input type="checkbox" id="cv-diabetes">
                                <span>Diabetes</span>
                            </label>
                        </div>
                        <button class="btn btn-primary" onclick="calculateCVRisk()">
                            <i class="fas fa-calculator"></i>
                            Calcular Riesgo
                        </button>
                    </div>
                    <div id="cv-result" class="calculator-result hidden">
                        <div class="result-value" id="cv-value">0</div>
                        <div class="result-interpretation" id="cv-interpretation"></div>
                        <button class="btn btn-secondary" onclick="saveCVRiskResult()">
                            <i class="fas fa-save"></i>
                            Guardar Resultado
                        </button>
                    </div>
                </div>
            `;
        }

        // Calculator calculation functions
        function calculateBMI() {
            const weight = parseFloat(document.getElementById('bmi-weight').value);
            const height = parseFloat(document.getElementById('bmi-height').value) / 100; // Convert to meters
            
            if (!weight || !height) {
                showToast('Por favor ingresa peso y altura válidos', 'error');
                return;
            }
            
            const bmi = weight / (height * height);
            const resultDiv = document.getElementById('bmi-result');
            const valueDiv = document.getElementById('bmi-value');
            const interpretationDiv = document.getElementById('bmi-interpretation');
            
            valueDiv.textContent = bmi.toFixed(1);
            
            let interpretation = '';
            let category = '';
            
            if (bmi < 18.5) {
                interpretation = 'Bajo peso';
                category = 'underweight';
            } else if (bmi < 25) {
                interpretation = 'Peso normal';
                category = 'normal';
            } else if (bmi < 30) {
                interpretation = 'Sobrepeso';
                category = 'overweight';
            } else {
                interpretation = 'Obesidad';
                category = 'obese';
            }
            
            interpretationDiv.textContent = interpretation;
            resultDiv.classList.remove('hidden');
            
            // Store for saving
            window.currentBMIResult = { weight, height: height * 100, bmi, interpretation, category, date: new Date() };
        }

        function calculateGFR() {
            const creatinine = parseFloat(document.getElementById('gfr-creatinine').value);
            const age = parseInt(document.getElementById('gfr-age').value);
            const gender = document.getElementById('gfr-gender').value;
            const race = document.getElementById('gfr-race').value;
            
            if (!creatinine || !age) {
                showToast('Por favor ingresa creatinina y edad válidos', 'error');
                return;
            }
            
            // MDRD formula
            let gfr = 175 * Math.pow(creatinine, -1.154) * Math.pow(age, -0.203);
            
            if (gender === 'female') {
                gfr *= 0.742;
            }
            
            if (race === 'african') {
                gfr *= 1.212;
            }
            
            const resultDiv = document.getElementById('gfr-result');
            const valueDiv = document.getElementById('gfr-value');
            const interpretationDiv = document.getElementById('gfr-interpretation');
            
            valueDiv.textContent = gfr.toFixed(1) + ' mL/min/1.73m²';
            
            let interpretation = '';
            let stage = '';
            
            if (gfr >= 90) {
                interpretation = 'Función renal normal';
                stage = 'Estadio 1';
            } else if (gfr >= 60) {
                interpretation = 'Enfermedad renal leve';
                stage = 'Estadio 2';
            } else if (gfr >= 30) {
                interpretation = 'Enfermedad renal moderada';
                stage = 'Estadio 3';
            } else if (gfr >= 15) {
                interpretation = 'Enfermedad renal severa';
                stage = 'Estadio 4';
            } else {
                interpretation = 'Falla renal';
                stage = 'Estadio 5';
            }
            
            interpretationDiv.innerHTML = `${interpretation}<br><strong>${stage}</strong>`;
            resultDiv.classList.remove('hidden');
            
            window.currentGFRResult = { creatinine, age, gender, race, gfr, interpretation, stage, date: new Date() };
        }

        function calculatePediatricDose() {
            const weight = parseFloat(document.getElementById('ped-weight').value);
            const adultDose = parseFloat(document.getElementById('ped-adult-dose').value);
            const method = document.getElementById('ped-method').value;
            const age = parseInt(document.getElementById('ped-age').value);
            
            if (!weight || !adultDose) {
                showToast('Por favor ingresa peso y dosis adulto válidos', 'error');
                return;
            }
            
            let pediatricDose = 0;
            let methodName = '';
            
            switch (method) {
                case 'clark':
                    pediatricDose = (weight / 70) * adultDose;
                    methodName = 'Regla de Clark';
                    break;
                case 'young':
                    if (!age) {
                        showToast('Por favor ingresa la edad para la regla de Young', 'error');
                        return;
                    }
                    pediatricDose = (age / (age + 12)) * adultDose;
                    methodName = 'Regla de Young';
                    break;
                case 'surface':
                    const bsa = Math.sqrt((weight * 100) / 3600); // Simplified BSA calculation
                    pediatricDose = (bsa / 1.73) * adultDose;
                    methodName = 'Superficie corporal';
                    break;
            }
            
            const resultDiv = document.getElementById('ped-result');
            const valueDiv = document.getElementById('ped-value');
            const interpretationDiv = document.getElementById('ped-interpretation');
            
            valueDiv.textContent = pediatricDose.toFixed(1) + ' mg';
            interpretationDiv.innerHTML = `Calculado usando ${methodName}<br>Dosis por kg: ${(pediatricDose / weight).toFixed(2)} mg/kg`;
            resultDiv.classList.remove('hidden');
            
            window.currentPediatricResult = { weight, adultDose, method, age, pediatricDose, methodName, date: new Date() };
        }

        function calculateCVRisk() {
            const age = parseInt(document.getElementById('cv-age').value);
            const gender = document.getElementById('cv-gender').value;
            const cholesterol = parseFloat(document.getElementById('cv-cholesterol').value);
            const hdl = parseFloat(document.getElementById('cv-hdl').value);
            const systolic = parseFloat(document.getElementById('cv-systolic').value);
            const smoker = document.getElementById('cv-smoker').value === 'yes';
            const diabetes = document.getElementById('cv-diabetes').checked;
            
            if (!age || !cholesterol || !hdl || !systolic) {
                showToast('Por favor completa todos los campos requeridos', 'error');
                return;
            }
            
            // Simplified Framingham Risk Score calculation
            let points = 0;
            
            // Age points
            if (gender === 'male') {
                if (age >= 70) points += 11;
                else if (age >= 65) points += 10;
                else if (age >= 60) points += 8;
                else if (age >= 55) points += 6;
                else if (age >= 50) points += 4;
                else if (age >= 45) points += 2;
                else if (age >= 40) points += 1;
            } else {
                if (age >= 75) points += 16;
                else if (age >= 70) points += 12;
                else if (age >= 65) points += 9;
                else if (age >= 60) points += 7;
                else if (age >= 55) points += 4;
                else if (age >= 50) points += 3;
                else if (age >= 45) points += 2;
                else if (age >= 40) points += 1;
            }
            
            // Cholesterol points
            if (cholesterol >= 280) points += 3;
            else if (cholesterol >= 240) points += 2;
            else if (cholesterol >= 200) points += 1;
            
            // HDL points
            if (hdl < 35) points += 2;
            else if (hdl < 45) points += 1;
            else if (hdl >= 60) points -= 1;
            
            // Blood pressure points
            if (systolic >= 160) points += 2;
            else if (systolic >= 140) points += 1;
            
            // Smoking
            if (smoker) points += 2;
            
            // Diabetes
            if (diabetes) points += 2;
            
            // Convert points to risk percentage (simplified)
            let risk = 0;
            if (points <= 0) risk = 1;
            else if (points <= 4) risk = 2;
            else if (points <= 6) risk = 4;
            else if (points <= 8) risk = 7;
            else if (points <= 10) risk = 11;
            else if (points <= 12) risk = 17;
            else if (points <= 14) risk = 25;
            else risk = 35;
            
            const resultDiv = document.getElementById('cv-result');
            const valueDiv = document.getElementById('cv-value');
            const interpretationDiv = document.getElementById('cv-interpretation');
            
            valueDiv.textContent = risk + '%';
            
            let interpretation = '';
            if (risk < 10) {
                interpretation = 'Riesgo bajo - Continuar con prevención primaria';
            } else if (risk < 20) {
                interpretation = 'Riesgo moderado - Considerar tratamiento farmacológico';
            } else {
                interpretation = 'Riesgo alto - Tratamiento farmacológico recomendado';
            }
            
            interpretationDiv.textContent = interpretation;
            resultDiv.classList.remove('hidden');
            
            window.currentCVRiskResult = { age, gender, cholesterol, hdl, systolic, smoker, diabetes, risk, interpretation, date: new Date() };
        }

        // Save calculator results
        function saveBMIResult() {
            if (window.currentBMIResult) {
                const history = loadFromStorage('calculatorHistory', []);
                history.unshift({
                    id: generateId(),
                    type: 'BMI',
                    ...window.currentBMIResult
                });
                saveToStorage('calculatorHistory', history);
                showToast('Resultado guardado exitosamente');
                updateCalculatorHistory();
            }
        }

        function saveGFRResult() {
            if (window.currentGFRResult) {
                const history = loadFromStorage('calculatorHistory', []);
                history.unshift({
                    id: generateId(),
                    type: 'GFR',
                    ...window.currentGFRResult
                });
                saveToStorage('calculatorHistory', history);
                showToast('Resultado guardado exitosamente');
                updateCalculatorHistory();
            }
        }

        function savePediatricResult() {
            if (window.currentPediatricResult) {
                const history = loadFromStorage('calculatorHistory', []);
                history.unshift({
                    id: generateId(),
                    type: 'Pediatric Dose',
                    ...window.currentPediatricResult
                });
                saveToStorage('calculatorHistory', history);
                showToast('Resultado guardado exitosamente');
                updateCalculatorHistory();
            }
        }

        function saveCVRiskResult() {
            if (window.currentCVRiskResult) {
                const history = loadFromStorage('calculatorHistory', []);
                history.unshift({
                    id: generateId(),
                    type: 'CV Risk',
                    ...window.currentCVRiskResult
                });
                saveToStorage('calculatorHistory', history);
                showToast('Resultado guardado exitosamente');
                updateCalculatorHistory();
            }
        }

        function updateCalculatorHistory() {
            const container = document.getElementById('calculatorHistory');
            if (!container) return;
            
            const history = loadFromStorage('calculatorHistory', []);
            
            if (history.length === 0) {
                container.innerHTML = '<p class="text-center text-secondary">No hay cálculos guardados</p>';
                return;
            }
            
            container.innerHTML = history.slice(0, 10).map(result => `
                <div class="card mb-2">
                    <div class="card-body">
                        <div class="flex justify-between items-start">
                            <div>
                                <h5 class="font-bold">${result.type}</h5>
                                <p class="text-sm text-secondary">${formatDate(result.date)}</p>
                                <p class="text-sm">${getResultSummary(result)}</p>
                            </div>
                            <button class="btn btn-error btn-sm" onclick="deleteCalculatorResult('${result.id}')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getResultSummary(result) {
            switch (result.type) {
                case 'BMI':
                    return `IMC: ${result.bmi.toFixed(1)} - ${result.interpretation}`;
                case 'GFR':
                    return `GFR: ${result.gfr.toFixed(1)} mL/min/1.73m² - ${result.stage}`;
                case 'Pediatric Dose':
                    return `Dosis: ${result.pediatricDose.toFixed(1)} mg (${result.methodName})`;
                case 'CV Risk':
                    return `Riesgo: ${result.risk}% - ${result.interpretation.split(' - ')[0]}`;
                default:
                    return 'Resultado guardado';
            }
        }

        function deleteCalculatorResult(id) {
            const history = loadFromStorage('calculatorHistory', []);
            const filtered = history.filter(result => result.id !== id);
            saveToStorage('calculatorHistory', filtered);
            showToast('Resultado eliminado');
            updateCalculatorHistory();
        }

        // Favorites management
        function toggleFavorite(type, id) {
            if (!AppState.data.favorites[type]) {
                AppState.data.favorites[type] = [];
            }
            
            const index = AppState.data.favorites[type].indexOf(id);
            if (index > -1) {
                AppState.data.favorites[type].splice(index, 1);
                showToast('Eliminado de favoritos');
            } else {
                AppState.data.favorites[type].push(id);
                showToast('Agregado a favoritos');
            }
            
            saveToStorage('favorites', AppState.data.favorites);
            updateContent(); // Refresh current page to update favorite buttons
        }

        // Page initialization functions
        function initializePageEvents(pageId) {
            switch (pageId) {
                case 'calculators':
                    // Add event listener for pediatric method change
                    const pedMethod = document.getElementById('ped-method');
                    if (pedMethod) {
                        pedMethod.addEventListener('change', function() {
                            const ageGroup = document.getElementById('ped-age-group');
                            if (this.value === 'young') {
                                ageGroup.style.display = 'block';
                            } else {
                                ageGroup.style.display = 'none';
                            }
                        });
                    }
                    updateCalculatorHistory();
                    break;
                case 'lab-results':
                    initializeLabResults();
                    break;
                case 'news':
                    initializeNews();
                    break;
                case 'profile':
                    initializeProfile();
                    break;
                case 'help':
                    initializeHelp();
                    break;
            }
        }

        function initializeLabResults() {
            const testTypeSelect = document.getElementById('testType');
            if (testTypeSelect) {
                testTypeSelect.addEventListener('change', function() {
                    updateLabParameters(this.value);
                });
            }
            
            const labForm = document.getElementById('labResultForm');
            if (labForm) {
                labForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveLabResult();
                });
            }
            
            // Set default date
            const dateInput = document.getElementById('testDate');
            if (dateInput) {
                dateInput.value = new Date().toISOString().split('T')[0];
            }
            
            updateLabResultsHistory();
        }

        function updateLabParameters(testType) {
            const container = document.getElementById('labParameters');
            if (!container) return;
            
            const parameters = {
                hemograma: [
                    { name: 'Hemoglobina', unit: 'g/dL', normal: '12-16', id: 'hemoglobin' },
                    { name: 'Hematocrito', unit: '%', normal: '36-48', id: 'hematocrit' },
                    { name: 'Leucocitos', unit: '/μL', normal: '4000-11000', id: 'wbc' },
                    { name: 'Plaquetas', unit: '/μL', normal: '150000-450000', id: 'platelets' }
                ],
                quimica: [
                    { name: 'Glucosa', unit: 'mg/dL', normal: '70-100', id: 'glucose' },
                    { name: 'Urea', unit: 'mg/dL', normal: '15-45', id: 'urea' },
                    { name: 'Creatinina', unit: 'mg/dL', normal: '0.6-1.2', id: 'creatinine' },
                    { name: 'Ácido Úrico', unit: 'mg/dL', normal: '3.5-7.2', id: 'uric_acid' }
                ],
                lipidos: [
                    { name: 'Colesterol Total', unit: 'mg/dL', normal: '<200', id: 'total_chol' },
                    { name: 'HDL', unit: 'mg/dL', normal: '>40', id: 'hdl' },
                    { name: 'LDL', unit: 'mg/dL', normal: '<100', id: 'ldl' },
                    { name: 'Triglicéridos', unit: 'mg/dL', normal: '<150', id: 'triglycerides' }
                ],
                hepatico: [
                    { name: 'ALT (GPT)', unit: 'U/L', normal: '7-56', id: 'alt' },
                    { name: 'AST (GOT)', unit: 'U/L', normal: '10-40', id: 'ast' },
                    { name: 'Bilirrubina Total', unit: 'mg/dL', normal: '0.3-1.2', id: 'bilirubin' },
                    { name: 'Fosfatasa Alcalina', unit: 'U/L', normal: '44-147', id: 'alk_phos' }
                ],
                renal: [
                    { name: 'Creatinina', unit: 'mg/dL', normal: '0.6-1.2', id: 'creatinine' },
                    { name: 'Urea', unit: 'mg/dL', normal: '15-45', id: 'urea' },
                    { name: 'Ácido Úrico', unit: 'mg/dL', normal: '3.5-7.2', id: 'uric_acid' },
                    { name: 'Sodio', unit: 'mEq/L', normal: '136-145', id: 'sodium' },
                    { name: 'Potasio', unit: 'mEq/L', normal: '3.5-5.1', id: 'potassium' }
                ]
            };
            
            if (!parameters[testType]) {
                container.innerHTML = '<p class="text-secondary">Selecciona un tipo de análisis</p>';
                return;
            }
            
            container.innerHTML = `
                <div class="grid grid-cols-2 gap-4">
                    ${parameters[testType].map(param => `
                        <div class="form-group">
                            <label class="form-label">${param.name} (${param.unit})</label>
                            <input type="number" class="form-input" id="${param.id}" step="0.01" 
                                   placeholder="Valor normal: ${param.normal}">
                        </div>
                    `).join('')}
                </div>
            `;
        }

        function saveLabResult() {
            const patientId = document.getElementById('patientId').value;
            const testType = document.getElementById('testType').value;
            const testDate = document.getElementById('testDate').value;
            
            if (!patientId || !testType || !testDate) {
                showToast('Por favor completa todos los campos requeridos', 'error');
                return;
            }
            
            const parameters = {};
            const inputs = document.querySelectorAll('#labParameters input');
            inputs.forEach(input => {
                if (input.value) {
                    parameters[input.id] = parseFloat(input.value);
                }
            });
            
            const result = {
                id: generateId(),
                patientId,
                testType,
                testDate,
                parameters,
                interpretation: interpretLabResults(testType, parameters),
                createdAt: new Date()
            };
            
            const history = loadFromStorage('labResults', []);
            history.unshift(result);
            saveToStorage('labResults', history);
            
            showToast('Resultado de laboratorio guardado exitosamente');
            document.getElementById('labResultForm').reset();
            document.getElementById('testDate').value = new Date().toISOString().split('T')[0];
            updateLabResultsHistory();
        }

        function interpretLabResults(testType, parameters) {
            const interpretations = [];
            
            // Simple interpretation logic - in real app this would be more sophisticated
            Object.keys(parameters).forEach(param => {
                const value = parameters[param];
                let interpretation = 'Normal';
                
                switch (param) {
                    case 'glucose':
                        if (value > 126) interpretation = 'Elevada - Posible diabetes';
                        else if (value > 100) interpretation = 'Elevada - Prediabetes';
                        else if (value < 70) interpretation = 'Baja - Hipoglucemia';
                        break;
                    case 'creatinine':
                        if (value > 1.2) interpretation = 'Elevada - Posible disfunción renal';
                        break;
                    case 'total_chol':
                        if (value > 240) interpretation = 'Alto - Riesgo cardiovascular';
                        else if (value > 200) interpretation = 'Límite alto';
                        break;
                    case 'hdl':
                        if (value < 40) interpretation = 'Bajo - Riesgo cardiovascular';
                        else if (value > 60) interpretation = 'Alto - Protector';
                        break;
                    case 'alt':
                    case 'ast':
                        if (value > 56) interpretation = 'Elevada - Posible daño hepático';
                        break;
                }
                
                interpretations.push({
                    parameter: param,
                    value,
                    interpretation
                });
            });
            
            return interpretations;
        }

        function updateLabResultsHistory() {
            const container = document.getElementById('labResultsHistory');
            if (!container) return;
            
            const history = loadFromStorage('labResults', []);
            
            if (history.length === 0) {
                container.innerHTML = '<p class="text-center text-secondary">No hay resultados guardados</p>';
                return;
            }
            
            container.innerHTML = history.slice(0, 10).map(result => `
                <div class="card mb-3">
                    <div class="card-body">
                        <div class="flex justify-between items-start mb-2">
                            <div>
                                <h5 class="font-bold">Paciente: ${result.patientId}</h5>
                                <div class="badge badge-primary">${result.testType}</div>
                            </div>
                            <div class="text-right">
                                <div class="text-sm text-secondary">${formatDate(result.testDate)}</div>
                                <button class="btn btn-error btn-sm mt-1" onclick="deleteLabResult('${result.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="space-y-1">
                            ${result.interpretation.slice(0, 3).map(interp => `
                                <div class="text-sm">
                                    <strong>${interp.parameter}:</strong> ${interp.value} - 
                                    <span class="${interp.interpretation.includes('Normal') ? 'text-success' : 'text-warning'}">${interp.interpretation}</span>
                                </div>
                            `).join('')}
                            ${result.interpretation.length > 3 ? `<div class="text-xs text-secondary">+${result.interpretation.length - 3} parámetros más</div>` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function deleteLabResult(id) {
            const history = loadFromStorage('labResults', []);
            const filtered = history.filter(result => result.id !== id);
            saveToStorage('labResults', filtered);
            showToast('Resultado eliminado');
            updateLabResultsHistory();
        }

        function initializeNews() {
            displayNews();
            displayNewsCategories();
            displayImportantAlerts();
        }

        function displayNews() {
            const container = document.getElementById('newsArticles');
            if (!container) return;
            
            container.innerHTML = AppState.data.news.map(article => `
                <div class="card news-card mb-4">
                    <div class="card-body">
                        <div class="news-meta">
                            <span><i class="fas fa-calendar"></i> ${formatDate(article.date)}</span>
                            <span><i class="fas fa-user"></i> ${article.author}</span>
                            <span><i class="fas fa-tag"></i> ${AppState.language === 'es' ? article.category : article.categoryEn}</span>
                        </div>
                        <h3 class="news-title">${AppState.language === 'es' ? article.title : article.titleEn}</h3>
                        <p class="news-excerpt">${AppState.language === 'es' ? article.summary : article.summaryEn}</p>
                        <div class="flex justify-between items-center mt-3">
                            <div class="flex gap-2">
                                ${(AppState.language === 'es' ? article.tags : article.tagsEn).map(tag => 
                                    `<span class="badge badge-secondary">${tag}</span>`
                                ).join('')}
                            </div>
                            <button class="btn btn-primary btn-sm" onclick="showNewsDetail(${article.id})">
                                Leer más
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function displayNewsCategories() {
            const container = document.getElementById('newsCategories');
            if (!container) return;
            
            const categories = [...new Set(AppState.data.news.map(article => 
                AppState.language === 'es' ? article.category : article.categoryEn
            ))];
            
            container.innerHTML = categories.map(category => `
                <button class="btn btn-secondary btn-sm" style="width: 100%; text-align: left;" 
                        onclick="filterNewsByCategory('${category}')">
                    ${category}
                </button>
            `).join('');
        }

        function displayImportantAlerts() {
            const container = document.getElementById('importantAlerts');
            if (!container) return;
            
            const importantNews = AppState.data.news.filter(article => article.importance === 'high');
            
            container.innerHTML = importantNews.map(article => `
                <div class="card">
                    <div class="card-body">
                        <h5 class="font-bold text-sm">${AppState.language === 'es' ? article.title : article.titleEn}</h5>
                        <p class="text-xs text-secondary">${formatDate(article.date)}</p>
                    </div>
                </div>
            `).join('');
        }

        function initializeProfile() {
            if (AppState.currentUser) {
                document.getElementById('profileName').textContent = AppState.currentUser.name;
                document.getElementById('profileRole').textContent = AppState.currentUser.role;
                
                // Load saved profile data
                const profileData = loadFromStorage('profileData', {});
                document.getElementById('fullName').value = profileData.fullName || AppState.currentUser.name;
                document.getElementById('email').value = profileData.email || '';
                document.getElementById('phone').value = profileData.phone || '';
                document.getElementById('specialty').value = profileData.specialty || '';
            }
            
            updateUserActivity();
            updateUserStats();
            
            const profileForm = document.getElementById('profileForm');
            if (profileForm) {
                profileForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    saveProfileData();
                });
            }
        }

        function saveProfileData() {
            const profileData = {
                fullName: document.getElementById('fullName').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                specialty: document.getElementById('specialty').value
            };
            
            saveToStorage('profileData', profileData);
            showToast('Perfil actualizado exitosamente');
        }

        function updateUserActivity() {
            const container = document.getElementById('userActivity');
            if (!container) return;
            
            const activities = loadFromStorage('userActivity', []);
            
            if (activities.length === 0) {
                container.innerHTML = '<p class="text-center text-secondary">No hay actividad reciente</p>';
                return;
            }
            
            container.innerHTML = activities.slice(0, 5).map(activity => `
                <div class="flex items-center gap-3 mb-3">
                    <div class="text-primary">
                        <i class="fas ${getActivityIcon(activity.type)}"></i>
                    </div>
                    <div class="flex-1">
                        <div class="text-sm font-medium">${activity.description}</div>
                        <div class="text-xs text-secondary">${formatDate(activity.date)}</div>
                    </div>
                </div>
            `).join('');
        }

        function getActivityIcon(type) {
            const icons = {
                search: 'fa-search',
                calculation: 'fa-calculator',
                favorite: 'fa-star',
                login: 'fa-sign-in-alt',
                profile: 'fa-user-edit'
            };
            return icons[type] || 'fa-circle';
        }

        function updateUserStats() {
            const calculatorHistory = loadFromStorage('calculatorHistory', []);
            const favorites = loadFromStorage('favorites', { diseases: [], medications: [], guidelines: [] });
            const userActivity = loadFromStorage('userActivity', []);
            
            document.getElementById('searchCount').textContent = userActivity.filter(a => a.type === 'search').length;
            document.getElementById('calculationCount').textContent = calculatorHistory.length;
            document.getElementById('favoriteCount').textContent = 
                favorites.diseases.length + favorites.medications.length + favorites.guidelines.length;
            document.getElementById('loginCount').textContent = userActivity.filter(a => a.type === 'login').length;
        }

        function initializeHelp() {
            displayFAQ();
            updateSystemInfo();
        }

        function displayFAQ() {
            const container = document.getElementById('faqList');
            if (!container) return;
            
            const faqs = [
                {
                    question: '¿Cómo busco información sobre una enfermedad?',
                    answer: 'Ve a la sección "Enfermedades" y usa el buscador. Puedes buscar por nombre de la enfermedad, síntomas o especialidad médica.'
                },
                {
                    question: '¿Cómo guardo mis cálculos favoritos?',
                    answer: 'Después de realizar un cálculo, haz clic en "Guardar Resultado". Podrás ver todos tus cálculos guardados en el historial.'
                },
                {
                    question: '¿Puedo cambiar el idioma de la aplicación?',
                    answer: 'Sí, ve a Configuración y selecciona tu idioma preferido. La aplicación soporta español e inglés.'
                },
                {
                    question: '¿Cómo interpreto los resultados de laboratorio?',
                    answer: 'La aplicación proporciona interpretación automática basada en rangos normales. Siempre consulta con un profesional médico.'
                },
                {
                    question: '¿Los datos se guardan de forma segura?',
                    answer: 'Todos los datos se almacenan localmente en tu navegador. No se envían a servidores externos.'
                }
            ];
            
            container.innerHTML = faqs.map((faq, index) => `
                <div class="card">
                    <div class="card-body">
                        <button class="w-full text-left font-medium" onclick="toggleFAQ(${index})">
                            <div class="flex justify-between items-center">
                                <span>${faq.question}</span>
                                <i class="fas fa-chevron-down" id="faq-icon-${index}"></i>
                            </div>
                        </button>
                        <div class="mt-3 text-sm text-secondary hidden" id="faq-answer-${index}">
                            ${faq.answer}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function toggleFAQ(index) {
            const answer = document.getElementById(`faq-answer-${index}`);
            const icon = document.getElementById(`faq-icon-${index}`);
            
            if (answer.classList.contains('hidden')) {
                answer.classList.remove('hidden');
                icon.classList.remove('fa-chevron-down');
                icon.classList.add('fa-chevron-up');
            } else {
                answer.classList.add('hidden');
                icon.classList.remove('fa-chevron-up');
                icon.classList.add('fa-chevron-down');
            }
        }

        function updateSystemInfo() {
            document.getElementById('browserInfo').textContent = navigator.userAgent.split(' ').pop();
            
            // Calculate storage usage
            let totalSize = 0;
            for (let key in localStorage) {
                if (localStorage.hasOwnProperty(key)) {
                    totalSize += localStorage[key].length;
                }
            }
            document.getElementById('storageUsed').textContent = `${(totalSize / 1024).toFixed(1)} KB`;
        }

        // Settings functions
        function setThemeColor(color) {
            document.documentElement.style.setProperty('--primary-color', color);
            document.documentElement.style.setProperty('--secondary-color', color);
            
            // Update active color option
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('active');
            });
            event.target.classList.add('active');
            
            saveToStorage('themeColor', color);
            showToast('Color del tema actualizado');
        }

        function saveInstitutionalSettings() {
            const settings = {
                institutionName: document.getElementById('institutionName').value,
                institutionAddress: document.getElementById('institutionAddress').value,
                institutionPhone: document.getElementById('institutionPhone').value
            };
            
            saveToStorage('institutionalSettings', settings);
            
            // Update logo text
            document.getElementById('logoText').textContent = settings.institutionName || 'MedSys Pro';
            
            showToast('Configuración institucional guardada');
        }

        function exportData() {
            const data = {
                calculatorHistory: loadFromStorage('calculatorHistory', []),
                labResults: loadFromStorage('labResults', []),
                favorites: loadFromStorage('favorites', {}),
                profileData: loadFromStorage('profileData', {}),
                userActivity: loadFromStorage('userActivity', [])
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `medsys-data-${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showToast('Datos exportados exitosamente');
        }

        function clearCache() {
            if (confirm('¿Estás seguro de que quieres limpiar el caché? Esto eliminará datos temporales pero conservará tu información importante.')) {
                // Clear only temporary data
                localStorage.removeItem('userActivity');
                showToast('Caché limpiado exitosamente');
            }
        }

        function resetApplication() {
            if (confirm('¿Estás seguro de que quieres restablecer la aplicación? Esto eliminará TODOS los datos guardados.')) {
                localStorage.clear();
                location.reload();
            }
        }

        // Utility functions for user guides and support
        function showUserGuide(section) {
            const guides = {
                diseases: 'Para buscar enfermedades: 1) Ve a la sección Enfermedades, 2) Escribe el nombre o síntomas, 3) Filtra por especialidad si es necesario, 4) Haz clic en una enfermedad para ver detalles completos.',
                calculators: 'Para usar calculadoras: 1) Selecciona el tipo de calculadora, 2) Ingresa los valores requeridos, 3) Haz clic en Calcular, 4) Guarda el resultado si lo deseas.',
                lab: 'Para resultados de laboratorio: 1) Selecciona el tipo de análisis, 2) Ingresa los valores, 3) La interpretación se genera automáticamente, 4) Guarda para futuras referencias.',
                medications: 'Para medicamentos: 1) Busca por nombre o categoría, 2) Filtra por precio si es necesario, 3) Marca como favorito, 4) Ve detalles completos incluyendo interacciones.'
            };
            
            alert(guides[section] || 'Guía no disponible');
        }

        function openSupportChat() {
            alert('El chat de soporte estaría disponible en una implementación real. Por ahora, puedes contactar por teléfono o email.');
        }

        // Global search functionality
        function performGlobalSearch(query) {
            if (!query) return;
            
            const results = {
                diseases: AppState.data.diseases.filter(d => 
                    d.name.toLowerCase().includes(query) || 
                    d.symptoms.some(s => s.toLowerCase().includes(query))
                ),
                medications: AppState.data.medications.filter(m => 
                    m.name.toLowerCase().includes(query) || 
                    m.genericName.toLowerCase().includes(query)
                ),
                professionals: AppState.data.professionals.filter(p => 
                    p.name.toLowerCase().includes(query) || 
                    p.specialty.toLowerCase().includes(query)
                ),
                guidelines: AppState.data.guidelines.filter(g => 
                    g.title.toLowerCase().includes(query) || 
                    g.description.toLowerCase().includes(query)
                )
            };
            
            // Show search results modal or navigate to appropriate section
            if (results.diseases.length > 0) {
                navigateTo('diseases');
                setTimeout(() => {
                    document.getElementById('diseaseSearch').value = query;
                    searchDiseases();
                }, 100);
            } else if (results.medications.length > 0) {
                navigateTo('medications');
                setTimeout(() => {
                    document.getElementById('medicationSearch').value = query;
                    searchMedications();
                }, 100);
            }
            
            // Log search activity
            logUserActivity('search', `Búsqueda global: ${query}`);
        }

        // User activity logging
        function logUserActivity(type, description) {
            const activities = loadFromStorage('userActivity', []);
            activities.unshift({
                id: generateId(),
                type,
                description,
                date: new Date()
            });
            
            // Keep only last 50 activities
            if (activities.length > 50) {
                activities.splice(50);
            }
            
            saveToStorage('userActivity', activities);
        }

        // Content update function
        function updateContent() {
            // Update dashboard stats
            if (document.getElementById('diseasesCount')) {
                document.getElementById('diseasesCount').textContent = AppState.data.diseases.length;
                document.getElementById('medicationsCount').textContent = AppState.data.medications.length;
                document.getElementById('professionalsCount').textContent = AppState.data.professionals.length;
                document.getElementById('guidelinesCount').textContent = AppState.data.guidelines.length;
            }
            
            // Update current page content based on current page
            switch (AppState.currentPage) {
                case 'diseases':
                    displayDiseases(AppState.data.diseases);
                    break;
                case 'medications':
                    displayMedications(AppState.data.medications);
                    break;
                case 'directory':
                    displayProfessionals(AppState.data.professionals);
                    break;
                case 'guidelines':
                    displayGuidelines(AppState.data.guidelines);
                    break;
                case 'news':
                    displayNews();
                    break;
            }
        }

        function updateUserInterface() {
            if (AppState.currentUser) {
                const userAvatar = document.getElementById('userAvatar');
                if (userAvatar) {
                    userAvatar.innerHTML = AppState.currentUser.name.split(' ').map(n => n[0]).join('').substring(0, 2);
                    userAvatar.title = AppState.currentUser.name;
                }
            }
        }

        // Initialize application
        function initializeApp() {
            // Load saved state
            AppState.currentUser = loadFromStorage('currentUser');
            AppState.theme = loadFromStorage('theme', 'light');
            AppState.language = loadFromStorage('language', 'es');
            AppState.sidebarCollapsed = loadFromStorage('sidebarCollapsed', false);
            AppState.data.favorites = loadFromStorage('favorites', { diseases: [], medications: [], guidelines: [] });
            
            // Load sample data
            AppState.data.diseases = sampleData.diseases;
            AppState.data.medications = sampleData.medications;
            AppState.data.professionals = sampleData.professionals;
            AppState.data.guidelines = sampleData.guidelines;
            AppState.data.news = sampleData.news;
            
            // Apply saved settings
            loadTheme();
            updateTranslations();
            
            // Load saved theme color
            const savedColor = loadFromStorage('themeColor');
            if (savedColor) {
                setThemeColor(savedColor);
            }
            
            // Load institutional settings
            const institutionalSettings = loadFromStorage('institutionalSettings');
            if (institutionalSettings && institutionalSettings.institutionName) {
                document.getElementById('logoText').textContent = institutionalSettings.institutionName;
            }
            
            // Set up sidebar state
            const sidebar = document.getElementById('sidebar');
            if (AppState.sidebarCollapsed) {
                sidebar.classList.add('collapsed');
            }
            
            // Set up event listeners
            setupEventListeners();
            
            // Check authentication
            checkAuthentication();
            
            // Load saved page or default to dashboard
            const savedPage = loadFromStorage('currentPage', 'dashboard');
            navigateTo(savedPage);
            
            // Update content
            updateContent();
            
            // Log app initialization
            logUserActivity('login', 'Aplicación iniciada');
        }

        function setupEventListeners() {
            // Sidebar toggle
            document.getElementById('sidebarToggle').addEventListener('click', function() {
                const sidebar = document.getElementById('sidebar');
                sidebar.classList.toggle('collapsed');
                AppState.sidebarCollapsed = sidebar.classList.contains('collapsed');
                saveToStorage('sidebarCollapsed', AppState.sidebarCollapsed);
            });
            
            // Theme toggle
            document.getElementById('themeToggle').addEventListener('click', toggleTheme);
            
            // Navigation links
            document.querySelectorAll('.nav-link').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const page = this.getAttribute('data-page');
                    if (page) {
                        navigateTo(page);
                    }
                });
            });
            
            // Global search
            document.getElementById('globalSearch').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const query = this.value.toLowerCase().trim();
                    if (query) {
                        performGlobalSearch(query);
                    }
                }
            });
            
            // Login form
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const username = document.getElementById('loginUsername').value;
                const password = document.getElementById('loginPassword').value;
                
                if (login(username, password)) {
                    logUserActivity('login', 'Inicio de sesión exitoso');
                } else {
                    showToast('Usuario o contraseña incorrectos', 'error');
                }
            });
            
            // User avatar click (logout)
            document.getElementById('userAvatar').addEventListener('click', function() {
                if (confirm('¿Deseas cerrar sesión?')) {
                    logout();
                }
            });
            
            // Modal close buttons
            document.querySelectorAll('.modal-close').forEach(button => {
                button.addEventListener('click', function() {
                    const modal = this.closest('.modal');
                    if (modal) {
                        closeModal(modal.id);
                    }
                });
            });
            
            // Close modals when clicking outside
            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        closeModal(this.id);
                    }
                });
            });
            
            // Language selector in settings
            document.querySelectorAll('.language-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.language-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                });
            });
        }

        // Start the application when DOM is loaded
        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
