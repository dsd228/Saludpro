<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>SaludPro v7.0 - Inteligencia Cl√≠nica Avanzada</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&family=Material+Symbols+Outlined" rel="stylesheet">
  <style>
    :root {
      --primary-blue: #1a73e8;
      --primary-blue-darker: #0d47a1;
      --primary-blue-lighter: #e8f0fe;
      --success-green: #34a853;
      --warning-yellow: #f9ab00;
      --alert-red: #ea4335;
      --accent-teal: #00897b;
      --accent-purple: #7b1fa2;
      --background-light: #f8f9fa;
      --background-dark: #1e1e1e;
      --text-dark: #202124;
      --text-light: #ffffff;
      --text-muted: #5f6368;
      --border-radius: 8px;
      --shadow-small: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
      --shadow-medium: 0 3px 6px rgba(0,0,0,0.16), 0 3px 6px rgba(0,0,0,0.23);
      --shadow-large: 0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23);
      --shadow-xl: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
      --transition-fast: all 0.2s ease-in-out;
      --transition-slow: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      --z-modal: 1000;
      --z-header: 100;
      --status-success: #34a853;
      --status-warning: #f9ab00;
      --status-error: #ea4335;
      --status-info: #1a73e8;
      --font-size-base: 16px;
      --font-family: 'Roboto', sans-serif;
    }

    .theme-dark {
      --background-light: #1e1e1e;
      --background-dark: #121212;
      --text-dark: #e0e0e0;
      --text-muted: #b0b0b0;
      --primary-blue-lighter: #1a237e;
    }

    body {
      font-family: var(--font-family);
      margin: 0;
      background-color: var(--background-light);
      color: var(--text-dark);
      display: flex;
      flex-direction: column;
      min-height: 100vh;
      line-height: 1.6;
      transition: var(--transition-slow);
      font-size: var(--font-size-base);
    }

    h1, h2, h3, h4, h5, h6 {
      margin: 0 0 15px 0;
      color: var(--text-dark);
      font-weight: 500;
    }

    h1 { font-size: 2.5em; }
    h2 { font-size: 2em; }
    h3 { font-size: 1.7em; }
    h4 { font-size: 1.5em; }
    h5 { font-size: 1.2em; }
    h6 { font-size: 1em; }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
    }

    header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 15px 30px;
      background-color: white;
      box-shadow: var(--shadow-medium);
      border-bottom-left-radius: var(--border-radius);
      border-bottom-right-radius: var(--border-radius);
      z-index: var(--z-header);
      position: relative;
      border-bottom: 1px solid #eee;
    }

    .logo-container {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.5em;
      font-weight: 700;
    }

    .app-icon {
      font-size: 2.5em;
      color: var(--primary-blue);
    }

    .logo-container span {
      color: var(--warning-yellow);
    }

    nav ul {
      display: flex;
      list-style: none;
      gap: 20px;
      margin: 0;
      padding: 0;
    }

    nav ul li a {
      color: var(--text-dark);
      text-decoration: none;
      padding: 8px 12px;
      border-radius: var(--border-radius);
      transition: var(--transition-fast);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    nav ul li a:hover {
      background-color: var(--primary-blue-lighter);
    }

    nav ul li a.active {
      background-color: var(--primary-blue-lighter);
      color: var(--primary-blue);
      font-weight: 500;
    }

    main {
      flex-grow: 1;
      padding: 20px 0;
    }

    .page {
      display: none;
      padding: 20px;
      background-color: white;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-medium);
      margin-top: 20px;
      animation: fadeIn 0.5s ease-out;
      min-height: 500px;
    }

    .page.active {
      display: block;
    }

    .page-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }

    .page-header h2 {
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--primary-blue);
    }

    .breadcrumbs {
      display: flex;
      gap: 5px;
      margin-bottom: 10px;
      font-size: 0.9em;
      color: var(--text-muted);
    }

    .breadcrumbs span {
      color: var(--text-dark);
    }

    .btn {
      padding: 10px 20px;
      border: none;
      border-radius: var(--border-radius);
      font-size: 1em;
      cursor: pointer;
      transition: var(--transition-fast);
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .btn-primary {
      background-color: var(--primary-blue);
      color: white;
    }

    .btn-primary:hover {
      background-color: var(--primary-blue-darker);
    }

    .btn-secondary {
      background-color: var(--text-muted);
      color: white;
    }

    .btn-secondary:hover {
      background-color: #777;
    }

    .btn-warning {
      background-color: var(--warning-yellow);
      color: var(--text-dark);
    }

    .btn-warning:hover {
      background-color: #f09300;
    }

    .btn-danger {
      background-color: var(--alert-red);
      color: white;
    }

    .btn-danger:hover {
      background-color: #d32f2f;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: var(--text-dark);
    }

    .form-control {
      width: 100%;
      padding: 10px 15px;
      border: 1px solid #ccc;
      border-radius: var(--border-radius);
      font-size: 1em;
      transition: var(--transition-fast);
    }

    .form-control:focus {
      outline: none;
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
    }

    .form-row {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .form-row .form-group {
      flex: 1;
      min-width: 200px;
    }

    .card {
      background-color: white;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-small);
      padding: 20px;
      margin-bottom: 20px;
      border: 1px solid #eee;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
      padding-bottom: 10px;
      border-bottom: 1px solid #eee;
    }

    .card-title {
      margin: 0;
      color: var(--primary-blue);
      font-size: 1.3em;
      font-weight: 500;
    }

    .tabs {
      display: flex;
      border-bottom: 1px solid #eee;
      margin-bottom: 20px;
    }

    .tab {
      padding: 10px 20px;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: var(--transition-fast);
      font-weight: 500;
      color: var(--text-muted);
    }

    .tab.active {
      border-bottom-color: var(--primary-blue);
      color: var(--primary-blue);
      font-weight: 600;
    }

    .tab:hover {
      color: var(--primary-blue);
      background-color: rgba(26, 115, 232, 0.05);
    }

    .tab-content {
      display: none;
    }

    .tab-content.active {
      display: block;
    }

    /* Consultorio Virtual */
    .consultorio-container {
      background-color: var(--background-light);
      border-radius: var(--border-radius);
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: var(--shadow-medium);
    }

    .search-box {
      display: flex;
      gap: 10px;
      margin-bottom: 15px;
    }

    .search-box input {
      flex-grow: 1;
      padding: 12px 15px;
      border-radius: var(--border-radius);
      border: 1px solid #ccc;
      font-size: 1em;
      transition: var(--transition-fast);
    }

    .search-box input:focus {
      outline: none;
      border-color: var(--primary-blue);
      box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.2);
    }

    .search-box button {
      padding: 12px 20px;
      background-color: var(--primary-blue);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-size: 1em;
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .search-box button:hover {
      background-color: var(--primary-blue-darker);
    }

    .suggestions-container {
      position: absolute;
      background: white;
      border: 1px solid #ddd;
      border-radius: var(--border-radius);
      max-height: 200px;
      overflow-y: auto;
      width: 100%;
      box-shadow: var(--shadow-large);
      z-index: 1000;
      margin-top: 1px;
      display: none;
    }

    .suggestion-item {
      padding: 10px 15px;
      cursor: pointer;
      border-bottom: 1px solid #eee;
      transition: var(--transition-fast);
    }

    .suggestion-item:hover {
      background-color: #f5f5f5;
    }

    .suggestion-item:last-child {
      border-bottom: none;
    }

    .highlight {
      background-color: #fffacd;
      font-weight: bold;
    }

    .diagnostic-result {
      padding: 15px;
      border-radius: var(--border-radius);
      margin-bottom: 15px;
      background-color: white;
      border: 1px solid #eee;
      box-shadow: var(--shadow-small);
    }

    .diagnostic-result h4 {
      margin: 0 0 10px 0;
      color: var(--text-dark);
    }

    .progress-bar {
      width: 100%;
      height: 10px;
      background-color: #eee;
      border-radius: 5px;
      overflow: hidden;
      margin: 10px 0;
    }

    .progress {
      height: 100%;
      background-color: var(--primary-blue);
      border-radius: 5px;
      transition: width 0.5s ease;
    }

    .severity-high {
      color: var(--alert-red);
      font-weight: 600;
    }

    .severity-moderate {
      color: var(--warning-yellow);
      font-weight: 600;
    }

    .severity-low {
      color: var(--status-success);
      font-weight: 600;
    }

    .alert-card {
      display: flex;
      align-items: center;
      background-color: var(--warning-yellow);
      color: var(--text-dark);
      padding: 15px;
      border-radius: var(--border-radius);
      margin-bottom: 20px;
      box-shadow: var(--shadow-medium);
      border-left: 5px solid var(--alert-red);
    }

    .alert-card.info {
      background-color: #e3f2fd;
      border-left-color: var(--primary-blue);
    }

    .alert-card.success {
      background-color: #e8f5e8;
      border-left-color: var(--status-success);
    }

    .alert-icon {
      font-size: 2em;
      margin-right: 15px;
    }

    .recommendation {
      background-color: #f8f9fa;
      border-left: 4px solid var(--primary-blue);
      padding: 10px 15px;
      margin: 10px 0;
      border-radius: 0 4px 4px 0;
    }

    /* Calendario */
    .calendar {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      gap: 1px;
      background-color: #eee;
      border-radius: var(--border-radius);
      overflow: hidden;
      margin-bottom: 20px;
    }

    .calendar-header {
      display: grid;
      grid-template-columns: repeat(7, 1fr);
      background-color: var(--primary-blue);
      color: white;
      text-align: center;
      font-weight: 500;
    }

    .calendar-header div {
      padding: 10px;
    }

    .calendar-day {
      background-color: white;
      padding: 10px;
      min-height: 100px;
      position: relative;
    }

    .day-number {
      font-weight: 500;
      margin-bottom: 5px;
    }

    .appointment {
      background-color: var(--primary-blue);
      color: white;
      padding: 5px;
      border-radius: 4px;
      font-size: 0.8em;
      margin-bottom: 3px;
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }

    .waiting-room {
      background-color: white;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-medium);
      overflow: hidden;
    }

    .waiting-room table {
      width: 100%;
      border-collapse: collapse;
    }

    .waiting-room th {
      background-color: var(--primary-blue);
      color: white;
      text-align: left;
      padding: 15px;
    }

    .waiting-room td {
      padding: 12px 15px;
      border-bottom: 1px solid #eee;
    }

    .waiting-time.high {
      color: var(--alert-red);
      font-weight: 600;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: var(--z-modal);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background-color: white;
      border-radius: var(--border-radius);
      width: 90%;
      max-width: 800px;
      max-height: 90vh;
      overflow-y: auto;
      animation: slideIn 0.4s ease-out forwards;
      position: relative;
      border: 1px solid rgba(0,0,0,0.1);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #eee;
      padding: 15px 20px;
    }

    .modal-header h2 {
      margin: 0;
      color: var(--text-dark);
      font-size: 1.5em;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .modal-close-btn {
      background: none;
      border: none;
      font-size: 1.5em;
      color: #888;
      cursor: pointer;
      transition: var(--transition-fast);
    }

    .modal-close-btn:hover {
      color: var(--alert-red);
    }

    .modal-body {
      padding: 20px;
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 10px;
      padding: 15px 20px;
      border-top: 1px solid #eee;
      background-color: #f5f5f5;
      border-radius: 0 0 var(--border-radius) var(--border-radius);
    }

    @keyframes slideIn {
      from {
        transform: translateY(-50px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }
      to {
        opacity: 1;
      }
    }

    /* Notificaciones */
    .notification-container {
      position: fixed;
      top: 20px;
      right: 20px;
      z-index: 1000;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .notification {
      padding: 15px 20px;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-medium);
      display: flex;
      align-items: center;
      gap: 10px;
      color: white;
      min-width: 300px;
      animation: slideInRight 0.3s ease-out;
    }

    .notification.success {
      background-color: var(--status-success);
    }

    .notification.warning {
      background-color: var(--warning-yellow);
      color: var(--text-dark);
    }

    .notification.error {
      background-color: var(--status-error);
    }

    .notification.info {
      background-color: var(--primary-blue);
    }

    @keyframes slideInRight {
      from {
        transform: translateX(100%);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        gap: 15px;
        text-align: center;
      }

      nav ul {
        flex-wrap: wrap;
        justify-content: center;
      }

      .form-row {
        flex-direction: column;
      }

      .form-row .form-group {
          min-width: 100%;
      }

      .calendar {
        grid-template-columns: repeat(1, 1fr);
      }

      .calendar-header {
        display: none;
      }

      .modal {
        width: 95%;
        margin: 10px;
      }
    }

    /* Cargadores */
    .loader {
      display: inline-block;
      width: 20px;
      height: 20px;
      border: 3px solid #f3f3f3;
      border-top: 3px solid var(--primary-blue);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-right: 10px;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Accesibilidad */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0,0,0,0);
      white-space: nowrap;
      border: 0;
    }

    button, input, select, textarea {
      font-family: var(--font-family);
    }

    *:focus {
      outline: 2px solid var(--primary-blue);
      outline-offset: 2px;
    }

    /* Dashboard */
    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }

    .user-info {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .user-info p {
      margin: 0;
      color: var(--text-muted);
    }

    .indicator-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .indicator-card {
      background-color: white;
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: var(--shadow-small);
      border: 1px solid #eee;
      text-align: center;
    }

    .indicator-card h3 {
      color: var(--primary-blue);
      margin: 10px 0 5px 0;
    }

    .indicator-card p {
      color: var(--text-muted);
      margin: 0;
    }

    /* Pacientes Page Styles */
    .search-filter-bar {
      display: flex;
      align-items: center;
      gap: 15px;
      margin-bottom: 20px;
      padding: 15px;
      background-color: var(--background-light);
      border-radius: var(--border-radius);
    }

    .search-filter-bar input {
      flex-grow: 1;
    }

    .search-filter-bar select {
      min-width: 200px;
    }

    .patient-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
    }

    .patient-card {
      background-color: white;
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: var(--shadow-small);
      border: 1px solid #eee;
      transition: var(--transition-fast);
    }

    .patient-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-medium);
    }

    .patient-card h3 {
      margin: 0 0 10px 0;
      color: var(--primary-blue);
    }

    .patient-card p {
      margin: 5px 0;
      color: var(--text-muted);
    }

    .patient-card .status {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 0.8em;
      font-weight: 500;
      margin-top: 10px;
    }

    .status-high {
      background-color: rgba(234, 67, 53, 0.1);
      color: var(--alert-red);
    }

    .status-moderate {
      background-color: rgba(249, 171, 0, 0.1);
      color: var(--warning-yellow);
    }

    .status-low {
      background-color: rgba(52, 168, 83, 0.1);
      color: var(--status-success);
    }

    /* Recursos Educativos */
    .resource-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .resource-card {
      background-color: white;
      border-radius: var(--border-radius);
      overflow: hidden;
      box-shadow: var(--shadow-small);
      border: 1px solid #eee;
      transition: var(--transition-fast);
    }

    .resource-card:hover {
      transform: translateY(-2px);
      box-shadow: var(--shadow-medium);
    }

    .resource-image {
      width: 100%;
      height: 180px;
      object-fit: cover;
    }

    .resource-content {
      padding: 15px;
    }

    .resource-content h3 {
      margin: 0 0 10px 0;
      color: var(--primary-blue);
    }

    .resource-content p {
      margin: 5px 0;
      color: var(--text-muted);
    }

    .resource-meta {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
      padding-top: 10px;
      border-top: 1px solid #eee;
      font-size: 0.9em;
      color: var(--text-muted);
    }

    /* Consulta M√©dica */
    .consulta-container {
      background-color: var(--background-light);
      border-radius: var(--border-radius);
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: var(--shadow-medium);
    }

    .consulta-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 1px solid #eee;
    }

    .consulta-header h2 {
      display: flex;
      align-items: center;
      gap: 10px;
      color: var(--primary-blue);
    }

    .patient-selector {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 20px;
    }

    .patient-selector label {
      font-weight: 500;
      color: var(--text-dark);
    }

    .patient-selector select {
      flex-grow: 1;
      min-width: 300px;
    }

    /* Recetas */
    .medication-list {
      margin-bottom: 20px;
    }

    .medication-entry {
      background-color: white;
      border-radius: var(--border-radius);
      padding: 15px;
      margin-bottom: 15px;
      box-shadow: var(--shadow-small);
      border: 1px solid #eee;
    }

    .interactions-warning {
      background-color: #fff3cd;
      border: 1px solid #ffeaa7;
      border-radius: var(--border-radius);
      padding: 15px;
      margin: 20px 0;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .interactions-warning span {
      color: var(--alert-red);
      font-size: 1.5em;
    }

    /* Calculadoras */
    .calculator-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .calculator-form {
      background-color: white;
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: var(--shadow-small);
      border: 1px solid #eee;
    }

    .calculator-form h3 {
      color: var(--primary-blue);
      margin-bottom: 15px;
    }

    .calculator-form .form-row {
      margin-bottom: 15px;
    }

    .radio-group {
      display: flex;
      gap: 20px;
      margin: 10px 0;
    }

    .radio-option {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .result-display {
      margin-top: 15px;
      padding: 15px;
      background-color: var(--primary-blue-lighter);
      border-radius: var(--border-radius);
      text-align: center;
    }

    .result-display h4 {
      color: var(--primary-blue);
      margin: 0 0 10px 0;
    }

    .result-display p {
      margin: 0;
      font-size: 1.2em;
      font-weight: 500;
    }

    /* Detalles Modales */
    .modal-detail-content {
      line-height: 1.8;
    }

    .modal-detail-content h3 {
      color: var(--primary-blue);
      margin: 15px 0 10px 0;
    }

    .modal-detail-content h4 {
      color: var(--text-dark);
      margin: 15px 0 10px 0;
    }

    .modal-detail-content p {
      margin: 8px 0;
    }

    .modal-tabs {
      display: flex;
      border-bottom: 1px solid #eee;
      margin-bottom: 20px;
    }

    .modal-tab {
      padding: 10px 20px;
      cursor: pointer;
      border-bottom: 3px solid transparent;
      transition: var(--transition-fast);
      font-weight: 500;
      color: var(--text-muted);
    }

    .modal-tab.active {
      border-bottom-color: var(--primary-blue);
      color: var(--primary-blue);
      font-weight: 600;
    }

    .modal-tab:hover {
      color: var(--primary-blue);
      background-color: rgba(26, 115, 232, 0.05);
    }

    .modal-tab-content {
      display: none;
    }

    .modal-tab-content.active {
      display: block;
    }

    .modal-tab-content table {
      width: 100%;
      border-collapse: collapse;
      margin: 15px 0;
    }

    .modal-tab-content th {
      background-color: var(--background-light);
      color: var(--text-dark);
      font-weight: 500;
      padding: 12px 15px;
      text-align: left;
    }

    .modal-tab-content td {
      padding: 12px 15px;
      border-bottom: 1px solid #e0e0e0;
      transition: var(--transition-fast);
    }

    .modal-tab-content tr:hover {
      background-color: #f8f9fa;
    }

    .modal-tab-content tr:hover td:first-child {
      color: var(--primary-blue);
      font-weight: 500;
    }

    /* Im√°genes en detalles */
    .image-gallery {
      display: flex;
      gap: 10px;
      margin: 20px 0;
      overflow-x: auto;
      padding-bottom: 10px;
    }

    .image-thumbnail {
      width: 100px;
      height: 100px;
      object-fit: cover;
      border-radius: var(--border-radius);
      cursor: pointer;
      border: 2px solid transparent;
      transition: var(--transition-fast);
    }

    .image-thumbnail.active {
      border-color: var(--primary-blue);
    }

    .image-thumbnail:hover {
      border-color: var(--primary-blue-lighter);
    }

    .main-image {
      width: 100%;
      max-height: 400px;
      object-fit: contain;
      border-radius: var(--border-radius);
      margin-bottom: 15px;
    }

    /* Search Results */
    .search-results {
      margin-top: 20px;
      padding: 20px;
      background-color: white;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-small);
      border: 1px solid #eee;
    }

    .search-results h3 {
      color: var(--primary-blue);
      margin-bottom: 15px;
    }

    .search-result {
      padding: 15px;
      border-bottom: 1px solid #eee;
      transition: var(--transition-fast);
    }

    .search-result:hover {
      background-color: #f8f9fa;
    }

    .search-result h4 {
      margin: 0 0 10px 0;
      color: var(--primary-blue);
    }

    .search-result p {
      margin: 5px 0;
      color: var(--text-muted);
    }

    .result-actions {
      display: flex;
      gap: 10px;
      margin-top: 10px;
    }

    .btn-detail {
      background-color: var(--primary-blue);
      color: white;
    }

    .btn-view-image {
      background-color: var(--accent-teal);
      color: white;
    }

    .chart-container {
      margin-top: 30px;
      background-color: white;
      border-radius: var(--border-radius);
      padding: 20px;
      box-shadow: var(--shadow-small);
      border: 1px solid #eee;
    }

    .chart-controls {
      display: flex;
      gap: 15px;
      margin-top: 15px;
    }

    .chart-controls select,
    .chart-controls button {
      padding: 8px 12px;
      border-radius: var(--border-radius);
      border: 1px solid #ccc;
      font-size: 1em;
    }

    .chart-controls button {
      background-color: var(--primary-blue);
      color: white;
      border: none;
      cursor: pointer;
      transition: var(--transition-fast);
    }

    .chart-controls button:hover {
      background-color: var(--primary-blue-darker);
    }

    canvas {
      max-width: 100%;
      height: 300px !important;
    }
  </style>
</head>
<body>
  <header>
    <div class="logo-container">
      <span class="material-symbols-outlined app-icon">medical_information</span>
      Salud<span>Pro</span> v7.0
    </div>
    <nav>
      <ul>
        <li><a href="#" class="active" onclick="navigateTo('dashboard')"><span class="material-symbols-outlined">dashboard</span>Dashboard</a></li>
        <li><a href="#" onclick="navigateTo('pacientes')"><span class="material-symbols-outlined">groups</span>Pacientes</a></li>
        <li><a href="#" onclick="navigateTo('personal')"><span class="material-symbols-outlined">people</span>Personal</a></li>
        <li><a href="#" onclick="navigateTo('consultorio')"><span class="material-symbols-outlined">healing</span>Consultorio</a></li>
        <li><a href="#" onclick="navigateTo('recetas')"><span class="material-symbols-outlined">prescriptions</span>Recetas</a></li>
        <li><a href="#" onclick="navigateTo('recursos')"><span class="material-symbols-outlined">school</span>Recursos</a></li>
        <li><a href="#" onclick="toggleTheme()"><span class="material-symbols-outlined">dark_mode</span>Tema</a></li>
      </ul>
    </nav>
  </header>

  <main class="container">
    <!-- Dashboard -->
    <section id="dashboard" class="page active">
      <div class="dashboard-header">
        <h2><span class="material-symbols-outlined">dashboard</span>Dashboard</h2>
        <div class="user-info">
          <p>Bienvenido, Dr. Juan P√©rez</p>
          <button class="btn btn-secondary"><span class="material-symbols-outlined">settings</span> Personalizar</button>
        </div>
      </div>

      <div class="alert-card">
        <span class="material-symbols-outlined alert-icon">warning</span>
        <div>
          <strong>Seguimiento pendiente:</strong> Paciente Ana Garc√≠a con VIH requiere control de carga viral.
        </div>
      </div>

      <div class="indicator-cards">
        <div class="indicator-card">
          <span class="material-symbols-outlined" style="font-size: 2em; color: var(--primary-blue);">groups</span>
          <h3>142</h3>
          <p>Pacientes Activos</p>
        </div>
        <div class="indicator-card">
          <span class="material-symbols-outlined" style="font-size: 2em; color: var(--primary-blue);">event</span>
          <h3>28</h3>
          <p>Citas Hoy</p>
        </div>
        <div class="indicator-card">
          <span class="material-symbols-outlined" style="font-size: 2em; color: var(--primary-blue);">inventory</span>
          <h3>3</h3>
          <p>Medicamentos Bajo Stock</p>
        </div>
        <div class="indicator-card">
          <span class="material-symbols-outlined" style="font-size: 2em; color: var(--primary-blue);">warning</span>
          <h3>5</h3>
          <p>Alertas Cl√≠nicas</p>
        </div>
      </div>

      <div class="chart-container">
        <h3>Evoluci√≥n de Signos Vitales</h3>
        <canvas id="vitals-chart"></canvas>
        <div class="chart-controls">
          <select id="chart-patient">
            <option value="">Seleccionar paciente...</option>
          </select>
          <select id="chart-type">
            <option value="pressure">Presi√≥n Arterial</option>
            <option value="temperature">Temperatura</option>
            <option value="heart-rate">Frecuencia Card√≠aca</option>
            <option value="spo2">Saturaci√≥n O2</option>
          </select>
          <button id="refresh-chart">Actualizar</button>
        </div>
      </div>
    </section>

    <!-- Pacientes -->
    <section id="pacientes" class="page">
      <div class="page-header">
        <h2><span class="material-symbols-outlined">groups</span>Gesti√≥n de Pacientes</h2>
        <button class="btn btn-primary" onclick="openAddPatientModal()"><span class="material-symbols-outlined">add</span>Nuevo Paciente</button>
      </div>

      <div class="search-filter-bar">
        <input type="text" id="patient-search" placeholder="Buscar paciente por nombre, diagn√≥stico o CIE-10...">
        <select id="specialty-filter">
          <option value="">Filtrar por especialidad...</option>
        </select>
        <button id="advanced-search" class="btn btn-secondary"><span class="material-symbols-outlined">search</span> B√∫squeda Avanzada</button>
      </div>

      <div id="patient-grid" class="patient-grid">
        <!-- Tarjetas de pacientes se cargar√°n aqu√≠ -->
      </div>
    </section>

    <!-- Personal -->
    <section id="personal" class="page">
      <div class="page-header">
        <h2><span class="material-symbols-outlined">people</span>Gesti√≥n de Personal M√©dico</h2>
        <button class="btn btn-primary btn-add-staff" onclick="openAddStaffModal()"><span class="material-symbols-outlined">add</span> Nuevo Miembro</button>
      </div>

      <div class="search-filter-bar">
        <input type="text" id="staff-search" placeholder="Buscar personal por nombre, especialidad o rol...">
        <select id="role-filter">
          <option value="">Filtrar por rol...</option>
        </select>
      </div>

      <div id="staff-grid" class="patient-grid">
        <!-- Tarjetas de personal se cargar√°n aqu√≠ -->
      </div>
    </section>

    <!-- Consultorio Virtual -->
    <section id="consultorio" class="page">
      <div class="page-header">
        <h2><span class="material-symbols-outlined">search</span>Consultorio Virtual</h2>
      </div>

      <div class="consulta-container">
        <div class="patient-selector">
          <label for="active-patient">Paciente Activo:</label>
          <select id="active-patient">
            <option value="">Selecciona un paciente...</option>
          </select>
        </div>

        <div class="search-box">
          <input type="text" id="search-query" placeholder="¬øQu√© desea consultar? (s√≠ntomas, enfermedades, medicamentos, protocolos...)">
          <button id="search-button"><span class="material-symbols-outlined">search</span> Buscar</button>
        </div>
        <div id="suggestions-container" class="suggestions-container"></div>
      </div>

      <div id="search-results" class="search-results">
        <p>Busque informaci√≥n m√©dica relevante utilizando el cuadro de b√∫squeda superior.</p>
        
        <div class="chart-container" style="margin-top: 30px;">
          <h3>Consulta Reciente</h3>
          <p><strong>T√©rmino:</strong> Cefalea intensa, fotofobia, fiebre</p>
          <p><strong>Resultado principal:</strong> Meningitis Bacteriana</p>
          <p><strong>Probabilidad:</strong> 85%</p>
          <div class="result-actions">
            <button class="btn btn-detail" onclick="showDetail('disease', 'urn:snomed:32277002')"><span class="material-symbols-outlined">info</span>Ver Detalles</button>
          </div>
        </div>
      </div>
    </section>

    <!-- Recetas -->
    <section id="recetas" class="page">
      <div class="page-header">
        <h2><span class="material-symbols-outlined">prescriptions</span>Emisi√≥n de Recetas</h2>
      </div>

      <div class="patient-selector">
        <label for="recipe-patient">Paciente:</label>
        <select id="recipe-patient">
          <option value="">Selecciona un paciente...</option>
        </select>
      </div>

      <div class="medication-list">
        <h3>Medicamentos</h3>
        <div id="medication-entries">
          <div class="medication-entry">
            <div class="form-row">
              <div class="form-group flex-grow">
                <label for="medication-1">Medicamento</label>
                <input type="text" id="medication-1" class="form-control medication-name" placeholder="Nombre del medicamento">
              </div>
              <div class="form-group">
                <label for="dose-1">Dosis</label>
                <input type="text" id="dose-1" class="form-control" placeholder="10mg">
              </div>
              <div class="form-group">
                <label for="frequency-1">Frecuencia</label>
                <select id="frequency-1" class="form-control">
                  <option value="once">1 vez al d√≠a</option>
                  <option value="twice">2 veces al d√≠a</option>
                  <option value="thrice">3 veces al d√≠a</option>
                  <option value="four-times">4 veces al d√≠a</option>
                  <option value="as-needed">Seg√∫n necesidad</option>
                </select>
              </div>
              <div class="form-group">
                <label for="duration-1">Duraci√≥n</label>
                <input type="text" id="duration-1" class="form-control" placeholder="7 d√≠as">
              </div>
            </div>
            <div class="form-group">
              <label for="instructions-1">Instrucciones</label>
              <textarea id="instructions-1" class="form-control" rows="2" placeholder="Tomar despu√©s de las comidas..."></textarea>
            </div>
          </div>
        </div>
        <button class="btn btn-secondary" id="add-medication"><span class="material-symbols-outlined">add</span> A√±adir Medicamento</button>
      </div>

      <div class="interactions-warning" id="interactions-warning" style="display: none;">
        <span class="material-symbols-outlined">dangerous</span>
        <div>
          <strong>Interacciones Detectadas:</strong>
          <ul id="interactions-list"></ul>
        </div>
      </div>

      <button class="btn btn-primary" id="issue-prescription">Emitir Receta</button>
    </section>

    <!-- Recursos Educativos -->
    <section id="recursos" class="page">
      <div class="page-header">
        <h2><span class="material-symbols-outlined">school</span>Recursos Educativos</h2>
        <div class="resource-controls">
          <button class="btn btn-primary btn-add-resource" onclick="openAddResourceModal()"><span class="material-symbols-outlined">add</span> Nuevo Recurso</button>
        </div>
      </div>

      <div class="search-filter-bar">
        <input type="text" id="resource-search" placeholder="Buscar recursos por t√≠tulo, etiqueta o contenido...">
        <select id="category-filter">
          <option value="">Filtrar por categor√≠a...</option>
        </select>
      </div>

      <div class="resource-cards" id="resource-cards">
        <!-- Tarjetas de recursos se cargar√°n aqu√≠ -->
      </div>
    </section>

    <!-- Calculadoras M√©dicas -->
    <section id="calculadoras" class="page">
      <div class="page-header">
        <h2><span class="material-symbols-outlined">calculate</span>Calculadoras M√©dicas</h2>
      </div>

      <div class="calculator-container">
        <!-- Calculadora de IMC -->
        <div class="calculator-form">
          <h3>Calculadora de IMC</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="weight-imc">Peso (kg)</label>
              <input type="number" id="weight-imc" step="0.1" placeholder="70">
            </div>
            <div class="form-group">
              <label for="height-imc">Talla (cm)</label>
              <input type="number" id="height-imc" placeholder="170">
            </div>
          </div>
          <button class="btn btn-primary" onclick="calculateIMC()">Calcular</button>
          <div class="result-display" id="imc-result" style="display: none;">
            <h4>Resultado IMC</h4>
            <p id="imc-value">24.2</p>
            <p id="imc-category">Peso normal</p>
          </div>
        </div>

        <!-- Calculadora de Filtrado Glomerular -->
        <div class="calculator-form" id="filtration-calculator">
          <h3>Calculadora de Filtrado Glomerular (CKD-EPI)</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="creatinine">Creatinina s√©rica (mg/dL)</label>
              <input type="number" id="creatinine" step="0.1" placeholder="1.0">
            </div>
            <div class="form-group">
              <label for="age">Edad (a√±os)</label>
              <input type="number" id="age" placeholder="45">
            </div>
          </div>
          <div class="form-group">
            <label>Sexo</label>
            <div class="radio-group">
              <div class="radio-option">
                <input type="radio" id="sex-male" name="sex" value="male">
                <label for="sex-male">Masculino</label>
              </div>
              <div class="radio-option">
                <input type="radio" id="sex-female" name="sex" value="female">
                <label for="sex-female">Femenino</label>
              </div>
            </div>
          </div>
          <button class="btn btn-primary" onclick="calculateFiltration()">Calcular</button>
          <div class="result-display" id="filtration-result" style="display: none;">
            <h4>Filtrado Glomerular</h4>
            <p id="filtration-value">98</p>
            <p id="filtration-category">Normal</p>
          </div>
        </div>

        <!-- Calculadora de Child-Pugh -->
        <div class="calculator-form">
          <h3>Calculadora de Child-Pugh</h3>
          <div class="form-group">
            <label for="bilirrubin">Bilirrubina total (mg/dL)</label>
            <input type="number" id="bilirrubin" step="0.1" placeholder="2.0">
          </div>
          <div class="form-group">
            <label for="albumin">Alb√∫mina (g/dL)</label>
            <input type="number" id="albumin" step="0.1" placeholder="3.5">
          </div>
          <div class="form-group">
            <label for="inr">INR</label>
            <input type="number" id="inr" step="0.1" placeholder="1.2">
          </div>
          <div class="form-group">
            <label for="ascites">Ascitis</label>
            <select id="ascites" class="form-control">
              <option value="0">Ausente</option>
              <option value="1">Leve/Moderada (controlada)</option>
              <option value="2">Refractaria</option>
            </select>
          </div>
          <div class="form-group">
            <label for="encephalopathy">Encefalopat√≠a</label>
            <select id="encephalopathy" class="form-control">
              <option value="0">Ausente</option>
              <option value="1">Grado I-II (leve)</option>
              <option value="2">Grado III-IV (moderada/severa)</option>
            </select>
          </div>
          <button class="btn btn-primary" onclick="calculateChildPugh()">Calcular</button>
          <div class="result-display" id="child-pugh-result" style="display: none;">
            <h4>Puntuaci√≥n Child-Pugh</h4>
            <p id="child-pugh-score">7</p>
            <p id="child-pugh-class">Clase B</p>
          </div>
        </div>

        <!-- Calculadora de Riesgo Cardiovascular (SCORE) -->
        <div class="calculator-form">
          <h3>Calculadora de Riesgo Cardiovascular (SCORE)</h3>
          <div class="form-row">
            <div class="form-group">
              <label for="age-score">Edad (a√±os)</label>
              <input type="number" id="age-score" placeholder="55">
            </div>
            <div class="form-group">
              <label for="total-cholesterol">Colesterol total (mg/dL)</label>
              <input type="number" id="total-cholesterol" placeholder="220">
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label for="hdl-cholesterol">HDL Colesterol (mg/dL)</label>
              <input type="number" id="hdl-cholesterol" placeholder="50">
            </div>
            <div class="form-group">
              <label for="systolic-pressure">Presi√≥n sist√≥lica (mmHg)</label>
              <input type="number" id="systolic-pressure" placeholder="140">
            </div>
          </div>
          <div class="form-group">
            <label>Factores</label>
            <div class="radio-group">
              <div class="radio-option">
                <input type="checkbox" id="smoker">
                <label for="smoker">Fumador</label>
              </div>
              <div class="radio-option">
                <input type="checkbox" id="diabetes">
                <label for="diabetes">Diabetes</label>
              </div>
            </div>
          </div>
          <button class="btn btn-primary" onclick="calculateSCORE()">Calcular</button>
          <div class="result-display" id="score-result" style="display: none;">
            <h4>Riesgo Cardiovascular</h4>
            <p id="score-value">8.5%</p>
            <p id="score-category">Riesgo Moderado</p>
          </div>
        </div>
      </div>
    </section>
  </main>

  <!-- Modal de b√∫squeda de pacientes -->
  <div id="modal-overlay" class="modal-overlay">
    <div class="modal">
      <div class="modal-header">
        <h2><span class="material-symbols-outlined">info</span> <span id="modal-title">Detalles</span></h2>
        <button class="modal-close-btn" onclick="closeModal()">&times;</button>
      </div>
      <div class="modal-body" id="modal-body-content">
        <!-- Contenido del modal -->
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal()">Cerrar</button>
      </div>
    </div>
  </div>

  <!-- Contenedor de notificaciones -->
  <div class="notification-container" id="notification-container">
    <!-- Las notificaciones se agregar√°n aqu√≠ din√°micamente -->
  </div>

  <script>
    // Base de datos simulada
    const DATA_STORE = {
      patients: [
        {
          id: 1,
          nombre: "Mar√≠a L√≥pez",
          edad: 45,
          diagnosticoPrincipal: "Meningitis Bacteriana",
          especialidad: "Neurolog√≠a",
          riesgoCardiovascular: "alto",
          alergias: ["Penicilina"],
          historiaClinica: {
            resumen: "Paciente femenina de 45 a√±os con meningitis bacteriana aguda.",
            diagnosticos: [
              { fecha: "2025-04-10", cie10: "G00.9", descripcion: "Meningitis Bacteriana", estado: "Activo" },
              { fecha: "2024-03-15", cie10: "E11.9", descripcion: "Diabetes Mellitus Tipo 2", estado: "Cr√≥nico" }
            ],
            tratamientos: [
              { fechaInicio: "2025-04-10", medicamento: "Ceftriaxona", dosis: "2g IV cada 12h", duracion: "14 d√≠as" },
              { fechaInicio: "2025-04-10", medicamento: "Dexametasona", dosis: "10mg IV cada 6h", duracion: "4 d√≠as" }
            ],
            evolucion: [
              { fecha: "2025-04-10", nota: "Ingreso con cefalea intensa, fiebre y rigidez de nuca. Sospecha de meningitis." },
              { fecha: "2025-04-11", nota: "Punci√≥n lumbar realizada. LCR turbio, neutr√≥filos elevados. Iniciado tratamiento emp√≠rico." }
            ],
            signosVitales: [
              { fecha: "2025-04-10", temperatura: 39.2, pa: "150/95", fc: 110, fr: 22, spo2: 94 },
              { fecha: "2025-04-11", temperatura: 38.1, pa: "140/85", fc: 95, fr: 18, spo2: 96 }
            ],
            laboratorio: [],
            seguimiento: [
              { tipo: "Control de LCR", cada: "7 d√≠as", proximo: "2025-04-17" },
              { tipo: "Hemograma", cada: "3 d√≠as", proximo: "2025-04-14" }
            ]
          }
        },
        {
          id: 2,
          nombre: "Carlos Mart√≠nez",
          edad: 38,
          diagnosticoPrincipal: "Diabetes Mellitus Tipo 2",
          especialidad: "Endocrinolog√≠a",
          riesgoCardiovascular: "moderado",
          alergias: [],
          historiaClinica: {
            resumen: "Paciente masculino de 38 a√±os con DM2 diagnosticado hace 5 a√±os.",
            diagnosticos: [
              { fecha: "2020-05-10", cie10: "E11.9", descripcion: "Diabetes Mellitus Tipo 2", estado: "Cr√≥nico" },
              { fecha: "2022-11-03", cie10: "I25.10", descripcion: "Enfermedad Arterial Coronaria", estado: "Cr√≥nico" }
            ],
            tratamientos: [
              { fechaInicio: "2020-05-10", medicamento: "Metformina", dosis: "1000mg cada 12h", duracion: "Continuo" },
              { fechaInicio: "2022-11-03", medicamento: "Aspirina", dosis: "100mg cada 24h", duracion: "Continuo" },
              { fechaInicio: "2023-02-15", medicamento: "Glibenclamida", dosis: "5mg cada 24h", duracion: "Continuo" }
            ],
            evolucion: [
              { fecha: "2020-05-10", nota: "Diagn√≥stico de DM2. Iniciado tratamiento con Metformina." },
              { fecha: "2023-02-15", nota: "HbA1c 8.5%. Se agrega Glibenclamida." },
              { fecha: "2023-08-20", nota: "Angioplastia coronaria por angina inestable. Iniciado tratamiento con Aspirina." }
            ],
            signosVitales: [
              { fecha: "2023-02-10", temperatura: 36.6, pa: "140/90", fc: 78, fr: 16, spo2: 97, peso: 85, talla: 1.75, imc: 27.8 },
              { fecha: "2023-05-15", temperatura: 36.5, pa: "135/85", fc: 76, fr: 15, spo2: 98, peso: 83, talla: 1.75, imc: 27.1 },
              { fecha: "2023-08-15", temperatura: 36.7, pa: "130/80", fc: 74, fr: 15, spo2: 99, peso: 82, talla: 1.75, imc: 26.8 }
            ],
            laboratorio: [
              { fecha: "2023-02-10", test: "HbA1c", resultado: "8.5%", normal: "4.0-5.6%" },
              { fecha: "2023-05-15", test: "HbA1c", resultado: "7.8%", normal: "4.0-5.6%" },
              { fecha: "2023-08-15", test: "HbA1c", resultado: "7.2%", normal: "4.0-5.6%" }
            ],
            seguimiento: [
              { tipo: "HbA1c", cada: "3 meses", proximo: "2025-07-15" },
              { tipo: "Perfil Lip√≠dico", cada: "6 meses", proximo: "2025-10-20" }
            ]
          }
        },
        {
          id: 3,
          nombre: "Ana Garc√≠a",
          edad: 52,
          diagnosticoPrincipal: "VIH",
          especialidad: "Infectolog√≠a",
          riesgoCardiovascular: "moderado",
          alergias: ["Sulfa"],
          historiaClinica: {
            resumen: "Paciente femenina de 52 a√±os con VIH diagnosticado hace 10 a√±os.",
            diagnosticos: [
              { fecha: "2013-06-15", cie10: "B20", descripcion: "VIH", estado: "Cr√≥nico" },
              { fecha: "2020-01-10", cie10: "Z79.2", descripcion: "Terapia antirretroviral a largo plazo", estado: "Activo" }
            ],
            tratamientos: [
              { fechaInicio: "2013-06-15", medicamento: "Tenofovir/Emtricitabina", dosis: "1 tableta cada 24h", duracion: "Continuo" },
              { fechaInicio: "2013-06-15", medicamento: "Dolutegravir", dosis: "50mg cada 24h", duracion: "Continuo" }
            ],
            evolucion: [
              { fecha: "2013-06-15", nota: "Diagn√≥stico de VIH. Iniciado tratamiento antirretroviral." },
              { fecha: "2020-01-10", nota: "Control viral indetectable desde hace 5 a√±os." },
              { fecha: "2023-03-15", nota: "Carga viral indetectable. CD4 650 c√©lulas/mm¬≥." }
            ],
            signosVitales: [
              { fecha: "2023-01-10", temperatura: 36.8, pa: "115/75", fc: 72, fr: 14, spo2: 98, peso: 62, talla: 1.60, imc: 24.2 },
              { fecha: "2023-04-05", temperatura: 36.7, pa: "118/78", fc: 70, fr: 14, spo2: 99, peso: 63, talla: 1.60, imc: 24.6 },
              { fecha: "2023-07-12", temperatura: 36.6, pa: "116/76", fc: 71, fr: 14, spo2: 98, peso: 62, talla: 1.60, imc: 24.2 }
            ],
            laboratorio: [
              { fecha: "2023-01-10", test: "Carga Viral VIH", resultado: "Indetectable", normal: "<20 copias/mL" },
              { fecha: "2023-01-10", test: "CD4", resultado: "650 c√©lulas/mm¬≥", normal: ">500 c√©lulas/mm¬≥" },
              { fecha: "2023-07-12", test: "Carga Viral VIH", resultado: "Indetectable", normal: "<20 copias/mL" }
            ],
            seguimiento: [
              { tipo: "Carga Viral", cada: "6 meses", proximo: "2025-07-15" },
              { tipo: "Perfil Inmunol√≥gico", cada: "6 meses", proximo: "2025-07-15" }
            ]
          }
        },
        {
          id: 4,
          nombre: "Roberto S√°nchez",
          edad: 67,
          diagnosticoPrincipal: "Insuficiencia Card√≠aca",
          especialidad: "Cardiolog√≠a",
          riesgoCardiovascular: "alto",
          alergias: ["Ioduro"],
          historiaClinica: {
            resumen: "Paciente masculino de 67 a√±os con IC por miocardiopat√≠a isqu√©mica.",
            diagnosticos: [
              { fecha: "2020-01-15", cie10: "I50.9", descripcion: "Insuficiencia Card√≠aca", estado: "Cr√≥nico" },
              { fecha: "2018-06-20", cie10: "I25.10", descripcion: "Enfermedad Arterial Coronaria", estado: "Cr√≥nico" }
            ],
            tratamientos: [
              { fechaInicio: "2020-01-15", medicamento: "Furosemida", dosis: "40mg cada 24h", duracion: "Continuo" },
              { fechaInicio: "2020-01-15", medicamento: "Carvedilol", dosis: "25mg cada 12h", duracion: "Continuo" },
              { fechaInicio: "2020-01-15", medicamento: "Losart√°n", dosis: "50mg cada 24h", duracion: "Continuo" },
              { fechaInicio: "2020-01-15", medicamento: "Digoxina", dosis: "0.125mg cada 24h", duracion: "Continuo" }
            ],
            evolucion: [
              { fecha: "2020-01-15", nota: "Diagn√≥stico de IC por miocardiopat√≠a isqu√©mica. Clase funcional III NYHA." },
              { fecha: "2021-06-18", nota: "Optimizado tratamiento. Clase funcional II NYHA." },
              { fecha: "2023-03-22", nota: "Estable con tratamiento actual. Control de peso y PA adecuado." }
            ],
            signosVitales: [
              { fecha: "2023-02-08", temperatura: 36.5, pa: "125/80", fc: 68, fr: 16, spo2: 96, peso: 78, talla: 1.72, imc: 26.4 },
              { fecha: "2023-05-11", temperatura: 36.6, pa: "122/78", fc: 66, fr: 15, spo2: 97, peso: 77, talla: 1.72, imc: 26.0 },
              { fecha: "2023-08-15", temperatura: 36.4, pa: "120/75", fc: 65, fr: 15, spo2: 98, peso: 77, talla: 1.72, imc: 26.0 }
            ],
            laboratorio: [
              { fecha: "2023-02-08", test: "BNP", resultado: "850 pg/mL", normal: "<100 pg/mL" },
              { fecha: "2023-05-11", test: "BNP", resultado: "620 pg/mL", normal: "<100 pg/mL" },
              { fecha: "2023-08-15", test: "BNP", resultado: "580 pg/mL", normal: "<100 pg/mL" }
            ],
            seguimiento: [
              { tipo: "Control de peso", cada: "semanal", proximo: "2025-04-19" },
              { tipo: "Ecocardiograma", cada: "12 meses", proximo: "2026-03-15" }
            ]
          }
        }
      ],
      staff: [
        { id: 1, nombre: "Juan P√©rez", especialidad: "Cardiolog√≠a", rol: "M√©dico", telefono: "555-1234", email: "juan.perez@saludpro.com", bio: "M√©dico cardi√≥logo con m√°s de 15 a√±os de experiencia en manejo de insuficiencia card√≠aca y enfermedad coronaria." },
        { id: 2, nombre: "Ana Mart√≠nez", especialidad: "Enfermer√≠a", rol: "Enfermera", telefono: "555-5678", email: "ana.martinez@saludpro.com", bio: "Enfermera especializada en cuidados intensivos con enfoque en educaci√≥n del paciente." },
        { id: 3, nombre: "Carlos G√≥mez", especialidad: "Administraci√≥n", rol: "Administrador", telefono: "555-9012", email: "carlos.gomez@saludpro.com", bio: "Administrador de cl√≠nica con experiencia en gesti√≥n de recursos y optimizaci√≥n de procesos." },
        { id: 4, nombre: "Luc√≠a Fern√°ndez", especialidad: "Pediatr√≠a", rol: "M√©dico", telefono: "555-3456", email: "lucia.fernandez@saludpro.com", bio: "Pediatra especializada en neurolog√≠a pedi√°trica y desarrollo infantil." }
      ],
      resources: [
        {
          id: 1,
          titulo: "Gu√≠a de Pr√°ctica Cl√≠nica: Manejo de Diabetes Tipo 2",
          categoria: "Protocolos",
          tipo: "documento",
          url: "https://example.com/diabetes-guide.pdf",
          etiquetas: ["diabetes", "endocrinolog√≠a", "protocolo"],
          descripcion: "Gu√≠a completa para el manejo de diabetes mellitus tipo 2 seg√∫n las √∫ltimas recomendaciones de la ADA."
        },
        {
          id: 2,
          titulo: "T√©cnica de Punci√≥n Lumbar",
          categoria: "Procedimientos",
          tipo: "video",
          url: "https://example.com/lumbar-puncture.mp4",
          etiquetas: ["neurolog√≠a", "procedimiento", "punci√≥n lumbar"],
          descripcion: "Video tutorial paso a paso sobre la t√©cnica correcta de punci√≥n lumbar."
        },
        {
          id: 3,
          titulo: "Imagenes de Resonancia Magn√©tica en Esclerosis M√∫ltiple",
          categoria: "Im√°genes",
          tipo: "imagen",
          url: "https://placehold.co/600x400/1a73e8/ffffff?text=RM+Esclerosis+M√∫ltiple",
          etiquetas: ["neurolog√≠a", "imagenolog√≠a", "esclerosis m√∫ltiple"],
          descripcion: "Colecci√≥n de im√°genes de resonancia magn√©tica mostrando lesiones desmielinizantes en pacientes con esclerosis m√∫ltiple."
        },
        {
          id: 4,
          titulo: "Farmacocin√©tica de Medicamentos en Insuficiencia Renal",
          categoria: "Educaci√≥n",
          tipo: "documento",
          url: "https://example.com/renal-pharmacokinetics.pdf",
          etiquetas: ["farmacolog√≠a", "nefrolog√≠a", "ajuste de dosis"],
          descripcion: "Documento detallado sobre c√≥mo ajustar las dosis de medicamentos en pacientes con disfunci√≥n renal."
        }
      ],
      appointments: [
        { id: "app-001", pacienteId: 1, fecha: "2025-04-12", hora: "10:00", motivo: "Consulta de seguimiento", estado: "confirmada", medico: "Dr. P√©rez" },
        { id: "app-002", pacienteId: 2, fecha: "2025-04-12", hora: "14:00", motivo: "Control de glucemia", estado: "pendiente", medico: "Dr. G√≥mez" },
        { id: "app-003", pacienteId: 3, fecha: "2025-04-12", hora: "11:00", motivo: "Evaluaci√≥n cardiol√≥gica", estado: "confirmada", medico: "Dr. Fern√°ndez" }
      ],
      pharmacyStock: [
        { id: "med-001", nombre: "Metformina", laboratorio: "Gen√©rico", cantidad: 120, umbral: 50 },
        { id: "med-002", nombre: "Losart√°n", laboratorio: "MSD", cantidad: 30, umbral: 50 },
        { id: "med-003", nombre: "Aspirina", laboratorio: "Bayer", cantidad: 8, umbral: 20 },
        { id: "med-004", nombre: "Ceftriaxona", laboratorio: "Roche", cantidad: 50, umbral: 10 },
        { id: "med-005", nombre: "Dexametasona", laboratorio: "Merck", cantidad: 100, umbral: 25 }
      ]
    };

    // Base de conocimiento m√©dico
    const medicalKnowledgeBase = {
      diseases: [
        {
          id: "urn:snomed:74400008",
          nombre: "Esclerosis M√∫ltiple",
          codigoCIE10: "G35",
          etiologia: "Enfermedad autoinmune donde el sistema inmunol√≥gico ataca la mielina, la cubierta protectora de los nervios, en el sistema nervioso central.",
          fisiopatologia: "La inflamaci√≥n autoinmune conduce a la desmielinizaci√≥n de las fibras nerviosas, lo que interrumpe la transmisi√≥n de se√±ales nerviosas entre el cerebro y otras partes del cuerpo.",
          prevalencia: 0.0003,
          factoresRiesgo: ["edad: 20-50", "g√©nero: F > M", "antecedentes familiares", "deficiencia de vitamina D"],
          diagnostico: "Basado en criterios de McDonald, que requieren evidencia de lesiones en diferentes partes del sistema nervioso central (diseminaci√≥n en el espacio) y en diferentes momentos (diseminaci√≥n en el tiempo), generalmente confirmadas por resonancia magn√©tica (RM) y estudios del l√≠quido cefalorraqu√≠deo.",
          diagnosticosDiferenciales: ["Neuromielitis √≥ptica", "S√≠ndrome de Guillain-Barr√©", "Enfermedad de Lyme", "Tumores del sistema nervioso central", "Deficiencia de vitamina B12"],
          clasificacion: "Forma recurrente-remitente (RRMS), progresiva primaria (PPMS), progresiva secundaria (SPMS), progresiva activa, progresiva no activa.",
          tratamientos: ["Interfer√≥n beta (reduce la frecuencia de brotes)", "Glatiramer acetato", "Terapias de c√©lulas B (Ocrelizumab)", "Inmunosupresores (Mitoxantrona)", "Terapias para s√≠ntomas espec√≠ficos (fatiga, espasmos, depresi√≥n)"],
          protocolos: ["Gu√≠a de pr√°ctica cl√≠nica de la Asociaci√≥n Americana de Esclerosis M√∫ltiple"],
          pronostico: "Variable. La mayor√≠a de los pacientes tienen una esperanza de vida cercana a la normal, pero con discapacidad progresiva. El curso depende del tipo y de la respuesta al tratamiento.",
          educacionPaciente: "La esclerosis m√∫ltiple es una condici√≥n cr√≥nica del sistema nervioso. Aunque no tiene cura, hay tratamientos que pueden ralentizar su progreso y manejar los s√≠ntomas.",
          recursosAdicionales: ["https://www.nationalmssociety.org/", "https://www.msif.org/"],
          imagenes: [
            { url: "https://placehold.co/600x400/1a73e8/ffffff?text=RM+Esclerosis+M√∫ltiple", descripcion: "Lesiones desmielinizantes en la resonancia magn√©tica cerebral" },
            { url: "https://placehold.co/600x400/34a853/ffffff?text=Marcha+en+EM", descripcion: "Paciente con esclerosis m√∫ltiple mostrando dificultad de marcha" }
          ]
        },
        {
          id: "urn:snomed:32277002",
          nombre: "Meningitis Bacteriana",
          codigoCIE10: "G00.9",
          etiologia: "Infecci√≥n bacteriana del sistema nervioso central, com√∫nmente causada por Streptococcus pneumoniae, Neisseria meningitidis o Haemophilus influenzae tipo b.",
          fisiopatologia: "Las bacterias ingresan al sistema nervioso central, provocando inflamaci√≥n de las meninges (membranas que rodean el cerebro y la m√©dula espinal), lo que aumenta la presi√≥n intracraneal y puede da√±ar el tejido cerebral.",
          prevalencia: 0.00001,
          factoresRiesgo: ["edad: ni√±os, ancianos", "inmunosupresi√≥n", "trauma craneal", "otitis media", "sinusitis"],
          presentacionClinica: ["Cefalea intensa", "Fotofobia (sensibilidad a la luz)", "Fiebre alta", "Rigidez de nuca", "N√°useas y v√≥mites", "Confusi√≥n mental", "Convulsiones"],
          diagnostico: "Diagn√≥stico definitivo mediante punci√≥n lumbar y an√°lisis del l√≠quido cefalorraqu√≠deo (LCR): elevaci√≥n de c√©lulas (predominio de neutr√≥filos), prote√≠nas elevadas, glucosa baja. Cultivo del LCR para identificar el pat√≥geno.",
          diagnosticosDiferenciales: ["Meningitis viral", "Encefalitis", "Absceso cerebral", "Hemorragia subaracnoidea", "Sepsis"],
          clasificacion: "Aguda (progresi√≥n r√°pida) o subaguda (progresi√≥n m√°s lenta).",
          tratamientos: ["Ceftriaxona 2g IV cada 12h", "Vancomicina 15mg/kg IV cada 12h", "Dexametasona 10mg IV cada 6h", "Soporte vital"],
          protocolos: ["Gu√≠a IDSA para meningitis bacteriana", "Protocolo de manejo de meningitis en adultos"],
          pronostico: "Grave. Mortalidad del 10-30% incluso con tratamiento. Secuelas neurol√≥gicas en 20-50% de los sobrevivientes.",
          educacionPaciente: "La meningitis bacteriana es una emergencia m√©dica grave. Requiere hospitalizaci√≥n inmediata y tratamiento con antibi√≥ticos intravenosos.",
          recursosAdicionales: ["https://www.cdc.gov/meningitis/index.html"],
          imagenes: [
            { url: "https://placehold.co/600x400/ea4335/ffffff?text=RM+Meningitis", descripcion: "Resonancia magn√©tica cerebral en meningitis" },
            { url: "https://placehold.co/600x400/f9ab00/ffffff?text=Punci√≥n+Lumbar", descripcion: "Procedimiento de punci√≥n lumbar" }
          ]
        },
        {
          id: "urn:snomed:44054006",
          nombre: "Diabetes Mellitus Tipo 2",
          codigoCIE10: "E11.9",
          etiologia: "Resistencia a la insulina combinada con una deficiencia relativa de insulina. Factores de riesgo: obesidad, sedentarismo, antecedentes familiares, edad avanzada.",
          fisiopatologia: "Las c√©lulas del cuerpo no responden adecuadamente a la insulina (resistencia), lo que lleva a una producci√≥n inadecuada de insulina por parte del p√°ncreas, resultando en hiperglucemia cr√≥nica.",
          prevalencia: 0.1,
          factoresRiesgo: ["obesidad", "sedentarismo", "antecedentes familiares", "edad > 45", "hipertensi√≥n", "dislipidemia"],
          presentacionClinica: ["Poliuria", "Polidipsia", "Polidipsia", "P√©rdida de peso inexplicada", "Fatiga", "Visi√≥n borrosa", "Infecciones recurrentes"],
          diagnostico: "Diagn√≥stico basado en niveles de glucosa: ayunas ‚â•126 mg/dL, HbA1c ‚â•6.5%, o glucosa al azar ‚â•200 mg/dL con s√≠ntomas.",
          diagnosticosDiferenciales: ["Diabetes Mellitus Tipo 1", "Diabetes secundaria", "S√≠ndrome de Cushing", "Feocromocitoma"],
          clasificacion: "Por gravedad del control gluc√©mico, presencia de complicaciones micro/macrovasculares.",
          tratamientos: ["Modificaci√≥n del estilo de vida (dieta, ejercicio)", "Metformina (primera l√≠nea)", "Sulfonilureas", "Inhibidores de DPP-4", "An√°logos del GLP-1", "Insulina (en etapas avanzadas)"],
          protocolos: ["Gu√≠as de la Asociaci√≥n Americana de Diabetes (ADA)"],
          pronostico: "Cr√≥nica progresiva. Buen control gluc√©mico reduce significativamente el riesgo de complicaciones como nefropat√≠a, retinopat√≠a, neuropat√≠a y enfermedad cardiovascular.",
          educacionPaciente: "La diabetes tipo 2 se puede manejar con dieta, ejercicio y medicamentos. Es crucial controlar la glucosa para prevenir complicaciones.",
          recursosAdicionales: ["https://www.diabetes.org/"],
          imagenes: [
            { url: "https://placehold.co/600x400/34a853/ffffff?text=Glucosa+en+Sangre", descripcion: "Monitoreo de glucosa en sangre" },
            { url: "https://placehold.co/600x400/1a73e8/ffffff?text=Complicaciones+Diabetes", descripcion: "Complicaciones cr√≥nicas de la diabetes" }
          ]
        },
        {
          id: "urn:snomed:59621000",
          nombre: "Enfermedad de Parkinson",
          codigoCIE10: "G20",
          etiologia: "Trastorno neurodegenerativo caracterizado por la p√©rdida progresiva de neuronas dopamin√©rgicas en la sustancia negra del mesenc√©falo.",
          fisiopatologia: "La deficiencia de dopamina en los ganglios basales interrumpe los circuitos motores, llevando a los s√≠ntomas motores caracter√≠sticos.",
          prevalencia: 0.003,
          factoresRiesgo: ["edad > 60", "g√©nero: M > F", "antecedentes familiares", "exposici√≥n a pesticidas"],
          presentacionClinica: ["Temblor de reposo (mano, pierna, mand√≠bula)", "Bradicinesia (lentitud de movimientos)", "Rigidez muscular", "Postura encorvada", "Problemas de equilibrio y marcha (falta de balanceo de brazos, arrastre de pies)", "Alteraciones del habla y escritura"],
          diagnostico: "Diagn√≥stico cl√≠nico basado en la historia y el examen f√≠sico. No hay una prueba definitiva. Criterios de diagn√≥stico de la UK Parkinson's Disease Society Brain Bank.",
          diagnosticosDiferenciales: ["Parkinsonismo secundario (por medicamentos, traumatismo)", "Par√°lisis supranuclear progresiva", "Atrofia multisist√©mica", "Temblor esencial"],
          clasificacion: "Por etapa (escala de Hoehn y Yahr), por tipo de presentaci√≥n (temblor-dominante, akin√©tico-r√≠gido).",
          tratamientos: ["Levodopa/Carbidopa (tratamiento m√°s eficaz)", "Agonistas dopamin√©rgicos (Pramipexol, Ropinirol)", "Inhibidores de la COMT (Entacapona)", "Inhibidores de la MAO-B (Selegilina)", "Terapia con ejercicio y rehabilitaci√≥n"],
          protocolos: ["Gu√≠as de pr√°ctica cl√≠nica para el manejo del Parkinson"],
          pronostico: "Progresivo. No curable, pero los tratamientos pueden controlar los s√≠ntomas durante muchos a√±os. La esperanza de vida puede reducirse ligeramente.",
          educacionPaciente: "El Parkinson es una enfermedad neurodegenerativa que afecta el movimiento. Aunque no tiene cura, hay tratamientos que pueden mejorar significativamente la calidad de vida.",
          recursosAdicionales: ["https://www.parkinson.org/"],
          imagenes: [
            { url: "https://placehold.co/600x400/ea4335/ffffff?text=RM+Parkinson", descripcion: "Resonancia magn√©tica cerebral en Parkinson" },
            { url: "https://placehold.co/600x400/f9ab00/ffffff?text=Marcha+Parkinson", descripcion: "Caracter√≠stica marcha en pacientes con Parkinson" }
          ]
        }
      ],
      medicalTests: [
        {
          id: "urn:loinc:15056-0",
          nombre: "Hemoglobina",
          indicaciones: ["Anemia", "P√©rdida de sangre", "Evaluaci√≥n general de salud"],
          interpretacion: "Valores normales: Hombres 13.8-17.2 g/dL, Mujeres 12.1-15.1 g/dL. Valores bajos indican anemia, valores altos pueden indicar policitemia."
        },
        {
          id: "urn:loinc:2075-0",
          nombre: "Creatinina",
          indicaciones: ["Evaluaci√≥n de funci√≥n renal", "Monitorizaci√≥n en pacientes con enfermedad renal cr√≥nica", "Antes de estudios con contraste"],
          interpretacion: "Valores normales: 0.7-1.3 mg/dL. Valores elevados indican disminuci√≥n de la funci√≥n renal glomerular."
        },
        {
          id: "urn:loinc:17855-8",
          nombre: "HbA1c",
          indicaciones: ["Diagn√≥stico de diabetes", "Monitorizaci√≥n del control gluc√©mico a largo plazo"],
          interpretacion: "Valores normales: <5.7%. Prediabetes: 5.7-6.4%. Diabetes: ‚â•6.5%. Refleja el promedio de glucosa en sangre en los √∫ltimos 2-3 meses."
        },
        {
          id: "urn:loinc:2885-2",
          nombre: "Perfil Lip√≠dico",
          indicaciones: ["Evaluaci√≥n de riesgo cardiovascular", "Monitorizaci√≥n en pacientes con dislipidemia"],
          interpretacion: "Incluye colesterol total, LDL, HDL y triglic√©ridos. LDL <100 mg/dL √≥ptimo, HDL >40 mg/dL (H), >50 mg/dL (M), triglic√©ridos <150 mg/dL."
        },
        {
          id: "urn:loinc:1988-5",
          nombre: "PCR (Prote√≠na C Reactiva)",
          indicaciones: ["Evaluaci√≥n de inflamaci√≥n", "Monitorizaci√≥n en enfermedades autoinmunes", "Riesgo cardiovascular"],
          interpretacion: "Valores normales: <10 mg/L. Valores elevados indican inflamaci√≥n sist√©mica. Valores >3 mg/L indican riesgo cardiovascular aumentado."
        },
        {
          id: "urn:loinc:94545-4",
          nombre: "BNP (P√©ptido Natriur√©tico B", 
          indicaciones: ["Evaluaci√≥n de insuficiencia card√≠aca", "Diferenciaci√≥n de disnea por IC vs. causa pulmonar"],
          interpretacion: "Valores normales: <100 pg/mL. Valores >400 pg/mL sugieren IC. Valores entre 100-400 pg/mL requieren evaluaci√≥n cl√≠nica adicional."
        },
        {
          id: "urn:loinc:24357-5",
          nombre: "Punci√≥n Lumbar",
          indicaciones: ["Diagn√≥stico de meningitis", "Diagn√≥stico de hemorragia subaracnoidea", "Medici√≥n de presi√≥n del LCR", "Administraci√≥n de medicamentos (quimioterapia, anestesia espinal)"],
          contraindicaciones: ["Infecci√≥n en el sitio de punci√≥n", "Trastornos de coagulaci√≥n no corregidos", "Presi√≥n intracraneal muy elevada (riesgo de herniaci√≥n)"],
          riesgos: ["Dolor de cabeza post-punci√≥n", "Infecci√≥n", "Hemorragia", "Da√±o nervioso"],
          interpretacion: "El LCR normal es claro e incoloro. En meningitis bacteriana: turbio, elevaci√≥n de c√©lulas (neutr√≥filos), prote√≠nas elevadas, glucosa baja. En meningitis viral: l√≠quido claro, linfocitos elevados, prote√≠nas levemente elevadas, glucosa normal."
        },
        {
          id: "urn:loinc:18728-5",
          nombre: "Resonancia Magn√©tica (RM) Cerebral",
          indicaciones: ["Evaluaci√≥n de tumores", "Diagn√≥stico de esclerosis m√∫ltiple", "Evaluaci√≥n de accidente cerebrovascular", "Investigaci√≥n de epilepsia", "Evaluaci√≥n de trauma craneal"],
          interpretacion: "Permite visualizar con gran detalle el tejido cerebral. Las lesiones desmielinizantes en EM aparecen como hiperintensidades en secuencias T2/FLAIR. Los tumores pueden realzarse con contraste."
        }
      ],
      treatments: {
        "Metformina": {
          nombre: "Metformina",
          laboratorio: "Gen√©rico",
          indicaciones: ["Diabetes Mellitus Tipo 2", "S√≠ndrome de ovario poliqu√≠stico"],
          mecanismoAccion: "Disminuye la producci√≥n de glucosa por el h√≠gado (gluconeog√©nesis) y mejora la sensibilidad a la insulina en los m√∫sculos.",
          farmacocinetica: "Biodisponibilidad del 50-60%. No se metaboliza. Se excreta inalterada por los ri√±ones.",
          efectosAdversos: ["Hipoglucemia", "N√°useas", "Malestar gastrointestinal"],
          contraindicaciones: ["Insuficiencia renal (TFG <30 ml/min)", "Acidosis metab√≥lica", "Alcoholismo cr√≥nico"],
          interacciones: {
            "Contraste yodado": { severidad: "moderada", descripcion: "Aumenta el riesgo de acidosis l√°ctica." },
            "Alcohol": { severidad: "moderada", descripcion: "Aumenta el riesgo de acidosis l√°ctica." },
            "Cimetidina": { severidad: "leve", descripcion: "Puede aumentar los niveles plasm√°ticos de metformina." }
          }
        },
        "Losart√°n": {
          nombre: "Losart√°n",
          laboratorio: "MSD",
          indicaciones: ["Hipertensi√≥n arterial", "Nefropat√≠a diab√©tica", "Insuficiencia card√≠aca"],
          mecanismoAccion: "Antagonista del receptor de angiotensina II (AT1), bloquea los efectos de la angiotensina II, causando vasodilataci√≥n y disminuci√≥n de la retenci√≥n de sodio.",
          farmacocinetica: "Biodisponibilidad del 33%. Se metaboliza a un metabolito activo. Eliminaci√≥n biliar y renal.",
          efectosAdversos: ["Hipotensi√≥n", "Hiperkalemia", "Tos", "Dolor de espalda"],
          contraindicaciones: ["Embarazo", "Hipersensibilidad", "Estenosis de arteria renal bilateral"],
          interacciones: {
            "Potasio": { severidad: "moderada", descripcion: "Aumenta el riesgo de hiperkalemia." },
            "AINEs": { severidad: "moderada", descripcion: "Pueden reducir el efecto antihipertensivo y aumentar el riesgo de nefrotoxicidad." },
            "Litio": { severidad: "moderada", descripcion: "Puede aumentar los niveles s√©ricos de litio." }
          }
        },
        "Aspirina": {
          nombre: "Aspirina",
          laboratorio: "Bayer",
          indicaciones: ["Analgesia", "Antipir√©tico", "Antiinflamatorio", "Antiagregante plaquetario (prevenci√≥n de eventos cardiovasculares)"],
          mecanismoAccion: "Inhibidor irreversible de la ciclooxigenasa (COX-1 y COX-2), reduciendo la producci√≥n de prostaglandinas y tromboxano A2.",
          farmacocinetica: "Absorci√≥n r√°pida en el est√≥mago e intestino delgado. Metabolismo hep√°tico. Excreci√≥n renal.",
          efectosAdversos: ["Irritaci√≥n g√°strica", "Sangrado gastrointestinal", "√ölcera p√©ptica", "S√≠ndrome de Reye (en ni√±os)"],
          contraindicaciones: ["Hemorragia activa", "√ölcera p√©ptica activa", "Hipersensibilidad a AINEs", "Asma inducida por AINEs"],
          interacciones: {
            "Warfarina": { severidad: "fatal", descripcion: "Riesgo muy alto de hemorragia grave." },
            "Tolbutamida": { severidad: "moderada", descripcion: "Puede aumentar el riesgo de hipoglucemia." },
            "Metotrexato": { severidad: "moderada", descripcion: "Puede aumentar los niveles s√©ricos y toxicidad del metotrexato." }
          }
        },
        "Glibenclamida": {
          nombre: "Glibenclamida",
          laboratorio: "Gen√©rico",
          indicaciones: ["Diabetes Mellitus Tipo 2"],
          mecanismoAccion: "Secretagogo de insulina. Estimula la liberaci√≥n de insulina por las c√©lulas beta del p√°ncreas.",
          farmacocinetica: "Absorci√≥n completa. Metabolismo hep√°tico extenso. Excreci√≥n renal y biliar.",
          efectosAdversos: ["Hipoglucemia", "Aumento de peso", "Reacciones cut√°neas"],
          contraindicaciones: ["Diabetes Mellitus Tipo 1", "Cetoacidosis diab√©tica", "Insuficiencia hep√°tica grave"],
          interacciones: {
            "Metformina": { severidad: "moderada", descripcion: "Aumenta el riesgo de hipoglucemia." },
            "AINEs": { severidad: "moderada", descripcion: "Pueden potenciar el efecto hipoglucemiante." },
            "Corticosteroides": { severidad: "moderada", descripcion: "Pueden antagonizar el efecto hipoglucemiante." }
          }
        },
        "Warfarina": {
          nombre: "Warfarina",
          laboratorio: "Bristol-Myers Squibb",
          indicaciones: ["Prevenci√≥n y tratamiento de trombosis venosa", "Prevenci√≥n de embolismo sist√©mico en fibrilaci√≥n auricular", "V√°lvulas card√≠acas mec√°nicas"],
          mecanismoAccion: "Antagonista de la vitamina K, inhibe la s√≠ntesis de factores de coagulaci√≥n dependientes de vitamina K (II, VII, IX, X).",
          farmacocinetica: "Absorci√≥n completa. Metabolismo hep√°tico extenso. Vida media de 20-60 horas.",
          efectosAdversos: ["Hemorragia", "Necrosis cut√°nea", "Teratogenicidad"],
          contraindicaciones: ["Embarazo", "Hemorragia activa", "√ölcera p√©ptica activa", "Trauma o cirug√≠a reciente"],
          interacciones: {
            "Aspirina": { severidad: "fatal", descripcion: "Riesgo muy alto de hemorragia grave." },
            "Antibi√≥ticos (como ciprofloxacina)": { severidad: "moderada", descripcion: "Pueden potenciar el efecto anticoagulante." },
            "Barbit√∫ricos": { severidad: "moderada", descripcion: "Pueden reducir el efecto anticoagulante." }
          }
        },
        "Tenofovir": {
          nombre: "Tenofovir",
          laboratorio: "Gilead Sciences",
          indicaciones: ["Tratamiento de VIH", "Tratamiento de hepatitis B cr√≥nica"],
          mecanismoAccion: "An√°logo nucle√≥tido que inhibe la transcriptasa inversa del VIH.",
          farmacocinetica: "Biodisponibilidad variable. Metabolismo hep√°tico. Excreci√≥n renal.",
          efectosAdversos: ["Nefrotoxicidad", "Disminuci√≥n de la densidad mineral √≥sea", "N√°useas"],
          contraindicaciones: ["Insuficiencia renal grave", "Hipersensibilidad"],
          interacciones: {
            "Didanosina": { severidad: "moderada", descripcion: "Aumenta el riesgo de toxicidad pancre√°tica y neurop√°tica." },
            "Atazanavir": { severidad: "moderada", descripcion: "Aumenta los niveles plasm√°ticos de tenofovir, aumentando el riesgo de nefrotoxicidad." }
          }
        },
        "Enalapril": {
          nombre: "Enalapril",
          laboratorio: "Novartis",
          contraindicaciones: ["Embarazo", "Angioedema previo a IECA"],
          interacciones: {
            "Espironolactona": { severidad: "moderada", descripcion: "Riesgo de hiperkalemia." }
          }
        },
        "Carvedilol": {
          nombre: "Carvedilol",
          laboratorio: "Abbott",
          contraindicaciones: ["Asma severa", "Bloqueo AV de 2do o 3er grado"],
          interacciones: {
            "Ranitidina": { severidad: "leve", descripcion: "Puede aumentar niveles de carvedilol." }
          }
        },
        "Espironolactona": {
          nombre: "Espironolactona",
          laboratorio: "Pfizer",
          contraindicaciones: ["Hiperkalemia", "Insuficiencia renal grave"],
          interacciones: {
            "Enalapril": { severidad: "moderada", descripcion: "Riesgo de hiperkalemia." },
            "AINEs": { severidad: "moderada", descripcion: "Puede aumentar el riesgo de hiperkalemia y reducir el efecto antihipertensivo." }
          }
        },
        "Furosemida": {
          nombre: "Furosemida",
          laboratorio: "Sanofi",
          contraindicaciones: ["Anuria", "Insuficiencia hep√°tica grave con coma hep√°tico"],
          interacciones: {
            "AINEs": { severidad: "moderada", descripcion: "Pueden reducir el efecto diur√©tico." },
            "Litio": { severidad: "moderada", descripcion: "Puede aumentar los niveles s√©ricos de litio." }
          }
        }
      },
      protocols: [
        {
          id: "urn:protocol:meningitis-001",
          nombre: "Manejo de Meningitis Bacteriana en Adultos",
          area: "Infectolog√≠a/Neurolog√≠a",
          descripcion: "Protocolo basado en evidencia para el diagn√≥stico y tratamiento inmediato de meningitis bacteriana.",
          pasos: [
            "1. Sospecha cl√≠nica: Cefalea intensa, fiebre, rigidez de nuca, fotofobia.",
            "2. Estudios inmediatos: Hemograma, funci√≥n renal, glucemia, cultivos de sangre.",
            "3. Im√°genes: Tomograf√≠a computarizada (TC) de cr√°neo si hay signos de herniaci√≥n o antecedente de lesi√≥n cerebral.",
            "4. Punci√≥n lumbar: Si la TC es normal o no est√° indicada, realizar punci√≥n lumbar para an√°lisis del LCR.",
            "5. Tratamiento emp√≠rico inmediato: Ceftriaxona 2g IV cada 12h + Vancomicina 15mg/kg IV cada 12h + Dexametasona 10mg IV cada 6h.",
            "6. Ajustar tratamiento seg√∫n cultivo del LCR.",
            "7. Soporte vital y monitoreo neurol√≥gico."
          ],
          referencias: ["IDSA Guidelines", "UpToDate"]
        },
        {
          id: "urn:protocol:ms-001",
          nombre: "Diagn√≥stico de Esclerosis M√∫ltiple (Criterios McDonald 2017)",
          area: "Neurolog√≠a",
          descripcion: "Criterios internacionales para el diagn√≥stico de esclerosis m√∫ltiple.",
          pasos: [
            "1. Demostrar diseminaci√≥n en el espacio (DIS): ‚â•1 lesi√≥n en al menos 2 de las 4 √°reas caracter√≠sticas del SNC (periventricular, juxtacortical, infratentorial, m√©dula espinal).",
            "2. Demostrar diseminaci√≥n en el tiempo (DIT): ‚â•1 lesi√≥n gadolinio-positiva nueva en relaci√≥n con una escaneo previo, o una nueva lesi√≥n T2 o gadolinio-positiva en un escaneo posterior.",
            "3. Excluir diagn√≥sticos alternativos m√°s probables."
          ],
          referencias: ["Lancet Neurology 2018"]
        }
      ],
      medicalProcedures: [
        {
          id: "pr-001",
          nombre: "Punci√≥n Lumbar",
          indicaciones: ["Diagn√≥stico de meningitis", "Diagn√≥stico de hemorragia subaracnoidea", "Medici√≥n de presi√≥n del LCR", "Administraci√≥n de medicamentos (quimioterapia, anestesia espinal)"],
          contraindicaciones: ["Infecci√≥n en el sitio de punci√≥n", "Trastornos de coagulaci√≥n no corregidos", "Presi√≥n intracraneal muy elevada (riesgo de herniaci√≥n)"],
          riesgos: ["Dolor de cabeza post-punci√≥n", "Infecci√≥n", "Hemorragia", "Da√±o nervioso"]
        },
        {
          id: "pr-002",
          nombre: "Biopsia Hep√°tica",
          indicaciones: ["Evaluaci√≥n de enfermedad hep√°tica cr√≥nica", "Diagn√≥stico de hepatitis autoinmune", "Evaluaci√≥n de masa hep√°tica"],
          contraindicaciones: ["Coagulopat√≠a no corregida", "Hipertensi√≥n portal severa", "Ascitis masiva"],
          riesgos: ["Hemorragia", "Perforaci√≥n de v√≠sceras", "Infecci√≥n"]
        }
      ]
    };

    // Estado de la aplicaci√≥n
    const APP_STATE = {
      activePatientId: null,
      currentSection: 'dashboard',
      filters: {
        patientSearch: '',
        specialty: '',
        staffSearch: '',
        staffRole: '',
        resourceSearch: '',
        resourceCategory: '',
        resourceType: ''
      },
      theme: 'light',
      activeChart: 'pressure',
      searchQuery: '',
      searchResults: [],
      currentImageIndex: 0,
      imageGallery: [],
      isModalOpen: false
    };

    // Funciones de utilidad
    function createEl(tag, attributes = {}, children = []) {
      const element = document.createElement(tag);
      
      // A√±adir atributos
      Object.keys(attributes).forEach(key => {
        if (key === 'className') {
          element.className = attributes[key];
        } else if (key === 'htmlFor') {
          element.htmlFor = attributes[key];
        } else if (key.startsWith('on') && typeof attributes[key] === 'function') {
          element.addEventListener(key.slice(2).toLowerCase(), attributes[key]);
        } else {
          element.setAttribute(key, attributes[key]);
        }
      });
      
      // A√±adir hijos
      children.forEach(child => {
        if (typeof child === 'string') {
          element.appendChild(document.createTextNode(child));
        } else if (child instanceof Node) {
          element.appendChild(child);
        }
      });
      
      return element;
    }

    function navigateTo(section) {
      document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
      });
      document.getElementById(section).classList.add('active');
      
      document.querySelectorAll('nav ul li a').forEach(link => {
        link.classList.remove('active');
      });
      document.querySelector(`nav ul li a[onclick="navigateTo('${section}')"]`).classList.add('active');
      
      APP_STATE.currentSection = section;
      
      // Actualizar contenido seg√∫n la secci√≥n
      if (section === 'pacientes') {
        updatePatientGrid();
        updateSpecialtyFilter();
      } else if (section === 'personal') {
        updateStaffGrid();
        updateRoleFilter();
      } else if (section === 'recursos') {
        updateResourceCards();
        updateCategoryFilter();
      } else if (section === 'consultorio') {
        updatePatientSelect('active-patient');
        setupSearchFunctionality();
      } else if (section === 'recetas') {
        updatePatientSelect('recipe-patient');
        setupPrescriptions();
      } else if (section === 'dashboard') {
        updateDashboard();
      }
    }

    function toggleTheme() {
      document.body.classList.toggle('theme-dark');
      const isDark = document.body.classList.contains('theme-dark');
      APP_STATE.theme = isDark ? 'dark' : 'light';
      
      const themeButton = document.querySelector('nav ul li a[onclick="toggleTheme()"] .material-symbols-outlined');
      if (themeButton) {
        themeButton.textContent = isDark ? 'light_mode' : 'dark_mode';
      }
    }

    function showNotification(message, type = 'info') {
      const container = document.getElementById('notification-container');
      const notification = document.createElement('div');
      notification.className = `notification ${type}`;
      notification.innerHTML = `
        <span class="material-symbols-outlined">
          ${type === 'success' ? 'check_circle' : type === 'error' ? 'error' : type === 'warning' ? 'warning' : 'info'}
        </span>
        ${message}
      `;
      
      container.appendChild(notification);
      
      setTimeout(() => {
        notification.style.opacity = '0';
        setTimeout(() => {
          container.removeChild(notification);
        }, 300);
      }, 5000);
    }

    // Funciones para modales
    function showModal(title, content) {
      const modalOverlay = document.getElementById('modal-overlay');
      const modalTitle = document.getElementById('modal-title');
      const modalBody = document.getElementById('modal-body-content');
      
      modalTitle.textContent = title;
      modalBody.innerHTML = content;
      modalOverlay.classList.add('active');
      
      APP_STATE.isModalOpen = true;
    }

    function closeModal() {
      const modalOverlay = document.getElementById('modal-overlay');
      modalOverlay.classList.remove('active');
      APP_STATE.isModalOpen = false;
    }

    // Inicializaci√≥n
    function initApp() {
      // Inicializar filtros
      document.getElementById('patient-search')?.addEventListener('input', function() {
        APP_STATE.filters.patientSearch = this.value.toLowerCase();
        updatePatientGrid();
      });
      
      document.getElementById('specialty-filter')?.addEventListener('change', function() {
        APP_STATE.filters.specialty = this.value;
        updatePatientGrid();
      });
      
      document.getElementById('staff-search')?.addEventListener('input', function() {
        APP_STATE.filters.staffSearch = this.value.toLowerCase();
        updateStaffGrid();
      });
      
      document.getElementById('role-filter')?.addEventListener('change', function() {
        APP_STATE.filters.staffRole = this.value;
        updateStaffGrid();
      });
      
      document.getElementById('resource-search')?.addEventListener('input', function() {
        APP_STATE.filters.resourceSearch = this.value.toLowerCase();
        updateResourceCards();
      });
      
      document.getElementById('category-filter')?.addEventListener('change', function() {
        APP_STATE.filters.resourceCategory = this.value;
        updateResourceCards();
      });
      
      // Inicializar eventos de b√∫squeda
      setupSearchFunctionality();
      
      // Inicializar calculadoras
      setupCalculators();
      
      // Inicializar dashboard
      updateDashboard();
      
      // Inicializar selects
      updatePatientSelect('active-patient');
      updatePatientSelect('recipe-patient');
      updatePatientSelect('chart-patient');
      
      // Inicializar grids
      updatePatientGrid();
      updateStaffGrid();
      updateResourceCards();
      
      // Inicializar filtros
      updateSpecialtyFilter();
      updateRoleFilter();
      updateCategoryFilter();
    }

    // Funciones para pacientes
    function updatePatientGrid() {
      const container = document.getElementById('patient-grid');
      if (!container) return;
      
      container.innerHTML = '';
      
      const filteredPatients = DATA_STORE.patients.filter(patient => {
        const matchesSearch = !APP_STATE.filters.patientSearch || 
          patient.nombre.toLowerCase().includes(APP_STATE.filters.patientSearch) ||
          patient.diagnosticoPrincipal.toLowerCase().includes(APP_STATE.filters.patientSearch) ||
          patient.historiaClinica.diagnosticos.some(d => d.cie10.toLowerCase().includes(APP_STATE.filters.patientSearch));
          
        const matchesSpecialty = !APP_STATE.filters.specialty || patient.especialidad === APP_STATE.filters.specialty;
        
        return matchesSearch && matchesSpecialty;
      });
      
      if (filteredPatients.length === 0) {
        container.innerHTML = '<p>No se encontraron pacientes.</p>';
        return;
      }
      
      filteredPatients.forEach(patient => {
        const card = createEl('div', { className: 'patient-card' }, [
          createEl('h3', {}, [patient.nombre]),
          createEl('p', {}, [`Edad: ${patient.edad} a√±os`]),
          createEl('p', {}, [`Diagn√≥stico: ${patient.diagnosticoPrincipal}`]),
          createEl('p', {}, [`Especialidad: ${patient.especialidad}`]),
          createEl('p', {}, [`Riesgo CV: ${patient.riesgoCardiovascular}`]),
          createEl('div', { className: `status status-${patient.riesgoCardiovascular === 'alto' ? 'high' : patient.riesgoCardiovascular === 'moderado' ? 'moderate' : 'low'}` }, 
            [patient.riesgoCardiovascular === 'alto' ? 'Alto Riesgo' : patient.riesgoCardiovascular === 'moderado' ? 'Riesgo Moderado' : 'Riesgo Bajo'])
        ]);
        
        card.addEventListener('click', () => showPatientDetail(patient));
        container.appendChild(card);
      });
    }

    function updateSpecialtyFilter() {
      const select = document.getElementById('specialty-filter');
      if (!select) return;
      
      // Obtener especialidades √∫nicas
      const specialties = [...new Set(DATA_STORE.patients.map(p => p.especialidad))];
      
      select.innerHTML = '<option value="">Filtrar por especialidad...</option>';
      specialties.forEach(specialty => {
        const option = document.createElement('option');
        option.value = specialty;
        option.textContent = specialty;
        select.appendChild(option);
      });
    }

    function openAddPatientModal() {
      const modalContent = `
        <div class="form-row">
          <div class="form-group">
            <label for="new-patient-nombre">Nombre</label>
            <input type="text" id="new-patient-nombre" class="form-control" required>
          </div>
          <div class="form-group">
            <label for="new-patient-edad">Edad</label>
            <input type="number" id="new-patient-edad" class="form-control" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="new-patient-diagnostico">Diagn√≥stico Principal</label>
            <input type="text" id="new-patient-diagnostico" class="form-control" required>
          </div>
          <div class="form-group">
            <label for="new-patient-especialidad">Especialidad</label>
            <select id="new-patient-especialidad" class="form-control" required>
              <option value="Cardiolog√≠a">Cardiolog√≠a</option>
              <option value="Neurolog√≠a">Neurolog√≠a</option>
              <option value="Endocrinolog√≠a">Endocrinolog√≠a</option>
              <option value="Infectolog√≠a">Infectolog√≠a</option>
              <option value="Pediatr√≠a">Pediatr√≠a</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="new-patient-riesgo">Riesgo Cardiovascular</label>
            <select id="new-patient-riesgo" class="form-control" required>
              <option value="bajo">Bajo</option>
              <option value="moderado">Moderado</option>
              <option value="alto">Alto</option>
            </select>
          </div>
          <div class="form-group">
            <label for="new-patient-alergias">Alergias (separadas por comas)</label>
            <input type="text" id="new-patient-alergias" class="form-control">
          </div>
        </div>
        <button class="btn btn-primary" onclick="addNewPatient()">Crear Paciente</button>
      `;
      
      showModal('Nuevo Paciente', modalContent);
    }

    function addNewPatient() {
      const nombre = document.getElementById('new-patient-nombre').value.trim();
      const edad = parseInt(document.getElementById('new-patient-edad').value);
      const diagnostico = document.getElementById('new-patient-diagnostico').value;
      const especialidad = document.getElementById('new-patient-especialidad').value;
      const alergiasInput = document.getElementById('new-patient-alergias').value;
      const alergias = alergiasInput ? alergiasInput.split(',').map(a => a.trim()).filter(a => a !== '') : [];
      const riesgo = document.getElementById('new-patient-riesgo').value;
      
      if (!nombre || isNaN(edad) || !diagnostico || !especialidad) {
        showNotification('Por favor, complete todos los campos obligatorios.', 'warning');
        return;
      }
      
      const newPatient = {
        id: DATA_STORE.patients.length + 1,
        nombre,
        edad,
        diagnosticoPrincipal: diagnostico,
        especialidad,
        riesgoCardiovascular: riesgo,
        alergias,
        historiaClinica: {
          resumen: "",
          diagnosticos: [],
          tratamientos: [],
          evolucion: [],
          signosVitales: [],
          laboratorio: [],
          seguimiento: []
        }
      };
      
      DATA_STORE.patients.push(newPatient);
      closeModal();
      updatePatientGrid();
      showNotification(`Paciente ${nombre} creado correctamente.`, 'success');
    }

    function showPatientDetail(patient) {
      let content = `
        <div class="modal-header">
          <h2><span class="material-symbols-outlined">person</span> ${patient.nombre}</h2>
          <button class="modal-close-btn" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-row">
            <div class="form-group">
              <label>Edad</label>
              <p>${patient.edad} a√±os</p>
            </div>
            <div class="form-group">
              <label>Diagn√≥stico Principal</label>
              <p>${patient.diagnosticoPrincipal}</p>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Especialidad</label>
              <p>${patient.especialidad}</p>
            </div>
            <div class="form-group">
              <label>Riesgo Cardiovascular</label>
              <p class="status status-${patient.riesgoCardiovascular === 'alto' ? 'high' : patient.riesgoCardiovascular === 'moderado' ? 'moderate' : 'low'}">
                ${patient.riesgoCardiovascular === 'alto' ? 'Alto Riesgo' : patient.riesgoCardiovascular === 'moderado' ? 'Riesgo Moderado' : 'Riesgo Bajo'}
              </p>
            </div>
          </div>
          <div class="form-group">
            <label>Alergias</label>
            <p>${patient.alergias.length > 0 ? patient.alergias.join(', ') : 'Ninguna'}</p>
          </div>
          
          <div class="modal-tabs">
            <div class="modal-tab active" onclick="switchModalTab('history')">Historia Cl√≠nica</div>
            <div class="modal-tab" onclick="switchModalTab('vitals')">Signos Vitales</div>
            <div class="modal-tab" onclick="switchModalTab('labs')">Laboratorio</div>
            <div class="modal-tab" onclick="switchModalTab('treatments')">Tratamientos</div>
          </div>
          
          <div id="modal-tab-content" class="modal-tab-content">
            <div id="history-tab" class="modal-tab-content active">
              <h4>Resumen</h4>
              <p>${patient.historiaClinica.resumen || 'No disponible'}</p>
              
              <h4>Diagn√≥sticos</h4>
              ${patient.historiaClinica.diagnosticos.length > 0 ? 
                `<table>
                  <tr><th>Fecha</th><th>CIE-10</th><th>Descripci√≥n</th><th>Estado</th></tr>
                  ${patient.historiaClinica.diagnosticos.map(d => 
                    `<tr><td>${d.fecha}</td><td>${d.cie10}</td><td>${d.descripcion}</td><td>${d.estado}</td></tr>`
                  ).join('')}
                </table>` : 
                '<p>No hay diagn√≥sticos registrados.</p>'
              }
              
              <h4>Evoluci√≥n</h4>
              ${patient.historiaClinica.evolucion.length > 0 ? 
                `<table>
                  <tr><th>Fecha</th><th>Nota</th></tr>
                  ${patient.historiaClinica.evolucion.map(e => 
                    `<tr><td>${e.fecha}</td><td>${e.nota}</td></tr>`
                  ).join('')}
                </table>` : 
                '<p>No hay evoluci√≥n registrada.</p>'
              }
            </div>
            
            <div id="vitals-tab" class="modal-tab-content">
              ${patient.historiaClinica.signosVitales.length > 0 ? 
                `<table>
                  <tr><th>Fecha</th><th>Temp (¬∞C)</th><th>PA</th><th>FC</th><th>FR</th><th>SpO2</th><th>Peso</th><th>Talla</th><th>IMC</th></tr>
                  ${patient.historiaClinica.signosVitales.map(v => 
                    `<tr>
                      <td>${v.fecha}</td>
                      <td>${v.temperatura}</td>
                      <td>${v.pa}</td>
                      <td>${v.fc}</td>
                      <td>${v.fr}</td>
                      <td>${v.spo2}</td>
                      <td>${v.peso ? v.peso + ' kg' : '-'}</td>
                      <td>${v.talla ? v.talla + ' cm' : '-'}</td>
                      <td>${v.imc ? v.imc : '-'}</td>
                    </tr>`
                  ).join('')}
                </table>` : 
                '<p>No hay signos vitales registrados.</p>'
              }
            </div>
            
            <div id="labs-tab" class="modal-tab-content">
              ${patient.historiaClinica.laboratorio.length > 0 ? 
                `<table>
                  <tr><th>Fecha</th><th>Test</th><th>Resultado</th><th>Normal</th></tr>
                  ${patient.historiaClinica.laboratorio.map(l => 
                    `<tr><td>${l.fecha}</td><td>${l.test}</td><td>${l.resultado}</td><td>${l.normal}</td></tr>`
                  ).join('')}
                </table>` : 
                '<p>No hay resultados de laboratorio registrados.</p>'
              }
            </div>
            
            <div id="treatments-tab" class="modal-tab-content">
              ${patient.historiaClinica.tratamientos.length > 0 ? 
                `<table>
                  <tr><th>Inicio</th><th>Medicamento</th><th>Dosis</th><th>Duraci√≥n</th></tr>
                  ${patient.historiaClinica.tratamientos.map(t => 
                    `<tr><td>${t.fechaInicio}</td><td>${t.medicamento}</td><td>${t.dosis}</td><td>${t.duracion}</td></tr>`
                  ).join('')}
                </table>` : 
                '<p>No hay tratamientos registrados.</p>'
              }
            </div>
          </div>
          
          <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal()">Cerrar</button>
            <button class="btn btn-primary" onclick="editPatient(${patient.id})">Editar</button>
          </div>
        </div>
      `;
      
      document.getElementById('modal-overlay').innerHTML = content;
      document.getElementById('modal-overlay').classList.add('active');
    }

    function switchModalTab(tabId) {
      document.querySelectorAll('.modal-tab').forEach(tab => {
        tab.classList.remove('active');
      });
      document.querySelectorAll('.modal-tab-content').forEach(content => {
        content.classList.remove('active');
      });
      
      document.querySelector(`.modal-tab[onclick="switchModalTab('${tabId}')"]`).classList.add('active');
      document.getElementById(`${tabId}-tab`).classList.add('active');
    }

    function editPatient(patientId) {
      const patient = DATA_STORE.patients.find(p => p.id === patientId);
      if (!patient) return;
      
      const modalContent = `
        <div class="form-row">
          <div class="form-group">
            <label for="edit-patient-nombre">Nombre</label>
            <input type="text" id="edit-patient-nombre" class="form-control" value="${patient.nombre}" required>
          </div>
          <div class="form-group">
            <label for="edit-patient-edad">Edad</label>
            <input type="number" id="edit-patient-edad" class="form-control" value="${patient.edad}" required>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="edit-patient-diagnostico">Diagn√≥stico Principal</label>
            <input type="text" id="edit-patient-diagnostico" class="form-control" value="${patient.diagnosticoPrincipal}" required>
          </div>
          <div class="form-group">
            <label for="edit-patient-especialidad">Especialidad</label>
            <select id="edit-patient-especialidad" class="form-control" required>
              <option value="Cardiolog√≠a" ${patient.especialidad === 'Cardiolog√≠a' ? 'selected' : ''}>Cardiolog√≠a</option>
              <option value="Neurolog√≠a" ${patient.especialidad === 'Neurolog√≠a' ? 'selected' : ''}>Neurolog√≠a</option>
              <option value="Endocrinolog√≠a" ${patient.especialidad === 'Endocrinolog√≠a' ? 'selected' : ''}>Endocrinolog√≠a</option>
              <option value="Infectolog√≠a" ${patient.especialidad === 'Infectolog√≠a' ? 'selected' : ''}>Infectolog√≠a</option>
              <option value="Pediatr√≠a" ${patient.especialidad === 'Pediatr√≠a' ? 'selected' : ''}>Pediatr√≠a</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="edit-patient-riesgo">Riesgo Cardiovascular</label>
            <select id="edit-patient-riesgo" class="form-control" required>
              <option value="bajo" ${patient.riesgoCardiovascular === 'bajo' ? 'selected' : ''}>Bajo</option>
              <option value="moderado" ${patient.riesgoCardiovascular === 'moderado' ? 'selected' : ''}>Moderado</option>
              <option value="alto" ${patient.riesgoCardiovascular === 'alto' ? 'selected' : ''}>Alto</option>
            </select>
          </div>
          <div class="form-group">
            <label for="edit-patient-alergias">Alergias (separadas por comas)</label>
            <input type="text" id="edit-patient-alergias" class="form-control" value="${patient.alergias.join(', ')}">
          </div>
        </div>
        <button class="btn btn-primary" onclick="savePatientEdit(${patient.id})">Guardar Cambios</button>
      `;
      
      showModal('Editar Paciente', modalContent);
    }

    function savePatientEdit(patientId) {
      const nombre = document.getElementById('edit-patient-nombre').value.trim();
      const edad = parseInt(document.getElementById('edit-patient-edad').value);
      const diagnostico = document.getElementById('edit-patient-diagnostico').value;
      const especialidad = document.getElementById('edit-patient-especialidad').value;
      const alergiasInput = document.getElementById('edit-patient-alergias').value;
      const alergias = alergiasInput ? alergiasInput.split(',').map(a => a.trim()).filter(a => a !== '') : [];
      const riesgo = document.getElementById('edit-patient-riesgo').value;
      
      if (!nombre || isNaN(edad) || !diagnostico || !especialidad) {
        showNotification('Por favor, complete todos los campos obligatorios.', 'warning');
        return;
      }
      
      const patientIndex = DATA_STORE.patients.findIndex(p => p.id === patientId);
      if (patientIndex === -1) return;
      
      DATA_STORE.patients[patientIndex] = {
        ...DATA_STORE.patients[patientIndex],
        nombre,
        edad,
        diagnosticoPrincipal: diagnostico,
        especialidad,
        riesgoCardiovascular: riesgo,
        alergias
      };
      
      closeModal();
      updatePatientGrid();
      showNotification(`Paciente ${nombre} actualizado correctamente.`, 'success');
    }

    // Funciones para personal
    function updateStaffGrid() {
      const container = document.getElementById('staff-grid');
      if (!container) return;
      
      container.innerHTML = '';
      
      const filteredStaff = DATA_STORE.staff.filter(staff => {
        const matchesSearch = !APP_STATE.filters.staffSearch || 
          staff.nombre.toLowerCase().includes(APP_STATE.filters.staffSearch) ||
          staff.especialidad.toLowerCase().includes(APP_STATE.filters.staffSearch) ||
          staff.rol.toLowerCase().includes(APP_STATE.filters.staffSearch);
          
        const matchesRole = !APP_STATE.filters.staffRole || staff.rol === APP_STATE.filters.staffRole;
        
        return matchesSearch && matchesRole;
      });
      
      if (filteredStaff.length === 0) {
        container.innerHTML = '<p>No se encontr√≥ personal.</p>';
        return;
      }
      
      filteredStaff.forEach(member => {
        const card = createEl('div', { className: 'patient-card' }, [
          createEl('h3', {}, [member.nombre]),
          createEl('p', {}, [`Especialidad: ${member.especialidad}`]),
          createEl('p', {}, [`Rol: ${member.rol}`]),
          createEl('p', {}, [`Tel√©fono: ${member.telefono}`]),
          createEl('p', {}, [`Email: ${member.email}`]),
          createEl('p', {}, [member.bio])
        ]);
        
        card.addEventListener('click', () => showStaffDetail(member));
        container.appendChild(card);
      });
    }

    function updateRoleFilter() {
      const select = document.getElementById('role-filter');
      if (!select) return;
      
      // Obtener roles √∫nicos
      const roles = [...new Set(DATA_STORE.staff.map(s => s.rol))];
      
      select.innerHTML = '<option value="">Filtrar por rol...</option>';
      roles.forEach(role => {
        const option = document.createElement('option');
        option.value = role;
        option.textContent = role;
        select.appendChild(option);
      });
    }

    function openAddStaffModal() {
      const modalContent = `
        <div class="form-row">
          <div class="form-group">
            <label for="new-staff-nombre">Nombre</label>
            <input type="text" id="new-staff-nombre" class="form-control" required>
          </div>
          <div class="form-group">
            <label for="new-staff-rol">Rol</label>
            <select id="new-staff-rol" class="form-control" required>
              <option value="M√©dico">M√©dico</option>
              <option value="Enfermera">Enfermera</option>
              <option value="Administrador">Administrador</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="new-staff-especialidad">Especialidad</label>
            <input type="text" id="new-staff-especialidad" class="form-control" required>
          </div>
          <div class="form-group">
            <label for="new-staff-telefono">Tel√©fono</label>
            <input type="text" id="new-staff-telefono" class="form-control">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="new-staff-email">Email</label>
            <input type="email" id="new-staff-email" class="form-control">
          </div>
        </div>
        <div class="form-group">
          <label for="new-staff-bio">Biograf√≠a</label>
          <textarea id="new-staff-bio" class="form-control" rows="3"></textarea>
        </div>
        <button class="btn btn-primary" onclick="addNewStaff()">Crear Miembro</button>
      `;
      
      showModal('Nuevo Miembro del Personal', modalContent);
    }

    function addNewStaff() {
      const nombre = document.getElementById('new-staff-nombre').value.trim();
      const rol = document.getElementById('new-staff-rol').value;
      const especialidad = document.getElementById('new-staff-especialidad').value.trim();
      const telefono = document.getElementById('new-staff-telefono').value.trim();
      const email = document.getElementById('new-staff-email').value.trim();
      const bio = document.getElementById('new-staff-bio').value.trim();
      
      if (!nombre || !rol || !especialidad) {
        showNotification('Por favor, complete todos los campos obligatorios.', 'warning');
        return;
      }
      
      const newStaff = {
        id: DATA_STORE.staff.length + 1,
        nombre,
        rol,
        especialidad,
        telefono,
        email,
        bio
      };
      
      DATA_STORE.staff.push(newStaff);
      closeModal();
      updateStaffGrid();
      showNotification(`Miembro ${nombre} agregado correctamente.`, 'success');
    }

    function showStaffDetail(staff) {
      let content = `
        <div class="modal-header">
          <h2><span class="material-symbols-outlined">person</span> ${staff.nombre}</h2>
          <button class="modal-close-btn" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-row">
            <div class="form-group">
              <label>Rol</label>
              <p>${staff.rol}</p>
            </div>
            <div class="form-group">
              <label>Especialidad</label>
              <p>${staff.especialidad}</p>
            </div>
          </div>
          <div class="form-row">
            <div class="form-group">
              <label>Tel√©fono</label>
              <p>${staff.telefono || 'No disponible'}</p>
            </div>
            <div class="form-group">
              <label>Email</label>
              <p>${staff.email || 'No disponible'}</p>
            </div>
          </div>
          <div class="form-group">
            <label>Biograf√≠a</label>
            <p>${staff.bio || 'No disponible'}</p>
          </div>
          
          <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal()">Cerrar</button>
          </div>
        </div>
      `;
      
      document.getElementById('modal-overlay').innerHTML = content;
      document.getElementById('modal-overlay').classList.add('active');
    }

    // Funciones para recursos educativos
    function updateResourceCards() {
      const container = document.getElementById('resource-cards');
      if (!container) return;
      
      container.innerHTML = '';
      
      const filteredResources = DATA_STORE.resources.filter(resource => {
        const matchesSearch = !APP_STATE.filters.resourceSearch || 
          resource.titulo.toLowerCase().includes(APP_STATE.filters.resourceSearch) ||
          resource.descripcion.toLowerCase().includes(APP_STATE.filters.resourceSearch) ||
          resource.etiquetas.some(tag => tag.toLowerCase().includes(APP_STATE.filters.resourceSearch));
          
        const matchesCategory = !APP_STATE.filters.resourceCategory || resource.categoria === APP_STATE.filters.resourceCategory;
        
        return matchesSearch && matchesCategory;
      });
      
      if (filteredResources.length === 0) {
        container.innerHTML = '<p>No se encontraron recursos.</p>';
        return;
      }
      
      filteredResources.forEach(resource => {
        const card = createEl('div', { className: 'resource-card' }, [
          resource.tipo === 'imagen' ? 
            createEl('img', { src: resource.url, alt: resource.titulo, className: 'resource-image' }) :
          resource.tipo === 'video' ?
            createEl('video', { controls: true, className: 'resource-image' }, [
              createEl('source', { src: resource.url, type: 'video/mp4' })
            ]) :
            createEl('div', { className: 'resource-image', style: 'background-color: #e3f2fd; display: flex; justify-content: center; align-items: center;' }, [
              createEl('span', { className: 'material-symbols-outlined', style: 'font-size: 4em; color: #1a73e8;' }, ['description'])
            ]),
          createEl('div', { className: 'resource-content' }, [
            createEl('h3', {}, [resource.titulo]),
            createEl('p', {}, [resource.descripcion]),
            createEl('div', { className: 'resource-meta' }, [
              createEl('span', {}, [resource.categoria]),
              createEl('span', {}, [resource.tipo])
            ])
          ])
        ]);
        
        card.addEventListener('click', () => showResourceDetail(resource));
        container.appendChild(card);
      });
    }

    function updateCategoryFilter() {
      const select = document.getElementById('category-filter');
      if (!select) return;
      
      // Obtener categor√≠as √∫nicas
      const categories = [...new Set(DATA_STORE.resources.map(r => r.categoria))];
      
      select.innerHTML = '<option value="">Filtrar por categor√≠a...</option>';
      categories.forEach(category => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        select.appendChild(option);
      });
    }

    function openAddResourceModal() {
      const modalContent = `
        <div class="form-row">
          <div class="form-group">
            <label for="new-resource-titulo">T√≠tulo</label>
            <input type="text" id="new-resource-titulo" class="form-control" required>
          </div>
          <div class="form-group">
            <label for="new-resource-categoria">Categor√≠a</label>
            <select id="new-resource-categoria" class="form-control" required>
              <option value="Protocolos">Protocolos</option>
              <option value="Procedimientos">Procedimientos</option>
              <option value="Im√°genes">Im√°genes</option>
              <option value="Educaci√≥n">Educaci√≥n</option>
              <option value="Videos">Videos</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label for="new-resource-tipo">Tipo</label>
            <select id="new-resource-tipo" class="form-control" required>
              <option value="documento">Documento</option>
              <option value="video">Video</option>
              <option value="imagen">Imagen</option>
            </select>
          </div>
          <div class="form-group">
            <label for="new-resource-url">URL</label>
            <input type="url" id="new-resource-url" class="form-control" required>
          </div>
        </div>
        <div class="form-group">
          <label for="new-resource-etiquetas">Etiquetas (separadas por comas)</label>
          <input type="text" id="new-resource-etiquetas" class="form-control">
        </div>
        <div class="form-group">
          <label for="new-resource-descripcion">Descripci√≥n</label>
          <textarea id="new-resource-descripcion" class="form-control" rows="3"></textarea>
        </div>
        <button class="btn btn-primary" onclick="addNewResource()">Crear Recurso</button>
      `;
      
      showModal('Nuevo Recurso Educativo', modalContent);
    }

    function addNewResource() {
      const titulo = document.getElementById('new-resource-titulo').value.trim();
      const categoria = document.getElementById('new-resource-categoria').value;
      const tipo = document.getElementById('new-resource-tipo').value;
      const url = document.getElementById('new-resource-url').value.trim();
      const etiquetasInput = document.getElementById('new-resource-etiquetas').value;
      const etiquetas = etiquetasInput ? etiquetasInput.split(',').map(e => e.trim()).filter(e => e !== '') : [];
      const descripcion = document.getElementById('new-resource-descripcion').value.trim();
      
      if (!titulo || !categoria || !tipo || !url) {
        showNotification('Por favor, complete todos los campos obligatorios.', 'warning');
        return;
      }
      
      const newResource = {
        id: DATA_STORE.resources.length + 1,
        titulo,
        categoria,
        tipo,
        url,
        etiquetas,
        descripcion
      };
      
      DATA_STORE.resources.push(newResource);
      closeModal();
      updateResourceCards();
      showNotification(`Recurso ${titulo} agregado correctamente.`, 'success');
    }

    function showResourceDetail(resource) {
      let content = `
        <div class="modal-header">
          <h2><span class="material-symbols-outlined">school</span> ${resource.titulo}</h2>
          <button class="modal-close-btn" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-row">
            <div class="form-group">
              <label>Categor√≠a</label>
              <p>${resource.categoria}</p>
            </div>
            <div class="form-group">
              <label>Tipo</label>
              <p>${resource.tipo}</p>
            </div>
          </div>
          <div class="form-group">
            <label>Descripci√≥n</label>
            <p>${resource.descripcion || 'No disponible'}</p>
          </div>
          <div class="form-group">
            <label>Etiquetas</label>
            <p>${resource.etiquetas.length > 0 ? resource.etiquetas.join(', ') : 'Ninguna'}</p>
          </div>
          
          <div class="resource-preview">
            ${resource.tipo === 'imagen' ? 
              `<img src="${resource.url}" alt="${resource.titulo}" style="max-width: 100%; border-radius: 8px;">` :
            resource.tipo === 'video' ?
              `<video controls style="max-width: 100%; border-radius: 8px;">
                <source src="${resource.url}" type="video/mp4">
                Tu navegador no soporta videos HTML5.
              </video>` :
              `<iframe src="${resource.url}" style="width: 100%; height: 400px; border-radius: 8px; border: none;"></iframe>`
            }
          </div>
          
          <div class="modal-footer">
            <button class="btn btn-secondary" onclick="closeModal()">Cerrar</button>
            <a href="${resource.url}" target="_blank" class="btn btn-primary">Abrir en Nueva Pesta√±a</a>
          </div>
        </div>
      `;
      
      document.getElementById('modal-overlay').innerHTML = content;
      document.getElementById('modal-overlay').classList.add('active');
    }

    // Funciones para b√∫squeda
    function setupSearchFunctionality() {
      const searchInput = document.getElementById('search-query');
      const suggestionsContainer = document.getElementById('suggestions-container');
      const searchButton = document.getElementById('search-button');
      
      if (!searchInput || !suggestionsContainer || !searchButton) return;
      
      // T√©rminos sugeridos
      const suggestions = [
        "cefalea intensa, fotofobia, fiebre",
        "diabetes mellitus tipo 2 tratamiento",
        "metformina mecanismo de acci√≥n",
        "protocolo de esclerosis m√∫ltiple",
        "parkinson diagn√≥stico",
        "losart√°n interacciones",
        "punci√≥n lumbar indicaciones",
        "RM cerebral en esclerosis m√∫ltiple",
        "s√≠ntomas de insuficiencia card√≠aca",
        "manejo de meningitis bacteriana",
        "tratamiento de VIH",
        "ajuste de dosis en insuficiencia renal"
      ];
      
      function performSearch(query) {
        if (!query || query.trim().length < 2) return;
        
        APP_STATE.searchQuery = query.trim();
        const terms = query.toLowerCase().split(' ').filter(t => t.length > 2);
        
        if (terms.length === 0) return;
        
        // Realizar b√∫squeda en todas las bases de conocimiento
        const results = [];
        
        function addResult(type, data, relevance) {
          if (relevance > 0) {
            results.push({ type, data, relevance });
          }
        }
        
        function calculateRelevance(text, terms) {
          let score = 0;
          const textLower = text.toLowerCase();
          
          terms.forEach(term => {
            if (textLower.includes(term)) {
              // Puntuaci√≥n m√°s alta si el t√©rmino est√° al principio
              const index = textLower.indexOf(term);
              if (index === 0) {
                score += 3;
              } else if (index < 20) {
                score += 2;
              } else {
                score += 1;
              }
            }
          });
          
          return score;
        }
        
        // B√∫squeda en enfermedades
        medicalKnowledgeBase.diseases.forEach(disease => {
          const text = `${disease.nombre} ${disease.codigoCIE10} ${disease.etiologia} ${disease.fisiopatologia} ${disease.diagnostico} ${disease.tratamientos.join(' ')} ${disease.pronostico}`.toLowerCase();
          addResult('disease', disease, calculateRelevance(text, terms));
        });
        
        // B√∫squeda en medicamentos
        Object.values(medicalKnowledgeBase.treatments).forEach(drug => {
          const text = `${drug.nombre} ${drug.laboratorio} ${drug.mecanismoAccion} ${drug.efectosAdversos.join(' ')} ${drug.contraindicaciones.join(' ')}`.toLowerCase();
          addResult('drug', drug, calculateRelevance(text, terms));
        });
        
        // B√∫squeda en protocolos
        medicalKnowledgeBase.protocols.forEach(protocol => {
          const text = `${protocol.nombre} ${protocol.area} ${protocol.descripcion} ${protocol.pasos.join(' ')} ${protocol.referencias.join(' ')}`.toLowerCase();
          addResult('protocol', protocol, calculateRelevance(text, terms));
        });
        
        // B√∫squeda en procedimientos
        medicalKnowledgeBase.medicalProcedures.forEach(procedure => {
          const text = `${procedure.nombre} ${procedure.indicaciones.join(' ')} ${procedure.contraindicaciones.join(' ')} ${procedure.riesgos.join(' ')}`.toLowerCase();
          addResult('procedure', procedure, calculateRelevance(text, terms));
        });
        
        // B√∫squeda en pruebas m√©dicas
        medicalKnowledgeBase.medicalTests.forEach(test => {
          const text = `${test.nombre} ${test.indicaciones.join(' ')} ${test.interpretacion}`.toLowerCase();
          addResult('test', test, calculateRelevance(text, terms));
        });
        
        // Ordenar por relevancia
        results.sort((a, b) => b.relevance - a.relevance);
        
        // Mostrar resultados
        displaySearchResults(results.slice(0, 10));
      }
      
      function displaySearchResults(results) {
        const resultsContainer = document.getElementById('search-results');
        if (!resultsContainer) return;
        
        if (results.length === 0) {
          resultsContainer.innerHTML = '<p>No se encontraron resultados para su b√∫squeda.</p>';
          return;
        }
        
        let html = '<h3>Resultados de B√∫squeda</h3>';
        
        results.forEach(result => {
          html += `
            <div class="search-result">
              <h4>${result.data.nombre || result.data.titulo}</h4>
              <p>${result.type === 'disease' ? 
                `<strong>C√≥digo CIE-10:</strong> ${result.data.codigoCIE10} | <strong>Prevalencia:</strong> ${(result.data.prevalencia * 100).toFixed(3)}%` : 
                result.type === 'drug' ? 
                `<strong>Laboratorio:</strong> ${result.data.laboratorio} | <strong>Indicaciones:</strong> ${result.data.indicaciones.slice(0,2).join(', ')}...` : 
                result.type === 'protocol' ? 
                `<strong>√Årea:</strong> ${result.data.area} | <strong>Referencias:</strong> ${result.data.referencias.join(', ')}` : 
                result.type === 'procedure' ? 
                `<strong>Indicaciones:</strong> ${result.data.indicaciones.slice(0,2).join(', ')}...` : 
                result.type === 'test' ? 
                `<strong>Indicaciones:</strong> ${result.data.indicaciones.slice(0,2).join(', ')}...` : ''}
              </p>
              <div class="result-actions">
                <button class="btn btn-detail" onclick="showDetail('${result.type}', '${result.data.id || result.data.nombre}')">
                  <span class="material-symbols-outlined">info</span>Detalles
                </button>
                ${result.data.imagenes && result.data.imagenes.length > 0 ? 
                  `<button class="btn btn-view-image" onclick="showImageGallery(${JSON.stringify(result.data.imagenes)})">
                    <span class="material-symbols-outlined">image</span>Im√°genes
                  </button>` : ''}
              </div>
            </div>
          `;
        });
        
        resultsContainer.innerHTML = html;
      }
      
      // Eventos de b√∫squeda
      searchInput.addEventListener('focus', () => {
        if (searchInput.value === '') {
          suggestionsContainer.innerHTML = '';
          suggestions.forEach(suggestion => {
            const item = createEl('div', { className: 'suggestion-item' }, [suggestion]);
            item.addEventListener('click', () => {
              searchInput.value = suggestion;
              suggestionsContainer.style.display = 'none';
              performSearch(suggestion);
            });
            suggestionsContainer.appendChild(item);
          });
          suggestionsContainer.style.display = 'block';
        }
      });
      
      searchInput.addEventListener('input', () => {
        const query = searchInput.value.toLowerCase().trim();
        if (query === '') {
          suggestionsContainer.style.display = 'none';
          return;
        }
        
        const filteredSuggestions = suggestions.filter(suggestion => 
          suggestion.toLowerCase().includes(query)
        );
        
        suggestionsContainer.innerHTML = '';
        if (filteredSuggestions.length > 0) {
          filteredSuggestions.forEach(suggestion => {
            const item = createEl('div', { className: 'suggestion-item' }, [
              suggestion.replace(new RegExp(query, 'gi'), match => 
                `<span class="highlight">${match}</span>`
              )
            ]);
            item.addEventListener('click', () => {
              searchInput.value = suggestion;
              suggestionsContainer.style.display = 'none';
              performSearch(suggestion);
            });
            suggestionsContainer.appendChild(item);
          });
          suggestionsContainer.style.display = 'block';
        } else {
          suggestionsContainer.style.display = 'none';
        }
      });
      
      searchButton.addEventListener('click', () => {
        const query = searchInput.value.trim();
        if (query) {
          performSearch(query);
          suggestionsContainer.style.display = 'none';
        }
      });
      
      // Ocultar sugerencias al hacer clic fuera
      document.addEventListener('click', (e) => {
        if (!searchInput.contains(e.target) && !suggestionsContainer.contains(e.target)) {
          suggestionsContainer.style.display = 'none';
        }
      });
    }

    function showDetail(type, id) {
      let data = null;
      
      switch(type) {
        case 'disease':
          data = medicalKnowledgeBase.diseases.find(item => item.id === id);
          break;
        case 'drug':
          data = medicalKnowledgeBase.treatments[id];
          break;
        case 'protocol':
          data = medicalKnowledgeBase.protocols.find(item => item.id === id);
          break;
        case 'procedure':
          data = medicalKnowledgeBase.medicalProcedures.find(item => item.id === id);
          break;
        case 'test':
          data = medicalKnowledgeBase.medicalTests.find(item => item.id === id);
          break;
      }
      
      if (!data) {
        showNotification('No se pudo cargar el detalle.', 'error');
        return;
      }
      
      let content = `
        <div class="modal-header">
          <h2><span class="material-symbols-outlined">info</span> Detalles de ${data.nombre || data.titulo}</h2>
          <button class="modal-close-btn" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body modal-detail-content">
      `;
      
      switch(type) {
        case 'disease':
          content += `
            <h3>C√≥digo CIE-10: ${data.codigoCIE10}</h3>
            <h4>Etiolog√≠a</h4>
            <p>${data.etiologia}</p>
            <h4>Fisiopatolog√≠a</h4>
            <p>${data.fisiopatologia}</p>
            <h4>Prevalencia</h4>
            <p>${(data.prevalencia * 100).toFixed(3)}%</p>
            <h4>Factores de Riesgo</h4>
            <p>${data.factoresRiesgo.join(', ')}</p>
            <h4>Presentaci√≥n Cl√≠nica</h4>
            <p>${data.presentacionClinica ? data.presentacionClinica.join(', ') : 'No disponible'}</p>
            <h4>Diagn√≥stico</h4>
            <p>${data.diagnostico}</p>
            <h4>Diagn√≥sticos Diferenciales</h4>
            <p>${data.diagnosticosDiferenciales.join(', ')}</p>
            <h4>Tratamientos</h4>
            <p>${data.tratamientos.join(', ')}</p>
            <h4>Protocolos</h4>
            <p>${data.protocolos.join(', ')}</p>
            <h4>Pron√≥stico</h4>
            <p>${data.pronostico}</p>
            <h4>Educaci√≥n al Paciente</h4>
            <p>${data.educacionPaciente}</p>
            <h4>Recursos Adicionales</h4>
            <p>${data.recursosAdicionales.map(link => `<a href="${link}" target="_blank">${link}</a>`).join(', ')}</p>
          `;
          break;
          
        case 'drug':
          content += `
            <h3>Laboratorio: ${data.laboratorio}</h3>
            <h4>Indicaciones</h4>
            <p>${data.indicaciones.join(', ')}</p>
            <h4>Mecanismo de Acci√≥n</h4>
            <p>${data.mecanismoAccion}</p>
            <h4>Farmacocin√©tica</h4>
            <p>${data.farmacocinetica}</p>
            <h4>Efectos Adversos</h4>
            <p>${data.efectosAdversos.join(', ')}</p>
            <h4>Contraindicaciones</h4>
            <p>${data.contraindicaciones.join(', ')}</p>
            <h4>Interacciones</h4>
            ${Object.keys(data.interacciones).length > 0 ? 
              `<table>
                <tr><th>Medicamento</th><th>Severidad</th><th>Descripci√≥n</th></tr>
                ${Object.keys(data.interacciones).map(interaccion => 
                  `<tr>
                    <td>${interaccion}</td>
                    <td class="severity-${data.interacciones[interaccion].severidad}">${data.interacciones[interaccion].severidad}</td>
                    <td>${data.interacciones[interaccion].descripcion}</td>
                  </tr>`
                ).join('')}
              </table>` : 
              '<p>No hay interacciones registradas.</p>'
            }
          `;
          break;
          
        case 'protocol':
          content += `
            <h3>√Årea: ${data.area}</h3>
            <h4>Descripci√≥n</h4>
            <p>${data.descripcion}</p>
            <h4>Pasos</h4>
            <ol>
              ${data.pasos.map(paso => `<li>${paso}</li>`).join('')}
            </ol>
            <h4>Referencias</h4>
            <p>${data.referencias.join(', ')}</p>
          `;
          break;
          
        case 'procedure':
          content += `
            <h4>Indicaciones</h4>
            <p>${data.indicaciones.join(', ')}</p>
            <h4>Contraindicaciones</h4>
            <p>${data.contraindicaciones.join(', ')}</p>
            <h4>Riesgos</h4>
            <p>${data.riesgos.join(', ')}</p>
          `;
          break;
          
        case 'test':
          content += `
            <h4>Indicaciones</h4>
            <p>${data.indicaciones.join(', ')}</p>
            <h4>Interpretaci√≥n</h4>
            <p>${data.interpretacion}</p>
            ${data.contraindicaciones ? 
              `<h4>Contraindicaciones</h4>
              <p>${data.contraindicaciones.join(', ')}</p>` : ''}
            ${data.riesgos ? 
              `<h4>Riesgos</h4>
              <p>${data.riesgos.join(', ')}</p>` : ''}
          `;
          break;
      }
      
      // A√±adir im√°genes si existen
      if (data.imagenes && data.imagenes.length > 0) {
        content += `
          <h4>Im√°genes</h4>
          <div class="image-gallery">
            ${data.imagenes.map((img, index) => 
              `<img src="${img.url}" alt="${img.descripcion}" class="image-thumbnail" onclick="showMainImage('${img.url}', ${index})">`
            ).join('')}
          </div>
          <img src="${data.imagenes[0].url}" class="main-image" id="main-image-display">
          <p id="image-description">${data.imagenes[0].descripcion}</p>
        `;
      }
      
      content += `
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="closeModal()">Cerrar</button>
        </div>
      `;
      
      document.getElementById('modal-overlay').innerHTML = content;
      document.getElementById('modal-overlay').classList.add('active');
    }

    function showImageGallery(images) {
      APP_STATE.imageGallery = images;
      APP_STATE.currentImageIndex = 0;
      
      let content = `
        <div class="modal-header">
          <h2><span class="material-symbols-outlined">image</span> Galer√≠a de Im√°genes</h2>
          <button class="modal-close-btn" onclick="closeModal()">&times;</button>
        </div>
        <div class="modal-body">
          <img src="${images[0].url}" class="main-image" id="gallery-main-image">
          <p id="gallery-image-description">${images[0].descripcion}</p>
          <div class="image-gallery">
            ${images.map((img, index) => 
              `<img src="${img.url}" alt="${img.descripcion}" class="image-thumbnail ${index === 0 ? 'active' : ''}" onclick="changeGalleryImage(${index})">`
            ).join('')}
          </div>
          <div style="display: flex; justify-content: space-between; margin-top: 20px;">
            <button class="btn btn-secondary" onclick="prevGalleryImage()" ${images.length <= 1 ? 'disabled' : ''}>
              <span class="material-symbols-outlined">arrow_back</span>Anterior
            </button>
            <button class="btn btn-secondary" onclick="nextGalleryImage()" ${images.length <= 1 ? 'disabled' : ''}>
              Siguiente<span class="material-symbols-outlined">arrow_forward</span>
            </button>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-secondary" onclick="closeModal()">Cerrar</button>
        </div>
      `;
      
      document.getElementById('modal-overlay').innerHTML = content;
      document.getElementById('modal-overlay').classList.add('active');
    }

    function showMainImage(url, index) {
      document.getElementById('main-image-display').src = url;
      document.getElementById('image-description').textContent = APP_STATE.imageGallery[index].descripcion;
      
      // Actualizar clases de miniaturas
      const thumbnails = document.querySelectorAll('.image-thumbnail');
      thumbnails.forEach((thumb, i) => {
        if (i === index) {
          thumb.classList.add('active');
        } else {
          thumb.classList.remove('active');
        }
      });
    }

    function changeGalleryImage(index) {
      APP_STATE.currentImageIndex = index;
      const images = APP_STATE.imageGallery;
      
      document.getElementById('gallery-main-image').src = images[index].url;
      document.getElementById('gallery-image-description').textContent = images[index].descripcion;
      
      // Actualizar clases de miniaturas
      const thumbnails = document.querySelectorAll('.image-thumbnail');
      thumbnails.forEach((thumb, i) => {
        if (i === index) {
          thumb.classList.add('active');
        } else {
          thumb.classList.remove('active');
        }
      });
    }

    function prevGalleryImage() {
      if (APP_STATE.currentImageIndex > 0) {
        changeGalleryImage(APP_STATE.currentImageIndex - 1);
      }
    }

    function nextGalleryImage() {
      if (APP_STATE.currentImageIndex < APP_STATE.imageGallery.length - 1) {
        changeGalleryImage(APP_STATE.currentImageIndex + 1);
      }
    }

    // Funciones para recetas
    function setupPrescriptions() {
      let entryCounter = 1;
      
      document.getElementById('add-medication')?.addEventListener('click', () => {
        const medicationEntries = document.getElementById('medication-entries');
        const newEntry = createEl('div', { className: 'medication-entry' }, [
          createEl('div', { className: 'form-row' }, [
            createEl('div', { className: 'form-group flex-grow' }, [
              createEl('label', { htmlFor: `medication-${entryCounter}` }, ['Medicamento']),
              createEl('input', { 
                type: 'text', 
                id: `medication-${entryCounter}`, 
                className: 'form-control medication-name',
                placeholder: 'Nombre del medicamento',
                oninput: checkInteractions
              })
            ]),
            createEl('div', { className: 'form-group' }, [
              createEl('label', { htmlFor: `dose-${entryCounter}` }, ['Dosis']),
              createEl('input', { 
                type: 'text', 
                id: `dose-${entryCounter}`, 
                className: 'form-control',
                placeholder: '10mg'
              })
            ]),
            createEl('div', { className: 'form-group' }, [
              createEl('label', { htmlFor: `frequency-${entryCounter}` }, ['Frecuencia']),
              createEl('select', { id: `frequency-${entryCounter}`, className: 'form-control' }, [
                createEl('option', { value: 'once' }, ['1 vez al d√≠a']),
                createEl('option', { value: 'twice' }, ['2 veces al d√≠a']),
                createEl('option', { value: 'thrice' }, ['3 veces al d√≠a']),
                createEl('option', { value: 'four-times' }, ['4 veces al d√≠a']),
                createEl('option', { value: 'as-needed' }, ['Seg√∫n necesidad'])
              ])
            ]),
            createEl('div', { className: 'form-group' }, [
              createEl('label', { htmlFor: `duration-${entryCounter}` }, ['Duraci√≥n']),
              createEl('input', { 
                type: 'text', 
                id: `duration-${entryCounter}`, 
                className: 'form-control',
                placeholder: '7 d√≠as'
              })
            ])
          ]),
          createEl('div', { className: 'form-group' }, [
            createEl('label', { htmlFor: `instructions-${entryCounter}` }, ['Instrucciones']),
            createEl('textarea', { 
              id: `instructions-${entryCounter}`, 
              className: 'form-control',
              rows: '2',
              placeholder: 'Tomar despu√©s de las comidas...'
            })
          ]),
          createEl('button', { 
            className: 'btn btn-danger',
            onclick: () => {
              newEntry.remove();
              checkInteractions();
            }
          }, [
            createEl('span', { className: 'material-symbols-outlined' }, ['delete']),
            'Eliminar'
          ])
        ]);
        
        medicationEntries.appendChild(newEntry);
        entryCounter++;
      });
      
      document.getElementById('issue-prescription')?.addEventListener('click', () => {
        const patientId = document.getElementById('recipe-patient').value;
        if (!patientId) {
          showNotification('Por favor, seleccione un paciente.', 'warning');
          return;
        }
        
        const medicationEntries = document.querySelectorAll('.medication-entry');
        if (medicationEntries.length === 0) {
          showNotification('Por favor, a√±ada al menos un medicamento a la receta.', 'warning');
          return;
        }
        
        // Verificar interacciones antes de emitir
        const warningDiv = document.getElementById('interactions-warning');
        if (warningDiv && warningDiv.style.display === 'block') {
          const confirmIssue = confirm('Hay interacciones medicamentosas detectadas. ¬øDesea continuar con la emisi√≥n de la receta?');
          if (!confirmIssue) return;
        }
        
        const patient = DATA_STORE.patients.find(p => p.id === parseInt(patientId));
        showNotification(`Receta emitida para ${patient.nombre} con √©xito.`, 'success');
      });
    }

    function checkInteractions() {
      const medicationEntries = document.querySelectorAll('.medication-entry');
      const currentMedications = [];
      
      medicationEntries.forEach(entry => {
        const medNameInput = entry.querySelector('.medication-name');
        if (medNameInput && medNameInput.value) {
          currentMedications.push(medNameInput.value.trim());
        }
      });
      
      if (currentMedications.length < 2) {
        document.getElementById('interactions-warning').style.display = 'none';
        return;
      }
      
      const warnings = new Set();
      
      // Verificar interacciones directas
      for (let i = 0; i < currentMedications.length; i++) {
        const med1Name = currentMedications[i];
        if (medicalKnowledgeBase.treatments[med1Name]) {
          const med1Data = medicalKnowledgeBase.treatments[med1Name];
          for (let j = i + 1; j < currentMedications.length; j++) {
            const med2Name = currentMedications[j];
            if (med1Data.interacciones[med2Name]) {
              const interaction = med1Data.interacciones[med2Name];
              warnings.add(`${med1Name} - ${med2Name}: ${interaction.descripcion} (<span class="severity-${interaction.severidad}">${interaction.severidad}</span>)`);
            }
          }
        }
      }
      
      // Mostrar advertencias
      const warningDiv = document.getElementById('interactions-warning');
      const warningList = document.getElementById('interactions-list');
      
      if (warnings.size > 0) {
        warningList.innerHTML = '';
        warnings.forEach(warning => {
          const li = document.createElement('li');
          li.innerHTML = warning;
          warningList.appendChild(li);
        });
        warningDiv.style.display = 'block';
      } else {
        warningDiv.style.display = 'none';
      }
    }

    // Funciones para calculadoras
    function setupCalculators() {
      // Calculadora de IMC
      document.getElementById('weight-imc')?.addEventListener('input', calculateIMC);
      document.getElementById('height-imc')?.addEventListener('input', calculateIMC);
      
      // Calculadora de Filtrado Glomerular
      document.getElementById('creatinine')?.addEventListener('input', calculateFiltration);
      document.getElementById('age')?.addEventListener('input', calculateFiltration);
      document.querySelectorAll('input[name="sex"]').forEach(radio => {
        radio.addEventListener('change', calculateFiltration);
      });
      
      // Calculadora de Child-Pugh
      document.getElementById('bilirrubin')?.addEventListener('input', calculateChildPugh);
      document.getElementById('albumin')?.addEventListener('input', calculateChildPugh);
      document.getElementById('inr')?.addEventListener('input', calculateChildPugh);
      document.getElementById('ascites')?.addEventListener('change', calculateChildPugh);
      document.getElementById('encephalopathy')?.addEventListener('change', calculateChildPugh);
      
      // Calculadora de SCORE
      document.getElementById('age-score')?.addEventListener('input', calculateSCORE);
      document.getElementById('total-cholesterol')?.addEventListener('input', calculateSCORE);
      document.getElementById('hdl-cholesterol')?.addEventListener('input', calculateSCORE);
      document.getElementById('systolic-pressure')?.addEventListener('input', calculateSCORE);
      document.getElementById('smoker')?.addEventListener('change', calculateSCORE);
      document.getElementById('diabetes')?.addEventListener('change', calculateSCORE);
    }

    function calculateIMC() {
      const weight = parseFloat(document.getElementById('weight-imc').value);
      const height = parseFloat(document.getElementById('height-imc').value);
      
      if (!weight || !height) {
        document.getElementById('imc-result').style.display = 'none';
        return;
      }
      
      const heightInMeters = height / 100;
      const imc = weight / (heightInMeters * heightInMeters);
      
      let category = '';
      if (imc < 18.5) {
        category = 'Bajo peso';
      } else if (imc < 25) {
        category = 'Peso normal';
      } else if (imc < 30) {
        category = 'Sobrepeso';
      } else {
        category = 'Obesidad';
      }
      
      document.getElementById('imc-value').textContent = imc.toFixed(2);
      document.getElementById('imc-category').textContent = category;
      document.getElementById('imc-result').style.display = 'block';
    }

    function calculateFiltration() {
      const creatinine = parseFloat(document.getElementById('creatinine').value);
      const age = parseInt(document.getElementById('age').value);
      const sex = document.querySelector('input[name="sex"]:checked')?.value;
      
      if (!creatinine || !age || !sex) {
        document.getElementById('filtration-result').style.display = 'none';
        return;
      }
      
      // F√≥rmula CKD-EPI
      let k, a, sexFactor;
      
      if (sex === 'female') {
        k = 0.7;
        a = creatinine <= 0.7 ? -0.329 : -1.209;
        sexFactor = 1.018;
      } else {
        k = 0.9;
        a = creatinine <= 0.9 ? -0.411 : -1.209;
        sexFactor = 1;
      }
      
      const filtration = 141 * Math.pow(Math.min(creatinine/k, 1), a) * Math.pow(Math.max(creatinine/k, 1), -1.209) * Math.pow(0.993, age) * sexFactor;
      
      let category = '';
      if (filtration >= 90) {
        category = 'Normal';
      } else if (filtration >= 60) {
        category = 'Leve (G2)';
      } else if (filtration >= 30) {
        category = 'Moderada (G3)';
      } else if (filtration >= 15) {
        category = 'Severa (G4)';
      } else {
        category = 'Terminal (G5)';
      }
      
      document.getElementById('filtration-value').textContent = filtration.toFixed(0);
      document.getElementById('filtration-category').textContent = category;
      document.getElementById('filtration-result').style.display = 'block';
    }

    function calculateChildPugh() {
      const bilirrubin = parseFloat(document.getElementById('bilirrubin').value);
      const albumin = parseFloat(document.getElementById('albumin').value);
      const inr = parseFloat(document.getElementById('inr').value);
      const ascites = parseInt(document.getElementById('ascites').value);
      const encephalopathy = parseInt(document.getElementById('encephalopathy').value);
      
      if (!bilirrubin || !albumin || !inr) {
        document.getElementById('child-pugh-result').style.display = 'none';
        return;
      }
      
      // Puntuaci√≥n Child-Pugh
      let score = 0;
      
      // Bilirrubina
      if (bilirrubin < 2) score += 1;
      else if (bilirrubin < 3) score += 2;
      else score += 3;
      
      // Alb√∫mina
      if (albumin > 3.5) score += 1;
      else if (albumin >= 2.8) score += 2;
      else score += 3;
      
      // INR
      if (inr < 1.7) score += 1;
      else if (inr < 2.3) score += 2;
      else score += 3;
      
      // Ascitis
      score += ascites;
      
      // Encefalopat√≠a
      score += encephalopathy;
      
      // Clasificaci√≥n
      let classification = '';
      if (score <= 6) {
        classification = 'Clase A';
      } else if (score <= 9) {
        classification = 'Clase B';
      } else {
        classification = 'Clase C';
      }
      
      document.getElementById('child-pugh-score').textContent = score;
      document.getElementById('child-pugh-class').textContent = classification;
      document.getElementById('child-pugh-result').style.display = 'block';
    }

    function calculateSCORE() {
      const age = parseInt(document.getElementById('age-score').value);
      const totalCholesterol = parseFloat(document.getElementById('total-cholesterol').value);
      const hdlCholesterol = parseFloat(document.getElementById('hdl-cholesterol').value);
      const systolicPressure = parseInt(document.getElementById('systolic-pressure').value);
      const smoker = document.getElementById('smoker').checked;
      const diabetes = document.getElementById('diabetes').checked;
      
      if (!age || !totalCholesterol || !hdlCholesterol || !systolicPressure) {
        document.getElementById('score-result').style.display = 'none';
        return;
      }
      
      // F√≥rmula SCORE simplificada (aproximaci√≥n)
      let score = 0;
      
      // Factores de riesgo
      if (age >= 70) score += 3;
      else if (age >= 60) score += 2;
      else if (age >= 50) score += 1;
      
      if (totalCholesterol >= 240) score += 3;
      else if (totalCholesterol >= 200) score += 2;
      else if (totalCholesterol >= 160) score += 1;
      
      if (systolicPressure >= 180) score += 3;
      else if (systolicPressure >= 160) score += 2;
      else if (systolicPressure >= 140) score += 1;
      
      if (smoker) score += 1;
      if (diabetes) score += 1;
      
      // Categorizaci√≥n aproximada
      let risk = '';
      if (score <= 2) {
        risk = 'Riesgo Bajo (<1%)';
      } else if (score <= 4) {
        risk = 'Riesgo Bajo (1-2%)';
      } else if (score <= 6) {
        risk = 'Riesgo Moderado (3-5%)';
      } else if (score <= 8) {
        risk = 'Riesgo Moderado (6-9%)';
      } else if (score <= 10) {
        risk = 'Riesgo Alto (10-15%)';
      } else {
        risk = 'Riesgo Alto (>15%)';
      }
      
      document.getElementById('score-value').textContent = risk.split(' ')[1] || 'Desconocido';
      document.getElementById('score-category').textContent = risk.split('(')[0].trim();
      document.getElementById('score-result').style.display = 'block';
    }

    // Funciones auxiliares
    function updatePatientSelect(selectId) {
      const select = document.getElementById(selectId);
      if (!select) return;
      
      select.innerHTML = '<option value="">Selecciona un paciente...</option>';
      
      DATA_STORE.patients.forEach(patient => {
        const option = document.createElement('option');
        option.value = patient.id;
        option.textContent = patient.nombre;
        select.appendChild(option);
      });
    }

    function updateDashboard() {
      // Actualizar indicadores
      document.querySelector('.indicator-card:nth-child(1) h3').textContent = DATA_STORE.patients.length;
      document.querySelector('.indicator-card:nth-child(2) h3').textContent = DATA_STORE.appointments.filter(a => a.fecha === new Date().toISOString().split('T')[0]).length;
      
      // Alertas de bajo stock
      const lowStockCount = DATA_STORE.pharmacyStock.filter(item => item.cantidad < item.umbral).length;
      document.querySelector('.indicator-card:nth-child(3) h3').textContent = lowStockCount;
      
      // Alertas cl√≠nicas
      let clinicalAlerts = 0;
      
      // Alertas de seguimiento
      DATA_STORE.patients.forEach(patient => {
        if (patient.historiaClinica.seguimiento) {
          patient.historiaClinica.seguimiento.forEach(seguimiento => {
            const today = new Date();
            const nextDate = new Date(seguimiento.proximo);
            const diffTime = nextDate - today;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays <= 7 && diffDays >= 0) {
              clinicalAlerts++;
            }
          });
        }
      });
      
      // Alertas de bajo stock
      clinicalAlerts += lowStockCount;
      
      document.querySelector('.indicator-card:nth-child(4) h3').textContent = clinicalAlerts;
      
      // Actualizar gr√°fico
      updateChart();
    }

    function updateChart() {
      const patientId = document.getElementById('chart-patient').value;
      const chartType = document.getElementById('chart-type').value;
      
      if (!patientId) return;
      
      const patient = DATA_STORE.patients.find(p => p.id === parseInt(patientId));
      if (!patient || !patient.historiaClinica.signosVitales || patient.historiaClinica.signosVitales.length === 0) return;
      
      const ctx = document.getElementById('vitals-chart');
      if (!ctx) return;
      
      // Datos seg√∫n el tipo de gr√°fico
      let data, labels, label;
      
      switch(chartType) {
        case 'pressure':
          data = patient.historiaClinica.signosVitales.map(v => {
            const parts = v.pa.split('/');
            return { x: v.fecha, y: parseInt(parts[0]), y2: parseInt(parts[1]) };
          });
          labels = data.map(d => d.x);
          label = 'Presi√≥n Arterial';
          break;
        case 'temperature':
          data = patient.historiaClinica.signosVitales.map(v => ({ x: v.fecha, y: v.temperatura }));
          labels = data.map(d => d.x);
          label = 'Temperatura (¬∞C)';
          break;
        case 'heart-rate':
          data = patient.historiaClinica.signosVitales.map(v => ({ x: v.fecha, y: v.fc }));
          labels = data.map(d => d.x);
          label = 'Frecuencia Card√≠aca';
          break;
        case 'spo2':
          data = patient.historiaClinica.signosVitales.map(v => ({ x: v.fecha, y: v.spo2 }));
          labels = data.map(d => d.x);
          label = 'Saturaci√≥n O2 (%)';
          break;
      }
      
      // Crear gr√°fico (simulado, ya que Chart.js no est√° disponible)
      const chartContainer = document.querySelector('.chart-container');
      chartContainer.innerHTML = `
        <h3>Evoluci√≥n de Signos Vitales</h3>
        <div style="background-color: #f8f9fa; height: 300px; display: flex; justify-content: center; align-items: center; border-radius: 8px; margin-bottom: 15px;">
          <p>Gr√°fico de ${label} para ${patient.nombre}</p>
        </div>
        <div class="chart-controls">
          <select id="chart-patient">
            <option value="">Seleccionar paciente...</option>
            ${DATA_STORE.patients.map(p => `<option value="${p.id}" ${p.id === parseInt(patientId) ? 'selected' : ''}>${p.nombre}</option>`).join('')}
          </select>
          <select id="chart-type">
            <option value="pressure" ${chartType === 'pressure' ? 'selected' : ''}>Presi√≥n Arterial</option>
            <option value="temperature" ${chartType === 'temperature' ? 'selected' : ''}>Temperatura</option>
            <option value="heart-rate" ${chartType === 'heart-rate' ? 'selected' : ''}>Frecuencia Card√≠aca</option>
            <option value="spo2" ${chartType === 'spo2' ? 'selected' : ''}>Saturaci√≥n O2</option>
          </select>
          <button id="refresh-chart">Actualizar</button>
        </div>
      `;
      
      // Reasignar eventos
      document.getElementById('chart-patient').addEventListener('change', updateChart);
      document.getElementById('chart-type').addEventListener('change', updateChart);
      document.getElementById('refresh-chart').addEventListener('click', updateChart);
      
      // Actualizar selects
      updatePatientSelect('chart-patient');
    }

    // Inicializar la aplicaci√≥n
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>
