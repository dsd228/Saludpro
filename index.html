<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Enfermería DAVID · Sistema completo con almacenamiento persistente">
    <title>Enfermería DAVID · Sistema Completo</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* Estilos modernizados con enfoque en fuentes confiables y diseño actual */
        :root {
            --bg: linear-gradient(135deg, #0f172a, #1e293b, #334155);
            --glass: rgba(15, 23, 42, 0.95);
            --glass-2: rgba(30, 41, 59, 0.8);
            --accent: #3b82f6;
            --accent-2: #2563eb;
            --accent-3: #1d4ed8;
            --primary-blue: #2563eb;
            --primary-blue-darker: #1d4ed8;
            --primary-blue-lighter: rgba(37, 99, 235, 0.1);
            --success-green: #10b981;
            --warning-yellow: #f59e0b;
            --alert-red: #ef4444;
            --text-light: #e2e8f0;
            --text-dark: #0f172a;
            --muted: #94a3b8;
            --danger: #ef4444;
            --card-radius: 24px;
            --shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);
            --shadow-sm: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 35px 60px -15px rgba(0, 0, 0, 0.2);
            --shadow-inset: inset 0 1px 2px rgba(255, 255, 255, 0.1);
            --tap: 48px;
            --font: 'Inter', 'Roboto', system-ui, -apple-system, "Segoe UI", sans-serif;
            --font-heading: 'Inter', 'Open Sans', system-ui, sans-serif;
            --maxwidth: 1600px;
            --border: rgba(148, 163, 184, 0.3);
            --border-light: rgba(148, 163, 184, 0.2);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-fast: all 0.15s ease;
            --z-header: 100;
            --z-sidebar: 90;
            --z-modal: 200;
            --gradient-primary: linear-gradient(135deg, #3b82f6, #2563eb);
            --gradient-secondary: linear-gradient(135deg, #60a5fa, #3b82f6);
            --gradient-success: linear-gradient(135deg, #10b981, #059669);
            --gradient-warning: linear-gradient(135deg, #f59e0b, #d97706);
            --gradient-danger: linear-gradient(135deg, #ef4444, #dc2626);
            --gradient-info: linear-gradient(135deg, #06b6d4, #0891b2);
        }
        :root[data-theme="light"] {
            --bg: linear-gradient(135deg, #f8fafc, #e2e8f0, #cbd5e1);
            --glass: rgba(255, 255, 255, 0.95);
            --glass-2: rgba(241, 245, 249, 0.9);
            --accent: #2563eb;
            --accent-2: #1d4ed8;
            --accent-3: #1e40af;
            --primary-blue: #1e40af;
            --primary-blue-darker: #1e40af;
            --primary-blue-lighter: rgba(30, 64, 175, 0.1);
            --success-green: #059669;
            --warning-yellow: #d97706;
            --alert-red: #dc2626;
            --text-light: #0f172a;
            --text-dark: #0f172a;
            --muted: #64748b;
            --border: rgba(100, 116, 139, 0.3);
            --border-light: rgba(100, 116, 139, 0.2);
            --gradient-primary: linear-gradient(135deg, #2563eb, #1d4ed8);
            --gradient-secondary: linear-gradient(135deg, #3b82f6, #2563eb);
            --gradient-success: linear-gradient(135deg, #059669, #047857);
            --gradient-warning: linear-gradient(135deg, #d97706, #b45309);
            --gradient-danger: linear-gradient(135deg, #dc2626, #b91c1c);
            --gradient-info: linear-gradient(135deg, #0891b2, #0e7490);
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            transition: var(--transition);
        }
        html, body {
            height: 100%;
            margin: 0;
            font-family: var(--font);
            background: var(--bg);
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            display: flex;
            justify-content: center;
            padding: 16px;
            color: var(--text-dark);
            overflow-x: hidden;
        }
        .app {
            width: 100%;
            max-width: var(--maxwidth);
            height: calc(100vh - 32px);
            display: flex;
            flex-direction: column;
            background: var(--glass);
            backdrop-filter: blur(24px);
            border-radius: var(--card-radius);
            box-shadow: var(--shadow);
            overflow: hidden;
            position: relative;
            border: 1px solid var(--border);
            border-bottom-width: 2px;
        }
        header {
            padding: 24px 32px;
            background: rgba(15, 23, 42, 0.98);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid var(--border);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: var(--z-header);
            box-shadow: 0 4px 24px rgba(0, 0, 0, 0.18);
        }
        header h1 {
            font-size: 1.9rem;
            font-weight: 700;
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 16px;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            letter-spacing: -0.5px;
        }
        .brand-icon {
            font-size: 2.2rem;
            color: var(--accent);
            text-shadow: 0 0 12px rgba(59, 130, 246, 0.4);
        }
        .controls {
            display: flex;
            align-items: center;
            gap: 18px;
        }
        .theme-toggle {
            background: var(--glass-2);
            border: none;
            font-size: 1.6rem;
            cursor: pointer;
            color: var(--text-light);
            padding: 14px;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
            transform: scale(1);
        }
        .theme-toggle:hover {
            background: var(--accent-2);
            transform: translateY(-3px) rotate(10deg);
            box-shadow: var(--shadow-md);
        }
        .theme-toggle:active {
            transform: translateY(-1px);
        }
        .container {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        .sidebar {
            width: 340px;
            background: var(--glass);
            border-right: 1px solid var(--border);
            padding: 24px;
            overflow-y: auto;
            transition: var(--transition);
            position: relative;
            z-index: var(--z-sidebar);
            box-shadow: var(--shadow-sm);
            border-right-width: 2px;
        }
        .sidebar-header {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 18px 0;
            margin-bottom: 28px;
            border-bottom: 1px solid var(--border-light);
            color: var(--accent);
        }
        .sidebar-header h3 {
            font-size: 1.3rem;
            font-weight: 600;
            letter-spacing: 0.8px;
        }
        .cat-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 16px;
        }
        .cat-btn {
            padding: 20px 24px;
            border: none;
            border-radius: 18px;
            background: var(--glass-2);
            color: var(--text-light);
            font-weight: 500;
            cursor: pointer;
            text-align: left;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 18px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            position: relative;
            overflow: hidden;
            font-size: 1.05rem;
            font-family: var(--font);
        }
        .cat-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 5px;
            height: 100%;
            background: transparent;
            transition: var(--transition);
        }
        .cat-btn:hover {
            background: var(--accent-2);
            color: white;
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }
        .cat-btn:hover::before {
            background: var(--accent);
        }
        .cat-btn.active {
            background: var(--accent-2);
            color: white;
            box-shadow: var(--shadow-md);
            font-weight: 600;
            transform: translateY(-2px);
        }
        .cat-btn.active::before {
            background: var(--accent);
        }
        .cat-btn i {
            font-size: 1.7rem;
            width: 32px;
            text-align: center;
            transition: var(--transition);
        }
        .cat-btn[data-cat="higiene"] i { color: #4ade80; }
        .cat-btn[data-cat="curaciones"] i { color: #38bdf8; }
        .cat-btn[data-cat="farmaco"] i { color: #a855f7; }
        .cat-btn[data-cat="emergencias"] i { color: #f87171; }
        .cat-btn[data-cat="movilizacion"] i { color: #fb923c; }
        .cat-btn[data-cat="nutricion"] i { color: #a3e635; }
        .cat-btn[data-cat="infeccion"] i { color: #fbbf24; }
        .cat-btn[data-cat="medicamentos"] i { color: #06b6d4; }
        .cat-btn[data-cat="enfermedades"] i { color: #818cf8; }
        .cat-btn[data-cat="pae"] i { color: #c084fc; }
        .cat-btn[data-cat="rcp"] i { color: #ec4899; }
        .cat-btn[data-cat="calculadoras"] i { color: #f97316; }
        .cat-btn[data-cat="recursos"] i { color: #06b6d4; }
        .cat-btn[data-cat="pacientes"] i { color: #8b5cf6; }
        .small {
            font-size: 0.95rem;
            color: var(--muted);
            margin-top: 12px;
            line-height: 1.6;
            opacity: 0.9;
        }
        main {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
            background: var(--glass);
            backdrop-filter: blur(10px);
        }
        .search-container {
            display: flex;
            gap: 14px;
            margin-bottom: 32px;
            position: sticky;
            top: 96px;
            background: var(--glass);
            padding: 16px 0;
            z-index: 50;
            border-radius: 14px;
            backdrop-filter: blur(12px);
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-sm);
        }
        .input {
            flex: 1;
            padding: 18px 24px;
            border: 1px solid var(--border-light);
            border-radius: 18px;
            font-family: var(--font);
            font-size: 1.1rem;
            background: rgba(255, 255, 255, 0.08);
            color: var(--text-light);
            box-shadow: var(--shadow-sm);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border-light);
        }
        .input::placeholder {
            color: rgba(226, 232, 240, 0.7);
        }
        .input:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2);
            background: rgba(255, 255, 255, 0.12);
        }
        .btn {
            padding: 18px 24px;
            border: none;
            border-radius: 18px;
            cursor: pointer;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            box-shadow: var(--shadow-sm);
            font-size: 1.1rem;
            transition: var(--transition);
            font-family: var(--font);
            font-weight: 500;
        }
        .btn.primary {
            background: var(--gradient-primary);
            color: white;
            border: 1px solid rgba(37, 99, 235, 0.3);
        }
        .btn.primary:hover {
            background: var(--gradient-secondary);
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }
        .btn.primary:active {
            transform: translateY(-2px);
        }
        .btn.secondary {
            background: var(--gradient-secondary);
            color: white;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        .btn.secondary:hover {
            background: var(--primary-blue-darker);
            transform: translateY(-4px);
            box-shadow: var(--shadow-md);
        }
        .btn.secondary:active {
            transform: translateY(-2px);
        }
        .btn.ghost {
            background: transparent;
            color: var(--accent);
            border: 1px solid var(--accent);
        }
        .btn.ghost:hover {
            background: var(--glass-2);
            transform: translateY(-4px);
        }
        .btn.small {
            padding: 12px 16px;
            font-size: 0.98rem;
        }
        .content-area {
            display: flex;
            flex-direction: column;
            gap: 28px;
        }
        .category-card {
            background: var(--glass-2);
            border-radius: 24px;
            padding: 32px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            transition: var(--transition);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border-light);
        }
        .category-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }
        .category-card h2 {
            color: var(--accent);
            margin-bottom: 24px;
            font-size: 1.7rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 14px;
            letter-spacing: -0.8px;
        }
        .category-card h2 i {
            font-size: 1.8rem;
        }
        .category-card h3 {
            color: var(--accent-2);
            margin: 24px 0 14px 0;
            font-size: 1.4rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
            letter-spacing: -0.5px;
        }
        .category-card h4 {
            color: var(--primary-blue);
            margin: 14px 0 10px 0;
            font-size: 1.2rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .procedure {
            margin-bottom: 28px;
            padding-bottom: 28px;
            border-bottom: 1px solid var(--border-light);
            transition: var(--transition);
            position: relative;
        }
        .procedure::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--accent);
            transition: var(--transition);
        }
        .procedure:hover::after {
            width: 100%;
        }
        .procedure:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .procedure h3 {
            color: var(--accent-2);
            margin-bottom: 14px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .procedure h3 i {
            font-size: 1.4rem;
            color: var(--accent);
        }
        .procedure p {
            margin: 8px 0;
            color: var(--text-light);
            line-height: 1.7;
            font-size: 1.05rem;
        }
        .procedure .summary {
            font-style: italic;
            color: var(--muted);
            margin-bottom: 14px;
            padding: 20px;
            background: var(--primary-blue-lighter);
            border-radius: 14px;
            border-left: 5px solid var(--primary-blue);
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-sm);
        }
        .procedure .summary i {
            color: var(--primary-blue);
            margin-right: 10px;
        }
        .materials, .steps, .notes {
            margin: 14px 0;
        }
        .materials ul, .steps ol {
            margin: 12px 0;
            padding-left: 32px;
        }
        .materials li, .steps li {
            margin: 8px 0;
            display: flex;
            align-items: flex-start;
            gap: 12px;
            line-height: 1.6;
        }
        .materials li::before, .steps li::before {
            content: "•";
            color: var(--accent);
            font-weight: bold;
            margin-top: 6px;
            font-size: 1.3rem;
        }
        .steps li::before {
            content: counter(step);
            counter-increment: step;
            background: var(--accent);
            color: white;
            width: 28px;
            height: 28px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            font-weight: bold;
            margin-top: 4px;
        }
        .notes {
            background: var(--primary-blue-lighter);
            padding: 22px 26px;
            border-radius: 16px;
            border-left: 5px solid var(--primary-blue);
            margin: 16px 0;
            font-size: 1.02rem;
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-sm);
        }
        .notes i {
            color: var(--primary-blue);
            margin-right: 12px;
        }
        .disease-panel {
            background: var(--glass-2);
            border-radius: 24px;
            padding: 32px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            margin-top: 28px;
            transition: var(--transition);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border-light);
        }
        .disease-panel h2 {
            color: var(--accent);
            margin-bottom: 24px;
            font-size: 1.7rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 14px;
        }
        .disease-panel h2 i {
            font-size: 1.8rem;
        }
        .disease-item {
            margin-bottom: 28px;
            padding-bottom: 28px;
            border-bottom: 1px solid var(--border-light);
            transition: var(--transition);
            position: relative;
        }
        .disease-item::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 0;
            height: 2px;
            background: var(--accent);
            transition: var(--transition);
        }
        .disease-item:hover::after {
            width: 100%;
        }
        .disease-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        .disease-item strong {
            color: var(--accent-2);
            font-size: 1.2rem;
            font-weight: 600;
        }
        .disease-item .small {
            font-size: 1.02rem;
            color: var(--muted);
            margin-top: 10px;
            line-height: 1.7;
        }
        .disease-item .small i {
            color: var(--primary-blue);
            margin-right: 8px;
        }
        .med-combo {
            background: var(--glass-2);
            border-radius: 24px;
            padding: 32px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            margin-top: 28px;
            transition: var(--transition);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border-light);
        }
        .med-combo h2 {
            color: var(--accent);
            margin-bottom: 28px;
            font-size: 1.7rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 14px;
        }
        .med-combo h2 i {
            font-size: 1.8rem;
        }
        .form-row {
            display: flex;
            gap: 24px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }
        .form-group {
            flex: 1;
            min-width: 260px;
        }
        .form-group label {
            display: block;
            margin-bottom: 12px;
            font-weight: 500;
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 1.08rem;
        }
        .form-group label i {
            color: var(--accent);
            font-size: 1.2rem;
        }
        select.form-control, input.form-control {
            width: 100%;
            padding: 18px 24px;
            border: 1px solid var(--border-light);
            border-radius: 18px;
            font-family: var(--font);
            font-size: 1.1rem;
            background: rgba(255, 255, 255, 0.08);
            color: var(--text-light);
            box-shadow: var(--shadow-sm);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border-light);
        }
        select.form-control:focus, input.form-control:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2);
            background: rgba(255, 255, 255, 0.12);
        }
        .interactions-warning {
            background: rgba(245, 158, 11, 0.18);
            border: 1px solid rgba(245, 158, 11, 0.35);
            border-radius: 18px;
            padding: 24px;
            margin: 24px 0;
            display: flex;
            align-items: flex-start;
            gap: 20px;
            animation: fadeIn 0.4s ease;
            backdrop-filter: blur(12px);
            border-left: 5px solid var(--warning-yellow);
            box-shadow: var(--shadow-sm);
        }
        .interactions-warning.danger {
            background: rgba(239, 68, 68, 0.18);
            border: 1px solid rgba(239, 68, 68, 0.35);
            color: #fecaca;
            border-left: 5px solid var(--alert-red);
        }
        .interactions-warning.success {
            background: rgba(16, 185, 129, 0.18);
            border: 1px solid rgba(16, 185, 129, 0.35);
            color: #d1fae5;
            border-left: 5px solid var(--success-green);
        }
        .interactions-warning i {
            font-size: 1.8rem;
            margin-top: 6px;
        }
        .interactions-warning.danger i {
            color: var(--alert-red);
        }
        .interactions-warning.success i {
            color: var(--success-green);
        }
        .interactions-list {
            margin: 12px 0 0 56px;
            flex: 1;
        }
        .interactions-list li {
            margin: 10px 0;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.12);
            color: var(--text-light);
            font-size: 1.02rem;
        }
        .interactions-list li:last-child {
            border-bottom: none;
        }
        .interactions-list li a {
            color: var(--accent);
            text-decoration: none;
            margin-left: 10px;
            font-weight: 500;
        }
        .interactions-list li a:hover {
            text-decoration: underline;
        }
        .pae-form {
            background: var(--glass-2);
            border-radius: 24px;
            padding: 32px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            margin-top: 28px;
            transition: var(--transition);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border-light);
        }
        .pae-form h2 {
            color: var(--accent);
            margin-bottom: 28px;
            font-size: 1.7rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 14px;
        }
        .pae-form h2 i {
            font-size: 1.8rem;
        }
        .rcp-guide {
            background: var(--glass-2);
            border-radius: 24px;
            padding: 32px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            margin-top: 28px;
            transition: var(--transition);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border-light);
        }
        .rcp-guide h2 {
            color: var(--accent);
            margin-bottom: 28px;
            font-size: 1.7rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 14px;
        }
        .rcp-guide h2 i {
            font-size: 1.8rem;
        }
        .rcp-step {
            margin-bottom: 28px;
            padding-left: 42px;
            position: relative;
            transition: var(--transition);
            padding: 20px 24px;
            background: rgba(37, 99, 235, 0.08);
            border-radius: 14px;
            border-left: 5px solid var(--primary-blue);
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-sm);
        }
        .rcp-step:hover {
            background: rgba(37, 99, 235, 0.14);
            transform: translateX(10px);
        }
        .rcp-step::before {
            content: attr(data-step);
            position: absolute;
            left: 0;
            top: 50%;
            transform: translateY(-50%);
            width: 36px;
            height: 36px;
            background: var(--accent);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.1rem;
            font-weight: bold;
            z-index: 1;
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
        }
        .score-result {
            background: var(--glass-2);
            border-radius: 24px;
            padding: 32px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            margin-top: 28px;
            text-align: center;
            transition: var(--transition);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border-light);
        }
        .score-result h3 {
            color: var(--accent);
            margin-bottom: 24px;
            font-size: 1.5rem;
            font-weight: 600;
        }
        .score-value {
            font-size: 2.8rem;
            font-weight: bold;
            color: var(--accent);
            margin: 24px 0;
            text-shadow: 0 2px 4px rgba(59, 130, 246, 0.3);
            font-family: 'Courier New', monospace;
            letter-spacing: -1px;
        }
        .score-category {
            font-size: 1.5rem;
            font-weight: 500;
            color: var(--accent-2);
        }
        .tab-container {
            margin-top: 28px;
        }
        .tabs {
            display: flex;
            border-bottom: 1px solid var(--border-light);
            margin-bottom: 28px;
            border-radius: 18px 18px 0 0;
            overflow: hidden;
            background: var(--glass-2);
            border: 1px solid var(--border-light);
        }
        .tab {
            padding: 18px 28px;
            cursor: pointer;
            font-weight: 500;
            color: var(--muted);
            border-bottom: 3px solid transparent;
            transition: var(--transition);
            background: transparent;
            flex: 1;
            text-align: center;
            font-size: 1.05rem;
        }
        .tab:first-child {
            border-radius: 18px 0 0 0;
        }
        .tab:last-child {
            border-radius: 0 18px 0 0;
        }
        .tab:hover {
            background: var(--accent-2);
            color: white;
        }
        .tab.active {
            color: var(--accent);
            border-bottom: 3px solid var(--accent);
            background: rgba(59, 130, 246, 0.12);
            font-weight: 600;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .calculator-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(380px, 1fr));
            gap: 28px;
            margin-top: 28px;
        }
        .calculator-form {
            background: var(--glass-2);
            border-radius: 24px;
            padding: 32px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            transition: var(--transition);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border-light);
        }
        .calculator-form:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }
        .calculator-form h3 {
            color: var(--accent);
            margin-bottom: 28px;
            font-size: 1.5rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 14px;
        }
        .calculator-form h3 i {
            font-size: 1.6rem;
        }
        .patient-list {
            background: var(--glass-2);
            border-radius: 24px;
            padding: 32px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            margin-top: 28px;
            transition: var(--transition);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border-light);
        }
        .patient-list h2 {
            color: var(--accent);
            margin-bottom: 28px;
            font-size: 1.7rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 14px;
        }
        .patient-list h2 i {
            font-size: 1.8rem;
        }
        .patient-card {
            background: var(--primary-blue-lighter);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            border-left: 6px solid var(--primary-blue);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-sm);
        }
        .patient-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(37, 99, 235, 0.12));
            opacity: 0;
            transition: var(--transition);
        }
        .patient-card:hover {
            transform: translateX(10px);
            background: rgba(37, 99, 235, 0.2);
        }
        .patient-card:hover::before {
            opacity: 1;
        }
        .patient-card::after {
            content: "→";
            position: absolute;
            right: 24px;
            top: 50%;
            transform: translateY(-50%);
            opacity: 0;
            transition: var(--transition);
            color: var(--primary-blue);
            font-weight: bold;
            font-size: 1.6rem;
        }
        .patient-card:hover::after {
            opacity: 1;
        }
        .patient-card:last-child {
            margin-bottom: 0;
        }
        .patient-card h3 {
            color: var(--primary-blue-darker);
            margin-bottom: 10px;
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .patient-card h3 i {
            color: var(--primary-blue);
            font-size: 1.4rem;
        }
        .patient-card p {
            margin: 6px 0;
            font-size: 1.02rem;
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .patient-card p i {
            color: var(--muted);
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }
        .resource-panel {
            background: var(--glass-2);
            border-radius: 24px;
            padding: 32px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            margin-top: 28px;
            transition: var(--transition);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border-light);
        }
        .resource-panel h2 {
            color: var(--accent);
            margin-bottom: 28px;
            font-size: 1.7rem;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 14px;
        }
        .resource-panel h2 i {
            font-size: 1.8rem;
        }
        .resource-card {
            background: var(--primary-blue-lighter);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            border-left: 6px solid var(--primary-blue);
            transition: var(--transition);
            border: 1px solid var(--border-light);
            box-shadow: var(--shadow-sm);
        }
        .resource-card:hover {
            transform: translateX(10px);
            background: rgba(37, 99, 235, 0.2);
        }
        .resource-card:last-child {
            margin-bottom: 0;
        }
        .resource-card h3 {
            color: var(--primary-blue-darker);
            margin-bottom: 10px;
            font-size: 1.2rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .resource-card h3 i {
            color: var(--primary-blue);
            font-size: 1.4rem;
        }
        .resource-card p {
            margin: 6px 0;
            font-size: 1.02rem;
            color: var(--text-light);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .resource-card p i {
            color: var(--muted);
            font-size: 1.2rem;
            width: 24px;
            text-align: center;
        }
        .resource-card a {
            display: inline-block;
            margin-top: 16px;
            padding: 12px 18px;
            background: var(--gradient-secondary);
            color: white;
            border-radius: 12px;
            text-decoration: none;
            font-weight: 500;
            transition: var(--transition);
            border: 1px solid rgba(59, 130, 246, 0.3);
            font-size: 1.02rem;
        }
        .resource-card a:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-sm);
        }
        .welcome-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-top: 28px;
        }
        .welcome-card {
            background: var(--glass-2);
            border-radius: 24px;
            padding: 32px;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-light);
            text-align: center;
            transition: var(--transition);
            cursor: pointer;
            backdrop-filter: blur(12px);
            position: relative;
            overflow: hidden;
            border: 1px solid var(--border-light);
        }
        .welcome-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, transparent, rgba(59, 130, 246, 0.12));
            opacity: 0;
            transition: var(--transition);
        }
        .welcome-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-lg);
        }
        .welcome-card:hover::before {
            opacity: 1;
        }
        .welcome-card i {
            font-size: 3.4rem;
            color: var(--accent);
            margin-bottom: 20px;
            transition: var(--transition);
        }
        .welcome-card:hover i {
            transform: scale(1.12);
        }
        .welcome-card h3 {
            color: var(--accent);
            margin-bottom: 12px;
            font-size: 1.4rem;
        }
        .welcome-card p {
            color: var(--muted);
            font-size: 1.02rem;
            line-height: 1.7;
        }
        .rcp-controls {
            display: flex;
            gap: 20px;
            margin-top: 28px;
            flex-wrap: wrap;
        }
        .rcp-timer {
            font-size: 2.4rem;
            font-weight: 700;
            color: var(--accent);
            margin: 24px 0;
            text-align: center;
            font-family: 'Courier New', monospace;
            background: rgba(59, 130, 246, 0.12);
            padding: 20px;
            border-radius: 18px;
            border: 2px solid var(--accent);
            box-shadow: var(--shadow-sm);
        }
        .rcp-state {
            font-size: 1.1rem;
            color: var(--muted);
            margin-bottom: 20px;
            text-align: center;
        }
        .detailed-info {
            background: rgba(37, 99, 235, 0.12);
            border: 1px solid var(--border-light);
            border-radius: 18px;
            padding: 24px;
            margin: 20px 0;
            font-size: 1.02rem;
            color: var(--text-light);
            box-shadow: var(--shadow-sm);
        }
        .detailed-info h4 {
            color: var(--primary-blue);
            margin: 14px 0 10px 0;
            font-size: 1.15rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .detailed-info p {
            margin: 8px 0;
            line-height: 1.7;
        }
        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.75);
            z-index: var(--z-modal);
            overflow-y: auto;
            backdrop-filter: blur(6px);
        }
        .modal-content {
            background: var(--glass);
            margin: 6% auto;
            padding: 36px;
            border-radius: var(--card-radius);
            width: 90%;
            max-width: 800px;
            box-shadow: var(--shadow-lg);
            border: 1px solid var(--border);
            position: relative;
            animation: modalFadeIn 0.4s;
            border: 2px solid var(--border);
        }
        .close-modal {
            position: absolute;
            top: 24px;
            right: 24px;
            font-size: 1.8rem;
            cursor: pointer;
            color: var(--muted);
            background: none;
            border: none;
        }
        .close-modal:hover {
            color: var(--alert-red);
            transform: rotate(90deg);
        }
        @keyframes modalFadeIn {
            from { opacity: 0; transform: translateY(-60px); }
            to { opacity: 1; transform: translateY(0); }
        }
        /* Mobile menu button */
        .mobile-menu-btn {
            display: none;
            background: var(--glass-2);
            border: none;
            font-size: 1.6rem;
            cursor: pointer;
            color: var(--text-light);
            padding: 14px;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            align-items: center;
            justify-content: center;
            transition: var(--transition);
            border: 1px solid var(--border);
            box-shadow: var(--shadow-sm);
        }
        .mobile-menu-btn:hover {
            background: var(--accent-2);
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }
        /* Patient form styles */
        .patient-form-container {
            padding: 24px 0;
        }
        .patient-form-container .form-row {
            margin-bottom: 24px;
        }
        .patient-form-container .form-group {
            margin-bottom: 18px;
        }
        .patient-form-container textarea {
            width: 100%;
            min-height: 120px;
            padding: 18px 24px;
            border: 1px solid var(--border-light);
            border-radius: 18px;
            font-family: var(--font);
            font-size: 1.1rem;
            background: rgba(255, 255, 255, 0.08);
            color: var(--text-light);
            box-shadow: var(--shadow-sm);
            backdrop-filter: blur(12px);
            resize: vertical;
            border: 1px solid var(--border-light);
        }
        .patient-form-container textarea:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 4px rgba(59, 130, 246, 0.2);
            background: rgba(255, 255, 255, 0.12);
        }
        .form-actions {
            display: flex;
            gap: 16px;
            justify-content: flex-end;
            margin-top: 28px;
            padding-top: 24px;
            border-top: 1px solid var(--border-light);
        }
        /* Notification styles */
        #notification-container {
            position: fixed;
            top: 24px;
            right: 24px;
            z-index: 1000;
            display: flex;
            flex-direction: column;
            gap: 12px;
            max-width: 400px;
        }
        .notification {
            padding: 20px 24px;
            border-radius: 16px;
            background: var(--glass);
            backdrop-filter: blur(12px);
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 16px;
            animation: fadeIn 0.4s ease;
            border: 1px solid var(--border);
        }
        .notification-success {
            background: rgba(16, 185, 129, 0.22);
            border-color: rgba(16, 185, 129, 0.38);
            color: var(--success-green);
        }
        .notification-error {
            background: rgba(239, 68, 68, 0.22);
            border-color: rgba(239, 68, 68, 0.38);
            color: var(--alert-red);
        }
        .notification-info {
            background: rgba(59, 130, 246, 0.22);
            border-color: rgba(59, 130, 246, 0.38);
            color: var(--accent);
        }
        .notification-warning {
            background: rgba(245, 158, 11, 0.22);
            border-color: rgba(245, 158, 11, 0.38);
            color: var(--warning-yellow);
        }
        .notification-close {
            margin-left: auto;
            background: none;
            border: none;
            cursor: pointer;
            color: inherit;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-16px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.08); }
            100% { transform: scale(1); }
        }
        /* Fuente confiable de información */
        .source-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent);
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.85rem;
            font-weight: 500;
            margin-left: 8px;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }
        .source-badge i {
            font-size: 0.9rem;
        }
        .source-badge.wiki {
            background: rgba(234, 234, 234, 0.2);
            color: #000000;
            border-color: rgba(234, 234, 234, 0.4);
        }
        .source-badge.fda {
            background: rgba(220, 38, 38, 0.15);
            color: var(--alert-red);
            border-color: rgba(220, 38, 38, 0.3);
        }
        .source-badge.who {
            background: rgba(0, 153, 255, 0.15);
            color: #0099ff;
            border-color: rgba(0, 153, 255, 0.3);
        }
        .source-reference {
            font-size: 0.9rem;
            color: var(--muted);
            margin-top: 8px;
            display: flex;
            align-items: center;
            gap: 8px;
            font-style: italic;
        }
        .source-reference a {
            color: var(--accent);
            text-decoration: none;
        }
        .source-reference a:hover {
            text-decoration: underline;
        }
        /* Enhanced search with sources */
        .search-suggestions {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: var(--glass);
            border: 1px solid var(--border-light);
            border-top: none;
            border-radius: 0 0 18px 18px;
            box-shadow: var(--shadow-md);
            z-index: 100;
            max-height: 300px;
            overflow-y: auto;
            backdrop-filter: blur(12px);
        }
        .suggestion-item {
            padding: 16px 24px;
            border-bottom: 1px solid var(--border-light);
            cursor: pointer;
            transition: var(--transition);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .suggestion-item:hover {
            background: var(--accent-2);
            color: white;
        }
        .suggestion-text {
            display: flex;
            align-items: center;
            gap: 12px;
        }
        .suggestion-text i {
            color: var(--accent);
            font-size: 1.2rem;
        }
        .suggestion-category {
            font-size: 0.9rem;
            background: rgba(59, 130, 246, 0.15);
            color: var(--accent);
            padding: 4px 12px;
            border-radius: 12px;
            font-weight: 500;
        }
        /* Mobile improvements */
        @media (max-width: 1200px) {
            .app {
                border-radius: 18px;
            }
            .category-card, .disease-panel, .med-combo, .pae-form, .rcp-guide, .patient-list, .resource-panel {
                border-radius: 18px;
                padding: 28px;
            }
            .calculator-container {
                grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
            }
        }
        @media (max-width: 1024px) {
            .app {
                border-radius: 16px;
            }
            .category-card, .disease-panel, .med-combo, .pae-form, .rcp-guide, .patient-list, .resource-panel {
                border-radius: 16px;
                padding: 24px;
            }
            .calculator-container {
                grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            }
        }
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                max-height: 320px;
                border-right: none;
                border-bottom: 1px solid var(--border);
                position: relative;
                z-index: 60;
            }
            .form-row {
                flex-direction: column;
            }
            .form-group {
                min-width: 100%;
            }
            .calculator-container {
                grid-template-columns: 1fr;
            }
            .welcome-actions {
                grid-template-columns: 1fr;
            }
            .rcp-controls {
                flex-direction: column;
            }
            header {
                padding: 20px;
            }
            .search-container {
                flex-direction: column;
            }
            .btn {
                width: 100%;
            }
            .app {
                border-radius: 14px;
            }
            .category-card, .disease-panel, .med-combo, .pae-form, .rcp-guide, .patient-list, .resource-panel {
                border-radius: 14px;
                padding: 20px;
            }
            .mobile-menu-btn {
                display: flex;
            }
            .sidebar.hidden-mobile {
                display: none;
            }
            .modal-content {
                width: 95%;
                margin: 12% auto;
                padding: 24px;
            }
            .search-suggestions {
                position: static;
                border-radius: 18px;
                margin-top: 8px;
                max-height: 200px;
            }
        }
        @media (max-width: 480px) {
            .app {
                border-radius: 14px;
            }
            .category-card, .disease-panel, .med-combo, .pae-form, .rcp-guide, .patient-list, .resource-panel {
                border-radius: 14px;
                padding: 18px;
            }
            .cat-btn {
                padding: 16px 20px;
                font-size: 1rem;
            }
            .input, .btn {
                font-size: 1rem;
            }
            header h1 {
                font-size: 1.6rem;
            }
            .modal-content {
                padding: 20px;
            }
            .welcome-card {
                padding: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="app">
        <header>
            <h1><i class="fas fa-microscope brand-icon"></i> Enfermería DAVID · Sistema Completo</h1>
            <div class="controls">
                <button class="theme-toggle" id="themeToggle" aria-label="Toggle theme">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="mobile-menu-btn" id="mobileMenuBtn" aria-label="Toggle menu">
                    <i class="fas fa-bars"></i>
                </button>
            </div>
        </header>
        <div class="container">
            <nav class="sidebar" id="sidebar" aria-label="Categorías">
                <div class="sidebar-header">
                    <i class="fas fa-th-large"></i>
                    <h3>Funcionalidades</h3>
                </div>
                <div class="cat-grid" role="navigation">
                    <button class="cat-btn" data-cat="higiene">
                        <i class="fas fa-soap"></i>
                        Higiene Clínica
                    </button>
                    <button class="cat-btn" data-cat="curaciones">
                        <i class="fas fa-band-aid"></i>
                        Curaciones Avanzadas
                    </button>
                    <button class="cat-btn" data-cat="farmaco">
                        <i class="fas fa-pills"></i>
                        Farmacología
                    </button>
                    <button class="cat-btn" data-cat="emergencias">
                        <i class="fas fa-ambulance"></i>
                        Emergencias Médicas
                    </button>
                    <button class="cat-btn" data-cat="movilizacion">
                        <i class="fas fa-wheelchair"></i>
                        Movilización
                    </button>
                    <button class="cat-btn" data-cat="nutricion">
                        <i class="fas fa-utensils"></i>
                        Nutrición
                    </button>
                    <button class="cat-btn" data-cat="infeccion">
                        <i class="fas fa-virus"></i>
                        Control Infecciones
                    </button>
                    <button class="cat-btn" data-cat="medicamentos">
                        <i class="fas fa-prescription-bottle-alt"></i>
                        Medicamentos
                    </button>
                    <button class="cat-btn" data-cat="enfermedades">
                        <i class="fas fa-notes-medical"></i>
                        Enfermedades
                    </button>
                    <button class="cat-btn" data-cat="pae">
                        <i class="fas fa-clipboard-list"></i>
                        PAE Avanzado
                    </button>
                    <button class="cat-btn" data-cat="rcp">
                        <i class="fas fa-heartbeat"></i>
                        RCP Integral
                    </button>
                    <button class="cat-btn" data-cat="calculadoras">
                        <i class="fas fa-calculator"></i>
                        Calculadoras Clínicas
                    </button>
                    <button class="cat-btn" data-cat="recursos">
                        <i class="fas fa-book"></i>
                        Recursos Educativos
                    </button>
                    <button class="cat-btn active" data-cat="pacientes">
                        <i class="fas fa-users"></i>
                        Gestión de Pacientes
                    </button>
                </div>
                <div class="small">
                    Seleccione una categoría para acceder a procedimientos, guías clínicas, combinador de fármacos, enfermedades y más funciones especializadas.
                </div>
            </nav>
            <main class="panel" id="mainPanel" aria-live="polite">
                <div class="search-container">
                    <div style="position: relative; flex: 1;">
                        <input id="globalSearch" class="input" placeholder="Buscar procedimiento, enfermedad, medicamento o paciente..." aria-label="Buscar">
                        <div id="searchSuggestions" class="search-suggestions"></div>
                    </div>
                    <button id="searchBtn" class="btn primary">
                        <i class="fas fa-search"></i> Buscar
                    </button>
                    <button id="openAllBtn" class="btn secondary">
                        <i class="fas fa-expand"></i> Mostrar Todo
                    </button>
                </div>
                <div class="content-area" id="contentArea">
                    <!-- Panel de pacientes como vista principal -->
                    <div class="patient-list" id="pacientes">
                        <h2><i class="fas fa-users"></i> Gestión Integral de Pacientes</h2>
                        <div class="form-row">
                            <div class="form-group">
                                <label for="patient-search"><i class="fas fa-search"></i> Buscar paciente por nombre</label>
                                <input type="text" id="patient-search" class="form-control" placeholder="Nombre del paciente...">
                            </div>
                            <div class="form-group">
                                <label for="patient-specialty"><i class="fas fa-stethoscope"></i> Especialidad médica</label>
                                <select id="patient-specialty" class="form-control">
                                    <option value="">Todas las especialidades</option>
                                    <option value="Cardiología">Cardiología</option>
                                    <option value="Neumología">Neumología</option>
                                    <option value="Endocrinología">Endocrinología</option>
                                    <option value="Neurología">Neurología</option>
                                    <option value="Oncología">Oncología</option>
                                    <option value="Nefrología">Nefrología</option>
                                    <option value="Gastroenterología">Gastroenterología</option>
                                    <option value="Reumatología">Reumatología</option>
                                </select>
                            </div>
                        </div>
                        <div style="margin-top:14px;display:flex;gap:12px;flex-wrap:wrap">
                            <button id="addPatientBtn" class="btn primary">
                                <i class="fas fa-plus"></i> Agregar Nuevo Paciente
                            </button>
                            <button id="exportPatientsBtn" class="btn secondary">
                                <i class="fas fa-file-export"></i> Exportar Pacientes
                            </button>
                        </div>
                        <div id="patients-container"></div>
                    </div>
                </div>
            </main>
        </div>
    </div>
    <!-- Modal para crear/editar pacientes -->
    <div class="modal" id="patientModal">
        <div class="modal-content">
            <button class="close-modal" id="closePatientModal">&times;</button>
            <h2><i class="fas fa-user-plus"></i> <span id="patientModalTitle">Agregar Nuevo Paciente</span></h2>
            <div class="patient-form-container">
                <div class="form-row">
                    <div class="form-group">
                        <label for="modal-patient-name"><i class="fas fa-user"></i> Nombre del Paciente</label>
                        <input type="text" id="modal-patient-name" class="form-control" placeholder="Nombre completo del paciente">
                    </div>
                    <div class="form-group">
                        <label for="modal-patient-age"><i class="fas fa-birthday-cake"></i> Edad</label>
                        <input type="number" id="modal-patient-age" class="form-control" placeholder="Edad en años">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="modal-patient-diagnosis"><i class="fas fa-diagnoses"></i> Diagnóstico Principal</label>
                        <input type="text" id="modal-patient-diagnosis" class="form-control" placeholder="Diagnóstico médico principal">
                    </div>
                    <div class="form-group">
                        <label for="modal-patient-specialty"><i class="fas fa-stethoscope"></i> Especialidad</label>
                        <select id="modal-patient-specialty" class="form-control">
                            <option value="">Seleccionar especialidad...</option>
                            <option value="Cardiología">Cardiología</option>
                            <option value="Neumología">Neumología</option>
                            <option value="Endocrinología">Endocrinología</option>
                            <option value="Neurología">Neurología</option>
                            <option value="Oncología">Oncología</option>
                            <option value="Nefrología">Nefrología</option>
                            <option value="Gastroenterología">Gastroenterología</option>
                            <option value="Reumatología">Reumatología</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label for="modal-patient-allergies"><i class="fas fa-allergies"></i> Alergias</label>
                    <input type="text" id="modal-patient-allergies" class="form-control" placeholder="Lista de alergias separadas por coma">
                </div>
                <div class="form-group">
                    <label for="modal-patient-history"><i class="fas fa-notes-medical"></i> Resumen de Historia Clínica</label>
                    <textarea id="modal-patient-history" class="form-control" placeholder="Resumen de la historia clínica del paciente..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn ghost" id="cancelPatientBtn">Cancelar</button>
                    <button type="button" class="btn primary" id="savePatientBtn">Guardar Paciente</button>
                </div>
            </div>
        </div>
    </div>
    <script>
        // Helper function to get element by ID
        function $(id) {
            return document.getElementById(id);
        }
        // Theme toggle functionality
        const themeToggle = $('themeToggle');
        const html = document.documentElement;
        const themeIcon = themeToggle.querySelector('i');
        // Check for saved theme preference or use preferred color scheme
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme) {
            html.setAttribute('data-theme', savedTheme);
            updateThemeIcon(savedTheme);
        } else if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            html.setAttribute('data-theme', 'dark');
            updateThemeIcon('dark');
        } else {
            updateThemeIcon('light');
        }
        function updateThemeIcon(theme) {
            if (theme === 'dark') {
                themeIcon.className = 'fas fa-sun';
            } else {
                themeIcon.className = 'fas fa-moon';
            }
        }
        themeToggle.addEventListener('click', () => {
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
            updateThemeIcon(newTheme);
        });
        // Mobile menu toggle
        const mobileMenuBtn = $('mobileMenuBtn');
        const sidebar = $('sidebar');
        mobileMenuBtn.addEventListener('click', () => {
            sidebar.classList.toggle('hidden-mobile');
        });
        // Procedimientos de enfermería con fuentes confiables
        const PROCEDURES = {
            higiene: [
                {
                    id: 'lavado_mano',
                    title: 'Lavado de manos',
                    summary: 'Técnica esencial para prevenir infecciones según protocolos de la OMS.',
                    source: 'who',
                    sourceLink: 'https://www.who.int/es/news-room/fact-sheets/detail/hand-hygiene',
                    materials: ['Jabón', 'Agua', 'Toalla desechable', 'Gel alcohólico 70%'],
                    steps: [
                        'Retirar joyas y reloj',
                        'Mojar manos con agua',
                        'Aplicar jabón suficiente',
                        'Frotar palmas, dorsos, entre dedos y pulgares ≥20s',
                        'Enjuagar abundantemente',
                        'Secar con toalla desechable',
                        'Cerrar grifo con toalla'
                    ],
                    notes: 'Crucial antes y después del contacto con paciente. Realice el lavado de manos siguiendo los 7 pasos recomendados por la OMS.'
                },
                {
                    id: 'baño_cama',
                    title: 'Baño en cama',
                    summary: 'Higiene integral del paciente encamado con prevención de lesiones.',
                    source: 'nih',
                    sourceLink: 'https://www.ncbi.nlm.nih.gov/books/NBK560818/',
                    materials: ['Toallas', 'Agua tibia', 'Jabón suave', 'Guantes', 'Sábana impermeable', 'Báscula'],
                    steps: [
                        'Preparar equipo y ambiente',
                        'Explicar procedimiento al paciente',
                        'Proteger intimidad con cortinas',
                        'Colocar sábana impermeable',
                        'Limpiar de proximal a distal',
                        'Secar y vestir',
                        'Cambiar sábana si está húmeda',
                        'Documentar procedimiento'
                    ],
                    notes: 'Evite fricciones excesivas. Revise áreas de riesgo para escaras. Mantenga al paciente abrigado durante el procedimiento.'
                }
            ],
            curaciones: [
                {
                    id: 'curacion_quirurgica',
                    title: 'Curación de herida quirúrgica',
                    summary: 'Técnica aséptica para el cuidado de heridas quirúrgicas.',
                    source: 'cdc',
                    sourceLink: 'https://www.cdc.gov/hai/pdfs/ssi/SSI_guideline-2017.pdf',
                    materials: ['Guantes estériles', 'Gasas estériles', 'Solución salina', 'Antiséptico', 'Apósito', 'Tijeras estériles'],
                    steps: [
                        'Lavado de manos',
                        'Preparar material estéril',
                        'Retirar apósito anterior con cuidado',
                        'Evaluar características de la herida',
                        'Limpiar con solución salina de centro a periferia',
                        'Aplicar antiséptico si es necesario',
                        'Colocar nuevo apósito estéril',
                        'Fijar adecuadamente',
                        'Documentar procedimiento'
                    ],
                    notes: 'Observar signos de infección: enrojecimiento, calor, dolor, edema, secreción purulenta.'
                }
            ],
            farmaco: [
                {
                    id: 'admin_medicamentos',
                    title: 'Administración segura de medicamentos',
                    summary: 'Protocolo de las 5 "R" para la administración segura de medicamentos.',
                    source: 'who',
                    sourceLink: 'https://www.who.int/teams/integrated-health-services/patient-safety/medication-safety',
                    materials: ['Historia clínica', 'Orden médica', 'Medicamento', 'Equipo de administración', 'Guantes'],
                    steps: [
                        'Verificar la identidad del paciente (Nombre y fecha de nacimiento)',
                        'Confirmar el medicamento, dosis, vía, frecuencia y hora',
                        'Revisar alergias e interacciones medicamentosas',
                        'Documentar la administración inmediatamente después de dar el medicamento',
                        'Monitorear efectos terapéuticos y efectos adversos'
                    ],
                    notes: 'Siempre siga el principio de las 5 "R": el paciente correcto, el medicamento correcto, la dosis correcta, la vía correcta y el momento correcto.'
                }
            ],
            emergencias: [
                {
                    id: 'paro_respiratorio',
                    title: 'Manejo de paro respiratorio',
                    summary: 'Protocolo para el manejo inicial del paro respiratorio.',
                    source: 'aha',
                    sourceLink: 'https://www.ahajournals.org/doi/10.1161/CIR.0000000000000982',
                    materials: ['Ambú', 'Máscara facial', 'Oxígeno', 'Equipo de intubación', 'Monitor'],
                    steps: [
                        'Evaluar conciencia y respiración',
                        'Llamar a emergencias y pedir ayuda',
                        'Iniciar ventilación con ambú a 10-12 respiraciones por minuto',
                        'Administrar oxígeno al 100%',
                        'Preparar para intubación si no mejora',
                        'Monitorear saturación de oxígeno y signos vitales'
                    ],
                    notes: 'El paro respiratorio puede progresar rápidamente a paro cardíaco. Actúe rápidamente para asegurar la vía aérea y la ventilación.'
                }
            ],
            movilizacion: [
                {
                    id: 'traslado_cama_silla',
                    title: 'Traslado de cama a silla de ruedas',
                    summary: 'Técnica segura para trasladar pacientes de cama a silla de ruedas.',
                    source: 'ahrq',
                    sourceLink: 'https://www.ahrq.gov/patient-safety/settings/hospital/resource/patientsafetyculture/pscultureosp/chap10.html',
                    materials: ['Silla de ruedas', 'Cinturón de seguridad', 'Colchón antiescaras', 'Guantes'],
                    steps: [
                        'Explicar el procedimiento al paciente',
                        'Frenar la silla de ruedas y colocarla al lado de la cama',
                        'Ayudar al paciente a sentarse en el borde de la cama',
                        'Colocar el cinturón de transferencia',
                        'Usar una técnica de elevación segura para trasladar al paciente',
                        'Asegurar al paciente en la silla con el cinturón',
                        'Documentar el traslado y estado del paciente'
                    ],
                    notes: 'Use equipo de transferencia cuando sea posible. Evite torsiones de la columna. Evalúe la fuerza muscular del paciente antes del traslado.'
                }
            ],
            nutricion: [
                {
                    id: 'alimentacion_paciente',
                    title: 'Alimentación de pacientes con dificultad para tragar',
                    summary: 'Protocolo para alimentar pacientes con disfagia.',
                    source: 'nih',
                    sourceLink: 'https://www.ncbi.nlm.nih.gov/books/NBK545243/',
                    materials: ['Alimentos modificados', 'Utensilios adaptados', 'Toallas', 'Sistema de alimentación enteral si es necesario'],
                    steps: [
                        'Evaluar la capacidad de deglución del paciente',
                        'Colocar al paciente en posición de 90 grados',
                        'Ofrecer pequeñas cantidades de alimento',
                        'Dar tiempo suficiente para masticar y tragar',
                        'Observar signos de aspiración (toser, cambiar de color)',
                        'Registrar la ingesta y tolerancia'
                    ],
                    notes: 'Los pacientes con disfagia tienen alto riesgo de aspiración. Modifique la textura de los alimentos según indicación del logopeda.'
                }
            ],
            infeccion: [
                {
                    id: 'aislamiento_contacto',
                    title: 'Precauciones de aislamiento por contacto',
                    summary: 'Protocolo para prevenir la transmisión de patógenos por contacto.',
                    source: 'cdc',
                    sourceLink: 'https://www.cdc.gov/infectioncontrol/guidelines/isolation/index.html',
                    materials: ['Bata', 'Guantes', 'Mascarilla si hay riesgo de salpicadura', 'Señalización de aislamiento'],
                    steps: [
                        'Usar bata y guantes al entrar en la habitación',
                        'Retirar equipo antes de salir de la habitación',
                        'Realizar higiene de manos inmediatamente después',
                        'Equipos médicos dedicados al paciente',
                        'Limpieza y desinfección frecuente de superficies',
                        'Documentar cumplimiento de precauciones'
                    ],
                    notes: 'Las precauciones por contacto se usan para pacientes con infecciones transmitidas por contacto directo o indirecto (MRSA, C. difficile, etc.).'
                }
            ],
            medicamentos: [
                {
                    id: 'control_medicamentos',
                    title: 'Control de medicamentos de alto riesgo',
                    summary: 'Protocolo para el manejo seguro de medicamentos de alto riesgo.',
                    source: 'ismp',
                    sourceLink: 'https://www.ismp.org/guidelines/high-alert-medications',
                    materials: ['Lista de medicamentos de alto riesgo', 'Protocolos específicos', 'Sistemas de doble verificación'],
                    steps: [
                        'Identificar medicamentos de alto riesgo en el paciente',
                        'Implementar controles adicionales (doble verificación)',
                        'Educación al paciente sobre el medicamento',
                        'Monitoreo estrecho de efectos adversos',
                        'Documentación exhaustiva de la administración',
                        'Revisión farmacéutica regular'
                    ],
                    notes: 'Los medicamentos de alto riesgo incluyen anticoagulantes, insulina, opiáceos, quimioterápicos y muchos otros. Un error puede resultar en daño grave al paciente.'
                }
            ]
        };
        // Enfermedades comunes con fuentes confiables
        const DISEASES = [
            {
                name: 'Neumonía',
                summary: 'Infección inflamatoria aguda del parénquima pulmonar, generalmente bacteriana o viral. Presenta fiebre, tos productiva, disnea y crepitaciones. Cuidados: oxigenoterapia, movilización, antibióticos según guía.',
                source: 'cdc',
                sourceLink: 'https://www.cdc.gov/pneumonia/index.html',
                detailed: {
                    etiologia: 'Bacteriana (Streptococcus pneumoniae), viral (influenza), atípica (Mycoplasma). Factores de riesgo: edad, tabaquismo, enfermedad pulmonar crónica.',
                    sintomas: 'Fiebre, tos productiva, disnea, dolor torácico pleurítico, escalofríos, sudoración nocturna.',
                    diagnostico: 'Radiografía de tórax, análisis de sangre, cultivo de esputo, gasometría arterial en casos graves.',
                    tratamiento: 'Antibióticos empíricos según gravedad, oxigenoterapia, hidratación, fisioterapia respiratoria.',
                    prevencion: 'Vacunación antineumocócica e influenza, abandono del tabaquismo, higiene de manos.'
                }
            },
            {
                name: 'Diabetes Mellitus',
                summary: 'Enfermedad metabólica caracterizada por niveles elevados de glucosa en sangre. Requiere control estricto de glucemia, dieta y medicación.',
                source: 'who',
                sourceLink: 'https://www.who.int/news-room/fact-sheets/detail/diabetes',
                detailed: {
                    etiologia: 'Tipo 1: destrucción autoinmune de células β pancreáticas. Tipo 2: resistencia a la insulina y deficiencia relativa de insulina.',
                    sintomas: 'Poliuria, polidipsia, polifagia, pérdida de peso, visión borrosa, fatiga.',
                    diagnostico: 'Glucemia en ayunas ≥126 mg/dL, hemoglobina glicosilada ≥6.5%, prueba de tolerancia a la glucosa alterada.',
                    tratamiento: 'Dieta, ejercicio, antidiabéticos orales, insulina, monitorización de glucemia.',
                    prevencion: 'Estilo de vida saludable, control de peso, ejercicio regular, dieta equilibrada.'
                }
            },
            {
                name: 'Insuficiencia Cardíaca',
                summary: 'Síndrome clínico causado por una disfunción estructural o funcional del corazón que reduce la capacidad del ventrículo para llenarse o vaciarse de sangre.',
                source: 'aha',
                sourceLink: 'https://www.heart.org/en/health-topics/heart-failure',
                detailed: {
                    etiologia: 'Enfermedad arterial coronaria, infarto de miocardio, hipertensión arterial, miocardiopatías, valvulopatías.',
                    sintomas: 'Disnea, ortopnea, disnea paroxística nocturna, edema periférico, fatiga, tos nocturna.',
                    diagnostico: 'Ecocardiograma, BNP/NT-proBNP, radiografía de tórax, ECG, evaluación funcional.',
                    tratamiento: 'Diuréticos, IECA/ARA-II, betabloqueantes, antagonistas de la aldosterona, dispositivos cardíacos, trasplante.',
                    prevencion: 'Control de factores de riesgo cardiovascular, tratamiento de enfermedades subyacentes, estilo de vida saludable.'
                }
            },
            {
                name: 'Enfermedad Pulmonar Obstructiva Crónica (EPOC)',
                summary: 'Enfermedad inflamatoria crónica de las vías respiratorias que causa obstrucción del flujo de aire desde los pulmones.',
                source: 'gold',
                sourceLink: 'https://goldcopd.org/',
                detailed: {
                    etiologia: 'Tabaquismo (principal causa), contaminación del aire, deficiencia de alfa-1 antitripsina, exposición ocupacional.',
                    sintomas: 'Tos crónica, producción de esputo, disnea progresiva, sibilancias, infecciones respiratorias frecuentes.',
                    diagnostico: 'Espirometría (VFG1/CVF < 0.7 después de broncodilatador), radiografía de tórax, gasometría arterial.',
                    tratamiento: 'Abandono del tabaquismo, broncodilatadores, corticosteroides inhalados, oxigenoterapia, rehabilitación pulmonar.',
                    prevencion: 'Abandono del tabaquismo, vacunación antigripal y antineumocócica, reducción de exposiciones ocupacionales.'
                }
            }
        ];
        // Medicamentos y combinaciones peligrosas con fuentes
        const NEVER_COMBINE = [
            { a: 'warfarina', b: 'ibuprofeno', reason: 'Aumento del riesgo de hemorragia gastrointestinal y sistémica', ref: 'https://www.ncbi.nlm.nih.gov/books/NBK545235/', source: 'nih' },
            { a: 'sertralina', b: 'tramadol', reason: 'Riesgo de síndrome serotoninérgico y convulsiones', ref: 'https://www.ncbi.nlm.nih.gov/books/NBK537237/', source: 'nih' },
            { a: 'omeprazol', b: 'clopidogrel', reason: 'Disminución del efecto antiagregante plaquetario', ref: 'https://www.ncbi.nlm.nih.gov/books/NBK548274/', source: 'nih' },
            { a: 'digoxina', b: 'verapamilo', reason: 'Aumento del riesgo de toxicidad por digoxina', ref: 'https://www.ncbi.nlm.nih.gov/books/NBK558918/', source: 'nih' },
            { a: 'litio', b: 'diuréticos', reason: 'Aumento del riesgo de toxicidad por litio', ref: 'https://www.ncbi.nlm.nih.gov/books/NBK558995/', source: 'nih' }
        ];
        const MEDS = [
            'Warfarina', 'Ibuprofeno', 'Paracetamol', 'Ciprofloxacina', 'Metformina',
            'Sertralina', 'Omeprazol', 'Sildenafil', 'Nitroglicerina', 'Clopidogrel',
            'Atorvastatina', 'Amlodipino', 'Losartán', 'Metoprolol', 'Insulina',
            'Aspirina', 'Tramadol', 'Diazepam', 'Loratadina', 'Amoxicilina'
        ];
        // Recursos educativos con fuentes confiables
        const RECURSOS_EDUCATIVOS = [
            {
                id: 1,
                titulo: 'Guía de Práctica Clínica: Manejo de la Diabetes Tipo 2',
                categoria: 'Protocolos',
                tipo: 'documento',
                url: 'https://www.ncbi.nlm.nih.gov/books/NBK555976/',
                etiquetas: ['diabetes', 'endocrinología', 'protocolo', 'tratamiento'],
                descripcion: 'Guía actualizada basada en evidencia para el manejo integral de la diabetes mellitus tipo 2, incluyendo objetivos terapéuticos, algoritmos de tratamiento y prevención de complicaciones.',
                fuente: 'NIH'
            },
            {
                id: 2,
                titulo: 'Técnicas de Venopunción',
                categoria: 'Videos',
                tipo: 'video',
                url: 'https://www.youtube.com/watch?v=1uR0b4q9PCA',
                etiquetas: ['venopunción', 'técnica', 'video', 'procedimiento'],
                descripcion: 'Video demostrativo de las técnicas adecuadas para la venopunción, incluyendo selección del sitio, preparación del equipo y método para minimizar molestias al paciente.',
                fuente: 'CDC'
            },
            {
                id: 3,
                titulo: 'Manejo de la Insuficiencia Cardíaca',
                categoria: 'Guías',
                tipo: 'documento',
                url: 'https://www.ahajournals.org/doi/10.1161/CIR.0000000000001063',
                etiquetas: ['cardiología', 'insuficiencia cardíaca', 'guía', 'tratamiento'],
                descripcion: 'Guía completa para el manejo de la insuficiencia cardíaca, con algoritmos de tratamiento, estrategias de monitoreo y enfoques de atención multidisciplinaria.',
                fuente: 'AHA'
            },
            {
                id: 4,
                titulo: 'Prevención de Infecciones del Tracto Urinario',
                categoria: 'Protocolos',
                tipo: 'documento',
                url: 'https://www.cdc.gov/hai/pdfs/psi/psi-urinary-tract-infection.pdf',
                etiquetas: ['infección', 'uti', 'prevención', 'cuidado'],
                descripcion: 'Protocolo basado en evidencia para la prevención de infecciones del tracto urinario asociadas a la atención sanitaria, con enfoque en el manejo del catéter urinario.',
                fuente: 'CDC'
            }
        ];
        // Pacientes
        const PATIENTS_KEY = 'enfermeria_david_pacientes';
        const PAE_KEY = 'enfermeria_david_pae';
        const RECURSOS_KEY = 'enfermeria_david_recursos';
        // Funciones de almacenamiento persistente
        function getStoredData(key, defaultValue = []) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : defaultValue;
            } catch (e) {
                console.error('Error reading from localStorage:', e);
                showNotification('Error al cargar datos almacenados. Algunas funciones pueden no estar disponibles.', 'error');
                return defaultValue;
            }
        }
        function setStoredData(key, data) {
            try {
                localStorage.setItem(key, JSON.stringify(data));
                return true;
            } catch (e) {
                console.error('Error writing to localStorage:', e);
                showNotification('Error al guardar datos. Verifique el almacenamiento del navegador.', 'error');
                return false;
            }
        }
        // Obtener datos almacenados o usar datos iniciales
        let PACIENTES = getStoredData(PATIENTS_KEY, [
            {
                id: 1,
                nombre: 'María González',
                edad: 65,
                diagnosticoPrincipal: 'Diabetes mellitus tipo 2',
                especialidad: 'Endocrinología',
                riesgoCardiovascular: 'moderado',
                alergias: ['Penicilina'],
                historiaClinica: {
                    resumen: 'Paciente femenina de 65 años con diabetes tipo 2 diagnosticada hace 10 años. Buen control glucémico actual con metformina y estilo de vida.',
                    diagnosticos: [
                        { fecha: '2023-05-10', cie10: 'E11.9', descripcion: 'Diabetes mellitus tipo 2', estado: 'Activo' },
                        { fecha: '2022-11-15', cie10: 'I10', descripcion: 'Hipertensión esencial', estado: 'Controlado' }
                    ],
                    tratamientos: [
                        { medicamento: 'Metformina', dosis: '850 mg', frecuencia: 'Cada 12 horas', inicio: '2023-05-10' },
                        { medicamento: 'Losartán', dosis: '50 mg', frecuencia: 'Una vez al día', inicio: '2022-11-15' }
                    ],
                    evolucion: [
                        { fecha: '2023-10-20', nota: 'Paciente estable, glucemias en rango objetivo. Refiere adherencia al tratamiento.' }
                    ],
                    signosVitales: [
                        { fecha: '2023-10-20', tensionArterial: '130/80', frecuenciaCardiaca: '72', temperatura: '36.5', saturacionOxigeno: '98%' }
                    ],
                    controles: [
                        { tipo: 'Control diabetes', proximo: '2023-11-20' },
                        { tipo: 'Laboratorio', proximo: '2024-01-15' }
                    ]
                }
            },
            {
                id: 2,
                nombre: 'Juan Pérez',
                edad: 72,
                diagnosticoPrincipal: 'Hipertensión arterial',
                especialidad: 'Cardiología',
                riesgoCardiovascular: 'alto',
                alergias: [],
                historiaClinica: {
                    resumen: 'Paciente masculino de 72 años con hipertensión arterial de 15 años de evolución. EPOC leve asociado. Tabaquismo previo.',
                    diagnosticos: [
                        { fecha: '2018-03-22', cie10: 'I10', descripcion: 'Hipertensión esencial', estado: 'Activo' },
                        { fecha: '2020-08-14', cie10: 'J44.9', descripcion: 'EPOC no especificado', estado: 'Estable' }
                    ],
                    tratamientos: [
                        { medicamento: 'Amlodipino', dosis: '5 mg', frecuencia: 'Una vez al día', inicio: '2018-03-22' },
                        { medicamento: 'Salbutamol', dosis: '100 mcg', frecuencia: 'Según necesidad', inicio: '2020-08-14' }
                    ],
                    evolucion: [
                        { fecha: '2023-10-18', nota: 'Tensión arterial controlada. EPOC estable. Recomendado ejercicio moderado.' }
                    ],
                    signosVitales: [
                        { fecha: '2023-10-18', tensionArterial: '125/75', frecuenciaCardiaca: '68', temperatura: '36.7', saturacionOxigeno: '96%' }
                    ],
                    controles: [
                        { tipo: 'Control hipertensión', proximo: '2023-11-18' },
                        { tipo: 'Espirometría', proximo: '2024-02-01' }
                    ]
                }
            }
        ]);
        let RECURSOS = getStoredData(RECURSOS_KEY, RECURSOS_EDUCATIVOS);
        // Variables globales
        let currentEditingPatientId = null;
        // Content area and functions
        const contentArea = $('contentArea');
        // Modal elements
        const patientModal = $('patientModal');
        const patientModalTitle = $('patientModalTitle');
        const closePatientModalBtn = $('closePatientModal');
        const cancelPatientBtn = $('cancelPatientBtn');
        const savePatientBtn = $('savePatientBtn');
        // Search suggestions
        const searchSuggestions = $('searchSuggestions');
        const globalSearch = $('globalSearch');
        
        // Source mapping for display
        const SOURCES = {
            who: { name: 'OMS', color: '#0099ff', icon: 'fas fa-globe-americas' },
            cdc: { name: 'CDC', color: '#d90429', icon: 'fas fa-shield-alt' },
            aha: { name: 'AHA', color: '#e30613', icon: 'fas fa-heart' },
            nih: { name: 'NIH', color: '#005a9c', icon: 'fas fa-microscope' },
            ismp: { name: 'ISMP', color: '#006400', icon: 'fas fa-check-circle' },
            fda: { name: 'FDA', color: '#d90429', icon: 'fas fa-capsules' },
            gold: { name: 'GOLD', color: '#f9c80e', icon: 'fas fa-lungs' },
            ahrq: { name: 'AHRQ', color: '#0072cf', icon: 'fas fa-hospital' }
        };

        function clearContent() {
            contentArea.innerHTML = '';
            // Remove active state from all buttons
            document.querySelectorAll('.cat-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            // Hide search suggestions
            if (searchSuggestions) {
                searchSuggestions.style.display = 'none';
            }
        }
        
        function getSourceBadge(sourceKey) {
            const source = SOURCES[sourceKey];
            if (!source) return '';
            return `<span class="source-badge ${sourceKey.toLowerCase()}" style="color: ${source.color}; border-color: ${source.color}80;">
                <i class="${source.icon}"></i> ${source.name}
            </span>`;
        }

        function getCatTitle(cat) {
            const titles = {
                'higiene': 'Procedimientos de Higiene Clínica',
                'curaciones': 'Técnicas Avanzadas de Curación',
                'farmaco': 'Farmacología y Administración de Medicamentos',
                'emergencias': 'Manejo de Emergencias Médicas',
                'movilizacion': 'Técnicas de Movilización',
                'nutricion': 'Cuidados Nutricionales',
                'infeccion': 'Control de Infecciones',
                'medicamentos': 'Gestión de Medicamentos',
                'enfermedades': 'Enfermedades y Condiciones',
                'pae': 'Plan de Atención de Enfermería',
                'rcp': 'Reanimación Cardiovascular',
                'calculadoras': 'Calculadoras Clínicas',
                'recursos': 'Recursos Educativos',
                'pacientes': 'Gestión de Pacientes'
            };
            return titles[cat] || cat;
        }
        
        // Enhanced search functionality
        function setupSearch() {
            if (!globalSearch) return;
            
            // Create all searchable items
            const searchItems = [];
            
            // Add procedures
            Object.keys(PROCEDURES).forEach(category => {
                PROCEDURES[category].forEach(proc => {
                    searchItems.push({
                        type: 'procedure',
                        category: category,
                        title: proc.title,
                        summary: proc.summary,
                        content: proc.steps.join(' ') + ' ' + proc.notes,
                        link: `#${category}-${proc.id}`
                    });
                });
            });
            
            // Add diseases
            DISEASES.forEach(disease => {
                searchItems.push({
                    type: 'disease',
                    category: 'enfermedades',
                    title: disease.name,
                    summary: disease.summary,
                    content: Object.values(disease.detailed).join(' '),
                    link: `#enfermedades-${disease.name.toLowerCase().replace(/\s+/g, '-')}`
                });
            });
            
            // Add medications
            MEDS.forEach(med => {
                searchItems.push({
                    type: 'medication',
                    category: 'medicamentos',
                    title: med,
                    summary: `Información sobre ${med}`,
                    content: med,
                    link: `#medicamentos-${med.toLowerCase().replace(/\s+/g, '-')}`
                });
            });
            
            // Add patients
            PACIENTES.forEach(patient => {
                searchItems.push({
                    type: 'patient',
                    category: 'pacientes',
                    title: patient.nombre,
                    summary: `${patient.edad} años, ${patient.diagnosticoPrincipal}`,
                    content: patient.historiaClinica.resumen + ' ' + patient.alergias.join(' '),
                    link: `#pacientes-${patient.id}`
                });
            });
            
            // Add resources
            RECURSOS.forEach(resource => {
                searchItems.push({
                    type: 'resource',
                    category: 'recursos',
                    title: resource.titulo,
                    summary: resource.descripcion,
                    content: resource.etiquetas.join(' ') + ' ' + resource.descripcion,
                    link: resource.url
                });
            });
            
            // Search function
            globalSearch.addEventListener('input', function(e) {
                const query = e.target.value.toLowerCase().trim();
                
                if (query.length === 0) {
                    searchSuggestions.style.display = 'none';
                    return;
                }
                
                // Filter results
                const results = searchItems.filter(item => 
                    item.title.toLowerCase().includes(query) ||
                    item.summary.toLowerCase().includes(query) ||
                    item.content.toLowerCase().includes(query)
                ).slice(0, 8);
                
                if (results.length === 0) {
                    searchSuggestions.style.display = 'none';
                    return;
                }
                
                // Display results
                searchSuggestions.innerHTML = results.map(item => {
                    const icon = item.type === 'procedure' ? 'fa-stethoscope' :
                                item.type === 'disease' ? 'fa-notes-medical' :
                                item.type === 'medication' ? 'fa-pills' :
                                item.type === 'patient' ? 'fa-user' : 'fa-book';
                    
                    return `
                        <div class="suggestion-item" data-link="${item.link}">
                            <div class="suggestion-text">
                                <i class="fas ${icon}"></i>
                                <div>
                                    <div>${item.title}</div>
                                    <div style="font-size: 0.9rem; opacity: 0.8; margin-top: 4px;">${item.summary}</div>
                                </div>
                            </div>
                            <span class="suggestion-category">${item.type}</span>
                        </div>
                    `;
                }).join('');
                
                searchSuggestions.style.display = 'block';
            });
            
            // Handle clicks on suggestions
            searchSuggestions.addEventListener('click', function(e) {
                const item = e.target.closest('.suggestion-item');
                if (item) {
                    const link = item.getAttribute('data-link');
                    const title = item.querySelector('.suggestion-text div:first-child').textContent;
                    
                    // Close suggestions
                    searchSuggestions.style.display = 'none';
                    globalSearch.value = title;
                    
                    // Navigate to the item
                    showNotification(`Buscando: ${title}`, 'info');
                    
                    // Find which category this belongs to and show it
                    const categoryMap = {
                        'procedure': (id) => {
                            const [cat, procId] = id.split('-');
                            showProcedures(cat);
                        },
                        'disease': () => showDiseases(),
                        'medication': () => showMedications(),
                        'patient': () => showPacientes(),
                        'resource': (url) => window.open(url, '_blank')
                    };
                    
                    // Extract category from link
                    if (link.startsWith('#')) {
                        const parts = link.substring(1).split('-');
                        const cat = parts[0];
                        if (cat === 'pacientes') {
                            const patientId = parseInt(parts[1]);
                            showPacientes();
                            // Scroll to patient after a delay
                            setTimeout(() => {
                                const patientCard = document.querySelector(`[data-id="${patientId}"]`);
                                if (patientCard) {
                                    patientCard.scrollIntoView({ behavior: 'smooth' });
                                }
                            }, 300);
                        } else {
                            // Activate the corresponding category button
                            const catBtn = document.querySelector(`.cat-btn[data-cat="${cat}"]`);
                            if (catBtn) {
                                catBtn.click();
                            }
                        }
                    } else {
                        // External link
                        window.open(link, '_blank');
                    }
                }
            });
            
            // Hide suggestions when clicking outside
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.search-container')) {
                    searchSuggestions.style.display = 'none';
                }
            });
        }

        // Show pacientes
        function showPacientes() {
            clearContent();
            // Add active state to the selected button
            document.querySelectorAll('.cat-btn').forEach(btn => {
                if (btn.getAttribute('data-cat') === 'pacientes') {
                    btn.classList.add('active');
                }
            });
            const pacientesHTML = `
                <div class="patient-list" id="pacientes">
                    <h2><i class="fas fa-users"></i> Gestión Integral de Pacientes</h2>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="patient-search"><i class="fas fa-search"></i> Buscar paciente por nombre</label>
                            <input type="text" id="patient-search" class="form-control" placeholder="Nombre del paciente...">
                        </div>
                        <div class="form-group">
                            <label for="patient-specialty"><i class="fas fa-stethoscope"></i> Especialidad médica</label>
                            <select id="patient-specialty" class="form-control">
                                <option value="">Todas las especialidades</option>
                                <option value="Cardiología">Cardiología</option>
                                <option value="Neumología">Neumología</option>
                                <option value="Endocrinología">Endocrinología</option>
                                <option value="Neurología">Neurología</option>
                                <option value="Oncología">Oncología</option>
                                <option value="Nefrología">Nefrología</option>
                                <option value="Gastroenterología">Gastroenterología</option>
                                <option value="Reumatología">Reumatología</option>
                            </select>
                        </div>
                    </div>
                    <div style="margin-top:14px;display:flex;gap:12px;flex-wrap:wrap">
                        <button id="addPatientBtn" class="btn primary">
                            <i class="fas fa-plus"></i> Agregar Nuevo Paciente
                        </button>
                        <button id="exportPatientsBtn" class="btn secondary">
                            <i class="fas fa-file-export"></i> Exportar Pacientes
                        </button>
                    </div>
                    <div id="patients-container"></div>
                </div>
            `;
            contentArea.innerHTML = pacientesHTML;
            // Add event listeners
            const searchInput = $('patient-search');
            const specialtySelect = $('patient-specialty');
            
            if (searchInput) searchInput.addEventListener('input', updatePatientGrid);
            if (specialtySelect) specialtySelect.addEventListener('change', updatePatientGrid);
            
            // Use setTimeout to ensure DOM is ready
            setTimeout(() => {
                const addBtn = $('addPatientBtn');
                const exportBtn = $('exportPatientsBtn');
                if (addBtn) addBtn.addEventListener('click', () => openPatientModal());
                if (exportBtn) exportBtn.addEventListener('click', () => exportPatients());
            }, 100);
            updatePatientGrid();
        }
        
        // Show procedures
        function showProcedures(category) {
            clearContent();
            // Add active state to the selected button
            document.querySelectorAll('.cat-btn').forEach(btn => {
                if (btn.getAttribute('data-cat') === category) {
                    btn.classList.add('active');
                }
            });
            
            const procedures = PROCEDURES[category] || [];
            const categoryTitle = getCatTitle(category);
            
            let html = `<div class="category-card" id="${category}">`;
            html += `<h2><i class="fas fa-stethoscope"></i> ${categoryTitle}</h2>`;
            
            if (procedures.length === 0) {
                html += `<p class="small">No hay procedimientos disponibles para esta categoría.</p>`;
            } else {
                procedures.forEach(proc => {
                    html += `<div class="procedure">`;
                    html += `<h3><i class="fas fa-arrow-right"></i> ${proc.title}</h3>`;
                    if (proc.source) {
                        html += `<div style="margin-bottom: 12px;">${getSourceBadge(proc.source)}</div>`;
                    }
                    html += `<div class="summary"><i class="fas fa-info-circle"></i> ${proc.summary}</div>`;
                    html += `<div class="materials"><h4><i class="fas fa-box"></i> Materiales</h4><ul>`;
                    proc.materials.forEach(mat => {
                        html += `<li>${mat}</li>`;
                    });
                    html += `</ul></div>`;
                    html += `<div class="steps"><h4><i class="fas fa-list-ol"></i> Pasos</h4><ol>`;
                    proc.steps.forEach(step => {
                        html += `<li>${step}</li>`;
                    });
                    html += `</ol></div>`;
                    if (proc.notes) {
                        html += `<div class="notes"><i class="fas fa-sticky-note"></i> ${proc.notes}</div>`;
                    }
                    if (proc.sourceLink) {
                        html += `<div class="source-reference">
                            <i class="fas fa-link"></i> Información verificada en 
                            <a href="${proc.sourceLink}" target="_blank">fuente oficial</a>
                        </div>`;
                    }
                    html += `</div>`;
                });
            }
            html += `</div>`;
            contentArea.innerHTML = html;
        }
        
        // Show diseases
        function showDiseases() {
            clearContent();
            // Add active state to the selected button
            document.querySelectorAll('.cat-btn').forEach(btn => {
                if (btn.getAttribute('data-cat') === 'enfermedades') {
                    btn.classList.add('active');
                }
            });
            
            let html = `<div class="disease-panel" id="enfermedades">`;
            html += `<h2><i class="fas fa-notes-medical"></i> Enfermedades y Condiciones</h2>`;
            
            DISEASES.forEach(disease => {
                html += `<div class="disease-item">`;
                html += `<strong>${disease.name}</strong>`;
                if (disease.source) {
                    html += ` ${getSourceBadge(disease.source)}`;
                }
                html += `<div class="small"><i class="fas fa-info-circle"></i> ${disease.summary}</div>`;
                
                html += `<div class="detailed-info">`;
                html += `<h4><i class="fas fa-book"></i> Detalles Clínicos</h4>`;
                html += `<p><strong>Etiología:</strong> ${disease.detailed.etiologia}</p>`;
                html += `<p><strong>Síntomas:</strong> ${disease.detailed.sintomas}</p>`;
                html += `<p><strong>Diagnóstico:</strong> ${disease.detailed.diagnostico}</p>`;
                html += `<p><strong>Tratamiento:</strong> ${disease.detailed.tratamiento}</p>`;
                html += `<p><strong>Prevención:</strong> ${disease.detailed.prevencion}</p>`;
                html += `</div>`;
                
                if (disease.sourceLink) {
                    html += `<div class="source-reference">
                        <i class="fas fa-link"></i> Información verificada en 
                        <a href="${disease.sourceLink}" target="_blank">fuente oficial</a>
                    </div>`;
                }
                
                html += `</div>`;
            });
            html += `</div>`;
            contentArea.innerHTML = html;
        }
        
        // Show medications
        function showMedications() {
            clearContent();
            // Add active state to the selected button
            document.querySelectorAll('.cat-btn').forEach(btn => {
                if (btn.getAttribute('data-cat') === 'medicamentos') {
                    btn.classList.add('active');
                }
            });
            
            let html = `<div class="med-combo" id="medicamentos">`;
            html += `<h2><i class="fas fa-pills"></i> Medicamentos y Combinaciones</h2>`;
            html += `<p class="small">Lista de medicamentos comunes y combinaciones peligrosas basadas en evidencia científica.</p>`;
            
            // Medication list
            html += `<div class="category-card" style="margin-top: 24px;">`;
            html += `<h3><i class="fas fa-prescription-bottle-alt"></i> Medicamentos Comunes</h3>`;
            html += `<div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 16px; margin-top: 16px;">`;
            MEDS.forEach(med => {
                html += `<div style="background: var(--glass-2); padding: 12px; border-radius: 12px; text-align: center; border: 1px solid var(--border-light);">
                    ${med}
                </div>`;
            });
            html += `</div></div>`;
            
            // Dangerous combinations
            html += `<div class="interactions-warning danger" style="margin-top: 24px;">`;
            html += `<i class="fas fa-exclamation-triangle"></i>`;
            html += `<div>`;
            html += `<h3>Combinaciones Medicamentosas Peligrosas</h3>`;
            html += `<p>Estas combinaciones están contraindicadas debido al alto riesgo de efectos adversos graves:</p>`;
            html += `<ul class="interactions-list">`;
            NEVER_COMBINE.forEach(combo => {
                html += `<li>${combo.a} + ${combo.b}: ${combo.reason} ${getSourceBadge(combo.source)}</li>`;
            });
            html += `</ul>`;
            html += `<div class="source-reference" style="margin-top: 12px;">
                <i class="fas fa-link"></i> Información basada en evidencia de 
                <a href="https://www.ncbi.nlm.nih.gov/books/NBK538287/" target="_blank">NIH</a>
            </div>`;
            html += `</div></div>`;
            
            html += `</div>`;
            contentArea.innerHTML = html;
        }
        
        // Show resources
        function showResources() {
            clearContent();
            // Add active state to the selected button
            document.querySelectorAll('.cat-btn').forEach(btn => {
                if (btn.getAttribute('data-cat') === 'recursos') {
                    btn.classList.add('active');
                }
            });
            
            let html = `<div class="resource-panel" id="recursos">`;
            html += `<h2><i class="fas fa-book"></i> Recursos Educativos</h2>`;
            html += `<p class="small">Recursos confiables y actualizados para la práctica clínica basada en evidencia.</p>`;
            
            RECURSOS.forEach(resource => {
                html += `<div class="resource-card">`;
                html += `<h3><i class="fas fa-file-alt"></i> ${resource.titulo}</h3>`;
                html += `<p><i class="fas fa-tags"></i> Categoría: ${resource.categoria}</p>`;
                html += `<p><i class="fas fa-link"></i> Fuente: ${resource.fuente}</p>`;
                html += `<p><i class="fas fa-info-circle"></i> ${resource.descripcion}</p>`;
                html += `<a href="${resource.url}" target="_blank" class="btn small">
                    <i class="fas fa-external-link-alt"></i> Acceder al recurso
                </a>`;
                html += `</div>`;
            });
            html += `</div>`;
            contentArea.innerHTML = html;
        }

        // Update patient grid
        function updatePatientGrid() {
            const container = $('patients-container');
            if (!container) return;
            const search = ($('patient-search') ? $('patient-search').value : '').toLowerCase();
            const specialty = ($('patient-specialty') ? $('patient-specialty').value : '');
            const filteredPatients = PACIENTES.filter(p => {
                const matchesSearch = !search || 
                    p.nombre.toLowerCase().includes(search) || 
                    p.diagnosticoPrincipal.toLowerCase().includes(search);
                const matchesSpecialty = !specialty || p.especialidad === specialty;
                return matchesSearch && matchesSpecialty;
            });
            if (filteredPatients.length === 0) {
                container.innerHTML = '<p class="small">No se encontraron pacientes que coincidan con los criterios de búsqueda.</p>';
                return;
            }
            container.innerHTML = filteredPatients.map(p => 
                `<div class="patient-card" data-id="${p.id}">
                    <h3><i class="fas fa-user"></i> ${p.nombre}</h3>
                    <p><i class="fas fa-birthday-cake"></i> Edad: ${p.edad} años</p>
                    <p><i class="fas fa-diagnoses"></i> Diagnóstico: ${p.diagnosticoPrincipal}</p>
                    <p><i class="fas fa-stethoscope"></i> Especialidad: ${p.especialidad}</p>
                    <p><i class="fas fa-heartbeat"></i> Riesgo cardiovascular: ${p.riesgoCardiovascular}</p>
                    <p><i class="fas fa-allergies"></i> Alergias: ${p.alergias.length > 0 ? p.alergias.join(', ') : 'Ninguna registrada'}</p>
                    <div class="detailed-info" style="margin-top:12px;">
                        <h4><i class="fas fa-notes-medical"></i> Información Clínica</h4>
                        <p><strong>Resumen:</strong> ${p.historiaClinica.resumen}</p>
                        <p><strong>Diagnosticos:</strong> ${p.historiaClinica.diagnosticos.map(d => d.descripcion).join(', ')}</p>
                        <p><strong>Tratamientos:</strong> ${p.historiaClinica.tratamientos.map(t => t.medicamento).join(', ')}</p>
                        <p><strong>Próximos controles:</strong> ${p.historiaClinica.controles.map(c => c.tipo + ' (' + c.proximo + ')').join(', ')}</p>
                    </div>
                    <div style="margin-top:16px; display:flex; gap:10px;">
                        <button class="btn small edit-patient" data-id="${p.id}">
                            <i class="fas fa-edit"></i> Editar
                        </button>
                        <button class="btn small ghost delete-patient" data-id="${p.id}">
                            <i class="fas fa-trash"></i> Eliminar
                        </button>
                    </div>
                </div>`
            ).join('');
            // Add event listeners to edit buttons
            document.querySelectorAll('.edit-patient').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const patientId = parseInt(btn.getAttribute('data-id'));
                    openPatientModal(patientId);
                });
            });
            // Add event listeners to delete buttons
            document.querySelectorAll('.delete-patient').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const patientId = parseInt(btn.getAttribute('data-id'));
                    deletePatient(patientId);
                });
            });
        }
        // Export patients
        function exportPatients() {
            if (PACIENTES.length === 0) {
                showNotification('No hay pacientes para exportar', 'error');
                return;
            }
            const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(PACIENTES, null, 2));
            const downloadAnchorNode = document.createElement('a');
            downloadAnchorNode.setAttribute("href", dataStr);
            downloadAnchorNode.setAttribute("download", "pacientes_enfermeria_david.json");
            document.body.appendChild(downloadAnchorNode);
            downloadAnchorNode.click();
            downloadAnchorNode.remove();
            showNotification('Pacientes exportados correctamente', 'success');
        }
        // Modal functions
        function openPatientModal(patientId = null) {
            currentEditingPatientId = patientId;
            if (patientId) {
                // Editing existing patient
                const patient = PACIENTES.find(p => p.id === patientId);
                if (patient) {
                    patientModalTitle.textContent = 'Editar Paciente';
                    $('modal-patient-name').value = patient.nombre;
                    $('modal-patient-age').value = patient.edad;
                    $('modal-patient-diagnosis').value = patient.diagnosticoPrincipal;
                    $('modal-patient-specialty').value = patient.especialidad;
                    $('modal-patient-allergies').value = patient.alergias.join(', ');
                    $('modal-patient-history').value = patient.historiaClinica.resumen;
                }
            } else {
                // Adding new patient
                patientModalTitle.textContent = 'Agregar Nuevo Paciente';
                $('modal-patient-name').value = '';
                $('modal-patient-age').value = '';
                $('modal-patient-diagnosis').value = '';
                $('modal-patient-specialty').value = '';
                $('modal-patient-allergies').value = '';
                $('modal-patient-history').value = '';
            }
            patientModal.style.display = 'block';
        }
        function closePatientModal() {
            patientModal.style.display = 'none';
            currentEditingPatientId = null;
        }
        function savePatient() {
            const name = $('modal-patient-name').value.trim();
            const ageInput = $('modal-patient-age').value.trim();
            const diagnosis = $('modal-patient-diagnosis').value.trim();
            const specialty = $('modal-patient-specialty').value;
            const allergies = $('modal-patient-allergies').value.split(',').map(a => a.trim()).filter(a => a);
            const history = $('modal-patient-history').value.trim();
            // Validación mejorada
            if (!name || !ageInput || !diagnosis || !specialty) {
                showNotification('Por favor, complete todos los campos obligatorios', 'error');
                return;
            }
            const age = parseInt(ageInput);
            if (isNaN(age) || age <= 0 || age > 150) {
                showNotification('La edad debe ser un número válido entre 1 y 150', 'error');
                return;
            }
            if (currentEditingPatientId) {
                // Editar paciente existente
                const patientIndex = PACIENTES.findIndex(p => p.id === currentEditingPatientId);
                if (patientIndex !== -1) {
                    PACIENTES[patientIndex] = {
                        ...PACIENTES[patientIndex],
                        nombre: name,
                        edad: age,
                        diagnosticoPrincipal: diagnosis,
                        especialidad: specialty,
                        alergias: allergies,
                        historiaClinica: {
                            ...PACIENTES[patientIndex].historiaClinica,
                            resumen: history
                        }
                    };
                    if (setStoredData(PATIENTS_KEY, PACIENTES)) {
                        showNotification('✅ Paciente actualizado con éxito', 'success');
                    }
                }
            } else {
                // Nuevo paciente
                const newId = PACIENTES.length > 0 ? Math.max(...PACIENTES.map(p => p.id)) + 1 : 1;
                const newPatient = {
                    id: newId,
                    nombre: name,
                    edad: age,
                    diagnosticoPrincipal: diagnosis,
                    especialidad: specialty,
                    riesgoCardiovascular: 'moderado',
                    alergias: allergies,
                    historiaClinica: {
                        resumen: history,
                        diagnosticos: [
                            {
                                fecha: new Date().toISOString().split('T')[0],
                                cie10: 'XX.X',
                                descripcion: diagnosis,
                                estado: 'Activo'
                            }
                        ],
                        tratamientos: [],
                        evolucion: [
                            {
                                fecha: new Date().toISOString().split('T')[0],
                                nota: 'Paciente agregado al sistema.'
                            }
                        ],
                        signosVitales: [],
                        controles: []
                    }
                };
                PACIENTES.push(newPatient);
                if (setStoredData(PATIENTS_KEY, PACIENTES)) {
                    showNotification('✅ Paciente agregado con éxito', 'success');
                }
            }
            updatePatientGrid();
            closePatientModal();
        }
        function deletePatient(patientId) {
            if (confirm('¿Está seguro de que desea eliminar este paciente? Esta acción no se puede deshacer.')) {
                PACIENTES = PACIENTES.filter(p => p.id !== patientId);
                if (setStoredData(PATIENTS_KEY, PACIENTES)) {
                    showNotification('Paciente eliminado correctamente', 'success');
                    updatePatientGrid();
                }
            }
        }
        // Modal event listeners
        closePatientModalBtn.addEventListener('click', closePatientModal);
        cancelPatientBtn.addEventListener('click', closePatientModal);
        savePatientBtn.addEventListener('click', savePatient);
        // Close modal when clicking outside
        window.addEventListener('click', (e) => {
            if (e.target === patientModal) {
                closePatientModal();
            }
        });
        // Notification system
        function showNotification(message, type = 'info') {
            // Create notification container if it doesn't exist
            let container = document.getElementById('notification-container');
            if (!container) {
                container = document.createElement('div');
                container.id = 'notification-container';
                container.style.cssText = `
                    position: fixed;
                    top: 24px;
                    right: 24px;
                    z-index: 1000;
                    display: flex;
                    flex-direction: column;
                    gap: 12px;
                    max-width: 400px;
                `;
                document.body.appendChild(container);
            }
            const notification = document.createElement('div');
            notification.className = `notification notification-${type}`;
            notification.innerHTML = `
                <div class="notification-icon">
                    ${type === 'success' ? '<i class="fas fa-check-circle"></i>' : 
                      type === 'error' ? '<i class="fas fa-exclamation-triangle"></i>' : 
                      type === 'warning' ? '<i class="fas fa-exclamation-triangle"></i>' : 
                      '<i class="fas fa-info-circle"></i>'}
                </div>
                <div class="notification-message">${message}</div>
                <button class="notification-close" onclick="this.parentElement.remove()">
                    <i class="fas fa-times"></i>
                </button>
            `;
            container.appendChild(notification);
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (notification.parentNode) {
                    notification.remove();
                }
            }, 5000);
        }
        // Event listeners for category buttons
        document.querySelectorAll('.cat-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const cat = btn.getAttribute('data-cat');
                if (cat === 'pacientes') {
                    showPacientes();
                } else if (cat === 'enfermedades') {
                    showDiseases();
                } else if (cat === 'medicamentos') {
                    showMedications();
                } else if (cat === 'recursos') {
                    showResources();
                } else if (PROCEDURES[cat]) {
                    showProcedures(cat);
                } else {
                    showNotification(`Función ${getCatTitle(cat)} en desarrollo`, 'info');
                }
                // En móviles, ocultar el menú después de seleccionar una opción
                if (window.innerWidth <= 768) {
                    sidebar.classList.add('hidden-mobile');
                }
            });
        });
        // Initialize app
        document.addEventListener('DOMContentLoaded', () => {
            // Verificar si localStorage está disponible
            try {
                localStorage.setItem('test', 'test');
                localStorage.removeItem('test');
                showNotification('💾 Almacenamiento local disponible', 'success');
            } catch (e) {
                showNotification('⚠️ No se puede usar localStorage. Revise permisos del navegador.', 'error');
            }
            // Set initial state - show patients by default
            showPacientes();
            // Setup search functionality
            setupSearch();
            // Reasignar eventos críticos por seguridad
            setTimeout(() => {
                const addBtn = $('addPatientBtn');
                const saveBtn = $('savePatientBtn');
                const cancelBtn = $('cancelPatientBtn');
                const closeBtn = $('closePatientModal');
                if (addBtn && !addBtn.onclick) {
                    addBtn.addEventListener('click', () => openPatientModal());
                }
                if (saveBtn && !saveBtn.onclick) {
                    saveBtn.addEventListener('click', savePatient);
                }
                if (cancelBtn && !cancelBtn.onclick) {
                    cancelBtn.addEventListener('click', closePatientModal);
                }
                if (closeBtn && !closeBtn.onclick) {
                    closeBtn.addEventListener('click', closePatientModal);
                }
            }, 500);
        });
    </script>
</body>
</html>
